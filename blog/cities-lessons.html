<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Learn English through exploring cities and urban environments. Master city vocabulary, prepositions of place, and cultural differences in urban planning."
    />
    <meta
      name="keywords"
      content="ESL, English learning, city vocabulary, urban English, prepositions, cultural studies"
    />
    <meta name="author" content="ESL Fun Online" />
    <meta
      property="og:title"
      content="Cities & Urban Life - ESL English Lesson"
    />
    <meta
      property="og:description"
      content="Interactive English lesson exploring city vocabulary, prepositions of place, and urban culture worldwide."
    />
    <meta property="og:type" content="educational" />
    <meta property="og:image" content="../images/education-4382169_1280.jpg" />
    <title>
      Cities & Urban Life - Interactive ESL English Lesson | ESL Fun Online
    </title>

    <!-- Preload critical resources -->
    <link rel="preload" href="../css/main.css" as="style" />
    <link rel="preload" href="../js/main.js" as="script" />

    <!-- External resources -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "LearningResource",
        "name": "Cities & Urban Life - ESL English Lesson",
        "description": "Interactive English lesson for learning city vocabulary and urban expressions",
        "educationalLevel": "Intermediate",
        "learningResourceType": "Interactive Lesson",
        "teaches": [
          "City Vocabulary",
          "Prepositions of Place",
          "Urban Culture",
          "Descriptive Language"
        ],
        "inLanguage": "en",
        "provider": {
          "@type": "Organization",
          "name": "ESL Fun Online"
        }
      }
    </script>
    <style>
      /* CSS Variables for consistency with design system */
      :root {
        --primary-color: #46bbe5;
        --primary-hover: #05425c;
        --secondary-color: #10b981;
        --accent-color: #f59e0b;
        --success-color: #10b981;
        --error-color: #ef4444;
        --warning-color: #f59e0b;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --text-inverse: #ffffff;
        --bg-primary: #ffffff;
        --bg-secondary: #f9fafb;
        --bg-overlay: rgba(0, 0, 0, 0.5);
        --border-color: #e5e7eb;
        --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        --radius: 0.5rem;
        --radius-lg: 1rem;
        --radius-xl: 1.5rem;
        --transition: 0.3s ease;
        --font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-brand: "Poppins", sans-serif;
      }

      /* Dark mode support */
      .dark-mode {
        --text-primary: #f9fafb;
        --text-secondary: #d1d5db;
        --text-inverse: #1f2937;
        --bg-primary: #1f2937;
        --bg-secondary: #111827;
        --border-color: #374151;
        --bg-overlay: rgba(0, 0, 0, 0.7);
      }

      /* Reset and base styles */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: var(--font-family);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: var(--text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        transition: background-color var(--transition), color var(--transition);
      }

      /* Skip link for accessibility */
      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: var(--primary-color);
        color: var(--text-inverse);
        padding: 0.5rem 1rem;
        text-decoration: none;
        border-radius: var(--radius);
        z-index: 1000;
        font-weight: 600;
        transition: top 0.15s ease;
      }

      .skip-link:focus {
        top: 6px;
      }

      /* Progress indicator */
      .progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 0%;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        z-index: 1000;
        transition: width 0.2s ease;
      }

      /* Improved header */
      .header {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        padding: 3rem 2rem;
        text-align: center;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 1px,
          transparent 1px
        );
        background-size: 50px 50px;
        animation: backgroundMove 20s linear infinite;
        opacity: 0.3;
      }

      @keyframes backgroundMove {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(50px, 50px);
        }
      }

      .header-content {
        position: relative;
        z-index: 2;
        max-width: 800px;
        margin: 0 auto;
      }

      .header h1 {
        color: white;
        font-family: var(--font-brand);
        font-size: clamp(2rem, 6vw, 3.5rem);
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        font-weight: 700;
      }

      .header .subtitle {
        color: rgba(255, 255, 255, 0.95);
        font-size: clamp(1rem, 3vw, 1.3rem);
        font-weight: 500;
        max-width: 600px;
        margin: 0 auto;
      }

      /* Container improvements */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      @media (min-width: 768px) {
        .container {
          padding: 2rem;
        }
      }

      /* Enhanced sections */
      .section {
        background: var(--bg-primary);
        border-radius: var(--radius-xl);
        padding: 2.5rem;
        margin: 2rem 0;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
        animation: slideUp 0.6s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        opacity: 0.8;
      }

      .intro-section::before {
        background: linear-gradient(90deg, #667eea, #764ba2);
      }
      .vocab-section::before {
        background: linear-gradient(90deg, #00b894, #00cec9);
      }
      .activity-section::before {
        background: linear-gradient(90deg, #e84393, #fd79a8);
      }
      .game-section::before {
        background: linear-gradient(90deg, #a29bfe, #6c5ce7);
      }
      .review-section::before {
        background: linear-gradient(90deg, #fdcb6e, #f39c12);
      }

      .lesson-topic {
        background: linear-gradient(45deg, #74b9ff, #0984e3);
        border-radius: var(--radius-xl);
        padding: 2.5rem;
        margin: 2rem 0;
        text-align: center;
        box-shadow: var(--shadow-lg);
        color: white;
        position: relative;
        overflow: hidden;
      }

      .lesson-topic::after {
        content: "🎯";
        position: absolute;
        top: -20px;
        right: -20px;
        font-size: 6rem;
        opacity: 0.1;
        transform: rotate(15deg);
      }

      /* Improved vocabulary cards */
      .vocab-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .vocab-card {
        background: linear-gradient(45deg, #fdcb6e, #ffeaa7);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        text-align: center;
        transition: all var(--transition);
        cursor: pointer;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }

      .vocab-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s ease;
      }

      .vocab-card:hover::before {
        left: 100%;
      }

      .vocab-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
      }

      .vocab-card:focus {
        outline: 3px solid var(--primary-color);
        outline-offset: 2px;
      }

      .vocab-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      .vocab-card h3 {
        font-family: var(--font-brand);
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .vocab-card p {
        font-size: 0.95rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }

      /* Enhanced audio button */
      .audio-button {
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 25px;
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition);
        box-shadow: var(--shadow-sm);
      }

      .audio-button:hover {
        background: var(--primary-hover);
        transform: scale(1.05);
        box-shadow: var(--shadow-md);
      }

      .audio-button:focus {
        outline: 3px solid rgba(70, 187, 229, 0.3);
        outline-offset: 2px;
      }

      .audio-button.playing {
        background: var(--success-color);
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
        100% {
          opacity: 1;
        }
      }

      /* Enhanced preposition exercise */
      .preposition-exercise {
        background: linear-gradient(135deg, #f1f3f4, #e8eaf0);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin: 2rem 0;
        border: 2px solid var(--border-color);
      }

      .preposition-exercise input[type="text"] {
        border: 2px solid var(--primary-color);
        border-radius: var(--radius);
        padding: 0.6rem 1rem;
        margin: 0 0.5rem;
        font-size: 1rem;
        font-family: var(--font-family);
        transition: all var(--transition);
        min-width: 120px;
      }

      .preposition-exercise input[type="text"]:focus {
        outline: none;
        border-color: var(--primary-hover);
        box-shadow: 0 0 0 3px rgba(70, 187, 229, 0.2);
        transform: scale(1.05);
      }

      .preposition-exercise input[type="text"].correct {
        border-color: var(--success-color);
        background: rgba(16, 185, 129, 0.1);
      }

      .preposition-exercise input[type="text"].incorrect {
        border-color: var(--error-color);
        background: rgba(239, 68, 68, 0.1);
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-5px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(5px);
        }
      }

      /* Improved buttons */
      .btn {
        background: linear-gradient(45deg, var(--primary-color), #0984e3);
        color: white;
        border: none;
        border-radius: var(--radius);
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin: 0.5rem;
        transition: all var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        font-family: var(--font-family);
        box-shadow: var(--shadow-sm);
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn:hover {
        background: linear-gradient(45deg, var(--primary-hover), #0652dd);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .btn:focus {
        outline: 3px solid rgba(70, 187, 229, 0.3);
        outline-offset: 2px;
      }

      .btn:active {
        transform: translateY(0);
      }

      /* Enhanced quiz styling */
      .quiz-container {
        background: var(--bg-primary);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin: 1.5rem 0;
        box-shadow: var(--shadow-md);
        border: 2px solid var(--border-color);
        position: relative;
      }

      .quiz-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
        margin: 1.5rem 0;
      }

      .quiz-btn {
        background: linear-gradient(45deg, #74b9ff, #0984e3);
        color: white;
        border: none;
        border-radius: var(--radius);
        padding: 1rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition);
        text-align: center;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow-sm);
      }

      .quiz-btn:hover:not(:disabled) {
        background: linear-gradient(45deg, #0984e3, #0652dd);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .quiz-btn:focus {
        outline: 3px solid rgba(70, 187, 229, 0.3);
        outline-offset: 2px;
      }

      .quiz-btn.correct {
        background: linear-gradient(45deg, var(--success-color), #059669);
        animation: correctAnswer 0.6s ease-out;
      }

      .quiz-btn.incorrect {
        background: linear-gradient(45deg, var(--error-color), #dc2626);
        animation: incorrectAnswer 0.6s ease-out;
      }

      @keyframes correctAnswer {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes incorrectAnswer {
        0% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
        100% {
          transform: translateX(0);
        }
      }

      .quiz-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        pointer-events: none;
      }

      /* Enhanced city patterns */
      .city-pattern {
        display: inline-block;
        width: 120px;
        height: 120px;
        margin: 1rem;
        border-radius: var(--radius-lg);
        position: relative;
        box-shadow: var(--shadow-md);
        transition: all var(--transition);
      }

      .city-pattern:hover {
        transform: scale(1.05);
        box-shadow: var(--shadow-lg);
      }

      .city-manhattan {
        background: linear-gradient(to top, #4ecdc4 0%, #44a08d 100%);
        background-image: linear-gradient(90deg, #333 2px, transparent 2px),
          linear-gradient(180deg, #333 2px, transparent 2px);
        background-size: 20px 20px;
      }

      .city-paris {
        background: linear-gradient(to top, #ffeaa7 0%, #fdcb6e 100%);
        position: relative;
      }

      .city-paris::after {
        content: "🗼";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 3rem;
        animation: tower 3s ease-in-out infinite;
      }

      @keyframes tower {
        0%,
        100% {
          transform: translate(-50%, -50%) scale(1);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.1);
        }
      }

      .city-tokyo {
        background: linear-gradient(to top, #ff7675 0%, #fd79a8 100%);
        background-image: radial-gradient(circle, #fff 2px, transparent 2px);
        background-size: 15px 15px;
      }

      /* Enhanced listening exercise */
      .listening-exercise {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin: 1.5rem 0;
        border: 2px solid var(--primary-color);
        position: relative;
      }

      .listening-exercise::before {
        content: "🎧";
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 2rem;
        opacity: 0.3;
      }

      /* Enhanced grammar and cultural boxes */
      .grammar-box,
      .cultural-note {
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin: 1.5rem 0;
        position: relative;
        box-shadow: var(--shadow-sm);
      }

      .grammar-box {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        border-left: 4px solid #2196f3;
      }

      .cultural-note {
        background: linear-gradient(135deg, #fff3e0, #ffe0b2);
        border-left: 4px solid #ff9800;
      }

      .grammar-box::before {
        content: "📚";
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        opacity: 0.5;
      }

      .cultural-note::before {
        content: "🌍";
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        opacity: 0.5;
      }

      /* Enhanced skill highlights */
      .skill-highlight {
        background: linear-gradient(135deg, #dff9fb, #b2f5ea);
        border: 2px solid #00cec9;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin: 1.5rem 0;
        font-weight: 600;
        position: relative;
        box-shadow: var(--shadow-sm);
      }

      .skill-highlight::before {
        content: "⭐";
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
      }

      /* Enhanced wrap-up section */
      .wrap-up {
        background: linear-gradient(45deg, #fd79a8, #fdcb6e);
        border-radius: var(--radius-xl);
        padding: 3rem 2rem;
        margin: 3rem 0;
        color: white;
        text-align: center;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .wrap-up::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 1px,
          transparent 1px
        );
        background-size: 30px 30px;
        animation: backgroundMove 15s linear infinite reverse;
      }

      .wrap-up-content {
        position: relative;
        z-index: 2;
      }

      /* Typography improvements */
      h2 {
        color: var(--text-primary);
        font-family: var(--font-brand);
        font-size: clamp(1.5rem, 4vw, 2.2rem);
        margin-bottom: 1.2rem;
        font-weight: 700;
      }

      h3 {
        color: var(--text-secondary);
        font-family: var(--font-brand);
        font-size: clamp(1.2rem, 3vw, 1.6rem);
        margin-bottom: 1rem;
        font-weight: 600;
      }

      p {
        font-size: 1.1rem;
        line-height: 1.7;
        margin-bottom: 1rem;
        color: var(--text-primary);
      }

      /* Responsive improvements */
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }

        .section {
          padding: 1.5rem;
          margin: 1rem 0;
        }

        .header {
          padding: 2rem 1rem;
        }

        .vocab-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .quiz-options {
          grid-template-columns: 1fr;
          gap: 0.8rem;
        }

        .quiz-btn {
          padding: 1.2rem;
          font-size: 1rem;
        }

        .city-pattern {
          width: 100px;
          height: 100px;
          margin: 0.5rem;
        }

        .preposition-exercise input[type="text"] {
          display: block;
          margin: 0.5rem auto;
          width: 200px;
          text-align: center;
        }
      }

      /* Print styles */
      @media print {
        .audio-button,
        .btn,
        .quiz-btn {
          display: none;
        }

        .section {
          break-inside: avoid;
          box-shadow: none;
          border: 1px solid #000;
        }

        body {
          background: white !important;
          color: black !important;
        }
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Focus management for keyboard users */
      .quiz-result {
        padding: 1rem;
        margin-top: 1rem;
        border-radius: var(--radius);
        font-weight: 600;
      }

      .quiz-result.success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid var(--success-color);
        color: var(--success-color);
      }

      .quiz-result.error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--error-color);
        color: var(--error-color);
      }

      /* Loading states */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px;
        border: 2px solid var(--primary-color);
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
      <link rel="canonical" href="https://eslfunonline.com/blog/cities-lessons.html" />\n  </head>
  <body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Progress indicator -->
    <div
      class="progress-bar"
      id="progressBar"
      role="progressbar"
      aria-label="Reading progress"
    ></div>

    <!-- Theme toggle (consistent with main site) -->
    <button
      id="themeToggle"
      class="theme-toggle"
      aria-label="Toggle dark mode"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      "
    >
      <i class="fas fa-moon" aria-hidden="true"></i>
    </button>

    <header class="header" role="banner">
      <div class="header-content">
        <h1>🏙️ Cities & Urban Life 🏙️</h1>
        <p class="subtitle">
          English Through Urban Exploration: Cities, Culture & Communication
        </p>
      </div>
    </header>

    <main id="main-content" class="container" role="main">
      <section class="intro-section section" aria-labelledby="intro-heading">
        <h2 id="intro-heading">Welcome to Urban English Adventure! 🌆</h2>
        <p>
          Today we're exploring the dynamic world of cities! You'll master
          vocabulary for describing urban environments, learn to use
          prepositions of place, and discover how cities reflect different
          cultures worldwide. From skyscrapers to street markets, get ready to
          navigate city life in English!
        </p>
        <div
          class="skill-highlight"
          role="note"
          aria-label="Learning objectives"
        >
          <strong>Learning Goals:</strong> Master city vocabulary • Practice
          prepositions of place • Develop descriptive language • Explore urban
          cultures
        </div>

        <!-- Learning progress tracker -->
        <div class="learning-tracker" style="margin-top: 1.5rem">
          <p><strong>Your Progress:</strong></p>
          <div
            style="
              background: #e5e7eb;
              border-radius: 10px;
              overflow: hidden;
              margin: 0.5rem 0;
            "
          >
            <div
              id="learningProgress"
              style="
                background: linear-gradient(
                  90deg,
                  var(--primary-color),
                  var(--secondary-color)
                );
                height: 10px;
                width: 0%;
                transition: width 0.5s ease;
              "
              aria-label="Learning progress"
            ></div>
          </div>
          <div
            id="progressText"
            style="font-size: 0.9rem; color: var(--text-secondary)"
          >
            Ready to start learning! 🚀
          </div>
        </div>
      </section>

      <section class="lesson-topic" aria-labelledby="lesson-focus">
        <h2 id="lesson-focus">
          🎯 Today's Focus: Urban Vocabulary & Descriptions
        </h2>
        <p>
          Learn essential city vocabulary, practice describing locations using
          prepositions, and explore cultural differences in urban planning and
          city life.
        </p>
      </section>

      <section class="vocab-section section" aria-labelledby="vocab-heading">
        <h2 id="vocab-heading">🔊 Vocabulary & Listening</h2>
        <p><strong>Listen and repeat these essential city terms:</strong></p>

        <div class="vocab-grid" role="grid" aria-label="City vocabulary cards">
          <div
            class="vocab-card"
            onclick="playAudio('skyscraper')"
            onkeydown="handleCardKeydown(event, 'skyscraper')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about skyscraper"
          >
            <div class="vocab-icon" aria-hidden="true">🏢</div>
            <h3>SKYSCRAPER</h3>
            <p>Very tall building in city center</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of skyscraper"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('subway')"
            onkeydown="handleCardKeydown(event, 'subway')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about subway"
          >
            <div class="vocab-icon" aria-hidden="true">🚇</div>
            <h3>SUBWAY</h3>
            <p>Underground train system</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of subway"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('crosswalk')"
            onkeydown="handleCardKeydown(event, 'crosswalk')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about crosswalk"
          >
            <div class="vocab-icon" aria-hidden="true">🚶‍♀️</div>
            <h3>CROSSWALK</h3>
            <p>Safe place to cross the street</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of crosswalk"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('downtown')"
            onkeydown="handleCardKeydown(event, 'downtown')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about downtown"
          >
            <div class="vocab-icon" aria-hidden="true">🏙️</div>
            <h3>DOWNTOWN</h3>
            <p>Central business district of city</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of downtown"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('intersection')"
            onkeydown="handleCardKeydown(event, 'intersection')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about intersection"
          >
            <div class="vocab-icon" aria-hidden="true">✖️</div>
            <h3>INTERSECTION</h3>
            <p>Where two streets meet</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of intersection"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('boulevard')"
            onkeydown="handleCardKeydown(event, 'boulevard')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about boulevard"
          >
            <div class="vocab-icon" aria-hidden="true">🛣️</div>
            <h3>BOULEVARD</h3>
            <p>Wide street, often with trees</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of boulevard"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('plaza')"
            onkeydown="handleCardKeydown(event, 'plaza')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about plaza"
          >
            <div class="vocab-icon" aria-hidden="true">⛲</div>
            <h3>PLAZA</h3>
            <p>Open public square in city</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of plaza"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
          <div
            class="vocab-card"
            onclick="playAudio('district')"
            onkeydown="handleCardKeydown(event, 'district')"
            role="gridcell"
            tabindex="0"
            aria-label="Learn about district"
          >
            <div class="vocab-icon" aria-hidden="true">🗺️</div>
            <h3>DISTRICT</h3>
            <p>Specific area or neighborhood</p>
            <button
              class="audio-button"
              aria-label="Listen to pronunciation of district"
            >
              <i class="fas fa-volume-up" aria-hidden="true"></i> Listen
            </button>
          </div>
        </div>

        <div
          class="preposition-exercise"
          aria-labelledby="prep-exercise-heading"
        >
          <h3 id="prep-exercise-heading">📝 Prepositions of Place Practice</h3>
          <p>Complete the sentences with the correct prepositions:</p>
          <form id="prepositionForm" aria-label="Preposition exercise">
            <div style="margin: 1.5rem 0; font-size: 1.1rem; line-height: 2.5">
              <label for="prep1">1. The bank is</label>
              <input
                type="text"
                id="prep1"
                aria-label="Enter preposition for sentence 1"
                autocomplete="off"
                spellcheck="false"
              />
              <span>the corner of Main Street.</span><br />

              <label for="prep2">2. There's a coffee shop</label>
              <input
                type="text"
                id="prep2"
                aria-label="Enter preposition for sentence 2"
                autocomplete="off"
                spellcheck="false"
              />
              <span>the library and the post office.</span><br />

              <label for="prep3">3. The subway station is</label>
              <input
                type="text"
                id="prep3"
                aria-label="Enter preposition for sentence 3"
                autocomplete="off"
                spellcheck="false"
              />
              <span>the street from the mall.</span><br />

              <label for="prep4">4. You can find the museum</label>
              <input
                type="text"
                id="prep4"
                aria-label="Enter preposition for sentence 4"
                autocomplete="off"
                spellcheck="false"
              />
              <span>the city center.</span><br />

              <label for="prep5">5. The park is located</label>
              <input
                type="text"
                id="prep5"
                aria-label="Enter preposition for sentence 5"
                autocomplete="off"
                spellcheck="false"
              />
              <span>the downtown area.</span>
            </div>
            <button
              type="button"
              class="btn"
              onclick="checkPrepositions()"
              aria-describedby="prep-result"
            >
              <i class="fas fa-check" aria-hidden="true"></i> Check Answers
            </button>
          </form>
          <div
            id="prep-result"
            aria-live="polite"
            class="quiz-result"
            style="display: none"
          ></div>
        </div>
      </section>

      <section
        class="activity-section section"
        aria-labelledby="activity-heading"
      >
        <h2 id="activity-heading">🎧 Listening Activity: City Navigation</h2>
        <p>
          <strong
            >Listen for directional language and location descriptions.</strong
          >
          You'll hear someone giving directions through a city center.
        </p>

        <div
          class="listening-exercise"
          role="region"
          aria-labelledby="listening-heading"
        >
          <h3 id="listening-heading">🔊 Audio Directions</h3>
          <button
            class="btn"
            onclick="playDirections()"
            aria-describedby="directions-transcript"
          >
            <i class="fas fa-play" aria-hidden="true"></i> Play City Directions
          </button>
          <div
            id="directions-transcript"
            style="
              display: none;
              margin-top: 1rem;
              background: var(--bg-secondary);
              padding: 1.5rem;
              border-radius: var(--radius);
              border: 2px solid var(--border-color);
            "
            aria-live="polite"
          ></div>
        </div>

        <div class="grammar-box" role="note" aria-labelledby="grammar-heading">
          <h3 id="grammar-heading">
            📚 Grammar Focus: Prepositions & Location Language
          </h3>
          <div>
            <h4>Prepositions of Place:</h4>
            <p>
              <strong>Common prepositions:</strong> on, in, at, between, across
              from, next to, behind
            </p>
            <p>
              <em>Examples:</em> "The store is on Fifth Avenue." "Meet me at the
              intersection." "The café is between the bank and the pharmacy."
            </p>

            <h4>Directional Language:</h4>
            <p>
              <strong>Giving directions:</strong> go straight, turn left/right,
              head north/south
            </p>
            <p>
              <em>Examples:</em> "Go straight for two blocks, then turn left at
              the traffic light."
            </p>
          </div>
        </div>

        <div
          class="cultural-note"
          role="note"
          aria-labelledby="cultural-heading"
        >
          <h3 id="cultural-heading">🌍 Urban Planning Across Cultures</h3>
          <p>
            Notice how different cities organize their spaces: American cities
            often have grid systems, European cities have historic centers with
            winding streets, and Asian cities blend modern districts with
            traditional neighborhoods.
          </p>
        </div>
      </section>

      <section class="game-section section" aria-labelledby="quiz-heading">
        <h2 id="quiz-heading">🎮 Interactive Quizzes: Cities Challenge</h2>

        <!-- Cities from Above Quiz -->
        <div
          class="quiz-container"
          role="region"
          aria-labelledby="aerial-quiz-heading"
        >
          <h3 id="aerial-quiz-heading">🛰️ Cities from Above Challenge</h3>
          <p>Can you identify these famous cities from their aerial views?</p>

          <div id="aerial-quiz" aria-live="polite">
            <div style="text-align: center">
              <div
                id="city-pattern"
                class="city-pattern city-manhattan"
                role="img"
                aria-label="Aerial view pattern of a city with grid layout"
              ></div>
              <p>
                <strong>Question 1:</strong> This city is famous for its grid
                pattern and tall buildings. Which city is it?
              </p>

              <div
                class="quiz-options"
                role="group"
                aria-label="Answer choices for aerial quiz"
              >
                <button
                  class="quiz-btn"
                  onclick="answerAerial(1, 'manhattan', this)"
                  aria-describedby="aerial-result-1"
                >
                  Manhattan, NYC
                </button>
                <button
                  class="quiz-btn"
                  onclick="answerAerial(1, 'chicago', this)"
                  aria-describedby="aerial-result-1"
                >
                  Chicago
                </button>
                <button
                  class="quiz-btn"
                  onclick="answerAerial(1, 'toronto', this)"
                  aria-describedby="aerial-result-1"
                >
                  Toronto
                </button>
                <button
                  class="quiz-btn"
                  onclick="answerAerial(1, 'boston', this)"
                  aria-describedby="aerial-result-1"
                >
                  Boston
                </button>
              </div>
              <div
                id="aerial-result-1"
                aria-live="polite"
                class="quiz-result"
                style="display: none"
              ></div>
            </div>
          </div>

          <button class="btn" onclick="nextAerialQuestion()" id="nextAerialBtn">
            <i class="fas fa-arrow-right" aria-hidden="true"></i> Next City
          </button>
        </div>

        <!-- City Features Quiz -->
        <div
          class="quiz-container"
          style="margin-top: 2rem"
          role="region"
          aria-labelledby="features-quiz-heading"
        >
          <h3 id="features-quiz-heading">🏛️ City Features Quiz</h3>
          <p>Match the description with the correct city feature:</p>

          <div id="features-quiz" aria-live="polite">
            <p>
              <strong>Question:</strong> "A large open area in the city center
              where people gather for events and markets."
            </p>
            <div
              class="quiz-options"
              role="group"
              aria-label="Answer choices for features quiz"
            >
              <button
                class="quiz-btn"
                onclick="answerFeature('plaza', this)"
                aria-describedby="feature-result"
              >
                Plaza/Square
              </button>
              <button
                class="quiz-btn"
                onclick="answerFeature('boulevard', this)"
                aria-describedby="feature-result"
              >
                Boulevard
              </button>
              <button
                class="quiz-btn"
                onclick="answerFeature('district', this)"
                aria-describedby="feature-result"
              >
                District
              </button>
              <button
                class="quiz-btn"
                onclick="answerFeature('intersection', this)"
                aria-describedby="feature-result"
              >
                Intersection
              </button>
            </div>
            <div
              id="feature-result"
              aria-live="polite"
              class="quiz-result"
              style="display: none"
            ></div>
          </div>

          <button
            class="btn"
            onclick="nextFeatureQuestion()"
            id="nextFeatureBtn"
          >
            <i class="fas fa-arrow-right" aria-hidden="true"></i> Next Question
          </button>
        </div>
      </section>

      <section class="review-section section" aria-labelledby="review-heading">
        <h2 id="review-heading">📋 Reading & Writing: Urban Descriptions</h2>
        <p>
          <strong>Describing urban environments</strong> - Let's review the
          language patterns we learned:
        </p>

        <div class="grammar-box" role="note" aria-labelledby="patterns-heading">
          <h3 id="patterns-heading">Key Language Patterns:</h3>
          <div>
            <h4>Location Descriptions:</h4>
            <ul style="margin: 1rem 0; padding-left: 2rem">
              <li>"The [building] is located [preposition] [landmark]"</li>
              <li>"You can find [place] [preposition] [street/area]"</li>
            </ul>

            <h4>Giving Directions:</h4>
            <ul style="margin: 1rem 0; padding-left: 2rem">
              <li>Start with landmarks: "From the subway station..."</li>
              <li>Use sequence: "First... then... finally..."</li>
              <li>Be specific: "two blocks," "at the second traffic light"</li>
            </ul>
          </div>
        </div>

        <div
          class="skill-highlight"
          role="note"
          aria-label="Speaking practice tip"
        >
          <strong>Speaking Practice:</strong> Now you can describe your
          neighborhood and give directions using proper prepositions and city
          vocabulary!
        </div>

        <div
          class="cultural-note"
          role="note"
          aria-labelledby="cultural-differences-heading"
        >
          <h3 id="cultural-differences-heading">
            🌏 Cultural Urban Differences
          </h3>
          <p>
            Cities reflect their cultures: Japanese cities often have small,
            specialized shops; European cities preserve historic architecture;
            American cities typically separate residential and commercial areas.
          </p>
        </div>
      </section>

      <section class="wrap-up" aria-labelledby="conclusion-heading">
        <div class="wrap-up-content">
          <h2 id="conclusion-heading">
            🎉 Outstanding Work, Urban Explorers! 🎉
          </h2>
          <p>
            You've successfully navigated the language of cities! You can now
            describe locations, give directions, and understand how urban
            environments vary across cultures.
          </p>
          <p>
            <strong>Next lesson:</strong> We'll dive into "Technology and Daily
            Life" - exploring how digital tools shape modern communication!
          </p>
          <p>
            Practice describing your own city using today's vocabulary - every
            street corner is a chance to use English! 🌟
          </p>

          <!-- Final progress update -->
          <div
            style="
              margin-top: 2rem;
              padding: 1rem;
              background: rgba(255, 255, 255, 0.2);
              border-radius: var(--radius);
              backdrop-filter: blur(10px);
            "
          >
            <p><strong>🏆 Lesson Complete!</strong></p>
            <p>
              You've mastered city vocabulary, prepositions, and cultural
              understanding. Great job! 🎓
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- Load main site JavaScript -->
    <script src="../js/main.js" defer></script>

    <script>
      // Enhanced lesson functionality with improved error handling and accessibility

      // Progress tracking variables
      let lessonProgress = {
        vocabListened: new Set(),
        exerciseCompleted: false,
        quizzesCompleted: 0,
        totalQuizzes: 2,
      };

      // Quiz state variables
      let currentAerialQuestion = 1;
      let currentFeatureQuestion = 1;
      let aerialScore = 0;
      let featureScore = 0;
      let audioContext = null;

      // Quiz data with enhanced structure
      const aerialQuestions = [
        {
          pattern: "city-manhattan",
          description:
            "This city is famous for its grid pattern and tall buildings. Which city is it?",
          options: ["Manhattan, NYC", "Chicago", "Toronto", "Boston"],
          correct: "manhattan",
          ariaLabel:
            "Aerial view pattern of Manhattan with grid layout and tall buildings",
        },
        {
          pattern: "city-paris",
          description:
            "This European capital is known for its iconic tower and radial street pattern. Which city is it?",
          options: ["London", "Paris", "Rome", "Berlin"],
          correct: "paris",
          ariaLabel: "Aerial view pattern of Paris with iconic Eiffel Tower",
        },
        {
          pattern: "city-tokyo",
          description:
            "This Asian megacity has a dense urban pattern with mixed traditional and modern areas. Which city is it?",
          options: ["Seoul", "Tokyo", "Bangkok", "Singapore"],
          correct: "tokyo",
          ariaLabel:
            "Aerial view pattern of Tokyo with dense mixed development",
        },
      ];

      const featureQuestions = [
        {
          question:
            "A large open area in the city center where people gather for events and markets.",
          options: ["Plaza/Square", "Boulevard", "District", "Intersection"],
          correct: "plaza",
        },
        {
          question:
            "A wide street, usually lined with trees and important buildings.",
          options: ["Crosswalk", "Boulevard", "Subway", "Plaza"],
          correct: "boulevard",
        },
        {
          question:
            "A specific area of the city known for particular activities or characteristics.",
          options: ["Intersection", "Crosswalk", "District", "Skyscraper"],
          correct: "district",
        },
      ];

      // Initialize Web Audio API for better audio feedback
      function initializeAudio() {
        try {
          audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          console.log("Audio context initialized successfully");
        } catch (error) {
          console.warn("Web Audio API not supported:", error);
        }
      }

      // Enhanced audio feedback with visual indicators
      function playAudio(word) {
        const audioButton = event.target
          .closest(".vocab-card")
          .querySelector(".audio-button");

        // Add playing state
        audioButton.classList.add("playing");

        // Simulate audio playback (in real implementation, use Web Audio API or HTML5 audio)
        console.log(`Playing audio for: ${word}`);

        // Update progress tracking
        lessonProgress.vocabListened.add(word);
        updateProgressBar();

        // Provide visual feedback
        showNotification(
          `🔊 Playing pronunciation: ${word.toUpperCase()}`,
          "info"
        );

        // Remove playing state after simulation
        setTimeout(() => {
          audioButton.classList.remove("playing");
        }, 1500);

        // Announce to screen readers
        announceToScreenReader(`Playing pronunciation of ${word}`);
      }

      // Enhanced keyboard support for vocab cards
      function handleCardKeydown(event, word) {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          playAudio(word);
        }
      }

      // Enhanced preposition checking with detailed feedback
      function checkPrepositions() {
        const answers = {
          prep1: ["on", "at"],
          prep2: ["between"],
          prep3: ["across", "across from"],
          prep4: ["in"],
          prep5: ["outside", "outside of"],
        };

        let correct = 0;
        let totalQuestions = Object.keys(answers).length;
        let feedback =
          '<h4>Results:</h4><ul style="list-style: none; padding: 0;">';

        for (let qid in answers) {
          const input = document.getElementById(qid);
          const userAnswer = input.value.toLowerCase().trim();
          const correctAnswers = answers[qid];
          const questionNum = qid.slice(4);

          if (correctAnswers.some((answer) => userAnswer === answer)) {
            input.classList.remove("incorrect");
            input.classList.add("correct");
            feedback += `<li style="color: var(--success-color); margin: 0.5rem 0;"><i class="fas fa-check-circle" aria-hidden="true"></i> Question ${questionNum}: Correct! ✨</li>`;
            correct++;
          } else {
            input.classList.remove("correct");
            input.classList.add("incorrect");
            feedback += `<li style="color: var(--error-color); margin: 0.5rem 0;"><i class="fas fa-times-circle" aria-hidden="true"></i> Question ${questionNum}: Try "${correctAnswers[0]}" 🤔</li>`;
          }
        }

        const percentage = Math.round((correct / totalQuestions) * 100);
        feedback += `</ul><div style="margin-top: 1.5rem; padding: 1rem; background: ${
          percentage >= 70
            ? "rgba(16, 185, 129, 0.1)"
            : "rgba(245, 158, 11, 0.1)"
        }; border-radius: var(--radius); text-align: center;">`;
        feedback += `<p style="font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem;">Score: ${correct}/${totalQuestions} (${percentage}%)</p>`;

        if (percentage === 100) {
          feedback += `<p style="color: var(--success-color);">🎉 Perfect! You've mastered prepositions of place!</p>`;
        } else if (percentage >= 70) {
          feedback += `<p style="color: var(--success-color);">✅ Great job! Keep practicing to perfect your skills.</p>`;
        } else {
          feedback += `<p style="color: var(--warning-color);">📖 Review the grammar section and try again!</p>`;
        }
        feedback += `</div>`;

        const resultDiv = document.getElementById("prep-result");
        resultDiv.innerHTML = feedback;
        resultDiv.style.display = "block";
        resultDiv.className =
          percentage >= 70 ? "quiz-result success" : "quiz-result";

        // Update progress
        if (percentage >= 70) {
          lessonProgress.exerciseCompleted = true;
          updateProgressBar();
          showNotification("🎯 Preposition exercise completed!", "success");
        }

        // Announce result to screen readers
        announceToScreenReader(
          `Exercise completed. You scored ${correct} out of ${totalQuestions}.`
        );

        // Focus management
        resultDiv.focus();
      }

      // Enhanced directions playback with transcript
      function playDirections() {
        const transcript = `
                <h4>🎧 City Navigation Instructions:</h4>
                <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius); margin: 1rem 0; border: 2px solid var(--primary-color);">
                    <p style="line-height: 2; font-size: 1.1rem;">
                        <strong>Listen carefully:</strong><br>
                        "Start at the subway station on Main Street. Go straight for three blocks until you reach the intersection with Oak Avenue. Turn right at the traffic light. The museum will be on your left, next to the large plaza. It's across from the shopping district, between the old courthouse and the modern art gallery."
                    </p>
                </div>
                <div style="background: rgba(70, 187, 229, 0.1); padding: 1rem; border-radius: var(--radius); margin: 1rem 0;">
                    <p style="font-style: italic; color: var(--primary-hover);">
                        <i class="fas fa-lightbulb" aria-hidden="true"></i> 
                        <strong>Learning tip:</strong> Pay attention to the prepositions and sequence words used in these directions!
                    </p>
                </div>
                <div style="margin-top: 1rem;">
                    <h5>Key Vocabulary Used:</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; margin: 0.5rem 0;">
                        <span style="background: var(--primary-light); padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.9rem;">subway station</span>
                        <span style="background: var(--primary-light); padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.9rem;">intersection</span>
                        <span style="background: var(--primary-light); padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.9rem;">plaza</span>
                        <span style="background: var(--primary-light); padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.9rem;">district</span>
                    </div>
                </div>
            `;

        const transcriptDiv = document.getElementById("directions-transcript");
        transcriptDiv.innerHTML = transcript;
        transcriptDiv.style.display = "block";

        // Simulate audio playback
        showNotification("🎧 Playing city navigation audio...", "info");
        announceToScreenReader("Playing city navigation directions");

        // Focus management
        transcriptDiv.focus();
      }

      // Enhanced aerial quiz with better error handling
      function answerAerial(questionNum, answer, button) {
        const question = aerialQuestions[questionNum - 1];
        const resultDiv = document.getElementById(
          `aerial-result-${questionNum}`
        );

        // Disable all buttons for this question
        const buttons = button.parentElement.querySelectorAll(".quiz-btn");
        buttons.forEach((btn) => {
          btn.disabled = true;
          btn.setAttribute("aria-disabled", "true");
        });

        let isCorrect = answer === question.correct;

        if (isCorrect) {
          button.classList.add("correct");
          aerialScore++;
          resultDiv.innerHTML = `<div style="color: var(--success-color); margin-top: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--radius); text-align: center;">
                    <i class="fas fa-check-circle" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <p style="font-weight: bold;">🎉 Excellent! You identified the city correctly!</p>
                    <p>Great eye for urban planning patterns!</p>
                </div>`;
          showNotification("🎯 Correct answer!", "success");
        } else {
          button.classList.add("incorrect");
          // Show correct answer
          buttons.forEach((btn) => {
            if (btn.onclick.toString().includes(question.correct)) {
              btn.classList.add("correct");
            }
          });
          resultDiv.innerHTML = `<div style="color: var(--error-color); margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius); text-align: center;">
                    <i class="fas fa-info-circle" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <p style="font-weight: bold;">Not quite right, but great try! 🤔</p>
                    <p>The correct answer is highlighted in green above.</p>
                </div>`;
          showNotification(
            "Keep trying! The correct answer is highlighted.",
            "info"
          );
        }

        resultDiv.style.display = "block";

        // Announce result to screen readers
        const resultText = isCorrect
          ? "Correct answer!"
          : `Incorrect. The correct answer was ${question.options.find((opt) =>
              opt.toLowerCase().includes(question.correct)
            )}`;
        announceToScreenReader(resultText);

        // Focus management
        resultDiv.focus();
      }

      // Enhanced next aerial question function
      function nextAerialQuestion() {
        if (currentAerialQuestion < aerialQuestions.length) {
          currentAerialQuestion++;
          loadAerialQuestion();
        } else {
          completeAerialQuiz();
        }
      }

      // Load aerial question with enhanced accessibility
      function loadAerialQuestion() {
        const question = aerialQuestions[currentAerialQuestion - 1];
        const quiz = document.getElementById("aerial-quiz");

        quiz.innerHTML = `
                <div style="text-align: center;">
                    <div class="city-pattern ${
                      question.pattern
                    }" role="img" aria-label="${question.ariaLabel}"></div>
                    <p><strong>Question ${currentAerialQuestion}:</strong> ${
          question.description
        }</p>
                    
                    <div class="quiz-options" role="group" aria-label="Answer choices for question ${currentAerialQuestion}">
                        ${question.options
                          .map(
                            (option, index) =>
                              `<button class="quiz-btn" onclick="answerAerial(${currentAerialQuestion}, '${question.correct}', this)" aria-describedby="aerial-result-${currentAerialQuestion}">${option}</button>`
                          )
                          .join("")}
                    </div>
                    <div id="aerial-result-${currentAerialQuestion}" aria-live="polite" class="quiz-result" style="display: none;"></div>
                </div>
            `;
      }

      // Complete aerial quiz with celebration
      function completeAerialQuiz() {
        const percentage = Math.round(
          (aerialScore / aerialQuestions.length) * 100
        );
        document.getElementById("aerial-quiz").innerHTML = `
                <div style="background: linear-gradient(45deg, var(--success-color), #059669); color: white; border-radius: var(--radius-lg); padding: 2rem; text-align: center; box-shadow: var(--shadow-lg);">
                    <i class="fas fa-trophy" style="font-size: 3rem; margin-bottom: 1rem; color: #ffd700;"></i>
                    <h4 style="font-size: 1.5rem; margin-bottom: 1rem;">🎉 Aerial Quiz Complete!</h4>
                    <p style="font-size: 1.2rem; margin-bottom: 1rem;"><strong>Final Score: ${aerialScore}/${
          aerialQuestions.length
        } (${percentage}%)</strong></p>
                    <p>${
                      percentage === 100
                        ? "Perfect! You're a master of urban geography!"
                        : percentage >= 70
                        ? "Excellent work recognizing city patterns!"
                        : "Good effort! Keep exploring different cities!"
                    }</p>
                </div>
            `;

        document.getElementById("nextAerialBtn").style.display = "none";
        lessonProgress.quizzesCompleted++;
        updateProgressBar();
        showNotification("🏆 Aerial quiz completed!", "success");
      }

      // Similar enhancements for feature quiz functions
      function answerFeature(answer, button) {
        const question = featureQuestions[currentFeatureQuestion - 1];
        const resultDiv = document.getElementById("feature-result");

        // Disable all buttons
        const buttons = button.parentElement.querySelectorAll(".quiz-btn");
        buttons.forEach((btn) => {
          btn.disabled = true;
          btn.setAttribute("aria-disabled", "true");
        });

        let isCorrect = answer === question.correct;

        if (isCorrect) {
          button.classList.add("correct");
          featureScore++;
          resultDiv.innerHTML = `<div style="color: var(--success-color); margin-top: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--radius); text-align: center;">
                    <i class="fas fa-check-circle" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <p style="font-weight: bold;">✨ Perfect! You understand city vocabulary!</p>
                </div>`;
          showNotification("🎯 Correct!", "success");
        } else {
          button.classList.add("incorrect");
          // Show correct answer
          buttons.forEach((btn) => {
            if (btn.onclick.toString().includes(question.correct)) {
              btn.classList.add("correct");
            }
          });
          resultDiv.innerHTML = `<div style="color: var(--warning-color); margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: var(--radius); text-align: center;">
                    <i class="fas fa-info-circle" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <p style="font-weight: bold;">Close! The correct answer is highlighted above.</p>
                </div>`;
          showNotification(
            "The correct answer is highlighted in green.",
            "info"
          );
        }

        resultDiv.style.display = "block";
        resultDiv.focus();
      }

      function nextFeatureQuestion() {
        if (currentFeatureQuestion < featureQuestions.length) {
          currentFeatureQuestion++;
          loadFeatureQuestion();
        } else {
          completeFeatureQuiz();
        }
      }

      function loadFeatureQuestion() {
        const question = featureQuestions[currentFeatureQuestion - 1];
        const quiz = document.getElementById("features-quiz");

        quiz.innerHTML = `
                <p><strong>Question ${currentFeatureQuestion}:</strong> "${
          question.question
        }"</p>
                <div class="quiz-options" role="group" aria-label="Answer choices for question ${currentFeatureQuestion}">
                    ${question.options
                      .map(
                        (option) =>
                          `<button class="quiz-btn" onclick="answerFeature('${
                            option.toLowerCase().split("/")[0]
                          }', this)" aria-describedby="feature-result">${option}</button>`
                      )
                      .join("")}
                </div>
                <div id="feature-result" aria-live="polite" class="quiz-result" style="display: none;"></div>
            `;
      }

      function completeFeatureQuiz() {
        const percentage = Math.round(
          (featureScore / featureQuestions.length) * 100
        );
        document.getElementById("features-quiz").innerHTML = `
                <div style="background: linear-gradient(45deg, #6c5ce7, #a29bfe); color: white; border-radius: var(--radius-lg); padding: 2rem; text-align: center; box-shadow: var(--shadow-lg);">
                    <i class="fas fa-medal" style="font-size: 3rem; margin-bottom: 1rem; color: #ffd700;"></i>
                    <h4 style="font-size: 1.5rem; margin-bottom: 1rem;">🎉 Features Quiz Complete!</h4>
                    <p style="font-size: 1.2rem; margin-bottom: 1rem;"><strong>Final Score: ${featureScore}/${
          featureQuestions.length
        } (${percentage}%)</strong></p>
                    <p>${
                      percentage === 100
                        ? "Outstanding! You've mastered city vocabulary!"
                        : percentage >= 70
                        ? "Excellent! You're ready to explore any urban environment!"
                        : "Great job! Keep building your city vocabulary!"
                    }</p>
                </div>
            `;

        document.getElementById("nextFeatureBtn").style.display = "none";
        lessonProgress.quizzesCompleted++;
        updateProgressBar();
        showNotification("🎖️ Feature quiz completed!", "success");
      }

      // Progress tracking functions
      function updateProgressBar() {
        const totalVocab = 8;
        const vocabProgress = lessonProgress.vocabListened.size / totalVocab;
        const exerciseProgress = lessonProgress.exerciseCompleted ? 1 : 0;
        const quizProgress =
          lessonProgress.quizzesCompleted / lessonProgress.totalQuizzes;

        // Weight the different components
        const overall =
          vocabProgress * 0.4 + exerciseProgress * 0.3 + quizProgress * 0.3;
        const percentage = Math.round(overall * 100);

        // Update learning progress bar
        const learningProgressBar = document.getElementById("learningProgress");
        if (learningProgressBar) {
          learningProgressBar.style.width = percentage + "%";
        }

        // Update page progress bar
        const progressBar = document.getElementById("progressBar");
        if (progressBar) {
          progressBar.style.width = percentage + "%";
        }

        // Update progress text
        const progressText = document.getElementById("progressText");
        if (progressText) {
          if (percentage === 100) {
            progressText.textContent =
              "🎉 Congratulations! Lesson completed! 🎓";
            progressText.style.color = "var(--success-color)";
            progressText.style.fontWeight = "bold";
          } else if (percentage >= 75) {
            progressText.textContent = `🌟 Almost there! ${percentage}% complete`;
            progressText.style.color = "var(--warning-color)";
          } else if (percentage >= 50) {
            progressText.textContent = `🚀 Great progress! ${percentage}% complete`;
            progressText.style.color = "var(--primary-color)";
          } else if (percentage > 0) {
            progressText.textContent = `📖 Getting started! ${percentage}% complete`;
            progressText.style.color = "var(--text-secondary)";
          } else {
            progressText.textContent = "Ready to start learning! 🚀";
          }
        }
      }

      // Notification system
      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.className = "notification";
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000;
                padding: 1rem 1.5rem;
                border-radius: var(--radius);
                color: white;
                font-weight: 600;
                box-shadow: var(--shadow-lg);
                opacity: 0;
                transition: all 0.3s ease;
                background: ${
                  type === "success"
                    ? "var(--success-color)"
                    : type === "error"
                    ? "var(--error-color)"
                    : "var(--primary-color)"
                };
            `;
        notification.textContent = message;

        document.body.appendChild(notification);

        // Animate in
        setTimeout(() => {
          notification.style.opacity = "1";
          notification.style.transform = "translateX(-50%) translateY(10px)";
        }, 100);

        // Remove after delay
        setTimeout(() => {
          notification.style.opacity = "0";
          notification.style.transform = "translateX(-50%) translateY(-10px)";
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      // Screen reader announcements
      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("aria-live", "polite");
        announcement.setAttribute("aria-atomic", "true");
        announcement.style.cssText =
          "position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;";
        announcement.textContent = message;

        document.body.appendChild(announcement);

        setTimeout(() => {
          if (announcement.parentNode) {
            announcement.parentNode.removeChild(announcement);
          }
        }, 1000);
      }

      // Initialize page functionality
      function initializePage() {
        // Initialize audio context
        initializeAudio();

        // Set up scroll progress tracking
        window.addEventListener(
          "scroll",
          function () {
            const scrolled =
              (window.scrollY /
                (document.body.scrollHeight - window.innerHeight)) *
              100;
            const progressBar = document.getElementById("progressBar");
            if (progressBar) {
              progressBar.style.width = Math.min(scrolled, 100) + "%";
            }
          },
          { passive: true }
        );

        // Initialize first quiz questions
        loadAerialQuestion();
        loadFeatureQuestion();

        // Set up theme toggle integration
        const themeToggle = document.getElementById("themeToggle");
        if (themeToggle && window.ESL && window.ESL.ThemeManager) {
          themeToggle.addEventListener("click", function () {
            window.ESL.ThemeManager.toggleTheme();
          });
        }

        // Focus trap for modals (if any)
        setupFocusManagement();

        // Initialize progress tracking
        updateProgressBar();

        // Welcome message
        setTimeout(() => {
          showNotification("🌆 Welcome to Cities & Urban Life lesson!", "info");
        }, 1000);
      }

      // Focus management for accessibility
      function setupFocusManagement() {
        // Add focus indicators for quiz elements
        document.addEventListener("keydown", function (e) {
          if (e.key === "Tab") {
            document.body.classList.add("keyboard-navigation");
          }
        });

        document.addEventListener("mousedown", function () {
          document.body.classList.remove("keyboard-navigation");
        });
      }

      // Error handling
      window.addEventListener("error", function (e) {
        console.error("Lesson error:", e.error);
        showNotification(
          "⚠️ Something went wrong. Please refresh the page.",
          "error"
        );
      });

      // Initialize when page loads
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializePage);
      } else {
        initializePage();
      }

      // Add CSS for keyboard navigation
      const keyboardStyles = document.createElement("style");
      keyboardStyles.textContent = `
            .keyboard-navigation *:focus {
                outline: 3px solid var(--primary-color) !important;
                outline-offset: 2px !important;
            }
        `;
      document.head.appendChild(keyboardStyles);
    </script>
  </body>
</html>
