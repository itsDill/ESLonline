<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Learn Japanese basics with interactive flashcards. Master hiragana, katakana, kanji, and essential Japanese vocabulary with our engaging learning tool."
    />
    <meta
      name="keywords"
      content="Japanese flashcards, learn Japanese, hiragana, katakana, kanji, Japanese vocabulary, Japanese language learning"
    />
    <meta name="author" content="ESL Fun Online" />
    <title>
      Japanese Basics Flashcards | ESL Fun Online - Learn Japanese Interactive
    </title>
        <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon-48x48.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="../images/favicon-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="../images/favicon-512x512.png" />

    <!-- Header -->
    <header>
      <div class="container">
        <nav class="navbar">
          <a href="../index.html" class="logo-container">
            <img
              src="../images/1.png"
              alt="ESL Fun Online Logo"
              class="logo-image"
              width="40"
              height="40"
            />
            <span class="logo-text">ESL Fun Online</span>
          </a>
          <ul class="nav-links" id="navLinks">
            <li>
              <a href="../index.html" class="nav-link"
                ><i class="fas fa-home"></i> Home</a
              >
            </li>
            <li>
              <a href="../tools/tools.html" class="nav-link"
                ><i class="fas fa-tools"></i> Tools</a
              >
            </li>
            <li>
              <a href="../games/games.html" class="nav-link"
                ><i class="fas fa-gamepad"></i> Games</a
              >
            </li>
          </ul>
          <div class="controls">
            <button class="control-btn theme-toggle" id="themeToggle">
              <i class="fas fa-moon"></i>
            </button>
          </div>
        </nav>
      </div>
    </header>

    <!-- Immediate Mobile Menu Script - Inline for guaranteed execution -->
    <script>
      (function () {
        "use strict";

        function initMobileMenu() {
          const mobileToggle = document.getElementById("mobileToggle");
          const navLinks = document.getElementById("navLinks");
          const body = document.body;

          if (!mobileToggle || !navLinks) {
            console.warn("Mobile menu elements not found");
            return;
          }

          console.log("Immediate mobile menu initialized");

          let isMenuOpen = false;

          function toggleMenu(e) {
            if (e && e.preventDefault) e.preventDefault();
            if (e && e.stopPropagation) e.stopPropagation();

            isMenuOpen = !isMenuOpen;
            const icon = mobileToggle.querySelector("i");

            if (isMenuOpen) {
              navLinks.classList.add("active");
              body.classList.add("mobile-menu-open");
              body.style.overflow = "hidden";
              if (icon) icon.className = "fas fa-times";
              console.log("Menu opened");
            } else {
              navLinks.classList.remove("active");
              body.classList.remove("mobile-menu-open");
              body.style.overflow = "";
              if (icon) icon.className = "fas fa-bars";
              console.log("Menu closed");

              // Close all dropdowns
              document.querySelectorAll(".nav-item").forEach((item) => {
                item.classList.remove("mobile-open", "mobile-dropdown-open");
                const chevron = item.querySelector(".fa-chevron-down");
                if (chevron) chevron.style.transform = "rotate(0deg)";
              });
            }
          }

          // Simple unified handler - works for both touch and click
          let lastToggleTime = 0;
          
          function handleToggleClick(e) {
            const now = Date.now();
            // Prevent double-firing within 300ms
            if (now - lastToggleTime < 300) {
              console.log("Toggle ignored - too fast");
              return;
            }
            lastToggleTime = now;
            
            e.preventDefault();
            e.stopPropagation();
            console.log("Hamburger clicked/tapped");
            toggleMenu(e);
          }

          mobileToggle.addEventListener("click", handleToggleClick);
          mobileToggle.addEventListener("touchend", handleToggleClick);

          // Handle dropdown toggles on mobile
          document.querySelectorAll(".nav-item").forEach((item) => {
            const link = item.querySelector(".nav-link");
            const dropdown = item.querySelector(".dropdown");
            const chevron = link?.querySelector(".fa-chevron-down");

            // Only add special handling for links WITH dropdowns
            if (link && dropdown && chevron) {
              // Simple unified dropdown handler
              let lastDropdownToggle = 0;
              
              function handleDropdownClick(e) {
                if (window.innerWidth > 768) return; // Only on mobile
                
                const now = Date.now();
                // Prevent double-firing within 300ms
                if (now - lastDropdownToggle < 300) {
                  console.log("Dropdown toggle ignored - too fast");
                  return;
                }
                lastDropdownToggle = now;
                
                e.preventDefault();
                e.stopPropagation();

                const isOpen = item.classList.contains("mobile-open");
                console.log("Dropdown clicked:", isOpen ? "closing" : "opening");

                // Close other dropdowns
                document.querySelectorAll(".nav-item").forEach((otherItem) => {
                  if (otherItem !== item) {
                    otherItem.classList.remove("mobile-open", "mobile-dropdown-open");
                    const otherChevron = otherItem.querySelector(".fa-chevron-down");
                    if (otherChevron) otherChevron.style.transform = "rotate(0deg)";
                  }
                });

                // Toggle current dropdown
                if (isOpen) {
                  item.classList.remove("mobile-open", "mobile-dropdown-open");
                  chevron.style.transform = "rotate(0deg)";
                  link.setAttribute("aria-expanded", "false");
                } else {
                  item.classList.add("mobile-open", "mobile-dropdown-open");
                  chevron.style.transform = "rotate(180deg)";
                  link.setAttribute("aria-expanded", "true");
                }
              }

              // Remove href="#" behavior on mobile
              if (link.getAttribute("href") === "#") {
                link.style.cursor = "pointer";
              }

              // Attach handlers for both click and touch
              link.addEventListener("click", handleDropdownClick);
              link.addEventListener("touchend", handleDropdownClick);
            }
          });

          // Close menu when clicking outside
          document.addEventListener("click", function (e) {
            if (window.innerWidth <= 768 && isMenuOpen) {
              if (
                !mobileToggle.contains(e.target) &&
                !navLinks.contains(e.target)
              ) {
                toggleMenu(null);
              }
            }
          });

          // Close menu on escape key
          document.addEventListener("keydown", function (e) {
            if (e.key === "Escape" && isMenuOpen) {
              toggleMenu(null);
              mobileToggle.focus();
            }
          });

          // Close menu on window resize to desktop
          window.addEventListener("resize", function () {
            if (window.innerWidth > 768 && isMenuOpen) {
              toggleMenu(null);
            }
          });

          // Close menu after dropdown link click
          document.querySelectorAll(".dropdown a").forEach((link) => {
            link.addEventListener("click", function () {
              if (window.innerWidth <= 768 && isMenuOpen) {
                setTimeout(() => {
                  toggleMenu(null);
                }, 100);
              }
            });
          });
        }

        // Initialize immediately if DOM is ready, otherwise wait
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", initMobileMenu);
        } else {
          initMobileMenu();
        }
      })();
    </script>

    <!-- Additional Mobile Dropdown Fixes -->
    <style>
      /* Ensure mobile dropdowns work properly */
      @media (max-width: 768px) {
        /* FORCE mobile menu to display full width */
        .nav-links,
        #navLinks,
        ul.nav-links {
          display: flex !important;
          position: fixed !important;
          top: 70px !important;
          left: 0 !important;
          right: 0 !important;
          bottom: 0 !important;
          width: 100vw !important;
          height: auto !important;
          min-height: calc(100vh - 70px) !important;
        }

        .nav-links.active,
        #navLinks.active,
        ul.nav-links.active {
          display: flex !important;
          max-height: calc(100vh - 70px) !important;
          height: auto !important;
        }

        /* Make sure nav links with dropdowns are clearly tappable */
        .nav-item .nav-link {
          position: relative;
          user-select: none;
          -webkit-user-select: none;
          -webkit-tap-highlight-color: rgba(70, 187, 229, 0.2);
          cursor: pointer;
        }

        /* Ensure chevron is visible and clickable */
        .nav-link .fa-chevron-down {
          transition: transform 0.3s ease !important;
          opacity: 1 !important;
          pointer-events: none; /* Let clicks go through to parent link */
        }

        /* Visual feedback when dropdown is open */
        .nav-item.mobile-open > .nav-link,
        .nav-item.mobile-dropdown-open > .nav-link {
          background: rgba(70, 187, 229, 0.15) !important;
          border-color: var(--primary-color, #46bbe5) !important;
        }

        /* Make dropdowns smoother */
        .dropdown {
          transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
            padding 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        /* Ensure dropdown items are visible when parent is open */
        .nav-item.mobile-open .dropdown,
        .nav-item.mobile-dropdown-open .dropdown {
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          pointer-events: auto !important;
        }

        /* Override any conflicting hover states */
        .nav-item:hover .dropdown {
          max-height: 0 !important;
          padding: 0 !important;
        }

        .nav-item.mobile-open:hover .dropdown,
        .nav-item.mobile-dropdown-open:hover .dropdown {
          max-height: 600px !important;
          padding: 0.75rem 0.5rem !important;
        }
      }
    </style>

    <main>
      <div class="container">
        <div style="text-align: center; margin: 2rem 0">
          <h1
            style="
              font-size: 3rem;
              font-weight: 700;
              color: var(--text-primary);
              margin-bottom: 1rem;
            "
          >
            üáØüáµ Japanese Basics Flashcards
          </h1>
          <p style="font-size: 1.2rem; color: var(--text-secondary)">
            Learn hiragana, katakana, kanji, and essential Japanese vocabulary
            with interactive flashcards
          </p>
        </div>

        <div class="category-selector">
          <h3>Choose Category:</h3>
          <button class="category-btn active" data-category="hiragana">
            Hiragana
          </button>
          <button class="category-btn" data-category="katakana">
            Katakana
          </button>
          <button class="category-btn" data-category="vocabulary">
            Vocabulary
          </button>
          <button class="category-btn" data-category="kanji">
            Basic Kanji
          </button>
        </div>

        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-value" id="currentCard">1</div>
            <div class="stat-label">Current Card</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalCards">20</div>
            <div class="stat-label">Total Cards</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="correctAnswers">0</div>
            <div class="stat-label">Correct</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="accuracy">100</div>
            <div class="stat-label">Accuracy %</div>
          </div>
        </div>

        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="flashcard-container">
          <div class="flashcard" id="flashcard">
            <div class="flashcard-face flashcard-front">
              <div class="japanese-character" id="japaneseChar">„ÅÇ</div>
              <div class="romaji" id="romaji">a</div>
              <p style="font-size: 1rem; opacity: 0.8; margin-top: 1rem">
                Click to see more info
              </p>
            </div>
            <div class="flashcard-face flashcard-back">
              <div class="english-translation" id="englishTranslation">
                Letter 'A'
              </div>
              <div class="example-sentence" id="exampleSentence">
                „ÅÇ„Çä (ari) - ant
              </div>
              <p style="font-size: 1rem; opacity: 0.8; margin-top: 1rem">
                Click to flip back
              </p>
            </div>
          </div>
        </div>

        <div class="controls">
          <button class="btn btn-secondary" id="prevBtn">
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <button class="btn btn-primary" id="flipBtn">
            <i class="fas fa-sync-alt"></i> Flip Card
          </button>
          <button class="btn btn-secondary" id="nextBtn">
            Next <i class="fas fa-chevron-right"></i>
          </button>
          <button class="btn btn-secondary" id="shuffleBtn">
            <i class="fas fa-random"></i> Shuffle
          </button>
          <button class="btn btn-primary" id="quizBtn">
            <i class="fas fa-question-circle"></i> Quiz Mode
          </button>
        </div>

        <div class="quiz-mode" id="quizMode" style="display: none">
          <h3>Quiz Time! üß†</h3>
          <div class="quiz-question" id="quizQuestion">
            What is the romaji for this character?
          </div>
          <div
            class="japanese-character"
            id="quizCharacter"
            style="color: var(--japanese-red); margin: 1rem 0"
          >
            „ÅÇ
          </div>
          <div class="quiz-options" id="quizOptions">
            <!-- Quiz options will be populated here -->
          </div>
          <button class="btn btn-secondary" id="exitQuizBtn">
            <i class="fas fa-times"></i> Exit Quiz
          </button>
        </div>

        <div style="text-align: center; margin: 3rem 0">
          <a href="tools.html" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Tools
          </a>
        </div>
      </div>
    </main>

    <script>
      // Japanese learning data
      const learningData = {
        hiragana: [
          {
            char: "„ÅÇ",
            romaji: "a",
            english: "Letter 'A'",
            example: "„ÅÇ„Çä (ari) - ant",
          },
          {
            char: "„ÅÑ",
            romaji: "i",
            english: "Letter 'I'",
            example: "„ÅÑ„ÅÑ (ii) - good",
          },
          {
            char: "„ÅÜ",
            romaji: "u",
            english: "Letter 'U'",
            example: "„ÅÜ„Åø (umi) - sea",
          },
          {
            char: "„Åà",
            romaji: "e",
            english: "Letter 'E'",
            example: "„Åà„Åç (eki) - station",
          },
          {
            char: "„Åä",
            romaji: "o",
            english: "Letter 'O'",
            example: "„Åä„Åã (oka) - hill",
          },
          {
            char: "„Åã",
            romaji: "ka",
            english: "Letter 'KA'",
            example: "„Åã„Åø (kami) - paper",
          },
          {
            char: "„Åç",
            romaji: "ki",
            english: "Letter 'KI'",
            example: "„Åç (ki) - tree",
          },
          {
            char: "„Åè",
            romaji: "ku",
            english: "Letter 'KU'",
            example: "„Åè„Å§ (kutsu) - shoes",
          },
          {
            char: "„Åë",
            romaji: "ke",
            english: "Letter 'KE'",
            example: "„Åë„Åó (keshi) - eraser",
          },
          {
            char: "„Åì",
            romaji: "ko",
            english: "Letter 'KO'",
            example: "„Åì„Åì (koko) - here",
          },
          {
            char: "„Åï",
            romaji: "sa",
            english: "Letter 'SA'",
            example: "„Åï„Åã„Å™ (sakana) - fish",
          },
          {
            char: "„Åó",
            romaji: "shi",
            english: "Letter 'SHI'",
            example: "„Åó„Åä (shio) - salt",
          },
          {
            char: "„Åô",
            romaji: "su",
            english: "Letter 'SU'",
            example: "„Åô„Åó (sushi) - sushi",
          },
          {
            char: "„Åõ",
            romaji: "se",
            english: "Letter 'SE'",
            example: "„Åõ„Çì (sen) - line",
          },
          {
            char: "„Åù",
            romaji: "so",
            english: "Letter 'SO'",
            example: "„Åù„Çâ (sora) - sky",
          },
          {
            char: "„Åü",
            romaji: "ta",
            english: "Letter 'TA'",
            example: "„Åü„Åæ„Åî (tamago) - egg",
          },
          {
            char: "„Å°",
            romaji: "chi",
            english: "Letter 'CHI'",
            example: "„Å°„Åö (chizu) - map",
          },
          {
            char: "„Å§",
            romaji: "tsu",
            english: "Letter 'TSU'",
            example: "„Å§„Åç (tsuki) - moon",
          },
          {
            char: "„Å¶",
            romaji: "te",
            english: "Letter 'TE'",
            example: "„Å¶ (te) - hand",
          },
          {
            char: "„Å®",
            romaji: "to",
            english: "Letter 'TO'",
            example: "„Å®„Çä (tori) - bird",
          },
        ],
        katakana: [
          {
            char: "„Ç¢",
            romaji: "a",
            english: "Letter 'A'",
            example: "„Ç¢„É°„É™„Ç´ (Amerika) - America",
          },
          {
            char: "„Ç§",
            romaji: "i",
            english: "Letter 'I'",
            example: "„Ç§„Çø„É™„Ç¢ (Itaria) - Italy",
          },
          {
            char: "„Ç¶",
            romaji: "u",
            english: "Letter 'U'",
            example: "„Ç¶„Ç£„Éº„É≥ (Wƒ´n) - Vienna",
          },
          {
            char: "„Ç®",
            romaji: "e",
            english: "Letter 'E'",
            example: "„Ç®„É¨„Éô„Éº„Çø„Éº (erebƒìtƒÅ) - elevator",
          },
          {
            char: "„Ç™",
            romaji: "o",
            english: "Letter 'O'",
            example: "„Ç™„É¨„É≥„Ç∏ (orenji) - orange",
          },
          {
            char: "„Ç´",
            romaji: "ka",
            english: "Letter 'KA'",
            example: "„Ç´„É°„É© (kamera) - camera",
          },
          {
            char: "„Ç≠",
            romaji: "ki",
            english: "Letter 'KI'",
            example: "„Ç≠„ÉÉ„ÉÅ„É≥ (kicchin) - kitchen",
          },
          {
            char: "„ÇØ",
            romaji: "ku",
            english: "Letter 'KU'",
            example: "„ÇØ„ÉÉ„Ç≠„Éº (kukkƒ´) - cookie",
          },
          {
            char: "„Ç±",
            romaji: "ke",
            english: "Letter 'KE'",
            example: "„Ç±„Éº„Ç≠ (kƒìki) - cake",
          },
          {
            char: "„Ç≥",
            romaji: "ko",
            english: "Letter 'KO'",
            example: "„Ç≥„Éº„Éí„Éº (k≈çhƒ´) - coffee",
          },
        ],
        vocabulary: [
          {
            char: "„Åì„Çì„Å´„Å°„ÅØ",
            romaji: "konnichiwa",
            english: "Hello",
            example: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü - Hello, how are you?",
          },
          {
            char: "„ÅÇ„Çä„Åå„Å®„ÅÜ",
            romaji: "arigatou",
            english: "Thank you",
            example: "„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô - Thank you very much",
          },
          {
            char: "„Åï„Çà„ÅÜ„Å™„Çâ",
            romaji: "sayounara",
            english: "Goodbye",
            example: "„Åï„Çà„ÅÜ„Å™„Çâ„ÄÅ„Åæ„ÅüÊòéÊó• - Goodbye, see you tomorrow",
          },
          {
            char: "„ÅØ„ÅÑ",
            romaji: "hai",
            english: "Yes",
            example: "„ÅØ„ÅÑ„ÄÅ„Åù„ÅÜ„Åß„Åô - Yes, that's right",
          },
          {
            char: "„ÅÑ„ÅÑ„Åà",
            romaji: "iie",
            english: "No",
            example: "„ÅÑ„ÅÑ„Åà„ÄÅÈÅï„ÅÑ„Åæ„Åô - No, that's wrong",
          },
          {
            char: "„Åô„Åø„Åæ„Åõ„Çì",
            romaji: "sumimasen",
            english: "Excuse me/Sorry",
            example:
              "„Åô„Åø„Åæ„Åõ„Çì„ÄÅÈßÖ„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü - Excuse me, where is the station?",
          },
          {
            char: "„Çè„Åü„Åó",
            romaji: "watashi",
            english: "I/Me",
            example: "„Çè„Åü„Åó„ÅØÂ≠¶Áîü„Åß„Åô - I am a student",
          },
          {
            char: "„ÅÇ„Å™„Åü",
            romaji: "anata",
            english: "You",
            example: "„ÅÇ„Å™„Åü„ÅÆÂêçÂâç„ÅØÔºü - What is your name?",
          },
          {
            char: "È£ü„Åπ„Çã",
            romaji: "taberu",
            english: "To eat",
            example: "Êúù„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Çã - To eat breakfast",
          },
          {
            char: "È£≤„ÇÄ",
            romaji: "nomu",
            english: "To drink",
            example: "Ê∞¥„ÇíÈ£≤„ÇÄ - To drink water",
          },
        ],
        kanji: [
          {
            char: "‰∫∫",
            romaji: "hito/jin",
            english: "Person",
            example: "Êó•Êú¨‰∫∫ (nihonjin) - Japanese person",
          },
          {
            char: "Êó•",
            romaji: "hi/nichi",
            english: "Day/Sun",
            example: "‰ªäÊó• (kyou) - today",
          },
          {
            char: "Êú¨",
            romaji: "hon/moto",
            english: "Book/Origin",
            example: "Êó•Êú¨ (nihon) - Japan",
          },
          {
            char: "Â§ß",
            romaji: "oo/dai",
            english: "Big",
            example: "Â§ß„Åç„ÅÑ (ookii) - big",
          },
          {
            char: "Â∞è",
            romaji: "chii/shou",
            english: "Small",
            example: "Â∞è„Åï„ÅÑ (chiisai) - small",
          },
          {
            char: "Â±±",
            romaji: "yama/san",
            english: "Mountain",
            example: "ÂØåÂ£´Â±± (fujisan) - Mt. Fuji",
          },
          {
            char: "Â∑ù",
            romaji: "kawa/sen",
            english: "River",
            example: "Â∑ù„ÅßÊ≥≥„Åê - swim in the river",
          },
          {
            char: "Â≠¶",
            romaji: "gaku/mana",
            english: "Study/Learn",
            example: "Â≠¶Ê†° (gakkou) - school",
          },
          {
            char: "Ê†°",
            romaji: "kou",
            english: "School",
            example: "È´òÊ†° (koukou) - high school",
          },
          {
            char: "Ê∞¥",
            romaji: "mizu/sui",
            english: "Water",
            example: "Ê∞¥„ÇíÈ£≤„ÇÄ - drink water",
          },
        ],
      };

      let currentCategory = "hiragana";
      let currentCardIndex = 0;
      let currentVocabulary = learningData.hiragana;
      let isFlipped = false;
      let quizMode = false;
      let correctAnswers = 0;
      let totalQuizQuestions = 0;

      // DOM elements
      const flashcard = document.getElementById("flashcard");
      const japaneseChar = document.getElementById("japaneseChar");
      const romaji = document.getElementById("romaji");
      const englishTranslation = document.getElementById("englishTranslation");
      const exampleSentence = document.getElementById("exampleSentence");
      const currentCardSpan = document.getElementById("currentCard");
      const totalCardsSpan = document.getElementById("totalCards");
      const correctAnswersSpan = document.getElementById("correctAnswers");
      const accuracySpan = document.getElementById("accuracy");
      const progressFill = document.getElementById("progressFill");
      const quizModeDiv = document.getElementById("quizMode");

      // Event listeners
      document.querySelectorAll(".category-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".category-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          currentCategory = btn.dataset.category;
          currentVocabulary = learningData[currentCategory];
          currentCardIndex = 0;
          correctAnswers = 0;
          totalQuizQuestions = 0;
          updateCard();
          updateStats();
        });
      });

      document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentCardIndex > 0) {
          currentCardIndex--;
          updateCard();
          updateStats();
        }
      });

      document.getElementById("nextBtn").addEventListener("click", () => {
        if (currentCardIndex < currentVocabulary.length - 1) {
          currentCardIndex++;
          updateCard();
          updateStats();
        }
      });

      document.getElementById("flipBtn").addEventListener("click", flipCard);
      flashcard.addEventListener("click", flipCard);

      document.getElementById("shuffleBtn").addEventListener("click", () => {
        currentVocabulary = [...currentVocabulary].sort(
          () => Math.random() - 0.5
        );
        currentCardIndex = 0;
        updateCard();
        updateStats();
      });

      document.getElementById("quizBtn").addEventListener("click", startQuiz);
      document
        .getElementById("exitQuizBtn")
        .addEventListener("click", exitQuiz);

      function updateCard() {
        const card = currentVocabulary[currentCardIndex];
        japaneseChar.textContent = card.char;
        romaji.textContent = card.romaji;
        englishTranslation.textContent = card.english;
        exampleSentence.textContent = card.example;

        if (isFlipped) {
          flashcard.classList.remove("flipped");
          isFlipped = false;
        }
      }

      function flipCard() {
        if (quizMode) return;

        flashcard.classList.toggle("flipped");
        isFlipped = !isFlipped;
      }

      function updateStats() {
        currentCardSpan.textContent = currentCardIndex + 1;
        totalCardsSpan.textContent = currentVocabulary.length;
        correctAnswersSpan.textContent = correctAnswers;

        const accuracy =
          totalQuizQuestions > 0
            ? Math.round((correctAnswers / totalQuizQuestions) * 100)
            : 100;
        accuracySpan.textContent = accuracy;

        const progress =
          ((currentCardIndex + 1) / currentVocabulary.length) * 100;
        progressFill.style.width = progress + "%";
      }

      function startQuiz() {
        quizMode = true;
        quizModeDiv.style.display = "block";
        flashcard.parentElement.style.display = "none";
        generateQuizQuestion();
      }

      function exitQuiz() {
        quizMode = false;
        quizModeDiv.style.display = "none";
        flashcard.parentElement.style.display = "block";
      }

      function generateQuizQuestion() {
        const card = currentVocabulary[currentCardIndex];
        const quizCharacter = document.getElementById("quizCharacter");
        const quizOptions = document.getElementById("quizOptions");
        const quizQuestion = document.getElementById("quizQuestion");

        quizCharacter.textContent = card.char;

        // Set question based on category
        if (currentCategory === "hiragana" || currentCategory === "katakana") {
          quizQuestion.textContent = "What is the romaji for this character?";
        } else {
          quizQuestion.textContent = "What does this mean in English?";
        }

        // Generate options (1 correct + 3 incorrect)
        const correctAnswer =
          currentCategory === "hiragana" || currentCategory === "katakana"
            ? card.romaji
            : card.english;
        const options = [correctAnswer];
        const otherCards = currentVocabulary.filter((c) => c !== card);

        while (options.length < 4 && otherCards.length > 0) {
          const randomCard =
            otherCards[Math.floor(Math.random() * otherCards.length)];
          const optionValue =
            currentCategory === "hiragana" || currentCategory === "katakana"
              ? randomCard.romaji
              : randomCard.english;
          if (!options.includes(optionValue)) {
            options.push(optionValue);
          }
          otherCards.splice(otherCards.indexOf(randomCard), 1);
        }

        // Shuffle options
        options.sort(() => Math.random() - 0.5);

        // Create option buttons
        quizOptions.innerHTML = "";
        options.forEach((option) => {
          const button = document.createElement("button");
          button.className = "quiz-option";
          button.textContent = option;
          button.addEventListener("click", () =>
            checkAnswer(button, option, correctAnswer)
          );
          quizOptions.appendChild(button);
        });
      }

      function checkAnswer(button, selected, correct) {
        totalQuizQuestions++;

        document.querySelectorAll(".quiz-option").forEach((opt) => {
          opt.style.pointerEvents = "none";
          if (opt.textContent === correct) {
            opt.classList.add("correct");
          } else if (opt === button && selected !== correct) {
            opt.classList.add("incorrect");
          }
        });

        if (selected === correct) {
          correctAnswers++;
        }

        updateStats();

        setTimeout(() => {
          if (currentCardIndex < currentVocabulary.length - 1) {
            currentCardIndex++;
            generateQuizQuestion();
          } else {
            alert(
              `Quiz completed! Your accuracy: ${Math.round(
                (correctAnswers / totalQuizQuestions) * 100
              )}%`
            );
            exitQuiz();
          }
        }, 2000);
      }

      // Initialize
      updateCard();
      updateStats();
    </script>

    <script src="../js/navigation.js"></script>
  </body>
</html>
