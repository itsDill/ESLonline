<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9G9RD6BHLN');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Adult-focused English speaking lesson with conditionals, modal verbs, pronunciation practice, and conversation activities for advanced ESL learners.">
    <meta name="keywords" content="English speaking practice, conditionals, modal verbs, pronunciation, adult ESL, conversation practice, speaking activities">
    <meta name="author" content="ESL Fun Online">
    <meta property="og:title" content="Adult Speaking Practice - ESL Fun Online">
    <meta property="og:description" content="Comprehensive speaking-focused lesson for adult English learners with grammar and pronunciation practice.">
    <meta property="og:type" content="website">
    <title>Adult Speaking Practice - ESL Fun Online</title>
        <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon-48x48.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="../images/favicon-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="../images/favicon-512x512.png" />

    <!-- Consistent fonts from main site -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Link to main site styles -->
    <link rel="canonical" href="https://eslfunonline.com/tools/lessonplan.html" />\n                  <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../css/main.css?v=1763019900" />
    <link rel="stylesheet" href="../css/header.css?v=1763019900" />
    <link rel="stylesheet" href="../css/hero-unified.css?v=1763019900" />
    <link rel="stylesheet" href="../css/index-page.css?v=1763019900" />
    <link rel="stylesheet" href="../css/lessonplan-old-backup-page.css?v=1763019900" />
    <link rel="stylesheet" href="../css/mobile-optimized.css?v=1763019900" />
    <link rel="stylesheet" href="../css/mobile-menu.css?v=1763019900" />
    <link rel="stylesheet" href="../css/layout-fixes.css?v=1763019900" />
    </head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Site Header -->
    <header class="site-header">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="../index.html" class="logo-link" aria-label="ESL Fun Online Home">
                        <i class="fas fa-graduation-cap"></i>
                        <span class="logo-text">ESL Fun Online</span>
                    </a>
                </div>
                
                <div class="nav-menu" id="navMenu">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="../index.html" class="nav-link">
                                <i class="fas fa-home"></i>
                                Home
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="../lessons.html" class="nav-link">
                                <i class="fas fa-book"></i>
                                Lessons
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a href="../english/grammar.html" class="nav-link">
                                <i class="fas fa-language"></i>
                                English
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="../games/games.html" class="nav-link">
                                <i class="fas fa-gamepad"></i>
                                Games
                            </a>
                        </li>
                        <li class="nav-item current">
                            <a href="tools.html" class="nav-link">
                                <i class="fas fa-tools"></i>
                                Tools
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle mobile menu">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Immediate Mobile Menu Script - Inline for guaranteed execution -->
    <script>
      (function () {
        "use strict";

        function initMobileMenu() {
          const mobileToggle = document.getElementById("mobileToggle");
          const navLinks = document.getElementById("navLinks");
          const body = document.body;

          if (!mobileToggle || !navLinks) {
            console.warn("Mobile menu elements not found");
            return;
          }

          console.log("Immediate mobile menu initialized");

          let isMenuOpen = false;

          function toggleMenu(e) {
            if (e && e.preventDefault) e.preventDefault();
            if (e && e.stopPropagation) e.stopPropagation();

            isMenuOpen = !isMenuOpen;
            const icon = mobileToggle.querySelector("i");

            if (isMenuOpen) {
              navLinks.classList.add("active");
              body.classList.add("mobile-menu-open");
              body.style.overflow = "hidden";
              if (icon) icon.className = "fas fa-times";
              console.log("Menu opened");
            } else {
              navLinks.classList.remove("active");
              body.classList.remove("mobile-menu-open");
              body.style.overflow = "";
              if (icon) icon.className = "fas fa-bars";
              console.log("Menu closed");

              // Close all dropdowns
              document.querySelectorAll(".nav-item").forEach((item) => {
                item.classList.remove("mobile-open", "mobile-dropdown-open");
                const chevron = item.querySelector(".fa-chevron-down");
                if (chevron) chevron.style.transform = "rotate(0deg)";
              });
            }
          }

          // Simple unified handler - works for both touch and click
          let lastToggleTime = 0;
          
          function handleToggleClick(e) {
            const now = Date.now();
            // Prevent double-firing within 300ms
            if (now - lastToggleTime < 300) {
              console.log("Toggle ignored - too fast");
              return;
            }
            lastToggleTime = now;
            
            e.preventDefault();
            e.stopPropagation();
            console.log("Hamburger clicked/tapped");
            toggleMenu(e);
          }

          mobileToggle.addEventListener("click", handleToggleClick);
          mobileToggle.addEventListener("touchend", handleToggleClick);

          // Handle dropdown toggles on mobile
          document.querySelectorAll(".nav-item").forEach((item) => {
            const link = item.querySelector(".nav-link");
            const dropdown = item.querySelector(".dropdown");
            const chevron = link?.querySelector(".fa-chevron-down");

            // Only add special handling for links WITH dropdowns
            if (link && dropdown && chevron) {
              // Simple unified dropdown handler
              let lastDropdownToggle = 0;
              
              function handleDropdownClick(e) {
                if (window.innerWidth > 768) return; // Only on mobile
                
                const now = Date.now();
                // Prevent double-firing within 300ms
                if (now - lastDropdownToggle < 300) {
                  console.log("Dropdown toggle ignored - too fast");
                  return;
                }
                lastDropdownToggle = now;
                
                e.preventDefault();
                e.stopPropagation();

                const isOpen = item.classList.contains("mobile-open");
                console.log("Dropdown clicked:", isOpen ? "closing" : "opening");

                // Close other dropdowns
                document.querySelectorAll(".nav-item").forEach((otherItem) => {
                  if (otherItem !== item) {
                    otherItem.classList.remove("mobile-open", "mobile-dropdown-open");
                    const otherChevron = otherItem.querySelector(".fa-chevron-down");
                    if (otherChevron) otherChevron.style.transform = "rotate(0deg)";
                  }
                });

                // Toggle current dropdown
                if (isOpen) {
                  item.classList.remove("mobile-open", "mobile-dropdown-open");
                  chevron.style.transform = "rotate(0deg)";
                  link.setAttribute("aria-expanded", "false");
                } else {
                  item.classList.add("mobile-open", "mobile-dropdown-open");
                  chevron.style.transform = "rotate(180deg)";
                  link.setAttribute("aria-expanded", "true");
                }
              }

              // Remove href="#" behavior on mobile
              if (link.getAttribute("href") === "#") {
                link.style.cursor = "pointer";
              }

              // Attach handlers for both click and touch
              link.addEventListener("click", handleDropdownClick);
              link.addEventListener("touchend", handleDropdownClick);
            }
          });

          // Close menu when clicking outside
          document.addEventListener("click", function (e) {
            if (window.innerWidth <= 768 && isMenuOpen) {
              if (
                !mobileToggle.contains(e.target) &&
                !navLinks.contains(e.target)
              ) {
                toggleMenu(null);
              }
            }
          });

          // Close menu on escape key
          document.addEventListener("keydown", function (e) {
            if (e.key === "Escape" && isMenuOpen) {
              toggleMenu(null);
              mobileToggle.focus();
            }
          });

          // Close menu on window resize to desktop
          window.addEventListener("resize", function () {
            if (window.innerWidth > 768 && isMenuOpen) {
              toggleMenu(null);
            }
          });

          // Close menu after dropdown link click
          document.querySelectorAll(".dropdown a").forEach((link) => {
            link.addEventListener("click", function () {
              if (window.innerWidth <= 768 && isMenuOpen) {
                setTimeout(() => {
                  toggleMenu(null);
                }, 100);
              }
            });
          });
        }

        // Initialize immediately if DOM is ready, otherwise wait
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", initMobileMenu);
        } else {
          initMobileMenu();
        }
      })();
    </script>

    <!-- Additional Mobile Dropdown Fixes -->
    

    <main id="main-content" class="main-container">
        <!-- Lesson Header -->
        <header class="lesson-header">
            <h1 class="lesson-title">
                <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                Interactive English Lesson
            </h1>
            <p class="lesson-subtitle">
                Master English through engaging activities, games, and interactive exercises
            </p>
        </header>

        <!-- Progress Tracking Section -->
        <section class="progress-section" role="region" aria-labelledby="progress-title">
            <div class="progress-header">
                <h2 class="progress-title" id="progress-title">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    Your Learning Progress
                </h2>
                <div class="progress-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="completed-count">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-activities">12</div>
                        <div class="stat-label">Total Activities</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="progress-percentage">0%</div>
                        <div class="stat-label">Progress</div>
                    </div>
                </div>
            </div>
            <div class="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-labelledby="progress-title">
                <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
            </div>
        </section>

        <!-- Vocabulary Tracker -->
        <section class="vocabulary-tracker" role="region" aria-labelledby="vocab-title">
            <div class="vocab-header">
                <h2 class="vocab-title" id="vocab-title">
                    <i class="fas fa-book-open" aria-hidden="true"></i>
                    Key Vocabulary
                </h2>
                <div class="vocab-count" id="vocabCount">0/20 Learned</div>
            </div>
            <div class="vocab-words" id="vocabWords">
                <div class="vocab-word" onclick="learnWord(this, 'name')" tabindex="0">name</div>
                <div class="vocab-word" onclick="learnWord(this, 'live')" tabindex="0">live</div>
                <div class="vocab-word" onclick="learnWord(this, 'friend')" tabindex="0">friend</div>
                <div class="vocab-word" onclick="learnWord(this, 'birthday')" tabindex="0">birthday</div>
                <div class="vocab-word" onclick="learnWord(this, 'learn')" tabindex="0">learn</div>
                <div class="vocab-word" onclick="learnWord(this, 'age')" tabindex="0">age</div>
                <div class="vocab-word" onclick="learnWord(this, 'hobby')" tabindex="0">hobby</div>
                <div class="vocab-word" onclick="learnWord(this, 'school')" tabindex="0">school</div>
                <div class="vocab-word" onclick="learnWord(this, 'work')" tabindex="0">work</div>
                <div class="vocab-word" onclick="learnWord(this, 'season')" tabindex="0">season</div>
                <div class="vocab-word" onclick="learnWord(this, 'family')" tabindex="0">family</div>
                <div class="vocab-word" onclick="learnWord(this, 'constellation')" tabindex="0">constellation</div>
                <div class="vocab-word" onclick="learnWord(this, 'grammar')" tabindex="0">grammar</div>
                <div class="vocab-word" onclick="learnWord(this, 'sentence')" tabindex="0">sentence</div>
                <div class="vocab-word" onclick="learnWord(this, 'pronunciation')" tabindex="0">pronunciation</div>
                <div class="vocab-word" onclick="learnWord(this, 'vocabulary')" tabindex="0">vocabulary</div>
                <div class="vocab-word" onclick="learnWord(this, 'practice')" tabindex="0">practice</div>
                <div class="vocab-word" onclick="learnWord(this, 'exercise')" tabindex="0">exercise</div>
                <div class="vocab-word" onclick="learnWord(this, 'activity')" tabindex="0">activity</div>
                <div class="vocab-word" onclick="learnWord(this, 'progress')" tabindex="0">progress</div>
            </div>
        </section>

        <!-- Learning Tips -->
        <section class="learning-tips" role="region" aria-labelledby="tips-title">
            <div class="tips-content">
                <h2 class="tips-title" id="tips-title">
                    <i class="fas fa-lightbulb" aria-hidden="true"></i>
                    Learning Tips for Success
                </h2>
                <div class="tips-list">
                    <div class="tip-item">
                        <div class="tip-icon">üó£Ô∏è</div>
                        <div class="tip-text">Practice speaking out loud, even when alone. This builds confidence and improves pronunciation.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">üëÇ</div>
                        <div class="tip-text">Listen to the pronunciation examples multiple times. Repetition helps with memory and accent.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">üìù</div>
                        <div class="tip-text">Write down new words in your own sentences. This helps you remember context and usage.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">üéØ</div>
                        <div class="tip-text">Set small daily goals. Complete one section at a time for steady progress.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">üîÑ</div>
                        <div class="tip-text">Review completed activities regularly. Spaced repetition improves long-term retention.</div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">üåü</div>
                        <div class="tip-text">Celebrate your progress! Each completed activity brings you closer to fluency.</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Question Practice Section -->
        <section class="lesson-section" role="region" aria-labelledby="questions-title">
            <header class="section-header">
                <h2 class="section-title" id="questions-title">
                    <i class="fas fa-question-circle" aria-hidden="true"></i>
                    Question Practice
                </h2>
            </header>
            <div class="section-content">
                <p class="game-description">
                    Practice answering common English questions. Click each question to reveal helpful prompts and practice your responses.
                </p>
                
                <div class="question-item" data-activity="question-1">
                    <div class="question-header" onclick="toggleQuestion('question-1')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-1">
                        <div class="question-text">
                            <span class="question-type">What</span>
                            What is your name?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-1">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "My name is [your name]." or "I'm [your name]."<br>
                            <strong>Example:</strong> "My name is Sarah." or "I'm John."
                            <div class="pronunciation-help">
                                <button class="pronunciation-btn" onclick="speakText('My name is Sarah')" aria-label="Hear pronunciation">
                                    <i class="fas fa-volume-up"></i>
                                    Listen
                                </button>
                                <span class="phonetic">/ma…™ ne…™m …™z/</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-2">
                    <div class="question-header" onclick="toggleQuestion('question-2')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-2">
                        <div class="question-text">
                            <span class="question-type">Where</span>
                            Where do you live?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-2">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "I live in [city/country]." or "I'm from [place]."<br>
                            <strong>Example:</strong> "I live in Tokyo, Japan." or "I'm from New York."
                            <div class="pronunciation-help">
                                <button class="pronunciation-btn" onclick="speakText('I live in Tokyo, Japan')" aria-label="Hear pronunciation">
                                    <i class="fas fa-volume-up"></i>
                                    Listen
                                </button>
                                <span class="phonetic">/a…™ l…™v …™n/</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-3">
                    <div class="question-header" onclick="toggleQuestion('question-3')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-3">
                        <div class="question-text">
                            <span class="question-type">Who</span>
                            Who is your best friend?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-3">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "My best friend is [name]." or "My best friend's name is [name]."<br>
                            <strong>Example:</strong> "My best friend is Maria." Tell me something about them!
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-4">
                    <div class="question-header" onclick="toggleQuestion('question-4')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-4">
                        <div class="question-text">
                            <span class="question-type">When</span>
                            When is your birthday?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-4">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "My birthday is [date]." or "I was born on [date]."<br>
                            <strong>Example:</strong> "My birthday is March 15th." or "I was born on December 3rd."
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-5">
                    <div class="question-header" onclick="toggleQuestion('question-5')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-5">
                        <div class="question-text">
                            <span class="question-type">Why</span>
                            Why do you like learning English?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-5">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "I like learning English because..." or "English is important to me because..."<br>
                            <strong>Example:</strong> "I like learning English because it helps me communicate with people from different countries."
                            <div class="pronunciation-help">
                                <button class="pronunciation-btn" onclick="speakText('I like learning English because it helps me communicate')" aria-label="Hear pronunciation">
                                    <i class="fas fa-volume-up"></i>
                                    Listen
                                </button>
                                <span class="phonetic">/a…™ la…™k Ààl…úrn…™≈ã/</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-6">
                    <div class="question-header" onclick="toggleQuestion('question-6')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-6">
                        <div class="question-text">
                            <span class="question-type">How</span>
                            How old are you?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-6">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "I am [age] years old." or "I'm [age]."<br>
                            <strong>Example:</strong> "I am 25 years old." or "I'm 16."
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-7">
                    <div class="question-header" onclick="toggleQuestion('question-7')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-7">
                        <div class="question-text">
                            <span class="question-type">What</span>
                            What do you like to do in your free time?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-7">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "In my free time, I like to..." or "I enjoy..."<br>
                            <strong>Example:</strong> "In my free time, I like to read books and play sports."
                            <div class="pronunciation-help">
                                <button class="pronunciation-btn" onclick="speakText('In my free time, I like to read books and play sports')" aria-label="Hear pronunciation">
                                    <i class="fas fa-volume-up"></i>
                                    Listen
                                </button>
                                <span class="phonetic">/…™n ma…™ fri ta…™m/</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-8">
                    <div class="question-header" onclick="toggleQuestion('question-8')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-8">
                        <div class="question-text">
                            <span class="question-type">How</span>
                            How do you get to school/work?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-8">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "I go to school/work by..." or "I take the..."<br>
                            <strong>Example:</strong> "I go to school by bus." or "I take the train to work."
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-9">
                    <div class="question-header" onclick="toggleQuestion('question-9')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-9">
                        <div class="question-text">
                            <span class="question-type">Which</span>
                            Which season do you like best?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-9">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "My favorite season is..." or "I like... best because..."<br>
                            <strong>Example:</strong> "My favorite season is spring because the flowers bloom."
                        </div>
                    </div>
                </div>

                <div class="question-item" data-activity="question-10">
                    <div class="question-header" onclick="toggleQuestion('question-10')" tabindex="0" role="button" aria-expanded="false" aria-controls="answer-10">
                        <div class="question-text">
                            <span class="question-type">Can</span>
                            Can you tell me about your family?
                        </div>
                        <i class="fas fa-chevron-down chevron-icon" aria-hidden="true"></i>
                    </div>
                    <div class="answer-content" id="answer-10">
                        <div class="answer-text">
                            <strong>Practice saying:</strong> "I have..." or "My family consists of..."<br>
                            <strong>Example:</strong> "I have two brothers and one sister. My parents work in the city."
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Enhanced Star Constellation Activity -->
        <section class="lesson-section" role="region" aria-labelledby="constellation-title">
            <header class="section-header">
                <h2 class="section-title" id="constellation-title">
                    <i class="fas fa-star" aria-hidden="true"></i>
                    Interactive Constellation Creator
                </h2>
            </header>
            <div class="section-content">
                <div class="game-container" data-activity="constellation">
                    <p class="game-description">
                        Click anywhere in the night sky to create amazing stars! Watch them connect into beautiful constellations. Double-click stars to make them sparkle! Practice saying "star," "bright," "beautiful," "constellation," and "galaxy" as you create.
                    </p>
                    
                    <div class="star-game enhanced" id="starGame" onclick="createStar(event)" role="button" tabindex="0" aria-label="Click to create stars">
                        <div class="constellation-info">
                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                            <strong>Interactive Sky:</strong> Click to create stars ‚Ä¢ Double-click stars to add sparkle effects ‚Ä¢ Stars auto-connect when close ‚Ä¢ Hold down mouse to create star trails!
                        </div>
                        <div class="star-counter">
                            Stars Created: <span id="starCount">0</span>
                        </div>
                    </div>
                    
                    <div class="game-controls">
                        <button class="btn btn-secondary" onclick="clearStars()">
                            <i class="fas fa-trash-alt" aria-hidden="true"></i>
                            Clear Sky
                        </button>
                        <button class="btn" onclick="randomConstellation()">
                            <i class="fas fa-random" aria-hidden="true"></i>
                            Random Pattern
                        </button>
                        <button class="btn" onclick="createMilkyWay()">
                            <i class="fas fa-circle" aria-hidden="true"></i>
                            Milky Way
                        </button>
                        <button class="btn btn-secondary" onclick="toggleStarSound()">
                            <i class="fas fa-volume-up" id="soundIcon" aria-hidden="true"></i>
                            Sound
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grammar for Junior School -->
        <section class="lesson-section" role="region" aria-labelledby="grammar-junior-title">
            <header class="section-header">
                <h2 class="section-title" id="grammar-junior-title">
                    <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                    Grammar for Junior School (Ages 6-12)
                </h2>
            </header>
            <div class="section-content">
                <div class="game-container" data-activity="grammar-junior">
                    <p class="game-description">
                        Learn basic English grammar rules! Click each card to practice fundamental grammar concepts for young learners.
                    </p>
                    
                    <div class="grammar-grid">
                        <div class="grammar-card" onclick="practiceGrammar('subject-verb', 'junior')" tabindex="0" role="button">
                            <div class="grammar-concept">Subject + Verb</div>
                            <div class="grammar-example">I run.</div>
                            <div class="grammar-rule">Subject comes before verb</div>
                        </div>
                        
                        <div class="grammar-card" onclick="practiceGrammar('articles', 'junior')" tabindex="0" role="button">
                            <div class="grammar-concept">Articles</div>
                            <div class="grammar-example">a cat, an apple, the book</div>
                            <div class="grammar-rule">a/an for singular, the for specific</div>
                        </div>
                        
                        <div class="grammar-card" onclick="practiceGrammar('plural', 'junior')" tabindex="0" role="button">
                            <div class="grammar-concept">Plural Nouns</div>
                            <div class="grammar-example">cat ‚Üí cats, box ‚Üí boxes</div>
                            <div class="grammar-rule">Add -s or -es to make plural</div>
                        </div>
                        
                        <div class="grammar-card" onclick="practiceGrammar('present-simple', 'junior')" tabindex="0" role="button">
                            <div class="grammar-concept">Present Simple</div>
                            <div class="grammar-example">I play. She plays.</div>
                            <div class="grammar-rule">Add -s for he/she/it</div>
                        </div>
                        
                        <div class="grammar-card" onclick="practiceGrammar('possessive', 'junior')" tabindex="0" role="button">
                            <div class="grammar-concept">Possessive</div>
                            <div class="grammar-example">my book, your pen, his toy</div>
                            <div class="grammar-rule">Shows who owns something</div>
                        </div>
                        
                        <div class="grammar-card" onclick="practiceGrammar('questions', 'junior')" tabindex="0" role="button">
                            <div class="grammar-concept">Simple Questions</div>
                            <div class="grammar-example">What is this? Where are you?</div>
                            <div class="grammar-rule">Question word + verb + subject</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grammar for High School -->
        <section class="lesson-section" role="region" aria-labelledby="grammar-high-title">
            <header class="section-header">
                <h2 class="section-title" id="grammar-high-title">
                    <i class="fas fa-university" aria-hidden="true"></i>
                    Grammar for High School (Ages 13-18)
                </h2>
            </header>
            <div class="section-content">
                <div class="game-container" data-activity="grammar-high">
                    <p class="game-description">
                        Master advanced English grammar! These concepts will help you speak and write with greater accuracy and sophistication.
                    </p>
                    
                    <div class="grammar-grid">
                        <div class="grammar-card advanced" onclick="practiceGrammar('conditional', 'high')" tabindex="0" role="button">
                            <div class="grammar-concept">Conditional Sentences</div>
                            <div class="grammar-example">If I study, I will pass.</div>
                            <div class="grammar-rule">If + present, will + base verb</div>
                        </div>
                        
                        <div class="grammar-card advanced" onclick="practiceGrammar('perfect-tense', 'high')" tabindex="0" role="button">
                            <div class="grammar-concept">Present Perfect</div>
                            <div class="grammar-example">I have finished my homework.</div>
                            <div class="grammar-rule">have/has + past participle</div>
                        </div>
                        
                        <div class="grammar-card advanced" onclick="practiceGrammar('passive', 'high')" tabindex="0" role="button">
                            <div class="grammar-concept">Passive Voice</div>
                            <div class="grammar-example">The book was written by me.</div>
                            <div class="grammar-rule">be + past participle</div>
                        </div>
                        
                        <div class="grammar-card advanced" onclick="practiceGrammar('relative-clauses', 'high')" tabindex="0" role="button">
                            <div class="grammar-concept">Relative Clauses</div>
                            <div class="grammar-example">The man who called is my teacher.</div>
                            <div class="grammar-rule">who/which/that + clause</div>
                        </div>
                        
                        <div class="grammar-card advanced" onclick="practiceGrammar('reported-speech', 'high')" tabindex="0" role="button">
                            <div class="grammar-concept">Reported Speech</div>
                            <div class="grammar-example">He said that he was tired.</div>
                            <div class="grammar-rule">Change tense when reporting</div>
                        </div>
                        
                        <div class="grammar-card advanced" onclick="practiceGrammar('subjunctive', 'high')" tabindex="0" role="button">
                            <div class="grammar-concept">Subjunctive Mood</div>
                            <div class="grammar-example">I suggest that he study more.</div>
                            <div class="grammar-rule">suggest/recommend + base verb</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tic Tac Toe Game -->
        <section class="lesson-section" role="region" aria-labelledby="tictactoe-title">
            <header class="section-header">
                <h2 class="section-title" id="tictactoe-title">
                    <i class="fas fa-th-large" aria-hidden="true"></i>
                    English Tic Tac Toe
                </h2>
            </header>
            <div class="section-content">
                <div class="game-container" data-activity="tictactoe">
                    <p class="game-description">
                        Play tic-tac-toe while practicing English! Say "It's my turn," "I win," or "Good game" as you play.
                    </p>
                    
                    <div class="tic-tac-toe-container">
                        <div class="game-status">
                            <div class="game-status-text" id="gameStatus">Player X's turn</div>
                            <div class="game-score">
                                <div class="score-item">
                                    <i class="fas fa-times" style="color: var(--error-color);"></i>
                                    <span>X: <span id="scoreX">0</span></span>
                                </div>
                                <div class="score-item">
                                    <i class="fas fa-circle" style="color: var(--primary-color);"></i>
                                    <span>O: <span id="scoreO">0</span></span>
                                </div>
                                <div class="score-item">
                                    <i class="fas fa-handshake" style="color: var(--text-secondary);"></i>
                                    <span>Ties: <span id="scoreTies">0</span></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tic-tac-toe-board" id="ticTacToeBoard" role="grid" aria-label="Tic tac toe game board">
                            <!-- Cells will be generated by JavaScript -->
                        </div>
                        
                        <div class="game-controls">
                            <button class="btn btn-secondary" onclick="resetTicTacToe()">
                                <i class="fas fa-redo" aria-hidden="true"></i>
                                New Game
                            </button>
                            <button class="btn btn-secondary" onclick="resetScores()">
                                <i class="fas fa-chart-line" aria-hidden="true"></i>
                                Reset Scores
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grammar Building Game -->
        <section class="lesson-section" role="region" aria-labelledby="grammar-game-title">
            <header class="section-header">
                <h2 class="section-title" id="grammar-game-title">
                    <i class="fas fa-puzzle-piece" aria-hidden="true"></i>
                    Sentence Builder Challenge
                </h2>
            </header>
            <div class="section-content">
                <div class="game-container" data-activity="sentence-builder">
                    <p class="game-description">
                        Drag and drop words to build correct English sentences! Practice word order and grammar structure in this fun interactive game.
                    </p>
                    
                    <div class="sentence-builder-game">
                        <div class="target-sentence">
                            <h3 class="target-title">Build this sentence:</h3>
                            <div class="sentence-target" id="sentenceTarget">The cat is sleeping on the bed.</div>
                        </div>
                        
                        <div class="word-bank">
                            <h3 class="bank-title">Word Bank - Drag words below:</h3>
                            <div class="word-pieces" id="wordBank">
                                <!-- Words will be dynamically added here -->
                            </div>
                        </div>
                        
                        <div class="sentence-construction">
                            <h3 class="construction-title">Your Sentence:</h3>
                            <div class="drop-zone" id="dropZone">
                                <div class="drop-placeholder">Drag words here to build your sentence</div>
                            </div>
                        </div>
                        
                        <div class="game-feedback" id="gameFeedback">
                            <div class="feedback-message"></div>
                            <div class="score-display">
                                Score: <span id="builderScore">0</span> | 
                                Level: <span id="builderLevel">1</span> |
                                Completed: <span id="sentencesCompleted">0</span>/5
                            </div>
                        </div>
                        
                        <div class="game-controls">
                            <button class="btn btn-secondary" onclick="clearSentence()">
                                <i class="fas fa-eraser" aria-hidden="true"></i>
                                Clear
                            </button>
                            <button class="btn" onclick="checkSentence()">
                                <i class="fas fa-check" aria-hidden="true"></i>
                                Check Answer
                            </button>
                            <button class="btn" onclick="getHint()">
                                <i class="fas fa-lightbulb" aria-hidden="true"></i>
                                Hint
                            </button>
                            <button class="btn btn-secondary" onclick="nextSentence()">
                                <i class="fas fa-forward" aria-hidden="true"></i>
                                Next Sentence
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Word Matching Game -->
        <section class="lesson-section" role="region" aria-labelledby="matching-title">
            <header class="section-header">
                <h2 class="section-title" id="matching-title">
                    <i class="fas fa-puzzle-piece" aria-hidden="true"></i>
                    Rhyming Words Match
                </h2>
            </header>
            <div class="section-content">
                <div class="game-container" data-activity="wordmatch">
                    <p class="game-description">
                        Find pairs of words that rhyme! Click words that sound similar to match them together. Practice pronunciation as you play.
                    </p>
                    
                    <div class="word-matching-game">
                        <div class="matching-grid">
                            <div class="word-column">
                                <h3 class="column-title">
                                    <i class="fas fa-list" aria-hidden="true"></i>
                                    Group A
                                </h3>
                                <div class="word-item" onclick="selectWord(this, 'cat')" tabindex="0" role="button">cat</div>
                                <div class="word-item" onclick="selectWord(this, 'dog')" tabindex="0" role="button">dog</div>
                                <div class="word-item" onclick="selectWord(this, 'sun')" tabindex="0" role="button">sun</div>
                                <div class="word-item" onclick="selectWord(this, 'car')" tabindex="0" role="button">car</div>
                                <div class="word-item" onclick="selectWord(this, 'book')" tabindex="0" role="button">book</div>
                            </div>
                            
                            <div class="word-column">
                                <h3 class="column-title">
                                    <i class="fas fa-list" aria-hidden="true"></i>
                                    Group B
                                </h3>
                                <div class="word-item" onclick="selectWord(this, 'hat')" tabindex="0" role="button">hat</div>
                                <div class="word-item" onclick="selectWord(this, 'frog')" tabindex="0" role="button">frog</div>
                                <div class="word-item" onclick="selectWord(this, 'fun')" tabindex="0" role="button">fun</div>
                                <div class="word-item" onclick="selectWord(this, 'star')" tabindex="0" role="button">star</div>
                                <div class="word-item" onclick="selectWord(this, 'look')" tabindex="0" role="button">look</div>
                            </div>
                        </div>
                        
                        <div class="game-score-display">
                            <h3 class="score-title">Matching Progress</h3>
                            <div class="score-stats">
                                <div class="score-stat">
                                    <div class="score-number" id="matchedPairs">0</div>
                                    <div class="score-label">Matched Pairs</div>
                                </div>
                                <div class="score-stat">
                                    <div class="score-number" id="attempts">0</div>
                                    <div class="score-label">Attempts</div>
                                </div>
                                <div class="score-stat">
                                    <div class="score-number" id="accuracy">100%</div>
                                    <div class="score-label">Accuracy</div>
                                </div>
                            </div>
                            
                            <div class="game-controls">
                                <button class="btn btn-secondary" onclick="resetWordGame()">
                                    <i class="fas fa-redo" aria-hidden="true"></i>
                                    Reset Game
                                </button>
                                <button class="btn" onclick="shuffleWords()">
                                    <i class="fas fa-random" aria-hidden="true"></i>
                                    Shuffle Words
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Completion Celebration -->
        <div class="celebration" id="completionCelebration">
            <div class="celebration-icon">üéâ</div>
            <div class="celebration-text">Congratulations!</div>
            <div class="celebration-message">You've completed all the activities! Your English skills are improving!</div>
        </div>
    </main>

    <!-- Site Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3 class="footer-title">ESL Fun Online</h3>
                <p class="footer-description">
                    Interactive English learning resources, games, and activities for students worldwide.
                </p>
                <div class="footer-social">
                    <a href="#" class="social-link" aria-label="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="social-link" aria-label="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="social-link" aria-label="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
            <div class="footer-section">
                <h4 class="footer-subtitle">Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../lessons.html">Lessons</a></li>
                    <li><a href="../english/grammar.html">Grammar</a></li>
                    <li><a href="../games/games.html">Games</a></li>
                    <li><a href="tools.html">Tools</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4 class="footer-subtitle">Learning Resources</h4>
                <ul class="footer-links">
                    <li><a href="../english/ielts.html">IELTS Prep</a></li>
                    <li><a href="../english/toeic.html">TOEIC Prep</a></li>
                    <li><a href="../english/business.html">Business English</a></li>
                    <li><a href="../english/vocabguide.html">Vocabulary Guide</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4 class="footer-subtitle">Support</h4>
                <ul class="footer-links">
                    <li><a href="../privacy.html">Privacy Policy</a></li>
                    <li><a href="../terms.html">Terms of Service</a></li>
                    <li><a href="../cookies.html">Cookie Policy</a></li>
                    <li><a href="mailto:support@eslfunonline.com">Contact Us</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ESL Fun Online. All rights reserved. Made with ‚ù§Ô∏è for English learners worldwide.</p>
        </div>
    </footer>

    <script>
        // Enhanced lesson plan with progress tracking and improved interactivity
        
        // Global state management
        const gameState = {
            completedActivities: new Set(),
            totalActivities: 12,
            stars: [],
            connections: [],
            starCount: 0,
            soundEnabled: true,
            learnedWords: new Set(),
            totalWords: 20,
            ticTacToe: {
                board: Array(9).fill(''),
                currentPlayer: 'X',
                gameActive: true,
                scores: { X: 0, O: 0, ties: 0 }
            },
            wordMatch: {
                selectedWords: [],
                matchedPairs: 0,
                attempts: 0,
                rhymePairs: {
                    'cat': 'hat', 'hat': 'cat',
                    'dog': 'frog', 'frog': 'dog', 
                    'sun': 'fun', 'fun': 'sun',
                    'car': 'star', 'star': 'car',
                    'book': 'look', 'look': 'book'
                }
            },
            sentenceBuilder: {
                currentSentence: 0,
                score: 0,
                level: 1,
                completed: 0,
                sentences: [
                    {
                        target: "The cat is sleeping on the bed.",
                        words: ["The", "cat", "is", "sleeping", "on", "the", "bed", "."],
                        hint: "Start with 'The' and describe what the cat is doing."
                    },
                    {
                        target: "I like to read books in the library.",
                        words: ["I", "like", "to", "read", "books", "in", "the", "library", "."],
                        hint: "Begin with 'I' and tell us what you enjoy doing."
                    },
                    {
                        target: "My friends are playing football outside.",
                        words: ["My", "friends", "are", "playing", "football", "outside", "."],
                        hint: "Start with 'My friends' and describe their activity."
                    },
                    {
                        target: "We will visit the museum tomorrow.",
                        words: ["We", "will", "visit", "the", "museum", "tomorrow", "."],
                        hint: "Use 'We will' to talk about future plans."
                    },
                    {
                        target: "She has been studying English for two years.",
                        words: ["She", "has", "been", "studying", "English", "for", "two", "years", "."],
                        hint: "This sentence uses present perfect continuous tense."
                    }
                ],
                droppedWords: []
            }
        };

        // Text-to-Speech Functionality
        function speakText(text, lang = 'en-US') {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.8; // Slightly slower for learning
                utterance.pitch = 1;
                utterance.volume = 1;
                
                // Try to use a natural voice
                const voices = speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice => 
                    voice.lang.startsWith('en') && 
                    (voice.name.includes('Natural') || voice.name.includes('Premium'))
                ) || voices.find(voice => voice.lang.startsWith('en'));
                
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }
                
                window.speechSynthesis.speak(utterance);
                
                // Visual feedback
                const button = event.target.closest('.pronunciation-btn');
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-volume-up"></i> Playing...';
                    button.style.background = 'var(--accent-color)';
                    
                    utterance.onend = () => {
                        button.innerHTML = originalText;
                        button.style.background = '';
                    };
                }
            } else {
                alert('Sorry, text-to-speech is not supported in your browser.');
            }
        }

        // Vocabulary Learning System
        function learnWord(element, word) {
            if (!gameState.learnedWords.has(word)) {
                gameState.learnedWords.add(word);
                element.classList.add('learned');
                
                // Speak the word
                speakText(word);
                
                // Update vocabulary counter
                updateVocabularyCount();
                
                // Show definition or example
                showWordDefinition(word, element);
                
                // Check if all words are learned
                if (gameState.learnedWords.size === gameState.totalWords) {
                    setTimeout(() => {
                        alert('üéâ Congratulations! You\'ve learned all the vocabulary words!');
                    }, 500);
                }
            } else {
                // Just speak the word again
                speakText(word);
            }
        }

        function updateVocabularyCount() {
            const count = gameState.learnedWords.size;
            const total = gameState.totalWords;
            document.getElementById('vocabCount').textContent = `${count}/${total} Learned`;
        }

        function showWordDefinition(word, element) {
            const definitions = {
                'name': 'What someone is called',
                'live': 'To have your home in a place',
                'friend': 'Someone you like and know well',
                'birthday': 'The day you were born',
                'learn': 'To get knowledge or skill',
                'age': 'How old someone is',
                'hobby': 'Something you do for fun',
                'school': 'Place where you study',
                'work': 'Job or place of employment',
                'season': 'Spring, summer, autumn, winter',
                'family': 'Parents, siblings, relatives',
                'constellation': 'Group of stars forming a pattern',
                'grammar': 'Rules of language structure',
                'sentence': 'Group of words expressing a thought',
                'pronunciation': 'How words are spoken',
                'vocabulary': 'Words in a language',
                'practice': 'To do something repeatedly to improve',
                'exercise': 'Activity to practice skills',
                'activity': 'Something you do',
                'progress': 'Forward movement or improvement'
            };
            
            const definition = definitions[word] || 'A useful English word';
            
            // Create floating tooltip
            const tooltip = document.createElement('div');
            tooltip.style.cssText = `
                position: absolute;
                top: -50px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--text-primary);
                color: var(--text-inverse);
                padding: 0.75rem 1rem;
                border-radius: var(--radius-lg);
                font-size: 0.875rem;
                white-space: nowrap;
                z-index: 1000;
                opacity: 0;
                animation: tooltipShow 2s ease-out forwards;
                pointer-events: none;
            `;
            tooltip.textContent = definition;
            
            element.style.position = 'relative';
            element.appendChild(tooltip);
            
            // Add tooltip animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes tooltipShow {
                    0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
                    20% { opacity: 1; transform: translateX(-50%) translateY(-10px); }
                    80% { opacity: 1; transform: translateX(-50%) translateY(-10px); }
                    100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                tooltip.remove();
                document.head.removeChild(style);
            }, 2000);
        }

        // Mobile Navigation
        function initMobileNavigation() {
            const mobileToggle = document.getElementById('mobileMenuToggle');
            const navMenu = document.getElementById('navMenu');
            
            if (mobileToggle && navMenu) {
                mobileToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    
                    // Animate hamburger lines
                    const lines = this.querySelectorAll('.hamburger-line');
                    if (navMenu.classList.contains('active')) {
                        lines[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
                        lines[1].style.opacity = '0';
                        lines[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
                    } else {
                        lines[0].style.transform = '';
                        lines[1].style.opacity = '';
                        lines[2].style.transform = '';
                    }
                });
                
                // Close menu when clicking on a link
                navMenu.addEventListener('click', function(e) {
                    if (e.target.classList.contains('nav-link')) {
                        navMenu.classList.remove('active');
                        const lines = mobileToggle.querySelectorAll('.hamburger-line');
                        lines.forEach(line => {
                            line.style.transform = '';
                            line.style.opacity = '';
                        });
                    }
                });
            }
        }

        // Theme Toggle
        function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                // Check for saved theme
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.body.classList.toggle('dark-mode', savedTheme === 'dark');
                
                const icon = themeToggle.querySelector('i');
                if (icon) {
                    icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                }
                
                themeToggle.addEventListener('click', function() {
                    document.body.classList.toggle('dark-mode');
                    const isDark = document.body.classList.contains('dark-mode');
                    
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                    icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
                });
            }
        }

        // Progress tracking functions
        function updateProgress() {
            const completed = gameState.completedActivities.size;
            const total = gameState.totalActivities;
            const percentage = Math.round((completed / total) * 100);
            
            // Update progress display
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('progress-percentage').textContent = percentage + '%';
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.querySelector('.progress-bar-container').setAttribute('aria-valuenow', percentage);
            
            // Save progress to localStorage
            saveProgress();
            
            // Check for completion
            if (completed === total) {
                showCompletionCelebration();
            }
        }

        // Progress Persistence
        function saveProgress() {
            const progressData = {
                completedActivities: Array.from(gameState.completedActivities),
                learnedWords: Array.from(gameState.learnedWords),
                ticTacToeScores: gameState.ticTacToe.scores,
                sentenceBuilderProgress: {
                    currentSentence: gameState.sentenceBuilder.currentSentence,
                    score: gameState.sentenceBuilder.score,
                    completed: gameState.sentenceBuilder.completed
                },
                wordMatchProgress: {
                    matchedPairs: gameState.wordMatch.matchedPairs,
                    attempts: gameState.wordMatch.attempts
                },
                lastUpdated: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('eslLessonProgress', JSON.stringify(progressData));
                showSaveIndicator();
            } catch (error) {
                console.warn('Could not save progress:', error);
            }
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('eslLessonProgress');
                if (saved) {
                    const progressData = JSON.parse(saved);
                    
                    // Restore completed activities
                    progressData.completedActivities.forEach(activity => {
                        gameState.completedActivities.add(activity);
                        const element = document.querySelector(`[data-activity="${activity}"]`);
                        if (element) {
                            element.classList.add('completed');
                        }
                    });
                    
                    // Restore learned words
                    progressData.learnedWords.forEach(word => {
                        gameState.learnedWords.add(word);
                        const wordElement = document.querySelector(`[onclick*="${word}"]`);
                        if (wordElement) {
                            wordElement.classList.add('learned');
                        }
                    });
                    
                    // Restore game scores if available
                    if (progressData.ticTacToeScores) {
                        gameState.ticTacToe.scores = progressData.ticTacToeScores;
                        updateTicTacToeScores();
                    }
                    
                    if (progressData.sentenceBuilderProgress) {
                        Object.assign(gameState.sentenceBuilder, progressData.sentenceBuilderProgress);
                        updateBuilderDisplay();
                    }
                    
                    if (progressData.wordMatchProgress) {
                        Object.assign(gameState.wordMatch, progressData.wordMatchProgress);
                        updateWordMatchScores();
                    }
                    
                    console.log('Progress loaded successfully from', progressData.lastUpdated);
                    return true;
                }
            } catch (error) {
                console.warn('Could not load progress:', error);
            }
            return false;
        }

        function showSaveIndicator() {
            // Create or update save indicator
            let indicator = document.getElementById('saveIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'saveIndicator';
                indicator.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: var(--success-color);
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: var(--radius-full);
                    font-size: 0.875rem;
                    font-weight: 600;
                    z-index: 1000;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: all var(--transition-normal);
                    pointer-events: none;
                `;
                indicator.innerHTML = '<i class="fas fa-check"></i> Progress Saved';
                document.body.appendChild(indicator);
            }
            
            // Show briefly
            indicator.style.opacity = '1';
            indicator.style.transform = 'translateY(0)';
            
            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transform = 'translateY(20px)';
            }, 2000);
        }

        function clearProgress() {
            if (confirm('Are you sure you want to clear all progress? This cannot be undone.')) {
                localStorage.removeItem('eslLessonProgress');
                location.reload();
            }
        }

        function markActivityComplete(activityName) {
            if (!gameState.completedActivities.has(activityName)) {
                gameState.completedActivities.add(activityName);
                const element = document.querySelector(`[data-activity="${activityName}"]`);
                if (element) {
                    element.classList.add('completed');
                    const icon = element.querySelector('.activity-icon, .chevron-icon');
                    if (icon && icon.classList.contains('activity-icon')) {
                        icon.innerHTML = '<i class="fas fa-check"></i>';
                    }
                }
                updateProgress();
                
                // Visual feedback
                showActivityFeedback(activityName);
            }
        }

        function showActivityFeedback(activityName) {
            const messages = [
                "Great job! üéâ", "Excellent work! ‚≠ê", "Well done! üëè", 
                "Amazing! üåü", "Perfect! ‚ú®", "Outstanding! üéä"
            ];
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            // Create temporary feedback element
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                background: var(--success-color); color: white; padding: 1rem 1.5rem;
                border-radius: var(--radius-lg); box-shadow: var(--shadow-xl);
                font-weight: 600; animation: slideInRight 0.5s ease-out;
            `;
            feedback.textContent = message;
            document.body.appendChild(feedback);
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                feedback.style.animation = 'slideInRight 0.5s ease-out reverse';
                setTimeout(() => feedback.remove(), 500);
                document.head.removeChild(style);
            }, 2000);
        }

        function showCompletionCelebration() {
            const celebration = document.getElementById('completionCelebration');
            celebration.classList.add('show');
            
            // Confetti effect (simple version)
            createConfetti();
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                celebration.classList.remove('show');
            }, 5000);
        }

        function createConfetti() {
            const colors = ['#46bbe5', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed; width: 10px; height: 10px; z-index: 1000;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        top: -10px; left: ${Math.random() * 100}vw;
                        animation: confettiFall ${2 + Math.random() * 3}s linear forwards;
                        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    `;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 100);
            }
            
            // Add confetti animation
            if (!document.querySelector('#confetti-style')) {
                const style = document.createElement('style');
                style.id = 'confetti-style';
                style.textContent = `
                    @keyframes confettiFall {
                        to {
                            transform: translateY(100vh) rotate(720deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Question and Answer functionality
        function toggleQuestion(questionId) {
            const questionItem = document.querySelector(`[data-activity="${questionId}"]`);
            const answerContent = document.getElementById(`answer-${questionId.split('-')[1]}`);
            const chevron = questionItem.querySelector('.chevron-icon');
            const header = questionItem.querySelector('.question-header');
            
            const isOpen = questionItem.classList.contains('open');
            
            if (isOpen) {
                questionItem.classList.remove('open');
                answerContent.style.maxHeight = '0';
                header.setAttribute('aria-expanded', 'false');
            } else {
                questionItem.classList.add('open');
                answerContent.style.maxHeight = '500px';
                header.setAttribute('aria-expanded', 'true');
                
                // Mark as answered after a delay
                setTimeout(() => {
                    questionItem.classList.add('answered');
                    markActivityComplete(questionId);
                }, 1000);
            }
        }

        // Enhanced star constellation game
        function createStar(event) {
            const rect = event.target.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const star = document.createElement('div');
            star.className = 'star clicked';
            star.style.left = x + 'px';
            star.style.top = y + 'px';
            
            // Enhanced vibrant colors for stars
            const colors = ['#ffef94', '#87ceeb', '#ffa07a', '#98fb98', '#f0e68c', '#dda0dd', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            star.style.background = color;
            star.style.boxShadow = `0 0 15px ${color}, 0 0 30px ${color}`;
            
            // Add double-click handler for sparkle effect
            star.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                addSparkleEffect(this);
            });
            
            document.getElementById('starGame').appendChild(star);
            
            const starData = { element: star, x: x, y: y, color: color };
            gameState.stars.push(starData);
            gameState.starCount++;
            
            // Update star counter
            document.getElementById('starCount').textContent = gameState.starCount;
            
            // Connect to nearby stars
            connectNearbyStars(starData);
            
            // Add floating animation
            setTimeout(() => {
                star.style.animation = 'float 3s ease-in-out infinite';
                star.style.animationDelay = Math.random() * 2 + 's';
            }, 600);
            
            // Play sound effect if enabled
            if (gameState.soundEnabled) {
                playStarSound();
            }
            
            // Mark activity as complete after creating 5 stars
            if (gameState.stars.length >= 5) {
                markActivityComplete('constellation');
            }
        }

        function addSparkleEffect(star) {
            // Create sparkle particles around the star
            for (let i = 0; i < 8; i++) {
                const sparkle = document.createElement('div');
                sparkle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: #fff;
                    border-radius: 50%;
                    pointer-events: none;
                    left: ${star.offsetLeft}px;
                    top: ${star.offsetTop}px;
                    animation: sparkle 1s ease-out forwards;
                `;
                
                const angle = (i / 8) * 2 * Math.PI;
                const distance = 20 + Math.random() * 20;
                sparkle.style.setProperty('--end-x', Math.cos(angle) * distance + 'px');
                sparkle.style.setProperty('--end-y', Math.sin(angle) * distance + 'px');
                
                document.getElementById('starGame').appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 1000);
            }
            
            // Add sparkle animation CSS if not already added
            if (!document.querySelector('#sparkle-style')) {
                const style = document.createElement('style');
                style.id = 'sparkle-style';
                style.textContent = `
                    @keyframes sparkle {
                        0% {
                            transform: translate(0, 0) scale(1);
                            opacity: 1;
                        }
                        100% {
                            transform: translate(var(--end-x), var(--end-y)) scale(0);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function createMilkyWay() {
            clearStars();
            
            // Create a galaxy-like pattern
            const centerX = 250;
            const centerY = 150;
            const spiralArms = 3;
            const starsPerArm = 15;
            
            for (let arm = 0; arm < spiralArms; arm++) {
                for (let i = 0; i < starsPerArm; i++) {
                    setTimeout(() => {
                        const angle = (arm * 2 * Math.PI / spiralArms) + (i * 0.3);
                        const radius = 30 + i * 8;
                        const x = centerX + Math.cos(angle) * radius + (Math.random() - 0.5) * 20;
                        const y = centerY + Math.sin(angle) * radius * 0.3 + (Math.random() - 0.5) * 20;
                        
                        const event = {
                            clientX: x,
                            clientY: y,
                            target: document.getElementById('starGame')
                        };
                        
                        // Simulate click event
                        const gameRect = document.getElementById('starGame').getBoundingClientRect();
                        event.clientX += gameRect.left;
                        event.clientY += gameRect.top;
                        
                        createStar(event);
                    }, (arm * starsPerArm + i) * 100);
                }
            }
        }

        function toggleStarSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const icon = document.getElementById('soundIcon');
            icon.className = gameState.soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
        }

        function playStarSound() {
            // Create a simple audio context for sound effects
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                const audioCtx = new (AudioContext || webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.1);
            }
        }

        function connectNearbyStars(newStar) {
            gameState.stars.forEach(star => {
                if (star !== newStar) {
                    const distance = Math.sqrt(
                        Math.pow(newStar.x - star.x, 2) + Math.pow(newStar.y - star.y, 2)
                    );
                    
                    if (distance < 120) {
                        createConnection(star, newStar);
                    }
                }
            });
        }

        function createConnection(star1, star2) {
            const connection = document.createElement('div');
            connection.className = 'star-connection';
            
            const dx = star2.x - star1.x;
            const dy = star2.y - star1.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            connection.style.width = length + 'px';
            connection.style.left = star1.x + 'px';
            connection.style.top = star1.y + 'px';
            connection.style.transform = `rotate(${angle}deg)`;
            connection.style.background = `linear-gradient(90deg, ${star1.color}, ${star2.color})`;
            
            document.getElementById('starGame').appendChild(connection);
            gameState.connections.push(connection);
        }

        function clearStars() {
            const starGame = document.getElementById('starGame');
            const stars = starGame.querySelectorAll('.star');
            const connections = starGame.querySelectorAll('.star-connection');
            
            stars.forEach(star => star.remove());
            connections.forEach(connection => connection.remove());
            
            gameState.stars = [];
            gameState.connections = [];
            gameState.starCount = 0;
            document.getElementById('starCount').textContent = gameState.starCount;
        }

        function randomConstellation() {
            clearStars();
            
            // Create random star pattern
            const starCount = 5 + Math.floor(Math.random() * 5);
            const gameArea = document.getElementById('starGame').getBoundingClientRect();
            
            for (let i = 0; i < starCount; i++) {
                setTimeout(() => {
                    const x = 50 + Math.random() * (gameArea.width - 100);
                    const y = 50 + Math.random() * (gameArea.height - 100);
                    
                    const event = {
                        clientX: gameArea.left + x,
                        clientY: gameArea.top + y,
                        target: document.getElementById('starGame')
                    };
                    createStar(event);
                }, i * 200);
            }
        }

        // Enhanced phonics practice
        function practicePhonics(sound, word) {
            const card = event.target.closest('.phonics-card');
            
            // Visual feedback
            card.style.animation = 'bounce 0.6s ease-out';
            card.style.transform = 'scale(1.05)';
            card.style.borderColor = 'var(--accent-color)';
            
            // Reset after animation
            setTimeout(() => {
                card.style.animation = '';
                card.style.transform = '';
                card.style.borderColor = '';
            }, 600);
            
            // Mark phonics activity as complete after practicing 3 sounds
            const practiceCount = (gameState.phonicsPracticed || 0) + 1;
            gameState.phonicsPracticed = practiceCount;
            
            if (practiceCount >= 3) {
                markActivityComplete('phonics');
            }
        }

        // Grammar practice function
        function practiceGrammar(concept, level) {
            const card = event.target.closest('.grammar-card');
            
            // Visual feedback with level-specific colors
            const color = level === 'junior' ? 'var(--secondary-color)' : 'var(--accent-color)';
            card.style.animation = 'bounce 0.6s ease-out';
            card.style.transform = 'scale(1.05)';
            card.style.borderColor = color;
            card.style.boxShadow = `0 0 20px ${color}40`;
            
            // Reset after animation
            setTimeout(() => {
                card.style.animation = '';
                card.style.transform = '';
                card.style.borderColor = '';
                card.style.boxShadow = '';
            }, 600);
            
            // Track practice for both levels
            const practiceKey = level === 'junior' ? 'grammarJuniorPracticed' : 'grammarHighPracticed';
            const practiceCount = (gameState[practiceKey] || 0) + 1;
            gameState[practiceKey] = practiceCount;
            
            // Mark activity as complete after practicing 3 concepts
            if (practiceCount >= 3) {
                markActivityComplete(level === 'junior' ? 'grammar-junior' : 'grammar-high');
            }
            
            // Show concept explanation
            showGrammarExplanation(concept, level);
        }

        function showGrammarExplanation(concept, level) {
            const explanations = {
                'subject-verb': 'Every sentence needs a subject (who/what) and a verb (action)!',
                'articles': 'Use "a" before consonants, "an" before vowels, "the" for specific things!',
                'plural': 'Most nouns add -s for plural, but some are irregular like child‚Üíchildren!',
                'present-simple': 'Add -s to verbs with he/she/it: He runs, She sings, It works!',
                'possessive': 'Show ownership with my, your, his, her, its, our, their!',
                'questions': 'Start with question words: What, Where, When, Who, Why, How!',
                'conditional': 'Use "if" for possibilities: If it rains, I will stay home!',
                'perfect-tense': 'Shows completed actions: I have finished = action done, result now!',
                'passive': 'Focus on action, not doer: The book was written (by someone)!',
                'relative-clauses': 'Connect ideas: The book (that I read) was amazing!',
                'reported-speech': 'Report what someone said: He said he was tired!',
                'subjunctive': 'For suggestions/recommendations: I suggest that he study more!'
            };
            
            const message = explanations[concept] || 'Great grammar practice!';
            showGrammarFeedback(message, level);
        }

        function showGrammarFeedback(message, level) {
            const feedback = document.createElement('div');
            const bgColor = level === 'junior' ? 'var(--secondary-color)' : 'var(--accent-color)';
            feedback.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                background: ${bgColor}; color: white; padding: 1rem 1.5rem;
                border-radius: var(--radius-lg); box-shadow: var(--shadow-xl);
                font-weight: 600; max-width: 300px; 
                animation: slideInRight 0.5s ease-out;
            `;
            feedback.textContent = message;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.style.animation = 'slideInRight 0.5s ease-out reverse';
                setTimeout(() => feedback.remove(), 500);
            }, 3000);
        }

        // Enhanced Tic Tac Toe game
        function initTicTacToe() {
            const board = document.getElementById('ticTacToeBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'tic-tac-toe-cell';
                cell.setAttribute('role', 'gridcell');
                cell.setAttribute('tabindex', '0');
                cell.setAttribute('aria-label', `Cell ${i + 1}`);
                cell.onclick = () => makeTicTacToeMove(i);
                cell.onkeydown = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        makeTicTacToeMove(i);
                    }
                };
                board.appendChild(cell);
            }
        }

        function makeTicTacToeMove(index) {
            const state = gameState.ticTacToe;
            
            if (state.board[index] === '' && state.gameActive) {
                state.board[index] = state.currentPlayer;
                const cells = document.querySelectorAll('.tic-tac-toe-cell');
                cells[index].textContent = state.currentPlayer;
                cells[index].classList.add(state.currentPlayer.toLowerCase());
                cells[index].setAttribute('aria-label', `Cell ${index + 1}, ${state.currentPlayer}`);
                
                if (checkTicTacToeWinner()) {
                    const winningCombination = getWinningCombination();
                    highlightWinningCells(winningCombination);
                    
                    state.scores[state.currentPlayer]++;
                    updateTicTacToeScores();
                    document.getElementById('gameStatus').textContent = `Player ${state.currentPlayer} wins! üéâ`;
                    state.gameActive = false;
                    
                    markActivityComplete('tictactoe');
                } else if (state.board.every(cell => cell !== '')) {
                    state.scores.ties++;
                    updateTicTacToeScores();
                    document.getElementById('gameStatus').textContent = "It's a tie! ü§ù";
                    state.gameActive = false;
                } else {
                    state.currentPlayer = state.currentPlayer === 'X' ? 'O' : 'X';
                    document.getElementById('gameStatus').textContent = `Player ${state.currentPlayer}'s turn`;
                }
            }
        }

        function checkTicTacToeWinner() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6] // diagonals
            ];
            
            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                const board = gameState.ticTacToe.board;
                return board[a] && board[a] === board[b] && board[a] === board[c];
            });
        }

        function getWinningCombination() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6] // diagonals
            ];
            
            return winPatterns.find(pattern => {
                const [a, b, c] = pattern;
                const board = gameState.ticTacToe.board;
                return board[a] && board[a] === board[b] && board[a] === board[c];
            });
        }

        function highlightWinningCells(combination) {
            const cells = document.querySelectorAll('.tic-tac-toe-cell');
            combination.forEach(index => {
                cells[index].classList.add('winning');
            });
        }

        function updateTicTacToeScores() {
            const scores = gameState.ticTacToe.scores;
            document.getElementById('scoreX').textContent = scores.X;
            document.getElementById('scoreO').textContent = scores.O;
            document.getElementById('scoreTies').textContent = scores.ties;
        }

        function resetTicTacToe() {
            gameState.ticTacToe.board = Array(9).fill('');
            gameState.ticTacToe.currentPlayer = 'X';
            gameState.ticTacToe.gameActive = true;
            
            document.getElementById('gameStatus').textContent = "Player X's turn";
            initTicTacToe();
        }

        function resetScores() {
            gameState.ticTacToe.scores = { X: 0, O: 0, ties: 0 };
            updateTicTacToeScores();
        }

        // Enhanced word matching game
        function selectWord(element, word) {
            const matchState = gameState.wordMatch;
            
            if (element.classList.contains('matched')) return;
            
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                matchState.selectedWords = matchState.selectedWords.filter(w => w.element !== element);
            } else {
                element.classList.add('selected');
                matchState.selectedWords.push({ element: element, word: word });
            }
            
            if (matchState.selectedWords.length === 2) {
                matchState.attempts++;
                checkWordMatch();
            }
        }

        function checkWordMatch() {
            const matchState = gameState.wordMatch;
            const [word1, word2] = matchState.selectedWords;
            
            if (matchState.rhymePairs[word1.word] === word2.word) {
                // Correct match!
                word1.element.classList.remove('selected');
                word2.element.classList.remove('selected');
                word1.element.classList.add('matched');
                word2.element.classList.add('matched');
                
                matchState.matchedPairs++;
                updateWordMatchScores();
                
                // Check if all pairs are matched
                if (matchState.matchedPairs === 5) {
                    markActivityComplete('wordmatch');
                    setTimeout(() => {
                        alert('üéâ Excellent! You found all the rhyming pairs!');
                    }, 500);
                }
            } else {
                // Incorrect match
                word1.element.classList.add('incorrect');
                word2.element.classList.add('incorrect');
                
                setTimeout(() => {
                    word1.element.classList.remove('selected', 'incorrect');
                    word2.element.classList.remove('selected', 'incorrect');
                }, 1000);
            }
            
            matchState.selectedWords = [];
            updateWordMatchScores();
        }

        function updateWordMatchScores() {
            const matchState = gameState.wordMatch;
            const accuracy = matchState.attempts > 0 ? 
                Math.round((matchState.matchedPairs / matchState.attempts) * 100) : 100;
            
            document.getElementById('matchedPairs').textContent = matchState.matchedPairs;
            document.getElementById('attempts').textContent = matchState.attempts;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        function resetWordGame() {
            const matchState = gameState.wordMatch;
            
            // Reset all word items
            document.querySelectorAll('.word-item').forEach(item => {
                item.classList.remove('selected', 'matched', 'incorrect');
            });
            
            // Reset game state
            matchState.selectedWords = [];
            matchState.matchedPairs = 0;
            matchState.attempts = 0;
            
            updateWordMatchScores();
        }

        function shuffleWords() {
            const columns = document.querySelectorAll('.word-column');
            
            columns.forEach(column => {
                const items = Array.from(column.querySelectorAll('.word-item'));
                const container = items[0].parentNode;
                
                // Shuffle array
                for (let i = items.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [items[i], items[j]] = [items[j], items[i]];
                }
                
                // Re-append in new order
                items.forEach(item => container.appendChild(item));
            });
        }

        // Keyboard navigation support
        document.addEventListener('keydown', function(e) {
            if (e.target.matches('.question-header, .grammar-card, .word-item, .word-piece')) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    e.target.click();
                }
            }
        });

        // Sentence Builder Game Functions
        function initSentenceBuilder() {
            loadCurrentSentence();
            setupDragAndDrop();
        }

        function loadCurrentSentence() {
            const builderState = gameState.sentenceBuilder;
            const sentence = builderState.sentences[builderState.currentSentence];
            
            // Update target sentence
            document.getElementById('sentenceTarget').textContent = sentence.target;
            
            // Shuffle and display words
            const shuffledWords = [...sentence.words].sort(() => Math.random() - 0.5);
            const wordBank = document.getElementById('wordBank');
            wordBank.innerHTML = '';
            
            shuffledWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word-piece';
                wordElement.textContent = word;
                wordElement.draggable = true;
                wordElement.dataset.word = word;
                wordBank.appendChild(wordElement);
            });
            
            // Clear drop zone
            const dropZone = document.getElementById('dropZone');
            dropZone.innerHTML = '<div class="drop-placeholder">Drag words here to build your sentence</div>';
            builderState.droppedWords = [];
            
            // Update display
            updateBuilderDisplay();
        }

        function setupDragAndDrop() {
            const wordBank = document.getElementById('wordBank');
            const dropZone = document.getElementById('dropZone');
            
            // Handle drag start from word bank
            wordBank.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('word-piece') && !e.target.classList.contains('used')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.dataset.word);
                    e.dataTransfer.setData('source', 'bank');
                }
            });
            
            wordBank.addEventListener('dragend', function(e) {
                e.target.classList.remove('dragging');
            });
            
            // Handle drop zone events
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const word = e.dataTransfer.getData('text/plain');
                const source = e.dataTransfer.getData('source');
                
                if (source === 'bank') {
                    addWordToSentence(word);
                }
            });
        }

        function addWordToSentence(word) {
            const builderState = gameState.sentenceBuilder;
            const dropZone = document.getElementById('dropZone');
            
            // Remove placeholder if it exists
            const placeholder = dropZone.querySelector('.drop-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            // Create dropped word element
            const droppedWord = document.createElement('div');
            droppedWord.className = 'dropped-word';
            droppedWord.textContent = word;
            droppedWord.onclick = () => removeWordFromSentence(droppedWord, word);
            
            dropZone.appendChild(droppedWord);
            builderState.droppedWords.push(word);
            
            // Mark word as used in bank
            const wordPieces = document.querySelectorAll('.word-piece');
            wordPieces.forEach(piece => {
                if (piece.dataset.word === word && !piece.classList.contains('used')) {
                    piece.classList.add('used');
                    return false; // Only mark the first unused instance
                }
            });
        }

        function removeWordFromSentence(element, word) {
            const builderState = gameState.sentenceBuilder;
            
            // Remove from UI
            element.remove();
            
            // Remove from state
            const index = builderState.droppedWords.indexOf(word);
            if (index > -1) {
                builderState.droppedWords.splice(index, 1);
            }
            
            // Unmark word in bank
            const wordPieces = document.querySelectorAll('.word-piece');
            wordPieces.forEach(piece => {
                if (piece.dataset.word === word && piece.classList.contains('used')) {
                    piece.classList.remove('used');
                    return false; // Only unmark the first used instance
                }
            });
            
            // Add placeholder if no words left
            const dropZone = document.getElementById('dropZone');
            if (dropZone.children.length === 0) {
                dropZone.innerHTML = '<div class="drop-placeholder">Drag words here to build your sentence</div>';
            }
        }

        function checkSentence() {
            const builderState = gameState.sentenceBuilder;
            const currentSentence = builderState.sentences[builderState.currentSentence];
            const userSentence = builderState.droppedWords.join(' ');
            const targetSentence = currentSentence.target;
            
            const feedbackElement = document.querySelector('.feedback-message');
            
            if (userSentence === targetSentence) {
                // Correct!
                feedbackElement.textContent = 'üéâ Perfect! That\'s exactly right!';
                feedbackElement.className = 'feedback-message feedback-correct';
                
                builderState.score += 10;
                builderState.completed++;
                
                if (builderState.completed >= builderState.sentences.length) {
                    markActivityComplete('sentence-builder');
                    setTimeout(() => {
                        feedbackElement.textContent = 'üèÜ Congratulations! You\'ve completed all sentences!';
                    }, 2000);
                } else {
                    setTimeout(() => {
                        nextSentence();
                    }, 2000);
                }
            } else {
                // Incorrect
                feedbackElement.textContent = '‚ùå Not quite right. Try again!';
                feedbackElement.className = 'feedback-message feedback-incorrect';
            }
            
            updateBuilderDisplay();
        }

        function getHint() {
            const builderState = gameState.sentenceBuilder;
            const currentSentence = builderState.sentences[builderState.currentSentence];
            
            const feedbackElement = document.querySelector('.feedback-message');
            feedbackElement.textContent = 'üí° Hint: ' + currentSentence.hint;
            feedbackElement.className = 'feedback-message feedback-hint';
        }

        function clearSentence() {
            const builderState = gameState.sentenceBuilder;
            const dropZone = document.getElementById('dropZone');
            
            // Remove all dropped words
            const droppedWords = dropZone.querySelectorAll('.dropped-word');
            droppedWords.forEach(word => {
                removeWordFromSentence(word, word.textContent);
            });
            
            // Clear feedback
            const feedbackElement = document.querySelector('.feedback-message');
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback-message';
        }

        function nextSentence() {
            const builderState = gameState.sentenceBuilder;
            
            if (builderState.currentSentence < builderState.sentences.length - 1) {
                builderState.currentSentence++;
                builderState.level = Math.floor(builderState.currentSentence / 2) + 1;
                loadCurrentSentence();
                
                // Clear feedback
                const feedbackElement = document.querySelector('.feedback-message');
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback-message';
            }
        }

        function updateBuilderDisplay() {
            const builderState = gameState.sentenceBuilder;
            
            document.getElementById('builderScore').textContent = builderState.score;
            document.getElementById('builderLevel').textContent = builderState.level;
            document.getElementById('sentencesCompleted').textContent = builderState.completed;
        }

        // Initialize the lesson when page loads
        window.addEventListener('load', function() {
            // Load saved progress first
            const progressLoaded = loadProgress();
            
            initTicTacToe();
            initSentenceBuilder();
            initMobileNavigation();
            initThemeToggle();
            updateProgress();
            updateVocabularyCount();
            
            // Show welcome message for new users
            if (!progressLoaded) {
                setTimeout(() => {
                    showWelcomeMessage();
                }, 1000);
            }
            
            // Load voices for text-to-speech
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = function() {
                    console.log('Speech synthesis voices loaded');
                };
            }
            
            // Add settings button to header if not exists
            addSettingsButton();
            
            // Add floating animation CSS and other styles
            const enhancedStyles = document.createElement('style');
            enhancedStyles.textContent = `
                @keyframes float {
                    0%, 100% { transform: translateY(0px); }
                    50% { transform: translateY(-15px); }
                }
                
                /* Dark mode styles */
                .dark-mode {
                    --text-primary: #f9fafb;
                    --text-secondary: #d1d5db;
                    --text-muted: #9ca3af;
                    --bg-primary: #1f2937;
                    --bg-secondary: #374151;
                    --bg-tertiary: #4b5563;
                    --border-color: #4b5563;
                }
                
                .dark-mode .site-header {
                    background: rgba(31, 41, 55, 0.95);
                }
                
                .dark-mode .lesson-section,
                .dark-mode .progress-section,
                .dark-mode .vocabulary-tracker {
                    background: rgba(31, 41, 55, 0.95);
                }
                
                .dark-mode .lesson-header {
                    background: rgba(31, 41, 55, 0.95);
                }
                
                /* Settings modal */
                .settings-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: none;
                    align-items: center;
                    justify-content: center;
                    z-index: 2000;
                }
                
                .settings-content {
                    background: var(--bg-primary);
                    border-radius: var(--radius-xl);
                    padding: 2rem;
                    max-width: 400px;
                    width: 90%;
                    position: relative;
                }
                
                .settings-title {
                    font-size: 1.5rem;
                    font-weight: 700;
                    margin-bottom: 1.5rem;
                    color: var(--text-primary);
                }
                
                .setting-item {
                    margin-bottom: 1rem;
                    padding: 1rem;
                    background: var(--bg-secondary);
                    border-radius: var(--radius);
                }
                
                .setting-label {
                    font-weight: 600;
                    margin-bottom: 0.5rem;
                    color: var(--text-primary);
                }
                
                .setting-button {
                    width: 100%;
                    padding: 0.75rem;
                    background: var(--primary-color);
                    color: white;
                    border: none;
                    border-radius: var(--radius);
                    cursor: pointer;
                    font-weight: 600;
                    transition: all var(--transition-normal);
                }
                
                .setting-button:hover {
                    background: var(--primary-hover);
                }
                
                .setting-button.danger {
                    background: var(--error-color);
                }
                
                .close-settings {
                    position: absolute;
                    top: 1rem;
                    right: 1rem;
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    color: var(--text-secondary);
                    cursor: pointer;
                }
                
                /* Improved mobile responsiveness */
                @media (max-width: 480px) {
                    .vocab-words {
                        justify-content: center;
                    }
                    
                    .tips-list {
                        grid-template-columns: 1fr;
                    }
                    
                    .progress-stats {
                        gap: 1rem;
                        flex-wrap: wrap;
                        justify-content: center;
                    }
                    
                    .settings-content {
                        padding: 1.5rem;
                    }
                }
            `;
            document.head.appendChild(enhancedStyles);
            
            // Enhanced keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.target.matches('.vocab-word')) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        e.target.click();
                    }
                }
                
                // ESC to close settings
                if (e.key === 'Escape') {
                    const modal = document.getElementById('settingsModal');
                    if (modal && modal.style.display === 'flex') {
                        modal.style.display = 'none';
                    }
                }
            });
            
            console.log('üéì Enhanced Interactive English Lesson loaded successfully with all features!');
            console.log('Features: Navigation, Dark Mode, Text-to-Speech, Vocabulary Tracking, Progress Saving, Mobile Support');
        });

        function showWelcomeMessage() {
            const welcome = document.createElement('div');
            welcome.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--gradient-primary);
                color: white;
                padding: 2rem;
                border-radius: var(--radius-xl);
                text-align: center;
                z-index: 2000;
                box-shadow: var(--shadow-xl);
                max-width: 400px;
                width: 90%;
            `;
            welcome.innerHTML = `
                <h3 style="margin-bottom: 1rem; font-size: 1.5rem;">Welcome to Your English Lesson! üéì</h3>
                <p style="margin-bottom: 1.5rem; opacity: 0.9;">Your progress will be automatically saved as you learn. Click anywhere to start your journey!</p>
                <button onclick="this.parentElement.remove()" style="background: white; color: var(--primary-color); border: none; padding: 0.75rem 1.5rem; border-radius: var(--radius); font-weight: 600; cursor: pointer;">Let's Begin!</button>
            `;
            document.body.appendChild(welcome);
        }

        function addSettingsButton() {
            const navActions = document.querySelector('.nav-actions');
            if (navActions && !document.getElementById('settingsBtn')) {
                const settingsBtn = document.createElement('button');
                settingsBtn.id = 'settingsBtn';
                settingsBtn.className = 'theme-toggle';
                settingsBtn.innerHTML = '<i class="fas fa-cog"></i>';
                settingsBtn.setAttribute('aria-label', 'Open settings');
                settingsBtn.onclick = toggleSettings;
                
                navActions.insertBefore(settingsBtn, navActions.firstChild);
                
                // Add settings modal
                const modal = document.createElement('div');
                modal.id = 'settingsModal';
                modal.className = 'settings-modal';
                modal.innerHTML = `
                    <div class="settings-content">
                        <button class="close-settings" onclick="toggleSettings()">√ó</button>
                        <h3 class="settings-title">Lesson Settings</h3>
                        
                        <div class="setting-item">
                            <div class="setting-label">Progress Management</div>
                            <button class="setting-button" onclick="saveProgress(); alert('Progress saved manually!')">
                                <i class="fas fa-save"></i> Save Progress Now
                            </button>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">Reset All Progress</div>
                            <button class="setting-button danger" onclick="clearProgress()">
                                <i class="fas fa-trash"></i> Clear All Progress
                            </button>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">Audio Settings</div>
                            <button class="setting-button" onclick="toggleSoundSettings(this)">
                                <i class="fas fa-volume-up"></i> Sound: ON
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
            }
        }

        function toggleSoundSettings(button) {
            gameState.soundEnabled = !gameState.soundEnabled;
            button.innerHTML = gameState.soundEnabled ? 
                '<i class="fas fa-volume-up"></i> Sound: ON' : 
                '<i class="fas fa-volume-mute"></i> Sound: OFF';
        }

        // Accessibility: Announce activity completions to screen readers
        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';
            announcement.textContent = message;
            
            document.body.appendChild(announcement);
            setTimeout(() => document.body.removeChild(announcement), 1000);
        }

        // Enhanced activity completion with announcements
        const originalMarkComplete = markActivityComplete;
        markActivityComplete = function(activityName) {
            originalMarkComplete(activityName);
            
            const activityNames = {
                'question-1': 'Name question',
                'question-2': 'Location question', 
                'question-3': 'Friend question',
                'question-4': 'Birthday question',
                'question-5': 'English learning question',
                'question-6': 'Age question',
                'question-7': 'Free time question',
                'question-8': 'Transportation question',
                'question-9': 'Season preference question',
                'question-10': 'Family question',
                'constellation': 'Enhanced star constellation game',
                'grammar-junior': 'Junior school grammar practice',
                'grammar-high': 'High school grammar practice',
                'tictactoe': 'Tic tac toe game',
                'sentence-builder': 'Sentence builder challenge',
                'wordmatch': 'Word matching game'
            };
            
            const activityDisplayName = activityNames[activityName] || activityName;
            announceToScreenReader(`Completed: ${activityDisplayName}`);
        };
    </script>
</body>
</html>
    </script>
</body>
</html>