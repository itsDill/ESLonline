<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-2456627863532019" />
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Login to ESL Fun Online - Access your personalized learning dashboard with interactive English and coding resources."
    />
    <meta
      name="keywords"
      content="ESL Fun Online login, student portal, teacher dashboard, English learning login, coding course access"
    />
    <meta name="author" content="ESL Fun Online" />
    <meta name="robots" content="noindex, nofollow" />

    <!-- Open Graph Tags -->
    <meta property="og:title" content="Login - ESL Fun Online" />
    <meta
      property="og:description"
      content="Access your personalized learning dashboard"
    />
    <meta property="og:image" content="https://eslfunonline.com/images/1.png" />
    <meta property="og:url" content="https://eslfunonline.com/login.html" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Login - ESL Fun Online" />
    <meta
      name="twitter:description"
      content="Access your personalized learning dashboard"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/1.png"
    />

    <title>üîê Login - ESL Fun Online | Access Your Learning Dashboard</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/1.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="images/1.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="images/1.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#46bbe5" />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Google Fonts -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
    /></noscript>

    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/mobile-optimized.css" />
    <link rel="stylesheet" href="css/login.css" />

    <!-- Performance optimizations -->
    <style>
      /* Critical above-the-fold styles */
      body {
        margin: 0;
        padding: 0;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }
      
      body.loaded {
        opacity: 1;
      }

      /* Enhanced loading spinner */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .loading-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(70, 187, 229, 0.2);
        border-top: 4px solid #46bbe5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Strength meter styles */
      .strength-meter {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        margin-top: 0.5rem;
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .strength-meter.visible {
        opacity: 1;
      }

      .strength-meter-fill {
        height: 100%;
        transition: all 0.3s ease;
        border-radius: 2px;
      }

      .strength-weak {
        width: 33%;
        background: #ef4444;
      }

      .strength-medium {
        width: 66%;
        background: #f59e0b;
      }

      .strength-strong {
        width: 100%;
        background: #10b981;
      }

      /* Capslock warning */
      .capslock-warning {
        display: none;
        align-items: center;
        gap: 0.5rem;
        color: #f59e0b;
        font-size: 0.85rem;
        margin-top: 0.5rem;
        animation: slideDown 0.3s ease-out;
      }

      .capslock-warning.visible {
        display: flex;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
    </div>

    <!-- Skip Link for Accessibility -->
    <a href="#loginForm" class="skip-link">Skip to login form</a>

    <!-- Toast Notification Container -->
    <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px;"></div>

    <!-- Main Login Section -->
    <main class="hero-login" role="main">
      <img
        src="images/11.png"
        alt="ESL Fun Online Background"
        class="hero-bg"
      />
      <div class="login-container">
        <div class="login-card" id="loginCard">
          <!-- Logo Section -->
          <div class="logo-section">
            <div class="logo-icon" id="logoIcon">
              <i class="fas fa-graduation-cap" id="logoIconElement"></i>
            </div>
            <h1 class="login-title">Welcome Back!</h1>
            <p class="login-subtitle">
              Sign in to continue your learning journey
            </p>
          </div>

          <!-- User Type Toggle -->
          <div
            class="user-type-toggle"
            role="radiogroup"
            aria-label="Select user type"
          >
            <div
              class="toggle-option active student"
              id="studentToggle"
              role="radio"
              aria-checked="true"
              tabindex="0"
              onclick="switchUserType('student')"
              onkeydown="handleToggleKeydown(event, 'student')"
            >
              <i class="fas fa-user-graduate"></i>
              <span>Student</span>
            </div>
            <div
              class="toggle-option teacher"
              id="teacherToggle"
              role="radio"
              aria-checked="false"
              tabindex="-1"
              onclick="switchUserType('teacher')"
              onkeydown="handleToggleKeydown(event, 'teacher')"
            >
              <i class="fas fa-chalkboard-teacher"></i>
              <span>Teacher</span>
            </div>
          </div>

          <!-- Login Form -->
          <form id="loginForm" novalidate aria-label="Login form">
            <!-- Error/Success Messages -->
            <div
              class="message error"
              id="errorMessage"
              role="alert"
              aria-live="polite"
            ></div>
            <div
              class="message success"
              id="successMessage"
              role="alert"
              aria-live="polite"
            ></div>

            <!-- Username Field -->
            <div class="form-group">
              <label for="username" class="form-label">
                <i class="fas fa-user"></i>
                Username
              </label>
              <input
                type="text"
                id="username"
                name="username"
                class="form-input student-mode"
                placeholder="Enter your username"
                required
                autocomplete="username"
                aria-describedby="usernameHelp"
                maxlength="50"
              />
              <div id="usernameHelp" class="sr-only">
                Enter the username provided to you
              </div>
            </div>

            <!-- Password Field -->
            <div class="form-group">
              <label for="password" class="form-label">
                <i class="fas fa-lock"></i>
                Password
              </label>
              <div style="position: relative">
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="form-input student-mode"
                  placeholder="Enter your password"
                  required
                  autocomplete="current-password"
                  aria-describedby="passwordHelp"
                  maxlength="100"
                />
                <button
                  type="button"
                  id="togglePassword"
                  class="password-toggle"
                  onclick="togglePasswordVisibility()"
                  aria-label="Toggle password visibility"
                  style="
                    position: absolute;
                    right: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: #6b7280;
                    cursor: pointer;
                    padding: 4px;
                  "
                >
                  <i class="fas fa-eye" id="passwordToggleIcon"></i>
                </button>
              </div>
              <!-- Caps Lock Warning -->
              <div class="capslock-warning" id="capslockWarning">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Caps Lock is ON</span>
              </div>
              <!-- Password Strength Meter -->
              <div class="strength-meter" id="strengthMeter">
                <div class="strength-meter-fill" id="strengthFill"></div>
              </div>
              <div id="passwordHelp" class="sr-only">Enter your password</div>
            </div>

            <!-- Remember Me & Forgot Password -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem;">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.9rem; color: #374151;">
                <input type="checkbox" id="rememberMe" style="cursor: pointer; width: 16px; height: 16px; accent-color: #46bbe5;">
                <span>Remember me</span>
              </label>
          <!-- Footer Links -->
          <div class="login-footer">
            <a href="contact.html" class="footer-link">
              <i class="fas fa-question-circle"></i>
              Need help logging in?
            </a>
            <a href="index.html" class="home-link">
              <i class="fas fa-arrow-left"></i>
              <span>Back to Homepage</span>
            </a>
            
            <!-- Demo Credentials Info -->
            <div style="margin-top: 1.5rem; padding: 1rem; background: #f0f9ff; border-radius: 12px; border-left: 4px solid #46bbe5;">
              <div style="display: flex; align-items: start; gap: 0.75rem;">
                <i class="fas fa-info-circle" style="color: #46bbe5; font-size: 1.25rem; margin-top: 2px;"></i>
                <div style="flex: 1;">
                  <div style="font-weight: 600; color: #0c4a6e; margin-bottom: 0.5rem; font-size: 0.9rem;">Demo Access</div>
                  <div style="color: #075985; font-size: 0.85rem; line-height: 1.5;">
                    <strong>Username:</strong> demo<br>
                    <strong>Password:</strong> demo
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Google AdSense -->
      </main>/button>
            <div id="loginButtonHelp" class="sr-only">
              Click to sign in to your account
            </div>
          </form>

          <!-- Footer Links -->
          <div class="login-footer">
            <a href="contact.html" class="footer-link">
              <i class="fas fa-question-circle"></i>
              Need help logging in?
            </a>
            <a href="index.html" class="home-link">
              <i class="fas fa-arrow-left"></i>
              <span>Back to Homepage</span>
            </a>
          </div>
        </div>
      </div>
      <!-- Google AdSense -->
      </main>

    <!-- Scripts -->
    <script src="js/navigation.js"></script>
    <script src="js/main.js"></script>
    <script src="js/credentials.js"></script>
    <script>
      // Global variables
      let currentUserType = "student";
      let isLoading = false;

      // Immediate initialization - don't wait for anything
      (function() {
        // Hide loading overlay ASAP
        const loadingOverlay = document.getElementById("loadingOverlay");
        if (loadingOverlay) {
          loadingOverlay.classList.add("hidden");
          setTimeout(() => loadingOverlay.remove(), 300);
        }
        
        // Show body immediately
        document.body.style.opacity = "1";
        document.body.classList.add("loaded");
      })();

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Check if user is already authenticated
        const isAuthenticated =
          sessionStorage.getItem("studentPortalAuth") ||
          localStorage.getItem("studentPortalAuth");
        if (isAuthenticated) {
          // Get user info to redirect to appropriate dashboard
          const currentUser = JSON.parse(
            sessionStorage.getItem("currentUser") || "{}"
          );
          if (currentUser.dashboard) {
            window.location.href = currentUser.dashboard;
            return;
          }
        }

        initializePage();
        setupEventListeners();
      });

      function initializePage() {
        // Apply initial user type styling
        switchUserType("student");

        // Focus on username field for better UX
        setTimeout(() => {
          const usernameField = document.getElementById("username");
          if (usernameField) {
            usernameField.focus();
          }
        }, 100);
      }

      function hideLoadingOverlay() {
        const loadingOverlay = document.getElementById("loadingOverlay");
        if (loadingOverlay) {
          loadingOverlay.classList.add("hidden");
          setTimeout(() => {
            loadingOverlay.remove();
          }, 300);
        }
      }

      function setupEventListeners() {
        // Form submission
        const loginForm = document.getElementById("loginForm");
        if (loginForm) {
          loginForm.addEventListener("submit", handleLogin);
        }

        // Real-time input validation
        const username = document.getElementById("username");
        const password = document.getElementById("password");

        if (username) {
          username.addEventListener("input", clearValidationState);
          username.addEventListener("blur", validateUsername);
        }

        if (password) {
          password.addEventListener("input", function () {
            clearValidationState();
            updatePasswordStrength();
          });
          password.addEventListener("blur", validatePassword);
          password.addEventListener("keyup", checkCapsLock);
        }

        // Remember me functionality
        const rememberMe = document.getElementById("rememberMe");
        if (rememberMe) {
          // Load saved preference
          const savedUsername = localStorage.getItem("savedUsername");
          if (savedUsername) {
            username.value = savedUsername;
            rememberMe.checked = true;
          }
        }

        // Enter key navigation
        document.addEventListener("keydown", function (e) {
          if (e.key === "Enter" && !isLoading) {
            const activeElement = document.activeElement;
            if (activeElement.classList.contains("toggle-option")) {
              activeElement.click();
            }
          }
        });

        // Add input animation on focus
        document.querySelectorAll(".form-input").forEach((input) => {
          input.addEventListener("focus", function () {
            this.parentElement.classList.add("focused");
          });
          input.addEventListener("blur", function () {
            this.parentElement.classList.remove("focused");
          });
        });
      }

      // Check Caps Lock status
      function checkCapsLock(e) {
        const capslockWarning = document.getElementById("capslockWarning");
        if (capslockWarning) {
          if (e.getModifierState && e.getModifierState("CapsLock")) {
            capslockWarning.classList.add("visible");
          } else {
            capslockWarning.classList.remove("visible");
          }
        }
      }

      // Update password strength meter
      function updatePasswordStrength() {
        const password = document.getElementById("password").value;
        const strengthMeter = document.getElementById("strengthMeter");
        const strengthFill = document.getElementById("strengthFill");

        if (!password) {
          strengthMeter.classList.remove("visible");
          return;
        }

        strengthMeter.classList.add("visible");

        let strength = 0;
        if (password.length >= 6) strength++;
        if (password.length >= 10) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/\d/.test(password)) strength++;
        if (/[^a-zA-Z\d]/.test(password)) strength++;

        strengthFill.className = "strength-meter-fill";

        if (strength <= 2) {
          strengthFill.classList.add("strength-weak");
        } else if (strength <= 3) {
          strengthFill.classList.add("strength-medium");
        } else {
          strengthFill.classList.add("strength-strong");
        }
      }

      function switchUserType(type) {
        if (isLoading) return;

        currentUserType = type;

        // Update toggle buttons
        const studentToggle = document.getElementById("studentToggle");
        const teacherToggle = document.getElementById("teacherToggle");
        const loginCard = document.getElementById("loginCard");
        const logoIcon = document.getElementById("logoIcon");
        const logoIconElement = document.getElementById("logoIconElement");
        const inputs = document.querySelectorAll(".form-input");
        const loginButton = document.getElementById("loginButton");

        // Clear any existing validation states
        clearMessages();
        clearValidationStates();

        if (type === "student") {
          // Student mode
          studentToggle.classList.add("active", "student");
          studentToggle.setAttribute("aria-checked", "true");
          studentToggle.setAttribute("tabindex", "0");

          teacherToggle.classList.remove("active", "teacher");
          teacherToggle.setAttribute("aria-checked", "false");
          teacherToggle.setAttribute("tabindex", "-1");

          loginCard.className = "login-card student-mode";
          logoIcon.className = "logo-icon student-mode";
          logoIconElement.className = "fas fa-user-graduate";
          loginButton.className = "login-btn student-mode";

          inputs.forEach((input) => {
            input.className =
              input.className.replace(/\b(student|teacher)-mode\b/g, "") +
              " student-mode";
          });
        } else if (type === "teacher") {
          // Teacher mode
          teacherToggle.classList.add("active", "teacher");
          teacherToggle.setAttribute("aria-checked", "true");
          teacherToggle.setAttribute("tabindex", "0");

          studentToggle.classList.remove("active", "student");
          studentToggle.setAttribute("aria-checked", "false");
          studentToggle.setAttribute("tabindex", "-1");

          loginCard.className = "login-card teacher-mode";
          logoIcon.className = "logo-icon teacher-mode";
          logoIconElement.className = "fas fa-chalkboard-teacher";
          loginButton.className = "login-btn teacher-mode";

          inputs.forEach((input) => {
            input.className =
              input.className.replace(/\b(student|teacher)-mode\b/g, "") +
              " teacher-mode";
          });
        }

        // Update placeholder text based on user type
        const usernameInput = document.getElementById("username");
        const passwordInput = document.getElementById("password");

        if (type === "student") {
          usernameInput.placeholder = "Enter your student ID";
          passwordInput.placeholder = "Enter your password";
        } else {
          usernameInput.placeholder = "Enter your teacher ID";
          passwordInput.placeholder = "Enter your password";
        }

        // Add smooth transition effect
        loginCard.style.transform = "scale(0.98)";
        setTimeout(() => {
          loginCard.style.transform = "scale(1)";
        }, 150);
      }

      function handleToggleKeydown(event, type) {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          switchUserType(type);
        } else if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
          event.preventDefault();
          const newType = type === "student" ? "teacher" : "student";
          switchUserType(newType);
          document.getElementById(newType + "Toggle").focus();
        }
      }

      function validateUsername() {
        const username = document.getElementById("username");
        const value = username.value.trim();

        if (!value) {
          setFieldError(username, "Username is required");
          return false;
        }

        if (value.length < 2) {
          setFieldError(username, "Username must be at least 2 characters");
          return false;
        }

        setFieldSuccess(username);
        return true;
      }

      function validatePassword() {
        const password = document.getElementById("password");
        const value = password.value;

        if (!value) {
          setFieldError(password, "Password is required");
          return false;
        }

        if (value.length < 3) {
          setFieldError(password, "Password must be at least 3 characters");
          return false;
        }

        setFieldSuccess(password);
        return true;
      }

      function setFieldError(field, message) {
        field.classList.remove("success");
        field.classList.add("error");
        field.setAttribute("aria-invalid", "true");

        // Remove existing tooltip if any
        const existingTooltip = field.parentElement.querySelector(".validation-tooltip");
        if (existingTooltip) {
          existingTooltip.remove();
        }

        // Create and add new tooltip
        const tooltip = document.createElement("div");
        tooltip.className = "validation-tooltip";
        tooltip.textContent = message;
        tooltip.setAttribute("role", "alert");
        field.parentElement.appendChild(tooltip);

        // Auto-hide tooltip after 3 seconds
        setTimeout(() => {
          if (tooltip.parentElement) {
            tooltip.style.animation = "tooltipFadeOut 0.3s ease-out";
            setTimeout(() => tooltip.remove(), 300);
          }
        }, 3000);
      }

      function setFieldSuccess(field) {
        field.classList.remove("error");
        field.classList.add("success");
        field.setAttribute("aria-invalid", "false");

        // Remove tooltip if any
        const tooltip = field.parentElement.querySelector(".validation-tooltip");
        if (tooltip) {
          tooltip.style.animation = "tooltipFadeOut 0.3s ease-out";
          setTimeout(() => tooltip.remove(), 300);
        }

        // Show toast notification for successful validation
        // showToast("Field validated successfully", "success", 1500);
      }

      function clearValidationState() {
        clearMessages();
        const inputs = document.querySelectorAll(".form-input");
        inputs.forEach((input) => {
          input.classList.remove("error", "success");
          input.removeAttribute("aria-invalid");
          input.removeAttribute("title");
          
          // Remove any tooltips
          const tooltip = input.parentElement.querySelector(".validation-tooltip");
          if (tooltip) {
            tooltip.remove();
          }
        });
      }

      function clearValidationStates() {
        const inputs = document.querySelectorAll(".form-input");
        inputs.forEach((input) => {
          input.classList.remove("error", "success");
          input.removeAttribute("aria-invalid");
          input.removeAttribute("title");
          
          // Remove any tooltips
          const tooltip = input.parentElement.querySelector(".validation-tooltip");
          if (tooltip) {
            tooltip.remove();
          }
        });
      }

      function togglePasswordVisibility() {
        const passwordField = document.getElementById("password");
        const toggleIcon = document.getElementById("passwordToggleIcon");
        const toggleButton = document.getElementById("togglePassword");

        if (passwordField.type === "password") {
          passwordField.type = "text";
          toggleIcon.className = "fas fa-eye-slash";
          toggleButton.setAttribute("aria-label", "Hide password");
        } else {
          passwordField.type = "password";
          toggleIcon.className = "fas fa-eye";
          toggleButton.setAttribute("aria-label", "Show password");
        }
      }

      function handleLogin(event) {
        event.preventDefault();

        if (isLoading) return;

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;
        const rememberMe = document.getElementById("rememberMe").checked;

        // Clear previous messages
        clearMessages();

        // Validate form
        const isUsernameValid = validateUsername();
        const isPasswordValid = validatePassword();

        if (!isUsernameValid || !isPasswordValid) {
          showMessage("Please fix the errors above", "error");
          return;
        }

        // Save username if remember me is checked
        if (rememberMe) {
          localStorage.setItem("savedUsername", username);
        } else {
          localStorage.removeItem("savedUsername");
        }

        // Set loading state
        setLoadingState(true);

        // Add ripple effect to button
        addRippleEffect(event);

        // Simulate network delay for better UX (reduced for faster response)
        setTimeout(() => {
          // Validate credentials using the imported function
          const result = validateCredentials(
            username,
            password,
            currentUserType
          );

          if (result.success) {
            showMessage(
              "‚úì Login successful! Redirecting to your dashboard...",
              "success"
            );

            // Confetti effect on successful login
            triggerSuccessAnimation();

            // Store user info in sessionStorage for navigation
            sessionStorage.setItem(
              "currentUser",
              JSON.stringify({
                id: result.userId,
                type: currentUserType,
                dashboard: result.dashboard,
              })
            );

            // Set authentication token for protected pages
            const authToken = `${
              result.userId
            }_${currentUserType}_${Date.now()}`;
            sessionStorage.setItem("studentPortalAuth", authToken);
            
            // Also store in localStorage for "remember me" functionality
            if (rememberMe) {
              localStorage.setItem("studentPortalAuth", authToken);
            }

            // Check if user was redirected from a protected page
            const redirectUrl = sessionStorage.getItem("redirectAfterLogin");
            const targetUrl = redirectUrl || result.dashboard;

            // Clear the redirect URL
            sessionStorage.removeItem("redirectAfterLogin");

            // Redirect after a brief delay
            setTimeout(() => {
              window.location.href = targetUrl;
            }, 800);
          } else {
            setLoadingState(false);
            showMessage("‚úï " + result.message, "error");

            // Shake effect for failed login
            const loginCard = document.getElementById("loginCard");
            loginCard.style.animation = "shake 0.5s ease-in-out";
            setTimeout(() => {
              loginCard.style.animation = "";
            }, 500);

            // Focus back on username for retry
            setTimeout(() => {
              document.getElementById("username").focus();
            }, 500);
          }
        }, 600); // Reduced from 1000ms for faster response
      }

      // Add ripple effect to button
      function addRippleEffect(event) {
        const button = event.currentTarget.querySelector(".login-btn");
        if (!button) return;

        const ripple = document.createElement("span");
        const rect = button.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = event.clientX - rect.left - size / 2;
        const y = event.clientY - rect.top - size / 2;

        ripple.style.cssText = `
          position: absolute;
          width: ${size}px;
          height: ${size}px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.5);
          left: ${x}px;
          top: ${y}px;
          pointer-events: none;
          animation: rippleEffect 0.6s ease-out;
        `;

        button.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }

      // Success animation
      function triggerSuccessAnimation() {
        const loginCard = document.getElementById("loginCard");
        loginCard.style.animation = "successPulse 0.6s ease-out";
        setTimeout(() => {
          loginCard.style.animation = "";
        }, 600);
      }

      function setLoadingState(loading) {
        isLoading = loading;
        const loginButton = document.getElementById("loginButton");
        const inputs = document.querySelectorAll(".form-input");
        const toggleButtons = document.querySelectorAll(".toggle-option");

        if (loading) {
          loginButton.classList.add("loading");
          loginButton.disabled = true;
          inputs.forEach((input) => (input.disabled = true));
          toggleButtons.forEach((btn) => (btn.style.pointerEvents = "none"));
        } else {
          loginButton.classList.remove("loading");
          loginButton.disabled = false;
          inputs.forEach((input) => (input.disabled = false));
          toggleButtons.forEach((btn) => (btn.style.pointerEvents = ""));
        }
      }

      function showMessage(text, type) {
        const messageElement = document.getElementById(type + "Message");
        if (messageElement) {
          messageElement.textContent = text;
          messageElement.style.display = "block";

          // Auto-hide success messages
          if (type === "success") {
            setTimeout(() => {
              messageElement.style.display = "none";
            }, 3000);
          }
        }
      }

      function clearMessages() {
        const errorMessage = document.getElementById("errorMessage");
        const successMessage = document.getElementById("successMessage");

        if (errorMessage) {
          errorMessage.style.display = "none";
          errorMessage.textContent = "";
        }

        if (successMessage) {
          successMessage.style.display = "none";
          successMessage.textContent = "";
        }
      }

      // Keyboard navigation improvements
      document.addEventListener("keydown", function (e) {
        // Escape key clears messages
        if (e.key === "Escape") {
          clearMessages();
          clearValidationState();
        }

        // Tab navigation enhancement
        if (e.key === "Tab") {
          const focusableElements = document.querySelectorAll(
            'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
          );

          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];

          if (e.shiftKey && document.activeElement === firstElement) {
            e.preventDefault();
            lastElement.focus();
          } else if (!e.shiftKey && document.activeElement === lastElement) {
            e.preventDefault();
            firstElement.focus();
          }
        }
      });

      // Enhanced error handling
      window.addEventListener("error", function (e) {
        console.error("Login page error:", e.error);
        setLoadingState(false);
        showMessage("An unexpected error occurred. Please try again.", "error");
      });

      // Enhanced accessibility announcements
      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("aria-live", "polite");
        announcement.setAttribute("aria-atomic", "true");
        announcement.className = "sr-only";
        announcement.textContent = message;

        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      }

      // Performance monitoring
      window.addEventListener("load", function () {
        if ("performance" in window) {
          const loadTime = performance.now();
          console.log(`Login page loaded in ${Math.round(loadTime)}ms`);
          
          // Don't show toast on page load to avoid confusion
          // if (loadTime < 2000) {
          //   showToast("Page loaded successfully!", "success", 2000);
          // }
        }
      });

      // Toast notification system
      function showToast(message, type = "info", duration = 3000) {
        const container = document.getElementById("toastContainer");
        if (!container) return;

        const toast = document.createElement("div");
        toast.style.cssText = `
          padding: 12px 20px;
          border-radius: 8px;
          color: white;
          font-size: 0.9rem;
          font-weight: 500;
          display: flex;
          align-items: center;
          gap: 10px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideInRight 0.3s ease-out;
          min-width: 250px;
          max-width: 350px;
          position: relative;
          overflow: hidden;
        `;

        // Set background color based on type
        const colors = {
          success: "linear-gradient(135deg, #10b981, #059669)",
          error: "linear-gradient(135deg, #ef4444, #dc2626)",
          info: "linear-gradient(135deg, #46bbe5, #3b9ec5)",
          warning: "linear-gradient(135deg, #f59e0b, #d97706)",
        };
        toast.style.background = colors[type] || colors.info;

        // Add icon based on type
        const icons = {
          success: "fa-check-circle",
          error: "fa-exclamation-circle",
          info: "fa-info-circle",
          warning: "fa-exclamation-triangle",
        };
        const icon = icons[type] || icons.info;

        toast.innerHTML = `
          <i class="fas ${icon}"></i>
          <span>${message}</span>
        `;

        // Add progress bar
        const progressBar = document.createElement("div");
        progressBar.style.cssText = `
          position: absolute;
          bottom: 0;
          left: 0;
          height: 3px;
          background: rgba(255, 255, 255, 0.5);
          animation: progressBar ${duration}ms linear;
        `;
        toast.appendChild(progressBar);

        container.appendChild(toast);

        // Auto remove
        setTimeout(() => {
          toast.style.animation = "slideOutRight 0.3s ease-out";
          setTimeout(() => toast.remove(), 300);
        }, duration);

        // Click to dismiss
        toast.addEventListener("click", () => {
          toast.style.animation = "slideOutRight 0.3s ease-out";
          setTimeout(() => toast.remove(), 300);
        });
      }

      // Add CSS for toast animations
      const toastStyles = document.createElement("style");
      toastStyles.textContent = `
        @keyframes slideInRight {
          from {
            transform: translateX(400px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        @keyframes slideOutRight {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(400px);
            opacity: 0;
          }
        }
        @keyframes progressBar {
          from {
            width: 100%;
          }
          to {
            width: 0%;
          }
        }
        #toastContainer > div {
          cursor: pointer;
          transition: transform 0.2s ease;
        }
        #toastContainer > div:hover {
          transform: translateX(-5px);
        }
      `;
      document.head.appendChild(toastStyles);
    </script>
  </body>
</html>
