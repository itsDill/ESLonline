<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Login to ESL Fun Online - Access your personalized learning dashboard with interactive English and coding resources."
    />
    <meta
      name="keywords"
      content="ESL Fun Online login, student portal, teacher dashboard, English learning login, coding course access"
    />
    <meta name="author" content="ESL Fun Online" />
    <meta name="robots" content="noindex, nofollow" />

    <!-- Open Graph Tags -->
    <meta property="og:title" content="Login - ESL Fun Online" />
    <meta
      property="og:description"
      content="Access your personalized learning dashboard"
    />
    <meta property="og:image" content="https://eslfunonline.com/images/1.png" />
    <meta property="og:url" content="https://eslfunonline.com/login.html" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Login - ESL Fun Online" />
    <meta
      name="twitter:description"
      content="Access your personalized learning dashboard"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/1.png"
    />

    <title>üîê Login - ESL Fun Online | Access Your Learning Dashboard</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/1.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="images/1.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="images/1.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#46bbe5" />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Google Fonts -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
    /></noscript>

    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/login.css" />

    <!-- Performance optimizations -->
    <style>
      /* Critical above-the-fold styles */
      body {
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      body.loaded {
        opacity: 1;
      }

      /* Enhanced loading spinner */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s ease, visibility 0.5s ease;
      }

      .loading-overlay.hidden {
        opacity: 0;
        visibility: hidden;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(70, 187, 229, 0.2);
        border-top: 4px solid #46bbe5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
    </div>

    <!-- Skip Link for Accessibility -->
    <a href="#loginForm" class="skip-link">Skip to login form</a>

    <!-- Main Login Section -->
    <main class="hero-login" role="main">
      <img
        src="images/11.png"
        alt="ESL Fun Online Background"
        class="hero-bg"
      />
      <div class="login-container">
        <div class="login-card" id="loginCard">
          <!-- Logo Section -->
          <div class="logo-section">
            <div class="logo-icon" id="logoIcon">
              <i class="fas fa-graduation-cap" id="logoIconElement"></i>
            </div>
            <h1 class="login-title">Welcome Back!</h1>
            <p class="login-subtitle">
              Sign in to continue your learning journey
            </p>
          </div>

          <!-- User Type Toggle -->
          <div
            class="user-type-toggle"
            role="radiogroup"
            aria-label="Select user type"
          >
            <div
              class="toggle-option active student"
              id="studentToggle"
              role="radio"
              aria-checked="true"
              tabindex="0"
              onclick="switchUserType('student')"
              onkeydown="handleToggleKeydown(event, 'student')"
            >
              <i class="fas fa-user-graduate"></i>
              <span>Student</span>
            </div>
            <div
              class="toggle-option teacher"
              id="teacherToggle"
              role="radio"
              aria-checked="false"
              tabindex="-1"
              onclick="switchUserType('teacher')"
              onkeydown="handleToggleKeydown(event, 'teacher')"
            >
              <i class="fas fa-chalkboard-teacher"></i>
              <span>Teacher</span>
            </div>
          </div>

          <!-- Login Form -->
          <form id="loginForm" novalidate aria-label="Login form">
            <!-- Error/Success Messages -->
            <div
              class="message error"
              id="errorMessage"
              role="alert"
              aria-live="polite"
            ></div>
            <div
              class="message success"
              id="successMessage"
              role="alert"
              aria-live="polite"
            ></div>

            <!-- Username Field -->
            <div class="form-group">
              <label for="username" class="form-label">
                <i class="fas fa-user"></i>
                Username
              </label>
              <input
                type="text"
                id="username"
                name="username"
                class="form-input student-mode"
                placeholder="Enter your username"
                required
                autocomplete="username"
                aria-describedby="usernameHelp"
                maxlength="50"
              />
              <div id="usernameHelp" class="sr-only">
                Enter the username provided to you
              </div>
            </div>

            <!-- Password Field -->
            <div class="form-group">
              <label for="password" class="form-label">
                <i class="fas fa-lock"></i>
                Password
              </label>
              <div style="position: relative">
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="form-input student-mode"
                  placeholder="Enter your password"
                  required
                  autocomplete="current-password"
                  aria-describedby="passwordHelp"
                  maxlength="100"
                />
                <button
                  type="button"
                  id="togglePassword"
                  class="password-toggle"
                  onclick="togglePasswordVisibility()"
                  aria-label="Toggle password visibility"
                  style="
                    position: absolute;
                    right: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: #6b7280;
                    cursor: pointer;
                    padding: 4px;
                  "
                >
                  <i class="fas fa-eye" id="passwordToggleIcon"></i>
                </button>
              </div>
              <div id="passwordHelp" class="sr-only">Enter your password</div>
            </div>

            <!-- Login Button -->
            <button
              type="submit"
              class="login-btn student-mode"
              id="loginButton"
              aria-describedby="loginButtonHelp"
            >
              <i class="fas fa-sign-in-alt"></i>
              <span>Sign In</span>
            </button>
            <div id="loginButtonHelp" class="sr-only">
              Click to sign in to your account
            </div>
          </form>

          <!-- Footer Links -->
          <div class="login-footer">
            <a href="contact.html" class="footer-link">
              <i class="fas fa-question-circle"></i>
              Need help logging in?
            </a>
            <a href="index.html" class="home-link">
              <i class="fas fa-arrow-left"></i>
              <span>Back to Homepage</span>
            </a>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="js/credentials.js"></script>
    <script>
      // Global variables
      let currentUserType = "student";
      let isLoading = false;

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        initializePage();
        setupEventListeners();
        hideLoadingOverlay();
      });

      function initializePage() {
        // Apply initial user type styling
        switchUserType("student");

        // Focus on username field for better UX
        setTimeout(() => {
          const usernameField = document.getElementById("username");
          if (usernameField) {
            usernameField.focus();
          }
        }, 500);

        // Mark body as loaded for CSS transitions
        document.body.classList.add("loaded");
      }

      function hideLoadingOverlay() {
        const loadingOverlay = document.getElementById("loadingOverlay");
        if (loadingOverlay) {
          setTimeout(() => {
            loadingOverlay.classList.add("hidden");
            setTimeout(() => {
              loadingOverlay.remove();
            }, 500);
          }, 1000);
        }
      }

      function setupEventListeners() {
        // Form submission
        const loginForm = document.getElementById("loginForm");
        if (loginForm) {
          loginForm.addEventListener("submit", handleLogin);
        }

        // Real-time input validation
        const username = document.getElementById("username");
        const password = document.getElementById("password");

        if (username) {
          username.addEventListener("input", clearValidationState);
          username.addEventListener("blur", validateUsername);
        }

        if (password) {
          password.addEventListener("input", clearValidationState);
          password.addEventListener("blur", validatePassword);
        }

        // Enter key navigation
        document.addEventListener("keydown", function (e) {
          if (e.key === "Enter" && !isLoading) {
            const activeElement = document.activeElement;
            if (activeElement.classList.contains("toggle-option")) {
              activeElement.click();
            }
          }
        });
      }

      function switchUserType(type) {
        if (isLoading) return;

        currentUserType = type;

        // Update toggle buttons
        const studentToggle = document.getElementById("studentToggle");
        const teacherToggle = document.getElementById("teacherToggle");
        const loginCard = document.getElementById("loginCard");
        const logoIcon = document.getElementById("logoIcon");
        const logoIconElement = document.getElementById("logoIconElement");
        const inputs = document.querySelectorAll(".form-input");
        const loginButton = document.getElementById("loginButton");

        // Clear any existing validation states
        clearMessages();
        clearValidationStates();

        if (type === "student") {
          // Student mode
          studentToggle.classList.add("active", "student");
          studentToggle.setAttribute("aria-checked", "true");
          studentToggle.setAttribute("tabindex", "0");

          teacherToggle.classList.remove("active", "teacher");
          teacherToggle.setAttribute("aria-checked", "false");
          teacherToggle.setAttribute("tabindex", "-1");

          loginCard.className = "login-card student-mode";
          logoIcon.className = "logo-icon student-mode";
          logoIconElement.className = "fas fa-user-graduate";
          loginButton.className = "login-btn student-mode";

          inputs.forEach((input) => {
            input.className =
              input.className.replace(/\b(student|teacher)-mode\b/g, "") +
              " student-mode";
          });
        } else if (type === "teacher") {
          // Teacher mode
          teacherToggle.classList.add("active", "teacher");
          teacherToggle.setAttribute("aria-checked", "true");
          teacherToggle.setAttribute("tabindex", "0");

          studentToggle.classList.remove("active", "student");
          studentToggle.setAttribute("aria-checked", "false");
          studentToggle.setAttribute("tabindex", "-1");

          loginCard.className = "login-card teacher-mode";
          logoIcon.className = "logo-icon teacher-mode";
          logoIconElement.className = "fas fa-chalkboard-teacher";
          loginButton.className = "login-btn teacher-mode";

          inputs.forEach((input) => {
            input.className =
              input.className.replace(/\b(student|teacher)-mode\b/g, "") +
              " teacher-mode";
          });
        }

        // Update placeholder text based on user type
        const usernameInput = document.getElementById("username");
        const passwordInput = document.getElementById("password");

        if (type === "student") {
          usernameInput.placeholder = "Enter your student ID";
          passwordInput.placeholder = "Enter your password";
        } else {
          usernameInput.placeholder = "Enter your teacher ID";
          passwordInput.placeholder = "Enter your password";
        }

        // Add smooth transition effect
        loginCard.style.transform = "scale(0.98)";
        setTimeout(() => {
          loginCard.style.transform = "scale(1)";
        }, 150);
      }

      function handleToggleKeydown(event, type) {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          switchUserType(type);
        } else if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
          event.preventDefault();
          const newType = type === "student" ? "teacher" : "student";
          switchUserType(newType);
          document.getElementById(newType + "Toggle").focus();
        }
      }

      function validateUsername() {
        const username = document.getElementById("username");
        const value = username.value.trim();

        if (!value) {
          setFieldError(username, "Username is required");
          return false;
        }

        if (value.length < 2) {
          setFieldError(username, "Username must be at least 2 characters");
          return false;
        }

        setFieldSuccess(username);
        return true;
      }

      function validatePassword() {
        const password = document.getElementById("password");
        const value = password.value;

        if (!value) {
          setFieldError(password, "Password is required");
          return false;
        }

        if (value.length < 3) {
          setFieldError(password, "Password must be at least 3 characters");
          return false;
        }

        setFieldSuccess(password);
        return true;
      }

      function setFieldError(field, message) {
        field.classList.remove("success");
        field.classList.add("error");
        field.setAttribute("aria-invalid", "true");

        // Show tooltip or message (you can enhance this)
        field.title = message;
      }

      function setFieldSuccess(field) {
        field.classList.remove("error");
        field.classList.add("success");
        field.setAttribute("aria-invalid", "false");
        field.removeAttribute("title");
      }

      function clearValidationState() {
        clearMessages();
        const inputs = document.querySelectorAll(".form-input");
        inputs.forEach((input) => {
          input.classList.remove("error", "success");
          input.removeAttribute("aria-invalid");
          input.removeAttribute("title");
        });
      }

      function clearValidationStates() {
        const inputs = document.querySelectorAll(".form-input");
        inputs.forEach((input) => {
          input.classList.remove("error", "success");
          input.removeAttribute("aria-invalid");
          input.removeAttribute("title");
        });
      }

      function togglePasswordVisibility() {
        const passwordField = document.getElementById("password");
        const toggleIcon = document.getElementById("passwordToggleIcon");
        const toggleButton = document.getElementById("togglePassword");

        if (passwordField.type === "password") {
          passwordField.type = "text";
          toggleIcon.className = "fas fa-eye-slash";
          toggleButton.setAttribute("aria-label", "Hide password");
        } else {
          passwordField.type = "password";
          toggleIcon.className = "fas fa-eye";
          toggleButton.setAttribute("aria-label", "Show password");
        }
      }

      function handleLogin(event) {
        event.preventDefault();

        if (isLoading) return;

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        // Clear previous messages
        clearMessages();

        // Validate form
        const isUsernameValid = validateUsername();
        const isPasswordValid = validatePassword();

        if (!isUsernameValid || !isPasswordValid) {
          showMessage("Please fix the errors above", "error");
          return;
        }

        // Set loading state
        setLoadingState(true);

        // Simulate network delay for better UX
        setTimeout(() => {
          // Validate credentials using the imported function
          const result = validateCredentials(
            username,
            password,
            currentUserType
          );

          if (result.success) {
            showMessage(
              "Login successful! Redirecting to your dashboard...",
              "success"
            );

            // Store user info in sessionStorage for navigation
            sessionStorage.setItem(
              "currentUser",
              JSON.stringify({
                id: result.userId,
                type: currentUserType,
                dashboard: result.dashboard,
              })
            );

            // Redirect after a brief delay
            setTimeout(() => {
              window.location.href = result.dashboard;
            }, 1500);
          } else {
            setLoadingState(false);
            showMessage(result.message, "error");

            // Shake effect for failed login
            const loginCard = document.getElementById("loginCard");
            loginCard.style.animation = "shake 0.5s ease-in-out";
            setTimeout(() => {
              loginCard.style.animation = "";
            }, 500);

            // Focus back on username for retry
            setTimeout(() => {
              document.getElementById("username").focus();
            }, 500);
          }
        }, 1000);
      }

      function setLoadingState(loading) {
        isLoading = loading;
        const loginButton = document.getElementById("loginButton");
        const inputs = document.querySelectorAll(".form-input");
        const toggleButtons = document.querySelectorAll(".toggle-option");

        if (loading) {
          loginButton.classList.add("loading");
          loginButton.disabled = true;
          inputs.forEach((input) => (input.disabled = true));
          toggleButtons.forEach((btn) => (btn.style.pointerEvents = "none"));
        } else {
          loginButton.classList.remove("loading");
          loginButton.disabled = false;
          inputs.forEach((input) => (input.disabled = false));
          toggleButtons.forEach((btn) => (btn.style.pointerEvents = ""));
        }
      }

      function showMessage(text, type) {
        const messageElement = document.getElementById(type + "Message");
        if (messageElement) {
          messageElement.textContent = text;
          messageElement.style.display = "block";

          // Auto-hide success messages
          if (type === "success") {
            setTimeout(() => {
              messageElement.style.display = "none";
            }, 3000);
          }
        }
      }

      function clearMessages() {
        const errorMessage = document.getElementById("errorMessage");
        const successMessage = document.getElementById("successMessage");

        if (errorMessage) {
          errorMessage.style.display = "none";
          errorMessage.textContent = "";
        }

        if (successMessage) {
          successMessage.style.display = "none";
          successMessage.textContent = "";
        }
      }

      // Keyboard navigation improvements
      document.addEventListener("keydown", function (e) {
        // Escape key clears messages
        if (e.key === "Escape") {
          clearMessages();
          clearValidationState();
        }

        // Tab navigation enhancement
        if (e.key === "Tab") {
          const focusableElements = document.querySelectorAll(
            'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
          );

          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];

          if (e.shiftKey && document.activeElement === firstElement) {
            e.preventDefault();
            lastElement.focus();
          } else if (!e.shiftKey && document.activeElement === lastElement) {
            e.preventDefault();
            firstElement.focus();
          }
        }
      });

      // Enhanced error handling
      window.addEventListener("error", function (e) {
        console.error("Login page error:", e.error);
        setLoadingState(false);
        showMessage("An unexpected error occurred. Please try again.", "error");
      });

      // Enhanced accessibility announcements
      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("aria-live", "polite");
        announcement.setAttribute("aria-atomic", "true");
        announcement.className = "sr-only";
        announcement.textContent = message;

        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      }

      // Performance monitoring
      window.addEventListener("load", function () {
        if ("performance" in window) {
          const loadTime = performance.now();
          console.log(`Login page loaded in ${Math.round(loadTime)}ms`);
        }
      });
    </script>
  </body>
</html>
