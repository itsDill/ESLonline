<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Colour Magic - Creative Coloring Game | ESL Fun Online</title>
    <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="../images/favicon-48x48.png"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../images/favicon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="../images/favicon-512x512.png"
    />

    <!-- Disable Pinterest Pin Button -->
    <meta name="pinterest" content="nopin" />

    <meta
      name="description"
      content="Express your creativity with Colour Magic! A fun interactive coloring game with multiple pictures to color. Perfect for all ages."
    />
    <meta
      name="keywords"
      content="coloring game, color magic, art game, creative game, drawing game, ESL games"
    />

    <link rel="stylesheet" href="../css/colourmagic-page.css?v=1763019900" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* Dark Theme Overrides */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0 !important;
        padding: 0 !important;
        padding-top: 0 !important;
        min-height: 100vh;
        overflow-x: hidden;
        width: 100%;
        max-width: 100vw;
      }

      body {
        background: linear-gradient(
          -45deg,
          #ff6b6b,
          #feca57,
          #48dbfb,
          #ff9ff3,
          #54a0ff,
          #5f27cd
        ) !important;
        background-size: 600% 600% !important;
        animation: rainbowShift 12s ease infinite !important;
        font-family: "Fredoka One", "Comic Sans MS", cursive, sans-serif;
        color: white !important;
      }

      @import url("https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap");

      /* Force dark theme on all elements */
      #gameContainer,
      #pictureSelect,
      #coloringArea,
      .colorPalette,
      .brush-grid,
      .pattern-grid {
        background: transparent !important;
        color: white !important;
      }

      #canvasContainer {
        background: rgba(30, 41, 59, 0.5) !important;
      }

      /* All buttons dark theme */
      button {
        color: white !important;
      }

      /* Prevent horizontal overflow */
      *,
      *::before,
      *::after {
        max-width: 100%;
      }

      @keyframes rainbowShift {
        0% {
          background-position: 0% 50%;
        }
        25% {
          background-position: 50% 100%;
        }
        50% {
          background-position: 100% 50%;
        }
        75% {
          background-position: 50% 0%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Floating Stars & Shapes */
      .floating-shapes {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }

      .floating-shape {
        position: absolute;
        font-size: 2rem;
        animation: floatAround 8s ease-in-out infinite;
        opacity: 0.7;
        filter: drop-shadow(0 0 10px currentColor);
      }

      .floating-shape:nth-child(1) {
        top: 10%;
        left: 5%;
        animation-delay: 0s;
        color: #ff6b6b;
      }
      .floating-shape:nth-child(2) {
        top: 20%;
        right: 10%;
        animation-delay: 1s;
        color: #feca57;
      }
      .floating-shape:nth-child(3) {
        top: 60%;
        left: 8%;
        animation-delay: 2s;
        color: #48dbfb;
      }
      .floating-shape:nth-child(4) {
        top: 80%;
        right: 5%;
        animation-delay: 3s;
        color: #ff9ff3;
      }
      .floating-shape:nth-child(5) {
        top: 40%;
        right: 3%;
        animation-delay: 4s;
        color: #54a0ff;
      }
      .floating-shape:nth-child(6) {
        bottom: 10%;
        left: 15%;
        animation-delay: 5s;
        color: #5f27cd;
      }
      .floating-shape:nth-child(7) {
        top: 5%;
        left: 50%;
        animation-delay: 1.5s;
        color: #1dd1a1;
      }
      .floating-shape:nth-child(8) {
        bottom: 30%;
        right: 15%;
        animation-delay: 2.5s;
        color: #ee5a24;
      }

      @keyframes floatAround {
        0%,
        100% {
          transform: translateY(0) rotate(0deg) scale(1);
        }
        25% {
          transform: translateY(-20px) rotate(10deg) scale(1.1);
        }
        50% {
          transform: translateY(-10px) rotate(-5deg) scale(0.95);
        }
        75% {
          transform: translateY(-25px) rotate(5deg) scale(1.05);
        }
      }

      /* Compact Game Header */
      .game-nav-header {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 255, 255, 0.85)
        );
        backdrop-filter: blur(10px);
        padding: 0.75rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 4px solid transparent;
        border-image: linear-gradient(
            90deg,
            #ff6b6b,
            #feca57,
            #48dbfb,
            #ff9ff3,
            #54a0ff
          )
          1;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .game-nav-header .nav-left {
        display: flex;
        gap: 0.75rem;
      }

      .game-nav-header .nav-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        color: white;
        padding: 0.6rem 1.2rem;
        border-radius: 25px;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .game-nav-header .nav-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
      }

      .game-nav-header .game-title {
        font-size: 1.4rem;
        font-weight: 700;
        background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: titlePulse 2s ease-in-out infinite;
      }

      @keyframes titlePulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      /* Ad Styling */
      .ad-wrapper {
        max-width: 800px;
        margin: 1rem auto;
        padding: 0 1rem;
        width: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }

      /* Game Container Override */
      #gameContainer {
        max-width: 1200px;
        margin: 0 auto !important;
        padding: 1rem !important;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
        background: transparent !important;
        box-shadow: none !important;
      }

      /* Toolbar fixes */
      #toolbar {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 255, 255, 0.9)
        ) !important;
        backdrop-filter: blur(10px);
        padding: 1.25rem !important;
        border-radius: 25px;
        border: 4px solid transparent !important;
        border-image: linear-gradient(
            135deg,
            #ff6b6b,
            #feca57,
            #48dbfb,
            #ff9ff3
          )
          1 !important;
        margin-bottom: 1rem;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: flex-start;
        width: 100%;
        box-sizing: border-box;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      }

      .toolSection {
        flex: 1 1 auto;
        min-width: 0;
        max-width: 100%;
      }

      .toolSection label {
        color: #5f27cd !important;
        font-weight: 600;
      }

      .sizeLabel {
        color: white !important;
        background: linear-gradient(135deg, #ff6b6b, #ff9ff3) !important;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-weight: 700;
      }

      #colorPicker {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 8px;
        cursor: pointer;
      }

      /* Slider container */
      .slider-container {
        background: transparent !important;
      }

      .slider-container input[type="range"] {
        background: transparent !important;
      }

      #coloringArea {
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }

      #header {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 255, 255, 0.9)
        ) !important;
        backdrop-filter: blur(10px);
        border: 5px solid transparent !important;
        border-image: linear-gradient(
            135deg,
            #ff6b6b,
            #feca57,
            #48dbfb,
            #ff9ff3
          )
          1 !important;
        border-radius: 25px;
        padding: 1.75rem;
        text-align: center;
        margin-bottom: 1rem;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
      }

      #header h1 {
        background: linear-gradient(
          135deg,
          #ff6b6b,
          #feca57,
          #48dbfb,
          #ff9ff3,
          #54a0ff
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        animation: rainbowText 3s ease-in-out infinite;
      }

      @keyframes rainbowText {
        0%,
        100% {
          filter: hue-rotate(0deg);
        }
        50% {
          filter: hue-rotate(30deg);
        }
      }

      #header p {
        color: #5f27cd !important;
        font-weight: 500;
        font-size: 1.1rem;
      }

      #header .header-controls {
        display: none; /* Hide old controls, using new nav header */
      }

      /* Picture Selection */
      #pictureSelect {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        padding: 1rem;
        background: transparent !important;
      }

      .pictureOption {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 255, 255, 0.85)
        ) !important;
        border: 4px solid #feca57 !important;
        border-radius: 20px;
        padding: 1.25rem 1rem;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        text-align: center;
        position: relative;
        overflow: hidden;
        width: auto !important;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .pictureOption.selected {
        background: linear-gradient(145deg, #ffeaa7, #fdcb6e) !important;
        border-color: #f39c12 !important;
        transform: scale(1.05);
      }

      .pictureOption::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .pictureOption:hover::before {
        left: 100%;
      }

      .pictureOption:hover {
        background: linear-gradient(145deg, #a29bfe, #6c5ce7) !important;
        transform: translateY(-10px) scale(1.08) rotate(-2deg);
        box-shadow: 0 20px 50px rgba(108, 92, 231, 0.4);
        border-color: #5f27cd !important;
      }

      .pictureOption p {
        color: #5f27cd !important;
        margin-top: 0.75rem;
        font-weight: 700;
        font-size: 1rem;
        letter-spacing: 0.5px;
        transition: color 0.3s ease;
      }

      .pictureOption:hover p {
        color: white !important;
      }

      .pictureOption img {
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
        transition: all 0.4s ease;
      }

      .pictureOption:hover img {
        filter: brightness(1.2) drop-shadow(0 8px 20px rgba(255, 255, 255, 0.5));
        transform: scale(1.15) rotate(5deg);
      }

      /* Color Palette */
      #colorPalette {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95),
          rgba(255, 255, 255, 0.85)
        ) !important;
        border: 4px solid #48dbfb !important;
        border-radius: 25px;
        padding: 1.25rem;
        margin: 1rem 0;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      }

      .colorPalette {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        padding: 0.5rem;
      }

      .colorBtn {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        border: 4px solid white;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2),
          inset 0 2px 4px rgba(255, 255, 255, 0.4);
      }

      .colorBtn:hover {
        transform: scale(1.3) translateY(-5px) rotate(15deg);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        animation: wiggle 0.5s ease-in-out;
      }

      @keyframes wiggle {
        0%,
        100% {
          transform: scale(1.3) translateY(-5px) rotate(15deg);
        }
        25% {
          transform: scale(1.3) translateY(-5px) rotate(-10deg);
        }
        75% {
          transform: scale(1.3) translateY(-5px) rotate(10deg);
        }
      }

      .colorBtn.active {
        border-color: #2d3436;
        transform: scale(1.25);
        box-shadow: 0 0 0 5px rgba(45, 52, 54, 0.3),
          0 8px 25px rgba(0, 0, 0, 0.3);
        animation: bounce 0.5s ease;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: scale(1.25);
        }
        50% {
          transform: scale(1.35);
        }
      }

      .colorBtn::after {
        content: "";
        position: absolute;
        top: 3px;
        left: 3px;
        width: 12px;
        height: 6px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.6),
          transparent
        );
        border-radius: 50%;
      }

      /* Color History */
      .color-history {
        display: flex;
        gap: 8px;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 3px dashed #feca57;
        justify-content: center;
        align-items: center;
      }

      .color-history-label {
        font-size: 0.85rem;
        color: #5f27cd;
        font-weight: 700;
        margin-right: 0.5rem;
      }

      .color-history .colorBtn {
        width: 28px;
        height: 28px;
      }

      /* Ripple animation */
      @keyframes ripple {
        from {
          transform: scale(0);
          opacity: 1;
        }
        to {
          transform: scale(2);
          opacity: 0;
        }
      }

      /* Canvas overlay show state */
      .canvas-overlay.show {
        opacity: 1 !important;
      }

      /* Sparkle save button */
      .sparkle-btn {
        background: linear-gradient(
          135deg,
          #10b981 0%,
          #059669 100%
        ) !important;
        position: relative;
      }

      .sparkle-btn::after {
        content: "‚ú®";
        position: absolute;
        right: -5px;
        top: -5px;
        font-size: 0.8rem;
        animation: sparkle 1.5s ease-in-out infinite;
      }

      @keyframes sparkle {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.2);
        }
      }

      /* Feature toggle buttons */
      .feature-toggle {
        background: linear-gradient(135deg, #a29bfe, #6c5ce7) !important;
        border: none !important;
        color: white !important;
        padding: 0.85rem 1.5rem;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        font-weight: 700;
        box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
      }

      .feature-toggle:hover {
        background: linear-gradient(135deg, #ff9ff3, #f368e0) !important;
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 10px 30px rgba(243, 104, 224, 0.5);
      }

      .feature-toggle.active {
        background: linear-gradient(
          135deg,
          #00b894 0%,
          #00cec9 100%
        ) !important;
        border-color: transparent !important;
        box-shadow: 0 6px 25px rgba(0, 206, 201, 0.5);
        animation: activePulse 1s ease-in-out infinite;
      }

      /* Brush grid styling */
      .brush-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      .brush-option {
        background: linear-gradient(135deg, #fff, #f8f9fa) !important;
        border: 3px solid #dfe6e9 !important;
        border-radius: 15px;
        padding: 0.85rem 0.6rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        color: #5f27cd !important;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .brush-option:hover {
        background: linear-gradient(135deg, #ffeaa7, #fdcb6e) !important;
        transform: translateY(-4px) rotate(-3deg);
        border-color: #f39c12 !important;
        box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
      }

      .brush-option.active {
        background: linear-gradient(
          135deg,
          #ff6b6b 0%,
          #ee5a24 100%
        ) !important;
        border-color: transparent !important;
        box-shadow: 0 6px 20px rgba(238, 90, 36, 0.5);
        color: white !important;
        transform: scale(1.05);
      }

      .brush-icon {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
      }

      /* Pattern grid */
      .pattern-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .pattern-btn {
        background: linear-gradient(135deg, #fff, #f8f9fa) !important;
        border: 3px solid #dfe6e9 !important;
        border-radius: 15px;
        padding: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.6rem;
        text-align: center;
      }

      .pattern-btn:hover {
        background: linear-gradient(135deg, #a29bfe, #6c5ce7) !important;
        transform: scale(1.2) rotate(10deg);
        border-color: #5f27cd !important;
        box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
      }

      .pattern-btn.active {
        background: linear-gradient(
          135deg,
          #00b894 0%,
          #00cec9 100%
        ) !important;
        border-color: transparent !important;
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 206, 201, 0.5);
      }

      /* Tool Buttons */
      .toolBtn {
        background: linear-gradient(135deg, #74b9ff, #0984e3) !important;
        border: none !important;
        color: white !important;
        padding: 0.85rem 1.5rem;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        font-size: 1rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 6px 20px rgba(9, 132, 227, 0.4);
      }

      .toolBtn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.4s ease, height 0.4s ease;
      }

      .toolBtn:hover::before {
        width: 200%;
        height: 200%;
      }

      .toolBtn:hover {
        background: linear-gradient(135deg, #a29bfe, #6c5ce7) !important;
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 10px 30px rgba(108, 92, 231, 0.5);
      }

      .toolBtn.active {
        background: linear-gradient(
          135deg,
          #00b894 0%,
          #00cec9 100%
        ) !important;
        border-color: transparent !important;
        box-shadow: 0 6px 25px rgba(0, 206, 201, 0.5);
        transform: translateY(-2px) scale(1.05);
        animation: activePulse 1s ease-in-out infinite;
      }

      @keyframes activePulse {
        0%,
        100% {
          box-shadow: 0 6px 25px rgba(0, 206, 201, 0.5);
        }
        50% {
          box-shadow: 0 6px 35px rgba(0, 206, 201, 0.8);
        }
      }

      .toolBtn:active {
        transform: translateY(1px) scale(0.98);
      }

      /* Canvas Container */
      #canvasContainer {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.98),
          rgba(255, 255, 255, 0.95)
        ) !important;
        border: 6px solid transparent !important;
        border-image: linear-gradient(
            135deg,
            #ff6b6b,
            #feca57,
            #48dbfb,
            #ff9ff3,
            #54a0ff,
            #5f27cd
          )
          1 !important;
        border-radius: 25px;
        padding: 1.5rem;
        margin: 1.5rem 0;
        position: relative;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15),
          inset 0 2px 0 rgba(255, 255, 255, 1);
      }

      #canvasContainer::before {
        content: "";
        position: absolute;
        top: -2px;
        left: 20%;
        right: 20%;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.5),
          transparent
        );
      }

      #canvas {
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        display: block;
        margin: 0 auto;
        max-width: 100%;
        height: auto;
      }

      /* Current color indicator */
      .current-color-indicator {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 4px solid white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        z-index: 100;
        display: none;
        transition: transform 0.3s ease;
      }

      .current-color-indicator:hover {
        transform: scale(1.1);
      }

      #coloringArea:not([style*="none"]) ~ .current-color-indicator {
        display: block;
      }

      /* Control Buttons */
      .controlBtn,
      .btn {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: white !important;
        padding: 0.75rem 1.25rem;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        font-weight: 500;
      }

      .controlBtn:hover,
      .btn:hover {
        background: rgba(255, 255, 255, 0.2) !important;
        transform: translateY(-2px);
      }

      .controlBtn.primary,
      .btn-primary {
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 100%
        ) !important;
        border-color: transparent !important;
      }

      /* Slider styling */
      input[type="range"] {
        accent-color: #667eea;
      }

      /* Toast messages */
      .toast {
        background: rgba(0, 0, 0, 0.8) !important;
        color: white !important;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
      }

      /* Help item dark theme */
      .help-item {
        background: rgba(255, 255, 255, 0.05) !important;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .help-item h3 {
        color: #a5b4fc !important;
        margin-bottom: 0.5rem;
      }

      .help-item p {
        color: rgba(255, 255, 255, 0.8) !important;
        line-height: 1.6;
      }

      /* Modal dark theme */
      .modal {
        background: rgba(0, 0, 0, 0.8) !important;
      }

      .close-modal:hover {
        background: rgba(255, 255, 255, 0.2) !important;
      }

      /* Footer */
      .game-footer {
        background: rgba(0, 0, 0, 0.3);
        padding: 1.5rem;
        text-align: center;
        margin-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        width: 100%;
        box-sizing: border-box;
      }

      .game-footer a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        margin: 0 1rem;
        font-size: 0.9rem;
        transition: color 0.3s ease;
      }

      .game-footer a:hover {
        color: #667eea;
      }

      .game-footer .copyright {
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.8rem;
        margin-top: 1rem;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        #header h1 {
          font-size: 1.5rem;
        }

        #pictureSelect {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: 0.75rem;
          padding: 0.75rem;
        }

        .pictureOption {
          padding: 0.75rem;
        }

        .game-nav-header .game-title {
          display: none;
        }

        #toolbar {
          padding: 0.75rem !important;
          gap: 0.75rem;
        }

        .toolBtn {
          padding: 0.5rem 0.75rem;
          font-size: 0.85rem;
        }

        #canvasContainer {
          padding: 0.75rem;
          margin: 0.75rem 0;
        }

        .colorPalette {
          gap: 6px !important;
        }

        .colorBtn {
          width: 32px !important;
          height: 32px !important;
        }

        .brush-grid {
          grid-template-columns: repeat(
            auto-fill,
            minmax(70px, 1fr)
          ) !important;
        }

        .pattern-grid {
          grid-template-columns: repeat(
            auto-fill,
            minmax(40px, 1fr)
          ) !important;
        }

        .zoom-controls {
          display: none !important;
        }
      }

      @media (max-width: 480px) {
        #pictureSelect {
          grid-template-columns: repeat(2, 1fr);
          padding: 0.5rem;
        }

        #gameContainer {
          padding: 0.5rem !important;
        }

        .game-nav-header {
          padding: 0.5rem 0.75rem;
        }

        .nav-btn {
          padding: 0.4rem 0.6rem;
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Floating Fun Shapes -->
    <div class="floating-shapes">
      <div class="floating-shape">‚≠ê</div>
      <div class="floating-shape">üé®</div>
      <div class="floating-shape">‚ú®</div>
      <div class="floating-shape">üåà</div>
      <div class="floating-shape">üí´</div>
      <div class="floating-shape">üñåÔ∏è</div>
      <div class="floating-shape">üéâ</div>
      <div class="floating-shape">üíñ</div>
    </div>

    <!-- Compact Game Header -->
    <header class="game-nav-header">
      <div class="nav-left">
        <a href="../index.html" class="nav-btn"
          ><i class="fas fa-home"></i> Home</a
        >
        <a href="../games.html" class="nav-btn"
          ><i class="fas fa-gamepad"></i> Games</a
        >
      </div>
      <div class="game-title">üé® Colour Magic ‚ú®</div>
    </header>

    <!-- Top Ad -->
    <div class="ad-wrapper">
      <script
        async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
        crossorigin="anonymous"
      ></script>
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-format="autorelaxed"
        data-ad-client="ca-pub-2456627863532019"
        data-ad-slot="2184713192"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <div id="gameContainer">
      <div id="header">
        <div class="header-controls">
          <a href="../index.html" class="header-btn">üè† Home</a>
          <a href="games.html" class="header-btn">üéÆ Games</a>
        </div>
        <h1>üé® Colour Magic üé®</h1>
        <p>Choose a picture and unleash your creativity!</p>
      </div>

      <div id="pictureSelect">
        <div class="pictureOption" onclick="selectPicture('pineapple')">
          <img
            src="colourmagic/Pineapple.svg"
            alt="Pineapple"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Pineapple</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('art')">
          <img
            src="colourmagic/art.svg"
            alt="Art"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Art</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('boat')">
          <img
            src="colourmagic/boat.svg"
            alt="Boat"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Boat</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('butterflyart')">
          <img
            src="colourmagic/butterflyart.svg"
            alt="Butterfly"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Butterfly</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('carrot')">
          <img
            src="colourmagic/carrot.svg"
            alt="Carrot"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Carrot</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('cat')">
          <img
            src="colourmagic/cat.svg"
            alt="Cat"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Cat</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('cookies')">
          <img
            src="colourmagic/cookies.svg"
            alt="Cookies"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Cookies</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('doctor')">
          <img
            src="colourmagic/doctor.svg"
            alt="Doctor"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Doctor</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('dolphin')">
          <img
            src="colourmagic/dolphin.svg"
            alt="Dolphin"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Dolphin</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('dragon')">
          <img
            src="colourmagic/dragon.svg"
            alt="Dragon"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Dragon</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('face')">
          <img
            src="colourmagic/face.svg"
            alt="Face"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Face</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('flowerart')">
          <img
            src="colourmagic/flowerart.svg"
            alt="Flower"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Flower</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('girl')">
          <img
            src="colourmagic/girl.svg"
            alt="Girl"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Girl</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('girlback')">
          <img
            src="colourmagic/girlback.svg"
            alt="Girl Back"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Girl Back</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('horse')">
          <img
            src="colourmagic/horse.svg"
            alt="Horse"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Horse</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('icecream')">
          <img
            src="colourmagic/icecream.svg"
            alt="Ice Cream"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Ice Cream</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('jellyfish')">
          <img
            src="colourmagic/jellyfish.svg"
            alt="Jellyfish"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Jellyfish</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('leafart')">
          <img
            src="colourmagic/leafart.svg"
            alt="Leaf"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Leaf</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('lines')">
          <img
            src="colourmagic/lines.svg"
            alt="Lines"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Lines</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('mushroomhouse')">
          <img
            src="colourmagic/mushroomhouse.svg"
            alt="Mushroom House"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Mushroom House</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('octopus')">
          <img
            src="colourmagic/octopus.svg"
            alt="Octopus"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Octopus</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('owlart')">
          <img
            src="colourmagic/owlart.svg"
            alt="Owl"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Owl</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('panda')">
          <img
            src="colourmagic/panda.svg"
            alt="Panda"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Panda</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('princess')">
          <img
            src="colourmagic/princess.svg"
            alt="Princess"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Princess</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('spiral')">
          <img
            src="colourmagic/spiral.svg"
            alt="Spiral"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Spiral</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('tiger')">
          <img
            src="colourmagic/tiger.svg"
            alt="Tiger"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Tiger</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('turtles')">
          <img
            src="colourmagic/turtles.svg"
            alt="Turtles"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Turtles</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('watermelon')">
          <img
            src="colourmagic/watermelon.svg"
            alt="Watermelon"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Watermelon</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('zebra')">
          <img
            src="colourmagic/zebra.svg"
            alt="Zebra"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Zebra</p>
        </div>
      </div>

      <div id="coloringArea">
        <div id="toolbar">
          <button id="backBtn" onclick="backToSelect()">‚Üê Back</button>

          <div class="toolSection">
            <label>Drawing Tools:</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
              <button class="toolBtn active" onclick="setTool('brush')">
                üñåÔ∏è Brush
              </button>
              <button class="toolBtn" onclick="setTool('fill')">ü™£ Fill</button>
              <button class="toolBtn" onclick="setTool('eraser')">
                üßπ Eraser
              </button>
              <button class="toolBtn" id="undoBtn" onclick="undo()" disabled>
                ‚Ü∂ Undo
              </button>
              <button class="toolBtn" id="redoBtn" onclick="redo()" disabled>
                ‚Ü∑ Redo
              </button>
            </div>
          </div>

          <div class="toolSection">
            <label
              >Brush Size:
              <span class="sizeLabel" id="sizeValue">10</span></label
            >
            <input
              type="range"
              id="brushSize"
              min="5"
              max="50"
              value="10"
              oninput="updateBrushSize(this.value)"
            />
          </div>

          <div class="toolSection" id="brushStyleSection" style="display: none">
            <label>üé® Brush Styles:</label>
            <div class="brush-grid">
              <div
                class="brush-option active"
                onclick="setBrushStyle('normal')"
              >
                <div class="brush-icon">‚úèÔ∏è</div>
                <div>Normal</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('spray')">
                <div class="brush-icon">üí®</div>
                <div>Spray</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('marker')">
                <div class="brush-icon">üñäÔ∏è</div>
                <div>Marker</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('crayon')">
                <div class="brush-icon">üñçÔ∏è</div>
                <div>Crayon</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('calligraphy')">
                <div class="brush-icon">üñãÔ∏è</div>
                <div>Calligraphy</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('glitter')">
                <div class="brush-icon">‚ú®</div>
                <div>Glitter</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('neon')">
                <div class="brush-icon">üí°</div>
                <div>Neon</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('watercolor')">
                <div class="brush-icon">üíß</div>
                <div>Watercolor</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('sketch')">
                <div class="brush-icon">üìù</div>
                <div>Sketch</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('rainbow')">
                <div class="brush-icon">üåà</div>
                <div>Rainbow</div>
              </div>
            </div>
          </div>

          <div class="toolSection">
            <label>Colors:</label>
            <div class="colorPalette">
              <div
                class="colorBtn active"
                style="background: #ff6b6b"
                onclick="selectColor('#FF6B6B')"
              ></div>
              <div
                class="colorBtn"
                style="background: #4ecdc4"
                onclick="selectColor('#4ECDC4')"
              ></div>
              <div
                class="colorBtn"
                style="background: #45b7d1"
                onclick="selectColor('#45B7D1')"
              ></div>
              <div
                class="colorBtn"
                style="background: #ffa07a"
                onclick="selectColor('#FFA07A')"
              ></div>
              <div
                class="colorBtn"
                style="background: #98d8c8"
                onclick="selectColor('#98D8C8')"
              ></div>
              <div
                class="colorBtn"
                style="background: #f7dc6f"
                onclick="selectColor('#F7DC6F')"
              ></div>
              <div
                class="colorBtn"
                style="background: #bb8fce"
                onclick="selectColor('#BB8FCE')"
              ></div>
              <div
                class="colorBtn"
                style="background: #f8b739"
                onclick="selectColor('#F8B739')"
              ></div>
              <div
                class="colorBtn"
                style="background: #52b788"
                onclick="selectColor('#52B788')"
              ></div>
              <div
                class="colorBtn"
                style="background: #e63946"
                onclick="selectColor('#E63946')"
              ></div>
              <div
                class="colorBtn"
                style="background: #06ffa5"
                onclick="selectColor('#06FFA5')"
              ></div>
              <div
                class="colorBtn"
                style="background: #3a86ff"
                onclick="selectColor('#3A86FF')"
              ></div>
              <div
                class="colorBtn"
                style="background: #fb5607"
                onclick="selectColor('#FB5607')"
              ></div>
              <div
                class="colorBtn"
                style="background: #ffbe0b"
                onclick="selectColor('#FFBE0B')"
              ></div>
              <div
                class="colorBtn"
                style="background: #ff006e"
                onclick="selectColor('#FF006E')"
              ></div>
              <div
                class="colorBtn"
                style="background: #8338ec"
                onclick="selectColor('#8338EC')"
              ></div>
              <input
                type="color"
                id="colorPicker"
                onchange="selectColor(this.value)"
                title="Custom Color"
              />
            </div>
          </div>

          <div class="toolSection">
            <label>üéõÔ∏è Advanced Features:</label>
            <div
              style="
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin-top: 10px;
              "
            >
              <button
                class="feature-toggle"
                id="symmetryBtn"
                onclick="toggleSymmetry()"
              >
                ü™û Symmetry
              </button>
              <button
                class="feature-toggle"
                id="patternsBtn"
                onclick="togglePatterns()"
              >
                üé≠ Patterns
              </button>
            </div>
          </div>

          <div class="toolSection" id="opacitySection">
            <label
              >Opacity:
              <span class="sizeLabel" id="opacityValue">100</span>%</label
            >
            <div class="slider-container">
              <input
                type="range"
                id="opacitySlider"
                min="10"
                max="100"
                value="100"
                oninput="updateOpacity(this.value)"
              />
            </div>
          </div>

          <div class="toolSection" id="patternsSection" style="display: none">
            <label>üìê Pattern Stamps:</label>
            <div class="pattern-grid">
              <div
                class="pattern-btn"
                onclick="setPattern('circle')"
                title="Circle"
              >
                ‚≠ï
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('square')"
                title="Square"
              >
                ‚¨ú
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('star')"
                title="Star"
              >
                ‚≠ê
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('heart')"
                title="Heart"
              >
                ‚ù§Ô∏è
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('flower')"
                title="Flower"
              >
                üå∏
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('triangle')"
                title="Triangle"
              >
                üî∫
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('hexagon')"
                title="Hexagon"
              >
                ‚¨°
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('diamond')"
                title="Diamond"
              >
                üíé
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('cloud')"
                title="Cloud"
              >
                ‚òÅÔ∏è
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('none')"
                title="No Pattern"
              >
                ‚úñÔ∏è
              </div>
            </div>
          </div>

          <button class="toolBtn" onclick="clearCanvas()">üóëÔ∏è Clear</button>
          <button class="toolBtn sparkle-btn" onclick="saveDrawing()">
            üíæ Save
          </button>
          <button class="toolBtn" onclick="openHelp()">‚ùì Help</button>
        </div>

        <div id="canvasContainer">
          <div
            class="canvas-overlay"
            id="canvasOverlay"
            style="
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: rgba(0, 0, 0, 0.8);
              color: white;
              padding: 0.75rem 1.5rem;
              border-radius: 30px;
              font-weight: 600;
              opacity: 0;
              transition: opacity 0.3s ease;
              pointer-events: none;
              z-index: 10;
            "
          >
            Tool: Brush
          </div>
          <canvas id="canvas" width="600" height="600"></canvas>
        </div>

        <!-- Zoom Controls -->
        <div
          class="zoom-controls"
          style="
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
          "
        >
          <button class="toolBtn" onclick="zoomCanvas(0.9)" title="Zoom Out">
            <i class="fas fa-search-minus"></i>
          </button>
          <button class="toolBtn" onclick="resetZoom()" title="Reset Zoom">
            <i class="fas fa-compress-arrows-alt"></i> 100%
          </button>
          <button class="toolBtn" onclick="zoomCanvas(1.1)" title="Zoom In">
            <i class="fas fa-search-plus"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Current Color Indicator -->
    <div
      id="currentColorIndicator"
      class="current-color-indicator"
      style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        z-index: 100;
        display: none;
        background: #ff6b6b;
      "
    ></div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
      <div
        class="modal-content"
        style="
          background: linear-gradient(
            145deg,
            rgba(30, 41, 59, 0.98),
            rgba(15, 23, 42, 0.98)
          );
          backdrop-filter: blur(20px);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 20px;
          max-width: 600px;
          max-height: 85vh;
          overflow-y: auto;
          box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        "
      >
        <div
          class="modal-header"
          style="
            background: linear-gradient(
              135deg,
              rgba(102, 126, 234, 0.2),
              rgba(118, 75, 162, 0.2)
            );
            padding: 1.5rem;
            border-radius: 20px 20px 0 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          "
        >
          <h2 style="color: white; margin: 0; font-size: 1.5rem">
            üé® How to Use Colour Magic
          </h2>
          <button
            class="close-modal"
            onclick="closeHelp()"
            style="
              background: rgba(255, 255, 255, 0.1);
              border: none;
              color: white;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              font-size: 1.5rem;
              cursor: pointer;
              transition: all 0.3s ease;
            "
          >
            &times;
          </button>
        </div>
        <div class="help-item">
          <h3>üñåÔ∏è Brush Tool & Styles</h3>
          <p>
            Click and drag to draw freely on the canvas. Choose from 10 amazing
            brush styles:<br />
            <strong>‚úèÔ∏è Normal</strong> - Classic smooth brush<br />
            <strong>üí® Spray</strong> - Airbrush effect<br />
            <strong>üñäÔ∏è Marker</strong> - Bold marker strokes<br />
            <strong>üñçÔ∏è Crayon</strong> - Textured crayon look<br />
            <strong>üñãÔ∏è Calligraphy</strong> - Elegant angled strokes<br />
            <strong>‚ú® Glitter</strong> - Sparkly star effects<br />
            <strong>üí° Neon</strong> - Glowing neon lines<br />
            <strong>üíß Watercolor</strong> - Soft watercolor blending<br />
            <strong>üìù Sketch</strong> - Rough sketchy lines<br />
            <strong>üåà Rainbow</strong> - Automatic rainbow colors!
          </p>
        </div>
        <div class="help-item">
          <h3>ü™£ Fill Tool</h3>
          <p>
            Click on any area to fill it with the selected color. Perfect for
            coloring large areas quickly!
          </p>
        </div>
        <div class="help-item">
          <h3>üßπ Eraser</h3>
          <p>
            Remove colors by clicking and dragging. Adjust the eraser size just
            like the brush.
          </p>
        </div>
        <div class="help-item">
          <h3>‚Ü∂‚Ü∑ Undo/Redo</h3>
          <p>
            Made a mistake? Use undo to go back. Changed your mind? Use redo to
            restore your work.
          </p>
        </div>
        <div class="help-item">
          <h3>üé® Color Picker</h3>
          <p>
            Choose from 16 preset colors or click the color input to create your
            own custom colors!
          </p>
        </div>
        <div class="help-item">
          <h3>üé≠ Pattern Stamps</h3>
          <p>
            Click the Patterns button (üé≠) to choose fun shapes to stamp:
            circles, squares, stars, hearts, flowers, and more! Perfect for
            adding decorative elements.
          </p>
        </div>
        <div class="help-item">
          <h3>ü™û Symmetry Mode</h3>
          <p>
            Toggle the Symmetry button (ü™û) to draw mirrored designs! Everything
            you draw will be reflected across the center, creating beautiful
            symmetrical patterns.
          </p>
        </div>
        <div class="help-item">
          <h3>ÔøΩÔ∏è Stay Inside Lines</h3>
          <p>
            Toggle the Stay Inside Lines button (üñçÔ∏è) to prevent drawing over the
            black outlines! When ON, your brush will automatically avoid
            painting on the picture's borders, keeping your coloring neat and
            tidy. Turn it OFF to draw freely anywhere!
          </p>
        </div>
        <div class="help-item">
          <h3>ÔøΩüíß Opacity Control</h3>
          <p>
            Adjust the opacity slider (10-100%) to make your strokes transparent
            or solid. Great for layering colors and creating depth!
          </p>
        </div>
        <div class="help-item">
          <h3>üíæ Save Your Art</h3>
          <p>
            Click the Save button to download your masterpiece as a PNG image
            file.
          </p>
        </div>
        <div class="help-item">
          <h3>üì± Touch Support</h3>
          <p>
            Works perfectly on tablets and phones! Just tap and drag with your
            finger.
          </p>
        </div>
        <div class="help-item">
          <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
          <p>
            <strong>B</strong> - Brush | <strong>F</strong> - Fill |
            <strong>E</strong> - Eraser<br />
            <strong>M</strong> - Toggle Symmetry | <strong>P</strong> - Toggle
            Patterns<br />
            <strong>Ctrl+Z</strong> - Undo | <strong>Ctrl+Shift+Z</strong> -
            Redo<br />
            <strong>Ctrl+S</strong> - Save | <strong>H</strong> - Help<br />
            <strong>Esc</strong> - Close Help
          </p>
        </div>
      </div>
    </div>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      let currentColor = "#FF6B6B";
      let currentTool = "brush";
      let brushSize = 10;
      let brushStyle = "normal";
      let isDrawing = false;
      let currentPicture = "";
      let undoStack = [];
      let redoStack = [];
      const MAX_UNDO = 20;
      let strokeCount = 0;
      let colorHistory = [];
      let rainbowHue = 0;
      let lastX = 0;
      let lastY = 0;
      let symmetryMode = false;
      let currentOpacity = 1.0;
      let currentPattern = "none";
      let cachedImageData = null; // Cache for performance
      let lastCursorCheck = { x: -1, y: -1, result: false };
      let currentZoom = 1;
      const colorIndicator = document.getElementById("currentColorIndicator");

      // Update color indicator
      function updateColorIndicator() {
        if (colorIndicator) {
          colorIndicator.style.backgroundColor = currentColor;
          colorIndicator.style.display =
            document.getElementById("coloringArea").style.display === "block"
              ? "block"
              : "none";
        }
      }

      // Zoom functions
      function zoomCanvas(factor) {
        currentZoom *= factor;
        currentZoom = Math.max(0.5, Math.min(2, currentZoom));
        canvas.style.transform = `scale(${currentZoom})`;
        canvas.style.transformOrigin = "center center";
        showToast(`Zoom: ${Math.round(currentZoom * 100)}%`);
      }

      function resetZoom() {
        currentZoom = 1;
        canvas.style.transform = "scale(1)";
        showToast("Zoom reset to 100%");
      }

      const pictures = {
        pineapple: [
          // Empty - user will draw their own pineapple
        ],
      };

      function selectPicture(pic) {
        currentPicture = pic;
        document.getElementById("pictureSelect").style.display = "none";
        document.getElementById("coloringArea").style.display = "block";
        undoStack = [];
        redoStack = [];
        updateUndoRedoButtons();
        drawPicture();
        saveState();
        updateColorIndicator();
        resetZoom();
      }

      function backToSelect() {
        document.getElementById("pictureSelect").style.display = "flex";
        document.getElementById("coloringArea").style.display = "none";
        clearCanvas();
        updateColorIndicator();
        resetZoom();
      }

      function drawPicture() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Load SVG file onto the canvas
        const svgFiles = [
          "pineapple",
          "art",
          "boat",
          "butterflyart",
          "carrot",
          "cat",
          "cookies",
          "doctor",
          "dolphin",
          "dragon",
          "face",
          "flowerart",
          "girl",
          "girlback",
          "horse",
          "icecream",
          "jellyfish",
          "leafart",
          "lines",
          "mushroomhouse",
          "octopus",
          "owlart",
          "panda",
          "princess",
          "spiral",
          "tiger",
          "turtles",
          "watermelon",
          "zebra",
        ];

        if (svgFiles.includes(currentPicture)) {
          const img = new Image();
          img.onload = function () {
            // Center the image on canvas
            const scale =
              Math.min(canvas.width / img.width, canvas.height / img.height) *
              0.9;
            const x = (canvas.width - img.width * scale) / 2;
            const y = (canvas.height - img.height * scale) / 2;
            ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
          };
          // Only Pineapple.svg is capitalized, all others are lowercase
          const fileName =
            currentPicture === "pineapple" ? "Pineapple" : currentPicture;
          img.src = `colourmagic/${fileName}.svg`;
          return;
        }

        ctx.strokeStyle = "black";
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        const shapes = pictures[currentPicture];
        shapes.forEach((shape) => {
          ctx.beginPath();
          switch (shape.type) {
            case "circle":
              ctx.arc(shape.x, shape.y, shape.r, 0, Math.PI * 2);
              ctx.stroke();
              break;
            case "rect":
              if (shape.rx) {
                ctx.roundRect(shape.x, shape.y, shape.w, shape.h, shape.rx);
              } else {
                ctx.rect(shape.x, shape.y, shape.w, shape.h);
              }
              ctx.stroke();
              break;
            case "ellipse":
              ctx.ellipse(
                shape.cx,
                shape.cy,
                shape.rx,
                shape.ry,
                shape.rotation || 0,
                0,
                Math.PI * 2
              );
              ctx.stroke();
              break;
            case "polygon":
              ctx.moveTo(shape.points[0][0], shape.points[0][1]);
              for (let i = 1; i < shape.points.length; i++) {
                ctx.lineTo(shape.points[i][0], shape.points[i][1]);
              }
              ctx.closePath();
              ctx.stroke();
              break;
            case "line":
              ctx.moveTo(shape.x1, shape.y1);
              ctx.lineTo(shape.x2, shape.y2);
              ctx.stroke();
              break;
            case "path":
              const path = new Path2D(shape.d);
              ctx.stroke(path);
              break;
          }
        });
      }

      function createRipple(element, e) {
        const ripple = document.createElement("span");
        const rect = element.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size / 2;
        const y = e.clientY - rect.top - size / 2;

        ripple.style.cssText = `
          position: absolute;
          width: ${size}px;
          height: ${size}px;
          top: ${y}px;
          left: ${x}px;
          background: rgba(255, 255, 255, 0.5);
          border-radius: 50%;
          pointer-events: none;
          animation: ripple 0.6s ease-out;
        `;

        element.style.position = "relative";
        element.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }

      function selectColor(color) {
        currentColor = color;
        document
          .querySelectorAll(".colorBtn")
          .forEach((btn) => btn.classList.remove("active"));
        if (
          event.target.classList &&
          event.target.classList.contains("colorBtn")
        ) {
          event.target.classList.add("active");
          createRipple(event.target, event);
        }
        if (currentTool === "eraser") {
          setTool("brush");
        }

        // Add to color history
        if (!colorHistory.includes(color)) {
          colorHistory.unshift(color);
          if (colorHistory.length > 5) {
            colorHistory.pop();
          }
        }

        // Update color indicator
        updateColorIndicator();
      }

      function setTool(tool) {
        currentTool = tool;
        document
          .querySelectorAll(".toolBtn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Show/hide brush style selector
        const brushStyleSection = document.getElementById("brushStyleSection");
        if (tool === "brush") {
          brushStyleSection.style.display = "block";
          canvas.style.cursor = "crosshair";
          showCanvasOverlay("Tool: Brush üñåÔ∏è");
        } else if (tool === "fill") {
          brushStyleSection.style.display = "none";
          canvas.style.cursor = "pointer";
          showCanvasOverlay("Tool: Fill ü™£");
        } else if (tool === "eraser") {
          brushStyleSection.style.display = "none";
          canvas.style.cursor = "grab";
          showCanvasOverlay("Tool: Eraser üßπ");
        }
      }

      function setBrushStyle(style) {
        brushStyle = style;
        const brushOptions = document.querySelectorAll(".brush-option");
        brushOptions.forEach((btn) => btn.classList.remove("active"));
        const selectedOption = event.target.closest(".brush-option");
        selectedOption.classList.add("active");
        createRipple(selectedOption, event);
        showCanvasOverlay(
          `Brush: ${style.charAt(0).toUpperCase() + style.slice(1)}`
        );
      }

      function showCanvasOverlay(message) {
        const overlay = document.getElementById("canvasOverlay");
        overlay.textContent = message;
        overlay.classList.add("show");
        setTimeout(() => overlay.classList.remove("show"), 2000);
      }

      function openHelp() {
        document.getElementById("helpModal").classList.add("show");
      }

      function closeHelp() {
        document.getElementById("helpModal").classList.remove("show");
      }

      // Close modal when clicking outside
      document
        .getElementById("helpModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeHelp();
          }
        });

      function updateBrushSize(value) {
        brushSize = value;
        const sizeLabel = document.getElementById("sizeValue");
        sizeLabel.textContent = value;
        sizeLabel.style.transform = "scale(1.2)";
        setTimeout(() => {
          sizeLabel.style.transform = "scale(1)";
        }, 150);
      }

      function updateOpacity(value) {
        currentOpacity = value / 100;
        const opacityLabel = document.getElementById("opacityValue");
        opacityLabel.textContent = value;
        opacityLabel.style.transform = "scale(1.2)";
        setTimeout(() => {
          opacityLabel.style.transform = "scale(1)";
        }, 150);
      }

      function toggleSymmetry() {
        symmetryMode = !symmetryMode;
        const btn = document.getElementById("symmetryBtn");
        if (symmetryMode) {
          btn.classList.add("active");
          showToast("Symmetry Mode ON ü™û");
        } else {
          btn.classList.remove("active");
          showToast("Symmetry Mode OFF");
        }
      }

      function togglePatterns() {
        const section = document.getElementById("patternsSection");
        const btn = document.getElementById("patternsBtn");
        if (section.style.display === "none") {
          section.style.display = "block";
          btn.classList.add("active");
        } else {
          section.style.display = "none";
          btn.classList.remove("active");
          currentPattern = "none";
        }
      }

      function setPattern(pattern) {
        currentPattern = pattern;
        document
          .querySelectorAll(".pattern-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");
        createRipple(event.target, event);
        showCanvasOverlay(`Pattern: ${pattern}`);
      }

      function clearCanvas() {
        if (currentPicture) {
          drawPicture();
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "white";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
      }

      function floodFill(startX, startY, fillColor) {
        startX = Math.floor(startX);
        startY = Math.floor(startY);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const pixels = imageData.data;
        const startPos = (startY * canvas.width + startX) * 4;
        const startR = pixels[startPos];
        const startG = pixels[startPos + 1];
        const startB = pixels[startPos + 2];
        const startA = pixels[startPos + 3];

        const fillRGB = hexToRgb(fillColor);

        // Don't fill if clicking on a black line (outline) - stricter threshold
        if (startR < 40 && startG < 40 && startB < 40) {
          showToast("Can't fill outline! Click inside an area.");
          return;
        }

        // Check if already the same color (within tolerance)
        if (
          Math.abs(startR - fillRGB.r) < 5 &&
          Math.abs(startG - fillRGB.g) < 5 &&
          Math.abs(startB - fillRGB.b) < 5
        ) {
          showToast("Already this color!");
          return;
        }

        const tolerance = 25; // Slightly higher tolerance for better filling
        const stack = [[startX, startY]];
        const visited = new Set();
        let filledPixels = 0;

        function isBlackLine(pos) {
          // Check if pixel is part of the black outline - stricter
          const r = pixels[pos];
          const g = pixels[pos + 1];
          const b = pixels[pos + 2];
          const a = pixels[pos + 3];
          return r < 40 && g < 40 && b < 40 && a > 200;
        }

        function colorMatch(pos) {
          // Don't cross black lines
          if (isBlackLine(pos)) return false;

          return (
            Math.abs(pixels[pos] - startR) <= tolerance &&
            Math.abs(pixels[pos + 1] - startG) <= tolerance &&
            Math.abs(pixels[pos + 2] - startB) <= tolerance &&
            pixels[pos + 3] > 0 // Only fill visible pixels
          );
        }

        while (stack.length > 0) {
          const [x, y] = stack.pop();

          if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height)
            continue;

          const key = `${x},${y}`;
          if (visited.has(key)) continue;

          const pos = (y * canvas.width + x) * 4;

          if (!colorMatch(pos)) continue;

          visited.add(key);
          filledPixels++;

          // Fill the pixel
          pixels[pos] = fillRGB.r;
          pixels[pos + 1] = fillRGB.g;
          pixels[pos + 2] = fillRGB.b;
          pixels[pos + 3] = 255;

          // Add neighboring pixels (4-directional for better boundary detection)
          stack.push([x + 1, y]);
          stack.push([x - 1, y]);
          stack.push([x, y + 1]);
          stack.push([x, y - 1]);
        }

        ctx.putImageData(imageData, 0, 0);

        if (filledPixels > 0) {
          showToast(`Filled ${filledPixels} pixels! üé®`);
          saveState(); // Save state after fill
        }
      }

      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? {
              r: parseInt(result[1], 16),
              g: parseInt(result[2], 16),
              b: parseInt(result[3], 16),
            }
          : null;
      }

      // Mouse and touch events
      canvas.addEventListener("mousedown", handleStart);
      canvas.addEventListener("mousemove", handleMove);
      canvas.addEventListener("mouseup", handleEnd);
      canvas.addEventListener("mouseout", handleEnd);

      canvas.addEventListener("touchstart", handleStart, { passive: false });
      canvas.addEventListener("touchmove", handleMove, { passive: false });
      canvas.addEventListener("touchend", handleEnd, { passive: false });
      canvas.addEventListener("touchcancel", handleEnd, { passive: false });

      // Prevent pull-to-refresh and scrolling on the canvas
      document.getElementById("canvasContainer").addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      // Visual feedback for cursor position
      let cursorCheckThrottle = 0;
      canvas.addEventListener("mousemove", function (e) {
        if (!stayInsideLines || currentTool === "fill") return;

        // Throttle checks for performance (every 100ms)
        canvas.style.cursor = currentTool === "eraser" ? "cell" : "crosshair";
      });

      function handleStart(e) {
        e.preventDefault();
        const pos = getEventPosition(e);

        if (currentTool === "fill") {
          floodFill(Math.floor(pos.x), Math.floor(pos.y), currentColor);
          saveState();
        } else {
          isDrawing = true;
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
          lastX = pos.x;
          lastY = pos.y;
        }
      }

      function handleMove(e) {
        e.preventDefault();
        if (!isDrawing) return;
        const pos = getEventPosition(e);
        draw(pos.x, pos.y);
        lastX = pos.x;
        lastY = pos.y;
      }

      function handleEnd(e) {
        if (isDrawing) {
          isDrawing = false;
          ctx.beginPath();
          saveState();
          strokeCount++;
        }
      }

      function getEventPosition(e) {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches ? e.touches[0] : e;

        // Calculate the scale between canvas internal size and displayed size
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        // Get position relative to canvas and scale to internal coordinates
        const x = (touch.clientX - rect.left) * scaleX;
        const y = (touch.clientY - rect.top) * scaleY;

        return { x, y };
      }

      function draw(x, y) {
        if (currentTool === "eraser") {
          ctx.globalCompositeOperation = "destination-out";
          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.lineWidth = brushSize;
          ctx.lineTo(x, y);
          ctx.stroke();
          ctx.moveTo(x, y);

          if (symmetryMode) {
            const mirrorX = canvas.width - x;
            ctx.lineTo(mirrorX, y);
            ctx.stroke();
            ctx.moveTo(mirrorX, y);
          }
          ctx.globalCompositeOperation = "source-over";
          return;
        }

        ctx.globalCompositeOperation = "source-over";

        // Apply pattern if selected
        if (currentPattern !== "none") {
          drawPattern(x, y);
          if (symmetryMode) {
            drawPattern(canvas.width - x, y);
          }
          return;
        }

        // Draw at main position
        switch (brushStyle) {
          case "normal":
            drawNormal(x, y);
            break;
          case "spray":
            drawSpray(x, y);
            break;
          case "marker":
            drawMarker(x, y);
            break;
          case "crayon":
            drawCrayon(x, y);
            break;
          case "calligraphy":
            drawCalligraphy(x, y);
            break;
          case "glitter":
            drawGlitter(x, y);
            break;
          case "neon":
            drawNeon(x, y);
            break;
          case "watercolor":
            drawWatercolor(x, y);
            break;
          case "sketch":
            drawSketch(x, y);
            break;
          case "rainbow":
            drawRainbow(x, y);
            break;
          default:
            drawNormal(x, y);
        }

        // Draw mirrored if symmetry is on
        if (symmetryMode) {
          const mirrorX = canvas.width - x;
          switch (brushStyle) {
            case "normal":
              drawNormal(mirrorX, y);
              break;
            case "spray":
              drawSpray(mirrorX, y);
              break;
            case "marker":
              drawMarker(mirrorX, y);
              break;
            case "crayon":
              drawCrayon(mirrorX, y);
              break;
            case "calligraphy":
              drawCalligraphy(mirrorX, y);
              break;
            case "glitter":
              drawGlitter(mirrorX, y);
              break;
            case "neon":
              drawNeon(mirrorX, y);
              break;
            case "watercolor":
              drawWatercolor(mirrorX, y);
              break;
            case "sketch":
              drawSketch(mirrorX, y);
              break;
            case "rainbow":
              drawRainbow(mirrorX, y);
              break;
          }
        }
      }

      function drawPattern(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.fillStyle = currentColor;
        ctx.strokeStyle = currentColor;
        const size = brushSize * 2;

        ctx.beginPath();
        switch (currentPattern) {
          case "circle":
            ctx.arc(x, y, size / 2, 0, Math.PI * 2);
            ctx.fill();
            break;
          case "square":
            ctx.fillRect(x - size / 2, y - size / 2, size, size);
            break;
          case "star":
            drawStar(x, y, 5, size / 2, size / 4);
            ctx.fill();
            break;
          case "heart":
            drawHeart(x, y, size / 2);
            ctx.fill();
            break;
          case "flower":
            drawFlowerPattern(x, y, size / 3);
            ctx.fill();
            break;
          case "triangle":
            ctx.moveTo(x, y - size / 2);
            ctx.lineTo(x - size / 2, y + size / 2);
            ctx.lineTo(x + size / 2, y + size / 2);
            ctx.closePath();
            ctx.fill();
            break;
          case "hexagon":
            drawHexagon(x, y, size / 2);
            ctx.fill();
            break;
          case "diamond":
            ctx.moveTo(x, y - size / 2);
            ctx.lineTo(x + size / 2, y);
            ctx.lineTo(x, y + size / 2);
            ctx.lineTo(x - size / 2, y);
            ctx.closePath();
            ctx.fill();
            break;
          case "cloud":
            drawCloud(x, y, size / 2);
            ctx.fill();
            break;
        }
        ctx.restore();
      }

      function drawStar(x, y, points, outer, inner) {
        ctx.moveTo(x, y - outer);
        for (let i = 0; i < points * 2; i++) {
          const radius = i % 2 === 0 ? outer : inner;
          const angle = (Math.PI * i) / points - Math.PI / 2;
          ctx.lineTo(
            x + radius * Math.cos(angle),
            y + radius * Math.sin(angle)
          );
        }
        ctx.closePath();
      }

      function drawHeart(x, y, size) {
        ctx.moveTo(x, y + size / 4);
        ctx.bezierCurveTo(x, y, x - size / 2, y - size / 2, x - size / 2, y);
        ctx.bezierCurveTo(
          x - size / 2,
          y + size / 3,
          x,
          y + size / 2,
          x,
          y + size
        );
        ctx.bezierCurveTo(
          x,
          y + size / 2,
          x + size / 2,
          y + size / 3,
          x + size / 2,
          y
        );
        ctx.bezierCurveTo(x + size / 2, y - size / 2, x, y, x, y + size / 4);
      }

      function drawFlowerPattern(x, y, size) {
        for (let i = 0; i < 6; i++) {
          const angle = (Math.PI * 2 * i) / 6;
          ctx.moveTo(x, y);
          ctx.arc(
            x + Math.cos(angle) * size,
            y + Math.sin(angle) * size,
            size / 2,
            0,
            Math.PI * 2
          );
        }
      }

      function drawHexagon(x, y, size) {
        for (let i = 0; i < 6; i++) {
          const angle = (Math.PI * i) / 3;
          const px = x + size * Math.cos(angle);
          const py = y + size * Math.sin(angle);
          if (i === 0) ctx.moveTo(px, py);
          else ctx.lineTo(px, py);
        }
        ctx.closePath();
      }

      function drawCloud(x, y, size) {
        ctx.arc(x - size / 2, y, size / 2, 0, Math.PI * 2);
        ctx.arc(x, y - size / 3, size / 2, 0, Math.PI * 2);
        ctx.arc(x + size / 2, y, size / 2, 0, Math.PI * 2);
      }

      function drawNormal(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = brushSize;
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.restore();
      }

      function drawSpray(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        const density = brushSize * 2;
        for (let i = 0; i < density; i++) {
          const offsetX = (Math.random() - 0.5) * brushSize * 2;
          const offsetY = (Math.random() - 0.5) * brushSize * 2;
          ctx.fillStyle = currentColor;
          ctx.fillRect(x + offsetX, y + offsetY, 1, 1);
        }
        ctx.restore();
      }

      function drawMarker(x, y) {
        ctx.save();
        ctx.lineCap = "square";
        ctx.lineJoin = "miter";
        ctx.lineWidth = brushSize;
        ctx.globalAlpha = 0.6 * currentOpacity;
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.restore();
      }

      function drawCrayon(x, y) {
        ctx.save();
        const density = Math.floor(brushSize / 2);
        for (let i = 0; i < density; i++) {
          const offsetX = (Math.random() - 0.5) * brushSize;
          const offsetY = (Math.random() - 0.5) * brushSize;
          ctx.globalAlpha = (Math.random() * 0.3 + 0.3) * currentOpacity;
          ctx.fillStyle = currentColor;
          ctx.fillRect(x + offsetX, y + offsetY, 2, 2);
        }
        ctx.restore();
      }

      function drawCalligraphy(x, y) {
        const angle = Math.atan2(y - lastY, x - lastX);
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.translate(x, y);
        ctx.rotate(angle);
        ctx.fillStyle = currentColor;
        ctx.fillRect(-brushSize / 2, -brushSize / 4, brushSize, brushSize / 2);
        ctx.restore();
      }

      function drawGlitter(x, y) {
        const sparkles = Math.floor(brushSize / 2);
        for (let i = 0; i < sparkles; i++) {
          const offsetX = (Math.random() - 0.5) * brushSize * 1.5;
          const offsetY = (Math.random() - 0.5) * brushSize * 1.5;
          const sparkleSize = Math.random() * 3 + 1;

          ctx.save();
          ctx.globalAlpha = (Math.random() * 0.8 + 0.2) * currentOpacity;
          ctx.fillStyle = currentColor;
          ctx.shadowBlur = 10;
          ctx.shadowColor = currentColor;

          // Draw star shape
          ctx.beginPath();
          for (let j = 0; j < 5; j++) {
            const angle = (j * 4 * Math.PI) / 5;
            const px = x + offsetX + Math.cos(angle) * sparkleSize;
            const py = y + offsetY + Math.sin(angle) * sparkleSize;
            if (j === 0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
          }
          ctx.closePath();
          ctx.fill();
          ctx.restore();
        }
      }

      function drawNeon(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.shadowBlur = brushSize;
        ctx.shadowColor = currentColor;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = brushSize / 2;
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.shadowBlur = 0;
        ctx.restore();
      }

      function drawWatercolor(x, y) {
        ctx.save();
        const layers = 3;
        for (let i = 0; i < layers; i++) {
          const offset = (brushSize * (i + 1)) / layers;
          ctx.globalAlpha = 0.1 * currentOpacity;
          ctx.beginPath();
          ctx.arc(x, y, offset, 0, Math.PI * 2);
          ctx.fillStyle = currentColor;
          ctx.fill();
        }
        ctx.restore();
      }

      function drawSketch(x, y) {
        ctx.save();
        const lines = 3;
        for (let i = 0; i < lines; i++) {
          const offsetX = (Math.random() - 0.5) * 3;
          const offsetY = (Math.random() - 0.5) * 3;
          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.lineWidth = Math.max(1, brushSize / 4);
          ctx.globalAlpha = 0.4 * currentOpacity;
          ctx.strokeStyle = currentColor;
          ctx.beginPath();
          ctx.moveTo(lastX + offsetX, lastY + offsetY);
          ctx.lineTo(x + offsetX, y + offsetY);
          ctx.stroke();
        }
        ctx.restore();
      }

      function drawRainbow(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        rainbowHue = (rainbowHue + 2) % 360;
        const rainbowColor = `hsl(${rainbowHue}, 100%, 50%)`;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = brushSize;
        ctx.strokeStyle = rainbowColor;
        ctx.shadowBlur = brushSize / 2;
        ctx.shadowColor = rainbowColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.shadowBlur = 0;
        ctx.restore();
      }

      function saveState() {
        if (undoStack.length >= MAX_UNDO) {
          undoStack.shift();
        }
        undoStack.push(canvas.toDataURL());
        redoStack = [];
        updateUndoRedoButtons();
      }

      function undo() {
        if (undoStack.length > 0) {
          redoStack.push(canvas.toDataURL());
          const imageData = undoStack.pop();
          restoreCanvas(imageData);
          updateUndoRedoButtons();
        }
      }

      function redo() {
        if (redoStack.length > 0) {
          undoStack.push(canvas.toDataURL());
          const imageData = redoStack.pop();
          restoreCanvas(imageData);
          updateUndoRedoButtons();
        }
      }

      function restoreCanvas(imageData) {
        const img = new Image();
        img.onload = function () {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };
        img.src = imageData;
      }

      function updateUndoRedoButtons() {
        document.getElementById("undoBtn").disabled = undoStack.length === 0;
        document.getElementById("redoBtn").disabled = redoStack.length === 0;
      }

      function saveDrawing() {
        const link = document.createElement("a");
        link.download = `colour-magic-${currentPicture}-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast("Drawing saved! üé®");
      }

      function showToast(message) {
        let toast = document.querySelector(".toast");
        if (!toast) {
          toast = document.createElement("div");
          toast.className = "toast";
          document.body.appendChild(toast);
        }
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        // Don't trigger shortcuts in modals
        if (document.getElementById("helpModal").classList.contains("show")) {
          if (e.key === "Escape") closeHelp();
          return;
        }

        // Only enable shortcuts when coloring
        if (document.getElementById("coloringArea").style.display === "none")
          return;

        switch (e.key.toLowerCase()) {
          case "z":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              if (e.shiftKey) {
                redo();
              } else {
                undo();
              }
            }
            break;
          case "y":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              redo();
            }
            break;
          case "s":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              saveDrawing();
            }
            break;
          case "b":
            e.preventDefault();
            document.querySelector('.toolBtn[onclick*="brush"]').click();
            break;
          case "f":
            e.preventDefault();
            document.querySelector('.toolBtn[onclick*="fill"]').click();
            break;
          case "e":
            e.preventDefault();
            document.querySelector('.toolBtn[onclick*="eraser"]').click();
            break;
          case "c":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              if (confirm("Clear the canvas?")) {
                clearCanvas();
                showToast("Canvas cleared");
              }
            }
            break;
          case "h":
          case "?":
            e.preventDefault();
            openHelp();
            break;
          case "l":
            e.preventDefault();
            toggleStayInsideLines();
            break;
          case "m":
            e.preventDefault();
            toggleSymmetry();
            break;
          case "p":
            e.preventDefault();
            togglePatterns();
            break;
          case "escape":
            closeHelp();
            break;
        }
      });

      // Add animation to picture options on load
      window.addEventListener("load", function () {
        const options = document.querySelectorAll(".pictureOption");
        options.forEach((option, index) => {
          option.style.opacity = "0";
          option.classList.add("fade-in");
          option.style.animationDelay = `${index * 0.1}s`;
          setTimeout(() => {
            option.style.opacity = "1";
          }, index * 100);
        });
      });

      clearCanvas();
    </script>

    <!-- Bottom Ad -->
    <div class="ad-wrapper">
      <script
        async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
        crossorigin="anonymous"
      ></script>
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-format="autorelaxed"
        data-ad-client="ca-pub-2456627863532019"
        data-ad-slot="2184713192"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <!-- Footer -->
    <footer class="game-footer">
      <div>
        <a href="../index.html">Home</a>
        <a href="../games.html">Games</a>
        <a href="../lessons.html">Lessons</a>
        <a href="../contact.html">Contact</a>
      </div>
      <p class="copyright">¬© 2024 ESL Fun Online. All rights reserved.</p>
    </footer>
  </body>
</html>
