<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Colour Magic - Creative Coloring Game | ESL Fun Online</title>
        <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="../images/favicon-48x48.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="../images/favicon-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="../images/favicon-512x512.png" />

    <!-- Disable Pinterest Pin Button -->
    <meta name="pinterest" content="nopin" />

    <meta
      name="description"
      content="Express your creativity with Colour Magic! A fun interactive coloring game with multiple pictures to color. Perfect for all ages."
    />
    <meta
      name="keywords"
      content="coloring game, color magic, art game, creative game, drawing game, ESL games"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      html,
      body {
        overscroll-behavior: none;
        overflow-x: hidden;
        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
      }

      body {
        font-family: "Comic Sans MS", "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        touch-action: manipulation;
      }

      #gameContainer {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 1200px;
        width: 100%;
      }

      #header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 20px 20px 0 0;
        text-align: center;
        position: relative;
      }

      #header h1 {
        font-size: 32px;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      #header p {
        font-size: 16px;
        opacity: 0.95;
      }

      .header-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
      }

      .header-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.5);
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }

      .header-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      #pictureSelect {
        display: flex;
        justify-content: center;
        gap: 20px;
        padding: 30px;
        flex-wrap: wrap;
        background: #f8f9fa;
      }

      .pictureOption {
        background: white;
        border: 3px solid #ddd;
        border-radius: 15px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        width: 150px;
      }

      .pictureOption:hover {
        transform: translateY(-5px);
        border-color: #667eea;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .pictureOption.selected {
        border-color: #667eea;
        background: #e8eaf6;
      }

      .pictureOption svg {
        width: 100px;
        height: 100px;
      }

      .pictureOption p {
        margin-top: 10px;
        font-weight: bold;
        color: #333;
      }

      #coloringArea {
        display: none;
        padding: 20px;
      }

      #toolbar {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        align-items: center;
      }

      .toolSection {
        display: flex;
        flex-direction: column;
        gap: 10px;
        animation: fadeInUp 0.5s ease;
      }

      .toolSection label {
        font-weight: bold;
        color: #333;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .colorPalette {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
        padding: 5px;
      }

      .colorBtn {
        width: 40px;
        height: 40px;
        border: 3px solid #ddd;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .colorBtn::after {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        border-radius: 10px;
        border: 2px solid transparent;
        transition: all 0.3s;
      }

      .colorBtn:hover {
        transform: scale(1.15) translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }

      .colorBtn.active {
        border-color: #333;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.4);
        transform: scale(1.1);
      }

      .colorBtn.active::after {
        border-color: rgba(102, 126, 234, 0.5);
        animation: pulse 1.5s infinite;
      }

      .toolBtn {
        background: white;
        border: 2px solid #ddd;
        border-radius: 12px;
        padding: 12px 20px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      .toolBtn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s;
      }

      .toolBtn:hover::before {
        left: 100%;
      }

      .toolBtn:hover {
        background: #f8f9fa;
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      }

      .toolBtn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      }

      .toolBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .toolBtn:disabled:hover {
        transform: none;
        box-shadow: none;
      }

      .brush-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 12px;
        margin-top: 10px;
      }

      .brush-option {
        background: white;
        border: 2px solid #ddd;
        border-radius: 12px;
        padding: 14px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-align: center;
        font-size: 12px;
        font-weight: bold;
        position: relative;
        overflow: hidden;
      }

      .brush-option::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(102, 126, 234, 0.1);
        transform: translate(-50%, -50%);
        transition: width 0.4s, height 0.4s;
      }

      .brush-option:hover::before {
        width: 100%;
        height: 100%;
      }

      .brush-option:hover {
        border-color: #667eea;
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
      }

      .brush-option.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }

      .brush-option .brush-icon {
        font-size: 28px;
        margin-bottom: 6px;
        position: relative;
        z-index: 1;
        transition: transform 0.3s;
      }

      .brush-option:hover .brush-icon {
        transform: scale(1.15) rotate(5deg);
      }

      .brush-option.active .brush-icon {
        animation: bounce 0.5s ease;
      }

      /* Stagger animation for brush options */
      #brushStyleSection .brush-option {
        animation: fadeInUp 0.4s ease backwards;
      }

      #brushStyleSection .brush-option:nth-child(1) {
        animation-delay: 0.05s;
      }
      #brushStyleSection .brush-option:nth-child(2) {
        animation-delay: 0.1s;
      }
      #brushStyleSection .brush-option:nth-child(3) {
        animation-delay: 0.15s;
      }
      #brushStyleSection .brush-option:nth-child(4) {
        animation-delay: 0.2s;
      }
      #brushStyleSection .brush-option:nth-child(5) {
        animation-delay: 0.25s;
      }
      #brushStyleSection .brush-option:nth-child(6) {
        animation-delay: 0.3s;
      }
      #brushStyleSection .brush-option:nth-child(7) {
        animation-delay: 0.35s;
      }
      #brushStyleSection .brush-option:nth-child(8) {
        animation-delay: 0.4s;
      }
      #brushStyleSection .brush-option:nth-child(9) {
        animation-delay: 0.45s;
      }
      #brushStyleSection .brush-option:nth-child(10) {
        animation-delay: 0.5s;
      }

      .brush-preview {
        width: 100%;
        height: 30px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-top: 5px;
      }

      .feature-toggle {
        background: white;
        border: 2px solid #ddd;
        border-radius: 12px;
        padding: 10px 18px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      .feature-toggle::after {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: -100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .feature-toggle:hover::after {
        left: 100%;
      }

      .feature-toggle:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
      }

      .feature-toggle.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        animation: subtle-pulse 3s ease-in-out infinite;
      }

      @keyframes subtle-pulse {
        0%,
        100% {
          box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        50% {
          box-shadow: 0 4px 16px rgba(102, 126, 234, 0.6);
        }
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .slider-container input[type="range"] {
        flex: 1;
      }

      .pattern-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
        margin-top: 10px;
      }

      .pattern-btn {
        background: white;
        border: 2px solid #ddd;
        border-radius: 10px;
        padding: 12px;
        cursor: pointer;
        font-size: 28px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .pattern-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(102, 126, 234, 0.15);
        transform: translate(-50%, -50%);
        transition: width 0.4s, height 0.4s;
      }

      .pattern-btn:hover::before {
        width: 150%;
        height: 150%;
      }

      .pattern-btn:hover {
        border-color: #667eea;
        transform: scale(1.15) rotate(5deg);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .pattern-btn.active {
        border-color: #667eea;
        background: linear-gradient(135deg, #e8eaf6 0%, #f0f0ff 100%);
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      /* Stagger animation for pattern buttons */
      #patternsSection .pattern-btn {
        animation: fadeInUp 0.3s ease backwards;
      }

      #patternsSection .pattern-btn:nth-child(1) {
        animation-delay: 0.05s;
      }
      #patternsSection .pattern-btn:nth-child(2) {
        animation-delay: 0.1s;
      }
      #patternsSection .pattern-btn:nth-child(3) {
        animation-delay: 0.15s;
      }
      #patternsSection .pattern-btn:nth-child(4) {
        animation-delay: 0.2s;
      }
      #patternsSection .pattern-btn:nth-child(5) {
        animation-delay: 0.25s;
      }
      #patternsSection .pattern-btn:nth-child(6) {
        animation-delay: 0.3s;
      }
      #patternsSection .pattern-btn:nth-child(7) {
        animation-delay: 0.35s;
      }
      #patternsSection .pattern-btn:nth-child(8) {
        animation-delay: 0.4s;
      }
      #patternsSection .pattern-btn:nth-child(9) {
        animation-delay: 0.45s;
      }
      #patternsSection .pattern-btn:nth-child(10) {
        animation-delay: 0.5s;
      }

      /* Stagger animation for color buttons */
      .colorPalette .colorBtn {
        animation: fadeInUp 0.25s ease backwards;
      }

      .colorPalette .colorBtn:nth-child(1) {
        animation-delay: 0.03s;
      }
      .colorPalette .colorBtn:nth-child(2) {
        animation-delay: 0.06s;
      }
      .colorPalette .colorBtn:nth-child(3) {
        animation-delay: 0.09s;
      }
      .colorPalette .colorBtn:nth-child(4) {
        animation-delay: 0.12s;
      }
      .colorPalette .colorBtn:nth-child(5) {
        animation-delay: 0.15s;
      }
      .colorPalette .colorBtn:nth-child(6) {
        animation-delay: 0.18s;
      }
      .colorPalette .colorBtn:nth-child(7) {
        animation-delay: 0.21s;
      }
      .colorPalette .colorBtn:nth-child(8) {
        animation-delay: 0.24s;
      }
      .colorPalette .colorBtn:nth-child(9) {
        animation-delay: 0.27s;
      }
      .colorPalette .colorBtn:nth-child(10) {
        animation-delay: 0.3s;
      }
      .colorPalette .colorBtn:nth-child(11) {
        animation-delay: 0.33s;
      }
      .colorPalette .colorBtn:nth-child(12) {
        animation-delay: 0.36s;
      }
      .colorPalette .colorBtn:nth-child(13) {
        animation-delay: 0.39s;
      }
      .colorPalette .colorBtn:nth-child(14) {
        animation-delay: 0.42s;
      }
      .colorPalette .colorBtn:nth-child(15) {
        animation-delay: 0.45s;
      }
      .colorPalette .colorBtn:nth-child(16) {
        animation-delay: 0.48s;
      }

      #brushSize,
      #opacitySlider {
        width: 150px;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        border-radius: 5px;
        background: linear-gradient(to right, #ddd 0%, #667eea 100%);
        outline: none;
        transition: all 0.3s;
      }

      #brushSize:hover,
      #opacitySlider:hover {
        background: linear-gradient(to right, #bbb 0%, #764ba2 100%);
      }

      #brushSize::-webkit-slider-thumb,
      #opacitySlider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        transition: all 0.3s;
      }

      #brushSize::-webkit-slider-thumb:hover,
      #opacitySlider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.6);
      }

      #brushSize::-webkit-slider-thumb:active,
      #opacitySlider::-webkit-slider-thumb:active {
        transform: scale(1.3);
      }

      #brushSize::-moz-range-thumb,
      #opacitySlider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        transition: all 0.3s;
      }

      #brushSize::-moz-range-thumb:hover,
      #opacitySlider::-moz-range-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.6);
      }

      #colorPicker {
        width: 50px;
        height: 40px;
        border: 3px solid #ddd;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      #colorPicker:hover {
        transform: scale(1.1);
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #333;
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s;
        z-index: 1000;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        animation: fadeIn 0.3s ease;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        animation: slideUp 0.3s ease;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h2 {
        color: #667eea;
        font-size: 24px;
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 30px;
        cursor: pointer;
        color: #999;
        transition: color 0.2s;
      }

      .close-modal:hover {
        color: #333;
      }

      .help-item {
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .help-item h3 {
        color: #764ba2;
        margin-bottom: 8px;
        font-size: 18px;
      }

      .help-item p {
        color: #666;
        line-height: 1.6;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes sparkle {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
          filter: brightness(1);
        }
        50% {
          transform: scale(1.2) rotate(180deg);
          filter: brightness(1.5);
        }
      }

      @keyframes bounce {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.5;
        }
        50% {
          opacity: 1;
        }
      }

      @keyframes ripple {
        0% {
          transform: scale(0);
          opacity: 1;
        }
        100% {
          transform: scale(2);
          opacity: 0;
        }
      }

      .sparkle-btn {
        position: relative;
        overflow: hidden;
      }

      .sparkle-btn::after {
        content: "‚ú®";
        position: absolute;
        top: -5px;
        right: -5px;
        font-size: 16px;
        animation: sparkle 2s infinite;
      }

      #canvasContainer {
        display: flex;
        justify-content: center;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
        position: relative;
      }

      .canvas-overlay {
        position: absolute;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(102, 126, 234, 0.9);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }

      .canvas-overlay.show {
        opacity: 1;
      }

      #canvas {
        border: 3px solid #333;
        background: white;
        cursor: crosshair;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        touch-action: none;
        -webkit-user-select: none;
        user-select: none;
      }

      #backBtn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s;
      }

      #backBtn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .sizeLabel {
        font-size: 16px;
        font-weight: bold;
        color: #667eea;
        padding: 4px 10px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 6px;
        transition: all 0.3s;
        display: inline-block;
        min-width: 40px;
        text-align: center;
      }

      /* Tablet styles */
      @media (max-width: 1024px) and (min-width: 769px) {
        #pictureSelect {
          padding: 20px;
          gap: 15px;
        }

        .pictureOption {
          width: 140px;
          padding: 12px;
        }

        .pictureOption img {
          max-width: 120px;
          max-height: 120px;
        }

        #toolbar {
          gap: 15px;
          padding: 20px;
        }

        .toolSection {
          padding: 15px;
        }

        #canvas {
          touch-action: none;
          -webkit-user-select: none;
          user-select: none;
        }
      }

      /* Mobile styles */
      @media (max-width: 768px) {
        body {
          padding: 0;
          overflow-x: hidden;
        }

        #gameContainer {
          border-radius: 0;
          min-height: 100vh;
        }

        #header {
          padding: 15px 10px;
          border-radius: 0;
          position: relative;
        }

        #header h1 {
          font-size: 24px;
          margin-top: 40px;
          margin-bottom: 8px;
        }

        #header p {
          font-size: 14px;
        }

        .header-controls {
          position: fixed;
          top: 10px;
          right: 10px;
          gap: 5px;
          z-index: 1000;
        }

        .header-btn {
          padding: 8px 12px;
          font-size: 13px;
          gap: 4px;
          min-width: 44px;
          min-height: 44px;
        }

        #pictureSelect {
          padding: 15px;
          gap: 12px;
          justify-content: center;
        }

        .pictureOption {
          width: calc(50% - 10px);
          min-width: 120px;
          max-width: 150px;
          padding: 12px;
          min-height: 120px;
        }

        .pictureOption img {
          width: 100% !important;
          height: auto !important;
          max-width: 100px;
          max-height: 100px;
        }

        .pictureOption p {
          font-size: 13px;
          margin-top: 8px;
          font-weight: 500;
        }

        #toolbar {
          flex-direction: column;
          gap: 12px;
          padding: 15px 10px;
          max-height: 70vh;
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
        }

        .toolSection {
          width: 100%;
          max-width: 100%;
          padding: 12px;
          overflow: hidden;
        }

        .toolSection label {
          font-size: 14px;
          font-weight: 500;
        }

        .colorPalette {
          grid-template-columns: repeat(4, 1fr);
          gap: 8px;
          padding: 5px;
          max-width: 100%;
        }

        .colorBtn {
          width: 100%;
          height: 0;
          padding-bottom: 100%;
          min-width: auto;
          min-height: auto;
          border-width: 3px;
          position: relative;
        }

        .colorBtn::before {
          content: "";
          position: absolute;
          inset: 0;
          border-radius: 50%;
        }

        .toolBtn {
          font-size: 14px;
          padding: 12px 15px;
          width: 100%;
          justify-content: center;
          min-height: 48px;
          font-weight: 500;
        }

        .brush-grid {
          display: flex;
          flex-direction: column;
          gap: 10px;
          max-width: 100%;
        }

        .brush-option {
          padding: 12px;
          font-size: 13px;
          min-height: 60px;
          display: flex;
          align-items: center;
          gap: 12px;
          text-align: left;
        }

        .brush-option .brush-icon {
          font-size: 28px;
          margin-bottom: 0;
          flex-shrink: 0;
        }

        .pattern-grid {
          grid-template-columns: repeat(5, 1fr);
          gap: 8px;
          max-width: 100%;
        }

        .pattern-btn {
          width: 100%;
          height: 0;
          padding-bottom: 100%;
          min-width: auto;
          min-height: auto;
          font-size: 18px;
          position: relative;
        }

        .pattern-btn::before {
          content: attr(data-pattern);
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .slider-container {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
          width: 100%;
        }

        .slider-container label {
          font-size: 14px;
          width: 100%;
        }

        #sizeSlider,
        #opacitySlider {
          width: 100%;
          height: 8px;
          -webkit-appearance: none;
          appearance: none;
        }

        #sizeSlider::-webkit-slider-thumb,
        #opacitySlider::-webkit-slider-thumb {
          width: 24px;
          height: 24px;
        }

        .feature-toggle {
          font-size: 14px;
          padding: 12px 18px;
          min-height: 48px;
          font-weight: 500;
        }

        #canvasContainer {
          padding: 10px;
          display: flex;
          align-items: center;
          justify-content: center;
          min-height: 400px;
        }

        #canvas {
          max-width: 100%;
          max-height: 500px;
          width: 100%;
          height: auto;
          touch-action: none;
          -webkit-user-select: none;
          user-select: none;
          -webkit-tap-highlight-color: transparent;
        }

        .modal-content {
          margin: 10px;
          max-width: calc(100% - 20px);
          max-height: calc(100vh - 40px);
          padding: 20px;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }

        .modal-content h2 {
          font-size: 22px;
          margin-bottom: 15px;
        }

        .help-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .help-item {
          padding: 15px;
        }

        .help-item h3 {
          font-size: 17px;
          margin-bottom: 8px;
        }

        .help-item p {
          font-size: 14px;
          line-height: 1.5;
        }

        #backBtn {
          min-height: 48px;
          font-size: 15px;
          padding: 12px 20px;
        }
      }

      .fade-in {
        animation: fadeInUp 0.6s ease forwards;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <div id="header">
        <div class="header-controls">
          <a href="../index.html" class="header-btn">üè† Home</a>
          <a href="games.html" class="header-btn">üéÆ Games</a>
        </div>
        <h1>üé® Colour Magic üé®</h1>
        <p>Choose a picture and unleash your creativity!</p>
      </div>

      <div id="pictureSelect">
        <div class="pictureOption" onclick="selectPicture('pineapple')">
          <img
            src="colourmagic/Pineapple.svg"
            alt="Pineapple"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Pineapple</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('art')">
          <img
            src="colourmagic/art.svg"
            alt="Art"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Art</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('boat')">
          <img
            src="colourmagic/boat.svg"
            alt="Boat"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Boat</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('butterflyart')">
          <img
            src="colourmagic/butterflyart.svg"
            alt="Butterfly"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Butterfly</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('carrot')">
          <img
            src="colourmagic/carrot.svg"
            alt="Carrot"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Carrot</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('cat')">
          <img
            src="colourmagic/cat.svg"
            alt="Cat"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Cat</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('cookies')">
          <img
            src="colourmagic/cookies.svg"
            alt="Cookies"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Cookies</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('doctor')">
          <img
            src="colourmagic/doctor.svg"
            alt="Doctor"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Doctor</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('dolphin')">
          <img
            src="colourmagic/dolphin.svg"
            alt="Dolphin"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Dolphin</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('dragon')">
          <img
            src="colourmagic/dragon.svg"
            alt="Dragon"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Dragon</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('face')">
          <img
            src="colourmagic/face.svg"
            alt="Face"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Face</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('flowerart')">
          <img
            src="colourmagic/flowerart.svg"
            alt="Flower"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Flower</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('girl')">
          <img
            src="colourmagic/girl.svg"
            alt="Girl"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Girl</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('girlback')">
          <img
            src="colourmagic/girlback.svg"
            alt="Girl Back"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Girl Back</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('horse')">
          <img
            src="colourmagic/horse.svg"
            alt="Horse"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Horse</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('icecream')">
          <img
            src="colourmagic/icecream.svg"
            alt="Ice Cream"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Ice Cream</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('jellyfish')">
          <img
            src="colourmagic/jellyfish.svg"
            alt="Jellyfish"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Jellyfish</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('leafart')">
          <img
            src="colourmagic/leafart.svg"
            alt="Leaf"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Leaf</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('lines')">
          <img
            src="colourmagic/lines.svg"
            alt="Lines"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Lines</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('mushroomhouse')">
          <img
            src="colourmagic/mushroomhouse.svg"
            alt="Mushroom House"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Mushroom House</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('octopus')">
          <img
            src="colourmagic/octopus.svg"
            alt="Octopus"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Octopus</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('owlart')">
          <img
            src="colourmagic/owlart.svg"
            alt="Owl"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Owl</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('panda')">
          <img
            src="colourmagic/panda.svg"
            alt="Panda"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Panda</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('princess')">
          <img
            src="colourmagic/princess.svg"
            alt="Princess"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Princess</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('spiral')">
          <img
            src="colourmagic/spiral.svg"
            alt="Spiral"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Spiral</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('tiger')">
          <img
            src="colourmagic/tiger.svg"
            alt="Tiger"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Tiger</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('turtles')">
          <img
            src="colourmagic/turtles.svg"
            alt="Turtles"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Turtles</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('watermelon')">
          <img
            src="colourmagic/watermelon.svg"
            alt="Watermelon"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Watermelon</p>
        </div>
        <div class="pictureOption" onclick="selectPicture('zebra')">
          <img
            src="colourmagic/zebra.svg"
            alt="Zebra"
            style="
              width: 100%;
              height: 100%;
              object-fit: contain;
              max-width: 180px;
              max-height: 180px;
            "
          />
          <p>Zebra</p>
        </div>
      </div>

      <div id="coloringArea">
        <div id="toolbar">
          <button id="backBtn" onclick="backToSelect()">‚Üê Back</button>

          <div class="toolSection">
            <label>Drawing Tools:</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
              <button class="toolBtn active" onclick="setTool('brush')">
                üñåÔ∏è Brush
              </button>
              <button class="toolBtn" onclick="setTool('fill')">ü™£ Fill</button>
              <button class="toolBtn" onclick="setTool('eraser')">
                üßπ Eraser
              </button>
              <button class="toolBtn" id="undoBtn" onclick="undo()" disabled>
                ‚Ü∂ Undo
              </button>
              <button class="toolBtn" id="redoBtn" onclick="redo()" disabled>
                ‚Ü∑ Redo
              </button>
            </div>
          </div>

          <div class="toolSection">
            <label
              >Brush Size:
              <span class="sizeLabel" id="sizeValue">10</span></label
            >
            <input
              type="range"
              id="brushSize"
              min="5"
              max="50"
              value="10"
              oninput="updateBrushSize(this.value)"
            />
          </div>

          <div class="toolSection" id="brushStyleSection" style="display: none">
            <label>üé® Brush Styles:</label>
            <div class="brush-grid">
              <div
                class="brush-option active"
                onclick="setBrushStyle('normal')"
              >
                <div class="brush-icon">‚úèÔ∏è</div>
                <div>Normal</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('spray')">
                <div class="brush-icon">üí®</div>
                <div>Spray</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('marker')">
                <div class="brush-icon">üñäÔ∏è</div>
                <div>Marker</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('crayon')">
                <div class="brush-icon">üñçÔ∏è</div>
                <div>Crayon</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('calligraphy')">
                <div class="brush-icon">üñãÔ∏è</div>
                <div>Calligraphy</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('glitter')">
                <div class="brush-icon">‚ú®</div>
                <div>Glitter</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('neon')">
                <div class="brush-icon">üí°</div>
                <div>Neon</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('watercolor')">
                <div class="brush-icon">üíß</div>
                <div>Watercolor</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('sketch')">
                <div class="brush-icon">üìù</div>
                <div>Sketch</div>
              </div>
              <div class="brush-option" onclick="setBrushStyle('rainbow')">
                <div class="brush-icon">üåà</div>
                <div>Rainbow</div>
              </div>
            </div>
          </div>

          <div class="toolSection">
            <label>Colors:</label>
            <div class="colorPalette">
              <div
                class="colorBtn active"
                style="background: #ff6b6b"
                onclick="selectColor('#FF6B6B')"
              ></div>
              <div
                class="colorBtn"
                style="background: #4ecdc4"
                onclick="selectColor('#4ECDC4')"
              ></div>
              <div
                class="colorBtn"
                style="background: #45b7d1"
                onclick="selectColor('#45B7D1')"
              ></div>
              <div
                class="colorBtn"
                style="background: #ffa07a"
                onclick="selectColor('#FFA07A')"
              ></div>
              <div
                class="colorBtn"
                style="background: #98d8c8"
                onclick="selectColor('#98D8C8')"
              ></div>
              <div
                class="colorBtn"
                style="background: #f7dc6f"
                onclick="selectColor('#F7DC6F')"
              ></div>
              <div
                class="colorBtn"
                style="background: #bb8fce"
                onclick="selectColor('#BB8FCE')"
              ></div>
              <div
                class="colorBtn"
                style="background: #f8b739"
                onclick="selectColor('#F8B739')"
              ></div>
              <div
                class="colorBtn"
                style="background: #52b788"
                onclick="selectColor('#52B788')"
              ></div>
              <div
                class="colorBtn"
                style="background: #e63946"
                onclick="selectColor('#E63946')"
              ></div>
              <div
                class="colorBtn"
                style="background: #06ffa5"
                onclick="selectColor('#06FFA5')"
              ></div>
              <div
                class="colorBtn"
                style="background: #3a86ff"
                onclick="selectColor('#3A86FF')"
              ></div>
              <div
                class="colorBtn"
                style="background: #fb5607"
                onclick="selectColor('#FB5607')"
              ></div>
              <div
                class="colorBtn"
                style="background: #ffbe0b"
                onclick="selectColor('#FFBE0B')"
              ></div>
              <div
                class="colorBtn"
                style="background: #ff006e"
                onclick="selectColor('#FF006E')"
              ></div>
              <div
                class="colorBtn"
                style="background: #8338ec"
                onclick="selectColor('#8338EC')"
              ></div>
              <input
                type="color"
                id="colorPicker"
                onchange="selectColor(this.value)"
                title="Custom Color"
              />
            </div>
          </div>

          <div class="toolSection">
            <label>üéõÔ∏è Advanced Features:</label>
            <div
              style="
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin-top: 10px;
              "
            >
              <button
                class="feature-toggle"
                id="symmetryBtn"
                onclick="toggleSymmetry()"
              >
                ü™û Symmetry
              </button>
              <button
                class="feature-toggle"
                id="patternsBtn"
                onclick="togglePatterns()"
              >
                üé≠ Patterns
              </button>
            </div>
          </div>

          <div class="toolSection" id="opacitySection">
            <label
              >Opacity:
              <span class="sizeLabel" id="opacityValue">100</span>%</label
            >
            <div class="slider-container">
              <input
                type="range"
                id="opacitySlider"
                min="10"
                max="100"
                value="100"
                oninput="updateOpacity(this.value)"
              />
            </div>
          </div>

          <div class="toolSection" id="patternsSection" style="display: none">
            <label>üìê Pattern Stamps:</label>
            <div class="pattern-grid">
              <div
                class="pattern-btn"
                onclick="setPattern('circle')"
                title="Circle"
              >
                ‚≠ï
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('square')"
                title="Square"
              >
                ‚¨ú
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('star')"
                title="Star"
              >
                ‚≠ê
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('heart')"
                title="Heart"
              >
                ‚ù§Ô∏è
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('flower')"
                title="Flower"
              >
                üå∏
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('triangle')"
                title="Triangle"
              >
                üî∫
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('hexagon')"
                title="Hexagon"
              >
                ‚¨°
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('diamond')"
                title="Diamond"
              >
                üíé
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('cloud')"
                title="Cloud"
              >
                ‚òÅÔ∏è
              </div>
              <div
                class="pattern-btn"
                onclick="setPattern('none')"
                title="No Pattern"
              >
                ‚úñÔ∏è
              </div>
            </div>
          </div>

          <button class="toolBtn" onclick="clearCanvas()">üóëÔ∏è Clear</button>
          <button class="toolBtn sparkle-btn" onclick="saveDrawing()">
            üíæ Save
          </button>
          <button class="toolBtn" onclick="openHelp()">‚ùì Help</button>
        </div>

        <div id="canvasContainer">
          <div class="canvas-overlay" id="canvasOverlay">Tool: Brush</div>
          <canvas id="canvas" width="600" height="600"></canvas>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üé® How to Use Colour Magic</h2>
          <button class="close-modal" onclick="closeHelp()">&times;</button>
        </div>
        <div class="help-item">
          <h3>üñåÔ∏è Brush Tool & Styles</h3>
          <p>
            Click and drag to draw freely on the canvas. Choose from 10 amazing
            brush styles:<br />
            <strong>‚úèÔ∏è Normal</strong> - Classic smooth brush<br />
            <strong>üí® Spray</strong> - Airbrush effect<br />
            <strong>üñäÔ∏è Marker</strong> - Bold marker strokes<br />
            <strong>üñçÔ∏è Crayon</strong> - Textured crayon look<br />
            <strong>üñãÔ∏è Calligraphy</strong> - Elegant angled strokes<br />
            <strong>‚ú® Glitter</strong> - Sparkly star effects<br />
            <strong>üí° Neon</strong> - Glowing neon lines<br />
            <strong>üíß Watercolor</strong> - Soft watercolor blending<br />
            <strong>üìù Sketch</strong> - Rough sketchy lines<br />
            <strong>üåà Rainbow</strong> - Automatic rainbow colors!
          </p>
        </div>
        <div class="help-item">
          <h3>ü™£ Fill Tool</h3>
          <p>
            Click on any area to fill it with the selected color. Perfect for
            coloring large areas quickly!
          </p>
        </div>
        <div class="help-item">
          <h3>üßπ Eraser</h3>
          <p>
            Remove colors by clicking and dragging. Adjust the eraser size just
            like the brush.
          </p>
        </div>
        <div class="help-item">
          <h3>‚Ü∂‚Ü∑ Undo/Redo</h3>
          <p>
            Made a mistake? Use undo to go back. Changed your mind? Use redo to
            restore your work.
          </p>
        </div>
        <div class="help-item">
          <h3>üé® Color Picker</h3>
          <p>
            Choose from 16 preset colors or click the color input to create your
            own custom colors!
          </p>
        </div>
        <div class="help-item">
          <h3>üé≠ Pattern Stamps</h3>
          <p>
            Click the Patterns button (üé≠) to choose fun shapes to stamp:
            circles, squares, stars, hearts, flowers, and more! Perfect for
            adding decorative elements.
          </p>
        </div>
        <div class="help-item">
          <h3>ü™û Symmetry Mode</h3>
          <p>
            Toggle the Symmetry button (ü™û) to draw mirrored designs! Everything
            you draw will be reflected across the center, creating beautiful
            symmetrical patterns.
          </p>
        </div>
        <div class="help-item">
          <h3>ÔøΩÔ∏è Stay Inside Lines</h3>
          <p>
            Toggle the Stay Inside Lines button (üñçÔ∏è) to prevent drawing over the
            black outlines! When ON, your brush will automatically avoid
            painting on the picture's borders, keeping your coloring neat and
            tidy. Turn it OFF to draw freely anywhere!
          </p>
        </div>
        <div class="help-item">
          <h3>ÔøΩüíß Opacity Control</h3>
          <p>
            Adjust the opacity slider (10-100%) to make your strokes transparent
            or solid. Great for layering colors and creating depth!
          </p>
        </div>
        <div class="help-item">
          <h3>üíæ Save Your Art</h3>
          <p>
            Click the Save button to download your masterpiece as a PNG image
            file.
          </p>
        </div>
        <div class="help-item">
          <h3>üì± Touch Support</h3>
          <p>
            Works perfectly on tablets and phones! Just tap and drag with your
            finger.
          </p>
        </div>
        <div class="help-item">
          <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
          <p>
            <strong>B</strong> - Brush | <strong>F</strong> - Fill |
            <strong>E</strong> - Eraser<br />
            <strong>M</strong> - Toggle Symmetry | <strong>P</strong> - Toggle
            Patterns<br />
            <strong>Ctrl+Z</strong> - Undo | <strong>Ctrl+Shift+Z</strong> -
            Redo<br />
            <strong>Ctrl+S</strong> - Save | <strong>H</strong> - Help<br />
            <strong>Esc</strong> - Close Help
          </p>
        </div>
      </div>
    </div>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      let currentColor = "#FF6B6B";
      let currentTool = "brush";
      let brushSize = 10;
      let brushStyle = "normal";
      let isDrawing = false;
      let currentPicture = "";
      let undoStack = [];
      let redoStack = [];
      const MAX_UNDO = 20;
      let strokeCount = 0;
      let colorHistory = [];
      let rainbowHue = 0;
      let lastX = 0;
      let lastY = 0;
      let symmetryMode = false;
      let currentOpacity = 1.0;
      let currentPattern = "none";
      let cachedImageData = null; // Cache for performance
      let lastCursorCheck = { x: -1, y: -1, result: false };

      const pictures = {
        pineapple: [
          // Empty - user will draw their own pineapple
        ],
      };

      function selectPicture(pic) {
        currentPicture = pic;
        document.getElementById("pictureSelect").style.display = "none";
        document.getElementById("coloringArea").style.display = "block";
        undoStack = [];
        redoStack = [];
        updateUndoRedoButtons();
        drawPicture();
        saveState();
      }

      function backToSelect() {
        document.getElementById("pictureSelect").style.display = "flex";
        document.getElementById("coloringArea").style.display = "none";
        clearCanvas();
      }

      function drawPicture() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Load SVG file onto the canvas
        const svgFiles = [
          "pineapple",
          "art",
          "boat",
          "butterflyart",
          "carrot",
          "cat",
          "cookies",
          "doctor",
          "dolphin",
          "dragon",
          "face",
          "flowerart",
          "girl",
          "girlback",
          "horse",
          "icecream",
          "jellyfish",
          "leafart",
          "lines",
          "mushroomhouse",
          "octopus",
          "owlart",
          "panda",
          "princess",
          "spiral",
          "tiger",
          "turtles",
          "watermelon",
          "zebra",
        ];

        if (svgFiles.includes(currentPicture)) {
          const img = new Image();
          img.onload = function () {
            // Center the image on canvas
            const scale =
              Math.min(canvas.width / img.width, canvas.height / img.height) *
              0.9;
            const x = (canvas.width - img.width * scale) / 2;
            const y = (canvas.height - img.height * scale) / 2;
            ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
          };
          // Only Pineapple.svg is capitalized, all others are lowercase
          const fileName =
            currentPicture === "pineapple" ? "Pineapple" : currentPicture;
          img.src = `colourmagic/${fileName}.svg`;
          return;
        }

        ctx.strokeStyle = "black";
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        const shapes = pictures[currentPicture];
        shapes.forEach((shape) => {
          ctx.beginPath();
          switch (shape.type) {
            case "circle":
              ctx.arc(shape.x, shape.y, shape.r, 0, Math.PI * 2);
              ctx.stroke();
              break;
            case "rect":
              if (shape.rx) {
                ctx.roundRect(shape.x, shape.y, shape.w, shape.h, shape.rx);
              } else {
                ctx.rect(shape.x, shape.y, shape.w, shape.h);
              }
              ctx.stroke();
              break;
            case "ellipse":
              ctx.ellipse(
                shape.cx,
                shape.cy,
                shape.rx,
                shape.ry,
                shape.rotation || 0,
                0,
                Math.PI * 2
              );
              ctx.stroke();
              break;
            case "polygon":
              ctx.moveTo(shape.points[0][0], shape.points[0][1]);
              for (let i = 1; i < shape.points.length; i++) {
                ctx.lineTo(shape.points[i][0], shape.points[i][1]);
              }
              ctx.closePath();
              ctx.stroke();
              break;
            case "line":
              ctx.moveTo(shape.x1, shape.y1);
              ctx.lineTo(shape.x2, shape.y2);
              ctx.stroke();
              break;
            case "path":
              const path = new Path2D(shape.d);
              ctx.stroke(path);
              break;
          }
        });
      }

      function createRipple(element, e) {
        const ripple = document.createElement("span");
        const rect = element.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size / 2;
        const y = e.clientY - rect.top - size / 2;

        ripple.style.cssText = `
          position: absolute;
          width: ${size}px;
          height: ${size}px;
          top: ${y}px;
          left: ${x}px;
          background: rgba(255, 255, 255, 0.5);
          border-radius: 50%;
          pointer-events: none;
          animation: ripple 0.6s ease-out;
        `;

        element.style.position = "relative";
        element.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }

      function selectColor(color) {
        currentColor = color;
        document
          .querySelectorAll(".colorBtn")
          .forEach((btn) => btn.classList.remove("active"));
        if (
          event.target.classList &&
          event.target.classList.contains("colorBtn")
        ) {
          event.target.classList.add("active");
          createRipple(event.target, event);
        }
        if (currentTool === "eraser") {
          setTool("brush");
        }

        // Add to color history
        if (!colorHistory.includes(color)) {
          colorHistory.unshift(color);
          if (colorHistory.length > 5) {
            colorHistory.pop();
          }
        }
      }

      function setTool(tool) {
        currentTool = tool;
        document
          .querySelectorAll(".toolBtn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Show/hide brush style selector
        const brushStyleSection = document.getElementById("brushStyleSection");
        if (tool === "brush") {
          brushStyleSection.style.display = "block";
          canvas.style.cursor = "crosshair";
          showCanvasOverlay("Tool: Brush üñåÔ∏è");
        } else if (tool === "fill") {
          brushStyleSection.style.display = "none";
          canvas.style.cursor = "pointer";
          showCanvasOverlay("Tool: Fill ü™£");
        } else if (tool === "eraser") {
          brushStyleSection.style.display = "none";
          canvas.style.cursor = "grab";
          showCanvasOverlay("Tool: Eraser üßπ");
        }
      }

      function setBrushStyle(style) {
        brushStyle = style;
        const brushOptions = document.querySelectorAll(".brush-option");
        brushOptions.forEach((btn) => btn.classList.remove("active"));
        const selectedOption = event.target.closest(".brush-option");
        selectedOption.classList.add("active");
        createRipple(selectedOption, event);
        showCanvasOverlay(
          `Brush: ${style.charAt(0).toUpperCase() + style.slice(1)}`
        );
      }

      function showCanvasOverlay(message) {
        const overlay = document.getElementById("canvasOverlay");
        overlay.textContent = message;
        overlay.classList.add("show");
        setTimeout(() => overlay.classList.remove("show"), 2000);
      }

      function openHelp() {
        document.getElementById("helpModal").classList.add("show");
      }

      function closeHelp() {
        document.getElementById("helpModal").classList.remove("show");
      }

      // Close modal when clicking outside
      document
        .getElementById("helpModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeHelp();
          }
        });

      function updateBrushSize(value) {
        brushSize = value;
        const sizeLabel = document.getElementById("sizeValue");
        sizeLabel.textContent = value;
        sizeLabel.style.transform = "scale(1.2)";
        setTimeout(() => {
          sizeLabel.style.transform = "scale(1)";
        }, 150);
      }

      function updateOpacity(value) {
        currentOpacity = value / 100;
        const opacityLabel = document.getElementById("opacityValue");
        opacityLabel.textContent = value;
        opacityLabel.style.transform = "scale(1.2)";
        setTimeout(() => {
          opacityLabel.style.transform = "scale(1)";
        }, 150);
      }

      function toggleSymmetry() {
        symmetryMode = !symmetryMode;
        const btn = document.getElementById("symmetryBtn");
        if (symmetryMode) {
          btn.classList.add("active");
          showToast("Symmetry Mode ON ü™û");
        } else {
          btn.classList.remove("active");
          showToast("Symmetry Mode OFF");
        }
      }

      function togglePatterns() {
        const section = document.getElementById("patternsSection");
        const btn = document.getElementById("patternsBtn");
        if (section.style.display === "none") {
          section.style.display = "block";
          btn.classList.add("active");
        } else {
          section.style.display = "none";
          btn.classList.remove("active");
          currentPattern = "none";
        }
      }

      function setPattern(pattern) {
        currentPattern = pattern;
        document
          .querySelectorAll(".pattern-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");
        createRipple(event.target, event);
        showCanvasOverlay(`Pattern: ${pattern}`);
      }

      function clearCanvas() {
        if (currentPicture) {
          drawPicture();
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "white";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
      }

      function floodFill(startX, startY, fillColor) {
        startX = Math.floor(startX);
        startY = Math.floor(startY);

        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const pixels = imageData.data;
        const startPos = (startY * canvas.width + startX) * 4;
        const startR = pixels[startPos];
        const startG = pixels[startPos + 1];
        const startB = pixels[startPos + 2];
        const startA = pixels[startPos + 3];

        const fillRGB = hexToRgb(fillColor);

        // Don't fill if clicking on a black line (outline) - stricter threshold
        if (startR < 40 && startG < 40 && startB < 40) {
          showToast("Can't fill outline! Click inside an area.");
          return;
        }

        // Check if already the same color (within tolerance)
        if (
          Math.abs(startR - fillRGB.r) < 5 &&
          Math.abs(startG - fillRGB.g) < 5 &&
          Math.abs(startB - fillRGB.b) < 5
        ) {
          showToast("Already this color!");
          return;
        }

        const tolerance = 25; // Slightly higher tolerance for better filling
        const stack = [[startX, startY]];
        const visited = new Set();
        let filledPixels = 0;

        function isBlackLine(pos) {
          // Check if pixel is part of the black outline - stricter
          const r = pixels[pos];
          const g = pixels[pos + 1];
          const b = pixels[pos + 2];
          const a = pixels[pos + 3];
          return r < 40 && g < 40 && b < 40 && a > 200;
        }

        function colorMatch(pos) {
          // Don't cross black lines
          if (isBlackLine(pos)) return false;

          return (
            Math.abs(pixels[pos] - startR) <= tolerance &&
            Math.abs(pixels[pos + 1] - startG) <= tolerance &&
            Math.abs(pixels[pos + 2] - startB) <= tolerance &&
            pixels[pos + 3] > 0 // Only fill visible pixels
          );
        }

        while (stack.length > 0) {
          const [x, y] = stack.pop();

          if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height)
            continue;

          const key = `${x},${y}`;
          if (visited.has(key)) continue;

          const pos = (y * canvas.width + x) * 4;

          if (!colorMatch(pos)) continue;

          visited.add(key);
          filledPixels++;

          // Fill the pixel
          pixels[pos] = fillRGB.r;
          pixels[pos + 1] = fillRGB.g;
          pixels[pos + 2] = fillRGB.b;
          pixels[pos + 3] = 255;

          // Add neighboring pixels (4-directional for better boundary detection)
          stack.push([x + 1, y]);
          stack.push([x - 1, y]);
          stack.push([x, y + 1]);
          stack.push([x, y - 1]);
        }

        ctx.putImageData(imageData, 0, 0);

        if (filledPixels > 0) {
          showToast(`Filled ${filledPixels} pixels! üé®`);
          saveState(); // Save state after fill
        }
      }

      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? {
              r: parseInt(result[1], 16),
              g: parseInt(result[2], 16),
              b: parseInt(result[3], 16),
            }
          : null;
      }

      // Mouse and touch events
      canvas.addEventListener("mousedown", handleStart);
      canvas.addEventListener("mousemove", handleMove);
      canvas.addEventListener("mouseup", handleEnd);
      canvas.addEventListener("mouseout", handleEnd);

      canvas.addEventListener("touchstart", handleStart, { passive: false });
      canvas.addEventListener("touchmove", handleMove, { passive: false });
      canvas.addEventListener("touchend", handleEnd, { passive: false });
      canvas.addEventListener("touchcancel", handleEnd, { passive: false });

      // Prevent pull-to-refresh and scrolling on the canvas
      document.getElementById("canvasContainer").addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      // Visual feedback for cursor position
      let cursorCheckThrottle = 0;
      canvas.addEventListener("mousemove", function (e) {
        if (!stayInsideLines || currentTool === "fill") return;

        // Throttle checks for performance (every 100ms)
        canvas.style.cursor = currentTool === "eraser" ? "cell" : "crosshair";
      });

      function handleStart(e) {
        e.preventDefault();
        const pos = getEventPosition(e);

        if (currentTool === "fill") {
          floodFill(Math.floor(pos.x), Math.floor(pos.y), currentColor);
          saveState();
        } else {
          isDrawing = true;
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
          lastX = pos.x;
          lastY = pos.y;
        }
      }

      function handleMove(e) {
        e.preventDefault();
        if (!isDrawing) return;
        const pos = getEventPosition(e);
        draw(pos.x, pos.y);
        lastX = pos.x;
        lastY = pos.y;
      }

      function handleEnd(e) {
        if (isDrawing) {
          isDrawing = false;
          ctx.beginPath();
          saveState();
          strokeCount++;
        }
      }

      function getEventPosition(e) {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches ? e.touches[0] : e;

        // Calculate the scale between canvas internal size and displayed size
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        // Get position relative to canvas and scale to internal coordinates
        const x = (touch.clientX - rect.left) * scaleX;
        const y = (touch.clientY - rect.top) * scaleY;

        return { x, y };
      }

      function draw(x, y) {
        if (currentTool === "eraser") {
          ctx.globalCompositeOperation = "destination-out";
          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.lineWidth = brushSize;
          ctx.lineTo(x, y);
          ctx.stroke();
          ctx.moveTo(x, y);

          if (symmetryMode) {
            const mirrorX = canvas.width - x;
            ctx.lineTo(mirrorX, y);
            ctx.stroke();
            ctx.moveTo(mirrorX, y);
          }
          ctx.globalCompositeOperation = "source-over";
          return;
        }

        ctx.globalCompositeOperation = "source-over";

        // Apply pattern if selected
        if (currentPattern !== "none") {
          drawPattern(x, y);
          if (symmetryMode) {
            drawPattern(canvas.width - x, y);
          }
          return;
        }

        // Draw at main position
        switch (brushStyle) {
          case "normal":
            drawNormal(x, y);
            break;
          case "spray":
            drawSpray(x, y);
            break;
          case "marker":
            drawMarker(x, y);
            break;
          case "crayon":
            drawCrayon(x, y);
            break;
          case "calligraphy":
            drawCalligraphy(x, y);
            break;
          case "glitter":
            drawGlitter(x, y);
            break;
          case "neon":
            drawNeon(x, y);
            break;
          case "watercolor":
            drawWatercolor(x, y);
            break;
          case "sketch":
            drawSketch(x, y);
            break;
          case "rainbow":
            drawRainbow(x, y);
            break;
          default:
            drawNormal(x, y);
        }

        // Draw mirrored if symmetry is on
        if (symmetryMode) {
          const mirrorX = canvas.width - x;
          switch (brushStyle) {
            case "normal":
              drawNormal(mirrorX, y);
              break;
            case "spray":
              drawSpray(mirrorX, y);
              break;
            case "marker":
              drawMarker(mirrorX, y);
              break;
            case "crayon":
              drawCrayon(mirrorX, y);
              break;
            case "calligraphy":
              drawCalligraphy(mirrorX, y);
              break;
            case "glitter":
              drawGlitter(mirrorX, y);
              break;
            case "neon":
              drawNeon(mirrorX, y);
              break;
            case "watercolor":
              drawWatercolor(mirrorX, y);
              break;
            case "sketch":
              drawSketch(mirrorX, y);
              break;
            case "rainbow":
              drawRainbow(mirrorX, y);
              break;
          }
        }
      }

      function drawPattern(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.fillStyle = currentColor;
        ctx.strokeStyle = currentColor;
        const size = brushSize * 2;

        ctx.beginPath();
        switch (currentPattern) {
          case "circle":
            ctx.arc(x, y, size / 2, 0, Math.PI * 2);
            ctx.fill();
            break;
          case "square":
            ctx.fillRect(x - size / 2, y - size / 2, size, size);
            break;
          case "star":
            drawStar(x, y, 5, size / 2, size / 4);
            ctx.fill();
            break;
          case "heart":
            drawHeart(x, y, size / 2);
            ctx.fill();
            break;
          case "flower":
            drawFlowerPattern(x, y, size / 3);
            ctx.fill();
            break;
          case "triangle":
            ctx.moveTo(x, y - size / 2);
            ctx.lineTo(x - size / 2, y + size / 2);
            ctx.lineTo(x + size / 2, y + size / 2);
            ctx.closePath();
            ctx.fill();
            break;
          case "hexagon":
            drawHexagon(x, y, size / 2);
            ctx.fill();
            break;
          case "diamond":
            ctx.moveTo(x, y - size / 2);
            ctx.lineTo(x + size / 2, y);
            ctx.lineTo(x, y + size / 2);
            ctx.lineTo(x - size / 2, y);
            ctx.closePath();
            ctx.fill();
            break;
          case "cloud":
            drawCloud(x, y, size / 2);
            ctx.fill();
            break;
        }
        ctx.restore();
      }

      function drawStar(x, y, points, outer, inner) {
        ctx.moveTo(x, y - outer);
        for (let i = 0; i < points * 2; i++) {
          const radius = i % 2 === 0 ? outer : inner;
          const angle = (Math.PI * i) / points - Math.PI / 2;
          ctx.lineTo(
            x + radius * Math.cos(angle),
            y + radius * Math.sin(angle)
          );
        }
        ctx.closePath();
      }

      function drawHeart(x, y, size) {
        ctx.moveTo(x, y + size / 4);
        ctx.bezierCurveTo(x, y, x - size / 2, y - size / 2, x - size / 2, y);
        ctx.bezierCurveTo(
          x - size / 2,
          y + size / 3,
          x,
          y + size / 2,
          x,
          y + size
        );
        ctx.bezierCurveTo(
          x,
          y + size / 2,
          x + size / 2,
          y + size / 3,
          x + size / 2,
          y
        );
        ctx.bezierCurveTo(x + size / 2, y - size / 2, x, y, x, y + size / 4);
      }

      function drawFlowerPattern(x, y, size) {
        for (let i = 0; i < 6; i++) {
          const angle = (Math.PI * 2 * i) / 6;
          ctx.moveTo(x, y);
          ctx.arc(
            x + Math.cos(angle) * size,
            y + Math.sin(angle) * size,
            size / 2,
            0,
            Math.PI * 2
          );
        }
      }

      function drawHexagon(x, y, size) {
        for (let i = 0; i < 6; i++) {
          const angle = (Math.PI * i) / 3;
          const px = x + size * Math.cos(angle);
          const py = y + size * Math.sin(angle);
          if (i === 0) ctx.moveTo(px, py);
          else ctx.lineTo(px, py);
        }
        ctx.closePath();
      }

      function drawCloud(x, y, size) {
        ctx.arc(x - size / 2, y, size / 2, 0, Math.PI * 2);
        ctx.arc(x, y - size / 3, size / 2, 0, Math.PI * 2);
        ctx.arc(x + size / 2, y, size / 2, 0, Math.PI * 2);
      }

      function drawNormal(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = brushSize;
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.restore();
      }

      function drawSpray(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        const density = brushSize * 2;
        for (let i = 0; i < density; i++) {
          const offsetX = (Math.random() - 0.5) * brushSize * 2;
          const offsetY = (Math.random() - 0.5) * brushSize * 2;
          ctx.fillStyle = currentColor;
          ctx.fillRect(x + offsetX, y + offsetY, 1, 1);
        }
        ctx.restore();
      }

      function drawMarker(x, y) {
        ctx.save();
        ctx.lineCap = "square";
        ctx.lineJoin = "miter";
        ctx.lineWidth = brushSize;
        ctx.globalAlpha = 0.6 * currentOpacity;
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.restore();
      }

      function drawCrayon(x, y) {
        ctx.save();
        const density = Math.floor(brushSize / 2);
        for (let i = 0; i < density; i++) {
          const offsetX = (Math.random() - 0.5) * brushSize;
          const offsetY = (Math.random() - 0.5) * brushSize;
          ctx.globalAlpha = (Math.random() * 0.3 + 0.3) * currentOpacity;
          ctx.fillStyle = currentColor;
          ctx.fillRect(x + offsetX, y + offsetY, 2, 2);
        }
        ctx.restore();
      }

      function drawCalligraphy(x, y) {
        const angle = Math.atan2(y - lastY, x - lastX);
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.translate(x, y);
        ctx.rotate(angle);
        ctx.fillStyle = currentColor;
        ctx.fillRect(-brushSize / 2, -brushSize / 4, brushSize, brushSize / 2);
        ctx.restore();
      }

      function drawGlitter(x, y) {
        const sparkles = Math.floor(brushSize / 2);
        for (let i = 0; i < sparkles; i++) {
          const offsetX = (Math.random() - 0.5) * brushSize * 1.5;
          const offsetY = (Math.random() - 0.5) * brushSize * 1.5;
          const sparkleSize = Math.random() * 3 + 1;

          ctx.save();
          ctx.globalAlpha = (Math.random() * 0.8 + 0.2) * currentOpacity;
          ctx.fillStyle = currentColor;
          ctx.shadowBlur = 10;
          ctx.shadowColor = currentColor;

          // Draw star shape
          ctx.beginPath();
          for (let j = 0; j < 5; j++) {
            const angle = (j * 4 * Math.PI) / 5;
            const px = x + offsetX + Math.cos(angle) * sparkleSize;
            const py = y + offsetY + Math.sin(angle) * sparkleSize;
            if (j === 0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
          }
          ctx.closePath();
          ctx.fill();
          ctx.restore();
        }
      }

      function drawNeon(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        ctx.shadowBlur = brushSize;
        ctx.shadowColor = currentColor;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = brushSize / 2;
        ctx.strokeStyle = currentColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.shadowBlur = 0;
        ctx.restore();
      }

      function drawWatercolor(x, y) {
        ctx.save();
        const layers = 3;
        for (let i = 0; i < layers; i++) {
          const offset = (brushSize * (i + 1)) / layers;
          ctx.globalAlpha = 0.1 * currentOpacity;
          ctx.beginPath();
          ctx.arc(x, y, offset, 0, Math.PI * 2);
          ctx.fillStyle = currentColor;
          ctx.fill();
        }
        ctx.restore();
      }

      function drawSketch(x, y) {
        ctx.save();
        const lines = 3;
        for (let i = 0; i < lines; i++) {
          const offsetX = (Math.random() - 0.5) * 3;
          const offsetY = (Math.random() - 0.5) * 3;
          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.lineWidth = Math.max(1, brushSize / 4);
          ctx.globalAlpha = 0.4 * currentOpacity;
          ctx.strokeStyle = currentColor;
          ctx.beginPath();
          ctx.moveTo(lastX + offsetX, lastY + offsetY);
          ctx.lineTo(x + offsetX, y + offsetY);
          ctx.stroke();
        }
        ctx.restore();
      }

      function drawRainbow(x, y) {
        ctx.save();
        ctx.globalAlpha = currentOpacity;
        rainbowHue = (rainbowHue + 2) % 360;
        const rainbowColor = `hsl(${rainbowHue}, 100%, 50%)`;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineWidth = brushSize;
        ctx.strokeStyle = rainbowColor;
        ctx.shadowBlur = brushSize / 2;
        ctx.shadowColor = rainbowColor;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.moveTo(x, y);
        ctx.shadowBlur = 0;
        ctx.restore();
      }

      function saveState() {
        if (undoStack.length >= MAX_UNDO) {
          undoStack.shift();
        }
        undoStack.push(canvas.toDataURL());
        redoStack = [];
        updateUndoRedoButtons();
      }

      function undo() {
        if (undoStack.length > 0) {
          redoStack.push(canvas.toDataURL());
          const imageData = undoStack.pop();
          restoreCanvas(imageData);
          updateUndoRedoButtons();
        }
      }

      function redo() {
        if (redoStack.length > 0) {
          undoStack.push(canvas.toDataURL());
          const imageData = redoStack.pop();
          restoreCanvas(imageData);
          updateUndoRedoButtons();
        }
      }

      function restoreCanvas(imageData) {
        const img = new Image();
        img.onload = function () {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };
        img.src = imageData;
      }

      function updateUndoRedoButtons() {
        document.getElementById("undoBtn").disabled = undoStack.length === 0;
        document.getElementById("redoBtn").disabled = redoStack.length === 0;
      }

      function saveDrawing() {
        const link = document.createElement("a");
        link.download = `colour-magic-${currentPicture}-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showToast("Drawing saved! üé®");
      }

      function showToast(message) {
        let toast = document.querySelector(".toast");
        if (!toast) {
          toast = document.createElement("div");
          toast.className = "toast";
          document.body.appendChild(toast);
        }
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        // Don't trigger shortcuts in modals
        if (document.getElementById("helpModal").classList.contains("show")) {
          if (e.key === "Escape") closeHelp();
          return;
        }

        // Only enable shortcuts when coloring
        if (document.getElementById("coloringArea").style.display === "none")
          return;

        switch (e.key.toLowerCase()) {
          case "z":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              if (e.shiftKey) {
                redo();
              } else {
                undo();
              }
            }
            break;
          case "y":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              redo();
            }
            break;
          case "s":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              saveDrawing();
            }
            break;
          case "b":
            e.preventDefault();
            document.querySelector('.toolBtn[onclick*="brush"]').click();
            break;
          case "f":
            e.preventDefault();
            document.querySelector('.toolBtn[onclick*="fill"]').click();
            break;
          case "e":
            e.preventDefault();
            document.querySelector('.toolBtn[onclick*="eraser"]').click();
            break;
          case "c":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              if (confirm("Clear the canvas?")) {
                clearCanvas();
                showToast("Canvas cleared");
              }
            }
            break;
          case "h":
          case "?":
            e.preventDefault();
            openHelp();
            break;
          case "l":
            e.preventDefault();
            toggleStayInsideLines();
            break;
          case "m":
            e.preventDefault();
            toggleSymmetry();
            break;
          case "p":
            e.preventDefault();
            togglePatterns();
            break;
          case "escape":
            closeHelp();
            break;
        }
      });

      // Add animation to picture options on load
      window.addEventListener("load", function () {
        const options = document.querySelectorAll(".pictureOption");
        options.forEach((option, index) => {
          option.style.opacity = "0";
          option.classList.add("fade-in");
          option.style.animationDelay = `${index * 0.1}s`;
          setTimeout(() => {
            option.style.opacity = "1";
          }, index * 100);
        });
      });

      clearCanvas();
    </script>
  </body>
</html>
