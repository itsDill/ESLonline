<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-2456627863532019" />
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Who Wants to Be a Fluent English Speaker? - ESL Millionaire Quiz | ESL Fun
      Online
    </title>
    <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="../images/favicon-48x48.png"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../images/favicon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="../images/favicon-512x512.png"
    />

    <!-- Open Graph Tags -->
    <meta
      property="og:title"
      content="Who Wants to Be a Fluent English Speaker? - ESL Millionaire Quiz"
    />
    <meta
      property="og:description"
      content="Test your English fluency in this millionaire-style quiz game! Perfect for intermediate to advanced ESL learners."
    />
    <meta
      property="og:image"
      content="https://eslfunonline.com/images/image copy 4.png"
    />
    <meta
      property="og:url"
      content="https://eslfunonline.com/games/whowants.html"
    />
    <meta property="og:type" content="game" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Who Wants to Be a Fluent English Speaker?"
    />
    <meta
      name="twitter:description"
      content="Test your English fluency in this exciting millionaire-style quiz!"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/image copy 4.png"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://eslfunonline.com/games/whowants.html" />

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "Who Wants to Be a Fluent English Speaker?",
        "description": "Test your English fluency in this millionaire-style quiz game! Answer questions about grammar, vocabulary, idioms, and culture. Perfect for intermediate to advanced ESL learners.",
        "url": "https://eslfunonline.com/games/whowants.html",
        "image": "https://eslfunonline.com/images/image copy 4.png",
        "publisher": {
          "@type": "Organization",
          "name": "ESL Fun Online",
          "url": "https://eslfunonline.com"
        },
        "genre": ["Educational", "Quiz", "Vocabulary", "Grammar"],
        "audience": {
          "@type": "EducationalAudience",
          "educationalRole": "student",
          "audienceType": "Intermediate to Advanced ESL Learners"
        },
        "educationalLevel": "Intermediate to Advanced",
        "educationalUse": [
          "fluency assessment",
          "vocabulary building",
          "grammar practice",
          "cultural knowledge"
        ],
        "interactivityType": "active",
        "learningResourceType": "game",
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "accessibilityFeature": [
          "alternativeText",
          "fullKeyboardControl",
          "screenReaderSupport"
        ],
        "accessibilityControl": ["fullKeyboardControl", "fullMouseControl"],
        "accessibilityHazard": [
          "noFlashingHazard",
          "noMotionSimulationHazard",
          "noSoundHazard"
        ],
        "keywords": "ESL millionaire game, English fluency quiz, advanced ESL, vocabulary quiz, grammar challenge, English learning game"
      }
    </script>

    

    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/whowants-page.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0 !important;
        padding: 0 !important;
        padding-top: 0 !important;
      }

      body {
        font-family: "Inter", "Poppins", sans-serif;
        background: linear-gradient(
          -45deg,
          #1a1a2e,
          #16213e,
          #0f3460,
          #1a1a2e
        ) !important;
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        min-height: 100vh;
        color: #e2e8f0;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Compact Navigation Header */
      .game-nav-header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 0.75rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav-left {
        display: flex;
        gap: 0.75rem;
      }

      .nav-btn {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      .nav-game-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .nav-game-title i {
        color: #fbbf24;
      }

      /* Ad Wrapper */
      .ad-wrapper {
        max-width: 800px;
        margin: 1rem auto;
        padding: 0 1rem;
        text-align: center;
      }

      /* Footer */
      .game-footer {
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        padding: 1.5rem;
        text-align: center;
        margin-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .footer-links {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }

      .footer-links a {
        color: #94a3b8;
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.3s ease;
      }

      .footer-links a:hover {
        color: white;
      }

      .footer-copyright {
        color: #64748b;
        font-size: 0.85rem;
      }

      /* Dark theme overrides for game elements */
      .game-container {
        background: transparent !important;
      }

      .title-screen {
        background: rgba(255, 255, 255, 0.05) !important;
        backdrop-filter: blur(10px) !important;
      }

      .main-title {
        color: #ffd700 !important;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5) !important;
      }

      .subtitle {
        color: #94a3b8 !important;
      }

      .instructions {
        background: rgba(255, 255, 255, 0.08) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        color: #e2e8f0 !important;
      }

      .instructions h3 {
        color: #ffd700 !important;
      }

      .instructions p,
      .instructions li {
        color: #94a3b8 !important;
      }

      .level-card {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
      }

      .level-number {
        color: #e2e8f0 !important;
      }

      .level-reward {
        color: #ffd700 !important;
      }

      .difficulty-btn {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .difficulty-btn:hover,
      .difficulty-btn.selected {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      .start-btn {
        background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
        color: white !important;
      }

      .back-btn {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.2) !important;
      }

      /* Game screen dark theme */
      .game-screen {
        background: rgba(255, 255, 255, 0.05) !important;
        backdrop-filter: blur(10px) !important;
      }

      .question-container {
        background: rgba(255, 255, 255, 0.08) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
      }

      .question-text {
        color: #e2e8f0 !important;
      }

      .answer-btn {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .answer-btn:hover:not(.disabled) {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      .answer-btn.selected {
        background: rgba(99, 102, 241, 0.4) !important;
        border-color: #6366f1 !important;
      }

      .answer-btn.correct {
        background: rgba(16, 185, 129, 0.4) !important;
        border-color: #10b981 !important;
      }

      .answer-btn.wrong {
        background: rgba(239, 68, 68, 0.4) !important;
        border-color: #ef4444 !important;
      }

      .lifeline-btn {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .lifeline-btn:hover:not(.used) {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      .progress-container {
        background: rgba(255, 255, 255, 0.1) !important;
      }

      .progress-level {
        color: #94a3b8 !important;
      }

      .progress-level.current {
        color: #ffd700 !important;
        background: rgba(255, 215, 0, 0.2) !important;
      }

      .progress-level.completed {
        color: #10b981 !important;
        background: rgba(16, 185, 129, 0.2) !important;
      }

      /* Results screen */
      .results-screen {
        background: rgba(255, 255, 255, 0.05) !important;
        backdrop-filter: blur(10px) !important;
      }

      .results-title {
        color: #ffd700 !important;
      }

      .score-display {
        color: #e2e8f0 !important;
      }

      /* Stats screen */
      .stats-screen {
        background: rgba(255, 255, 255, 0.05) !important;
        backdrop-filter: blur(10px) !important;
        color: #e2e8f0 !important;
      }

      .stats-card {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
      }
    </style>
  </head>
  <body>
    <!-- Compact Navigation Header -->
    <nav class="game-nav-header">
      <div class="nav-left">
        <a href="../index.html" class="nav-btn"
          ><i class="fas fa-home"></i> Home</a
        >
        <a href="games.html" class="nav-btn"
          ><i class="fas fa-gamepad"></i> Games</a
        >
      </div>
      <div class="nav-game-title">
        <i class="fas fa-trophy"></i> Who Wants to Be Fluent?
      </div>
    </nav>

    <!-- Top Ad -->
    <div class="ad-wrapper">
      <script
        async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
        crossorigin="anonymous"
      ></script>
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-format="autorelaxed"
        data-ad-client="ca-pub-2456627863532019"
        data-ad-slot="2184713192"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <!-- Screen reader announcements -->
    <div
      id="announcements"
      class="sr-only"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <div class="game-container" role="main">
      <!-- Title Screen -->
      <div
        id="title-screen"
        class="title-screen"
        role="region"
        aria-labelledby="main-title"
      >
        <h1 class="main-title" id="main-title">
          üéì Who Wants to Be a<br />Fluent English Speaker?
        </h1>
        <p class="subtitle">
          Test your English skills and climb the fluency ladder!
        </p>

        <div class="instructions">
          <h3>üìö How to Play</h3>
          <p>
            Answer 15 multiple-choice questions about English grammar,
            vocabulary, pronunciation, and culture. Each correct answer brings
            you closer to fluency!
          </p>

          <h3>üéØ Question Categories</h3>
          <ul style="list-style: none; padding: 0">
            <li>üìñ <strong>Vocabulary</strong> - Word meanings and usage</li>
            <li>‚úèÔ∏è <strong>Grammar</strong> - Sentence structure and rules</li>
            <li>
              üó£Ô∏è <strong>Pronunciation</strong> - Sounds and stress patterns
            </li>
            <li>
              üåç <strong>Culture</strong> - English-speaking countries and
              customs
            </li>
            <li>üí¨ <strong>Idioms</strong> - Common expressions and phrases</li>
          </ul>

          <h3>üÜò Lifelines (Use Once Each)</h3>
          <ul style="list-style: none; padding: 0">
            <li>üéØ <strong>50/50</strong> - Remove two wrong answers</li>
            <li>üí° <strong>Hint</strong> - Get a helpful clue</li>
            <li>üîÑ <strong>Skip</strong> - Move to the next question</li>
          </ul>

          <h3>üèÜ Fluency Levels</h3>
          <div class="level-grid">
            <div class="level-card">
              <div class="level-number">Questions 1-5</div>
              <div class="level-reward">Beginner Level</div>
            </div>
            <div class="level-card">
              <div class="level-number">Questions 6-10</div>
              <div class="level-reward">Intermediate Level</div>
            </div>
            <div class="level-card">
              <div class="level-number">Questions 11-15</div>
              <div class="level-reward">Advanced Level</div>
            </div>
          </div>
        </div>

        <div style="margin: 2rem 0">
          <h3 style="color: #ffd700; margin-bottom: 1rem">
            üéØ Choose Your Difficulty
          </h3>
          <div
            style="
              display: flex;
              justify-content: center;
              gap: 1rem;
              flex-wrap: wrap;
            "
            role="group"
            aria-label="Difficulty selection"
          >
            <button
              class="difficulty-btn"
              onclick="setDifficulty('beginner')"
              id="diff-beginner"
              aria-label="Select beginner difficulty"
              role="radio"
              aria-checked="false"
            >
              üü¢ Beginner
            </button>
            <button
              class="difficulty-btn selected"
              onclick="setDifficulty('mixed')"
              id="diff-mixed"
              aria-label="Select mixed difficulty - default option"
              role="radio"
              aria-checked="true"
            >
              üü° Mixed (Default)
            </button>
            <button
              class="difficulty-btn"
              onclick="setDifficulty('advanced')"
              id="diff-advanced"
              aria-label="Select advanced difficulty"
              role="radio"
              aria-checked="false"
            >
              üî¥ Advanced
            </button>
          </div>
        </div>

        <button
          class="start-btn"
          onclick="startGame()"
          aria-label="Start your fluency journey"
        >
          üöÄ Start Your Journey!
        </button>

        <div
          style="
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
          "
        >
          <button
            class="back-btn"
            onclick="showStats()"
            aria-label="View your statistics"
          >
            üìä Statistics
          </button>
          <button
            class="back-btn"
            onclick="toggleSound()"
            id="sound-toggle"
            aria-label="Toggle sound effects"
          >
            üîä Sound: ON
          </button>
        </div>
      </div>

      <!-- Game Screen -->
      <div
        id="game-screen"
        class="game-screen"
        role="region"
        aria-label="Quiz game area"
      >
        <div class="question-counter" id="question-counter" aria-live="polite">
          Question 1 of 15
        </div>
        <div class="current-reward" id="current-level" aria-live="polite">
          Beginner Level
        </div>

        <div
          class="progress-bar"
          role="progressbar"
          aria-label="Quiz progress"
          aria-valuenow="6.67"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          <div
            class="progress-fill"
            id="progress-fill"
            style="width: 6.67%"
          ></div>
        </div>

        <div class="question-box" role="region" aria-live="polite">
          <div class="question-type" id="question-type"></div>
          <div class="question-text" id="question-text"></div>
        </div>

        <div class="lifelines" role="group" aria-label="Lifeline helpers">
          <button
            class="lifeline-btn"
            id="fifty-fifty"
            onclick="useFiftyFifty()"
            aria-label="Use 50/50 lifeline to remove two wrong answers"
          >
            üéØ 50/50
          </button>
          <button
            class="lifeline-btn"
            id="hint"
            onclick="useHint()"
            aria-label="Use hint lifeline for a helpful clue"
          >
            üí° Hint
          </button>
          <button
            class="lifeline-btn"
            id="skip"
            onclick="useSkip()"
            aria-label="Use skip lifeline to move to next question"
          >
            üîÑ Skip
          </button>
        </div>

        <div
          class="answers-grid"
          id="answers-grid"
          role="group"
          aria-label="Answer options"
        ></div>

        <button
          class="confirm-btn"
          id="confirm-btn"
          onclick="confirmAnswer()"
          aria-label="Confirm your selected answer"
          style="display: none"
        >
          Confirm Answer
        </button>
        <button class="back-btn" onclick="showTitleScreen()">
          Back to Menu
        </button>

        <div
          id="hint-box"
          style="
            display: none;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            color: #ffd700;
          "
        ></div>
      </div>

      <!-- Results Screen -->
      <div id="results-screen" class="results-screen">
        <h1 class="main-title">üéä Congratulations!</h1>
        <div class="final-score" id="final-score"></div>
        <div class="achievement" id="achievement"></div>
        <button class="start-btn" onclick="startGame()">üîÑ Play Again</button>
        <button class="back-btn" onclick="showTitleScreen()">
          Back to Menu
        </button>
      </div>

      <!-- Statistics Screen -->
      <div id="stats-screen" class="stats-screen">
        <h1 class="main-title">üìä Your Statistics</h1>

        <div class="stats-grid" id="stats-grid">
          <!-- Stats will be populated by JavaScript -->
        </div>

        <div class="achievement" style="margin-top: 2rem">
          <h3 style="color: #ffd700; margin-bottom: 1rem">üèÜ Achievements</h3>
          <div class="achievement-list" id="achievement-list">
            <!-- Achievements will be populated by JavaScript -->
          </div>
        </div>

        <div style="margin-top: 2rem">
          <button class="start-btn" onclick="startGame()">üéÆ Play Game</button>
          <button class="back-btn" onclick="showTitleScreen()">
            Back to Menu
          </button>
          <button
            class="back-btn"
            onclick="resetStats()"
            style="background: linear-gradient(45deg, #ef4444, #dc2626)"
          >
            üóëÔ∏è Reset Stats
          </button>
        </div>
      </div>
    </div>

    <script>
      let gameState = {
        currentQuestion: 0,
        score: 0,
        selectedAnswer: null,
        lifelines: {
          fiftyFifty: false,
          hint: false,
          skip: false,
        },
      };

      // Sound effects using Web Audio API
      class SoundEffects {
        constructor() {
          this.audioContext = null;
          this.sounds = {};
          this.enabled = true;
          this.initAudioContext();
        }

        initAudioContext() {
          try {
            this.audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
            this.createSounds();
          } catch (error) {
            console.log("Web Audio API not supported");
            this.enabled = false;
          }
        }

        createSounds() {
          // Create different sound effects
          this.sounds = {
            select: this.createTone(800, 0.1, "sine"),
            correct: this.createMelody([523, 659, 784], 0.3),
            incorrect: this.createTone(200, 0.5, "square"),
            lifeline: this.createTone(1000, 0.2, "triangle"),
            gameStart: this.createMelody([392, 523, 659], 0.4),
            levelUp: this.createMelody([523, 659, 784, 1047], 0.5),
          };
        }

        createTone(frequency, duration, type = "sine") {
          return () => {
            if (!this.enabled || !this.audioContext) return;

            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);

            oscillator.frequency.setValueAtTime(
              frequency,
              this.audioContext.currentTime
            );
            oscillator.type = type;

            gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              this.audioContext.currentTime + duration
            );

            oscillator.start(this.audioContext.currentTime);
            oscillator.stop(this.audioContext.currentTime + duration);
          };
        }

        createMelody(frequencies, totalDuration) {
          return () => {
            if (!this.enabled || !this.audioContext) return;

            const noteDuration = totalDuration / frequencies.length;
            frequencies.forEach((freq, index) => {
              setTimeout(() => {
                this.createTone(freq, noteDuration, "sine")();
              }, index * noteDuration * 1000);
            });
          };
        }

        play(soundName) {
          if (this.enabled && this.sounds[soundName]) {
            // Resume audio context if suspended (required by some browsers)
            if (this.audioContext.state === "suspended") {
              this.audioContext.resume();
            }
            this.sounds[soundName]();
          }
        }

        toggle() {
          this.enabled = !this.enabled;
          return this.enabled;
        }
      }

      const soundFX = new SoundEffects();

      // Screen Reader Announcements
      function announceToScreenReader(message) {
        const announcements = document.getElementById("announcements");
        if (announcements) {
          announcements.textContent = message;
          setTimeout(() => {
            announcements.textContent = "";
          }, 1000);
        }
      }

      // Keyboard Navigation
      document.addEventListener("keydown", (e) => {
        // Get current screen
        const titleScreen = document.getElementById("title-screen");
        const gameScreen = document.getElementById("game-screen");
        const isTitleScreen = titleScreen.style.display !== "none";
        const isGameScreen = gameScreen.style.display === "block";

        // Escape key - return to title (if in game)
        if (e.key === "Escape" && isGameScreen) {
          if (confirm("Return to main menu? Your progress will be lost.")) {
            showTitleScreen();
          }
          return;
        }

        // Enter key - start game from title screen
        if (e.key === "Enter" && isTitleScreen) {
          const startBtn = document.querySelector(".start-btn");
          if (startBtn && document.activeElement !== startBtn) {
            startGame();
            e.preventDefault();
          }
          return;
        }

        // Number keys 1-4 for answer selection during game
        if (isGameScreen && ["1", "2", "3", "4"].includes(e.key)) {
          const answerBtns = document.querySelectorAll(
            ".answer-btn:not([disabled])"
          );
          const index = parseInt(e.key) - 1;
          if (answerBtns[index]) {
            answerBtns[index].click();
            e.preventDefault();
          }
          return;
        }

        // F key - use 50/50 lifeline
        if (e.key === "f" || e.key === "F") {
          const fiftyBtn = document.getElementById("fifty-fifty");
          if (fiftyBtn && !fiftyBtn.classList.contains("used")) {
            useFiftyFifty();
            e.preventDefault();
          }
          return;
        }

        // H key - use hint lifeline
        if (e.key === "h" || e.key === "H") {
          const hintBtn = document.getElementById("hint");
          if (hintBtn && !hintBtn.classList.contains("used")) {
            useHint();
            e.preventDefault();
          }
          return;
        }

        // K key - use skip lifeline
        if (e.key === "k" || e.key === "K") {
          const skipBtn = document.getElementById("skip");
          if (skipBtn && !skipBtn.classList.contains("used")) {
            useSkip();
            e.preventDefault();
          }
          return;
        }

        // Space or Enter - confirm answer
        if ((e.key === " " || e.key === "Enter") && isGameScreen) {
          const confirmBtn = document.getElementById("confirm-btn");
          if (
            confirmBtn &&
            !confirmBtn.disabled &&
            document.activeElement.classList.contains("answer-btn")
          ) {
            confirmAnswer();
            e.preventDefault();
          }
          return;
        }

        // S key - toggle sound
        if (e.key === "s" || e.key === "S") {
          if (!e.ctrlKey && !e.metaKey) {
            toggleSound();
            e.preventDefault();
          }
          return;
        }
      });

      // Streak tracking
      let currentStreak =
        parseInt(localStorage.getItem("whowants_currentStreak")) || 0;
      let bestStreak =
        parseInt(localStorage.getItem("whowants_bestStreak")) || 0;

      function updateStreak(won) {
        if (won) {
          currentStreak++;
          if (currentStreak > bestStreak) {
            bestStreak = currentStreak;
            localStorage.setItem("whowants_bestStreak", bestStreak.toString());
            announceToScreenReader(
              `New best streak: ${bestStreak} perfect games!`
            );
          }
          localStorage.setItem(
            "whowants_currentStreak",
            currentStreak.toString()
          );
        } else {
          if (currentStreak > 0) {
            currentStreak = 0;
            localStorage.setItem("whowants_currentStreak", "0");
          }
        }
      }

      // Score persistence and statistics
      class ScoreManager {
        constructor() {
          this.storageKey = "englishGameStats";
          this.loadStats();
        }

        loadStats() {
          try {
            const saved = localStorage.getItem(this.storageKey);
            this.stats = saved
              ? JSON.parse(saved)
              : {
                  highScore: 0,
                  totalGames: 0,
                  totalCorrect: 0,
                  bestStreak: 0,
                  averageScore: 0,
                  achievements: [],
                };
          } catch (error) {
            console.log("Error loading stats:", error);
            this.stats = {
              highScore: 0,
              totalGames: 0,
              totalCorrect: 0,
              bestStreak: 0,
              averageScore: 0,
              achievements: [],
            };
          }
        }

        saveStats() {
          try {
            localStorage.setItem(this.storageKey, JSON.stringify(this.stats));
          } catch (error) {
            console.log("Error saving stats:", error);
          }
        }

        recordGame(score, totalQuestions) {
          this.stats.totalGames++;
          this.stats.totalCorrect += score;

          if (score > this.stats.highScore) {
            this.stats.highScore = score;
          }

          this.stats.averageScore =
            Math.round(
              (this.stats.totalCorrect / this.stats.totalGames) * 100
            ) / 100;

          // Check for achievements
          this.checkAchievements(score, totalQuestions);

          this.saveStats();
        }

        checkAchievements(score, totalQuestions) {
          const percentage = (score / totalQuestions) * 100;
          const newAchievements = [];

          if (
            percentage === 100 &&
            !this.stats.achievements.includes("perfect")
          ) {
            newAchievements.push({
              id: "perfect",
              name: "Perfect Score!",
              description: "Got all questions correct in a single game",
              icon: "üèÜ",
            });
            this.stats.achievements.push("perfect");
          }

          if (
            this.stats.totalGames === 1 &&
            !this.stats.achievements.includes("firstGame")
          ) {
            newAchievements.push({
              id: "firstGame",
              name: "First Steps",
              description: "Completed your first game",
              icon: "üéØ",
            });
            this.stats.achievements.push("firstGame");
          }

          if (
            this.stats.totalGames >= 10 &&
            !this.stats.achievements.includes("dedicated")
          ) {
            newAchievements.push({
              id: "dedicated",
              name: "Dedicated Learner",
              description: "Played 10 games",
              icon: "üìö",
            });
            this.stats.achievements.push("dedicated");
          }

          if (
            percentage >= 80 &&
            !this.stats.achievements.includes("highAchiever")
          ) {
            newAchievements.push({
              id: "highAchiever",
              name: "High Achiever",
              description: "Scored 80% or higher",
              icon: "‚≠ê",
            });
            this.stats.achievements.push("highAchiever");
          }

          return newAchievements;
        }

        getStats() {
          return { ...this.stats };
        }

        resetStats() {
          this.stats = {
            highScore: 0,
            totalGames: 0,
            totalCorrect: 0,
            bestStreak: 0,
            averageScore: 0,
            achievements: [],
          };
          this.saveStats();
        }
      }

      const scoreManager = new ScoreManager();

      let gameDifficulty = "mixed"; // Default difficulty

      const allQuestions = [
        // Beginner Level Questions (Easy)
        {
          type: "Vocabulary",
          question: "What does the word 'enormous' mean?",
          answers: [
            "A) Very small",
            "B) Very large",
            "C) Very fast",
            "D) Very slow",
          ],
          correct: 1,
          hint: "Think about elephants - they are...",
          difficulty: "beginner",
        },
        {
          type: "Grammar",
          question: "Which sentence is correct?",
          answers: [
            "A) She don't like pizza",
            "B) She doesn't like pizza",
            "C) She not like pizza",
            "D) She no like pizza",
          ],
          correct: 1,
          hint: "Remember: 'She' is third person singular, so use 'doesn't'",
          difficulty: "beginner",
        },
        {
          type: "Vocabulary",
          question: "What is the opposite of 'happy'?",
          answers: ["A) Glad", "B) Joyful", "C) Sad", "D) Excited"],
          correct: 2,
          hint: "When you're not happy, you feel...",
          difficulty: "beginner",
        },
        {
          type: "Grammar",
          question: "Complete: 'I _____ to school every day.'",
          answers: ["A) goes", "B) go", "C) going", "D) went"],
          correct: 1,
          hint: "Use the base form of the verb with 'I'",
          difficulty: "beginner",
        },
        {
          type: "Pronunciation",
          question: "Which word rhymes with 'cat'?",
          answers: ["A) Cut", "B) Bat", "C) Coat", "D) Cute"],
          correct: 1,
          hint: "Think about the '-at' sound ending",
          difficulty: "beginner",
        },
        {
          type: "Vocabulary",
          question: "What do you call the meal you eat in the morning?",
          answers: ["A) Lunch", "B) Dinner", "C) Breakfast", "D) Snack"],
          correct: 2,
          hint: "You 'break' your 'fast' after sleeping",
          difficulty: "beginner",
        },
        {
          type: "Grammar",
          question: "Choose the correct article: '_____ apple is red.'",
          answers: ["A) A", "B) An", "C) The", "D) No article needed"],
          correct: 1,
          hint: "Use 'an' before vowel sounds",
          difficulty: "beginner",
        },
        {
          type: "Vocabulary",
          question: "What color do you get when you mix red and yellow?",
          answers: ["A) Purple", "B) Green", "C) Orange", "D) Blue"],
          correct: 2,
          hint: "Think about the color of a pumpkin",
          difficulty: "beginner",
        },
        {
          type: "Grammar",
          question: "What is the plural of 'child'?",
          answers: ["A) Childs", "B) Childrens", "C) Children", "D) Childses"],
          correct: 2,
          hint: "This is an irregular plural form",
          difficulty: "beginner",
        },
        {
          type: "Vocabulary",
          question: "Where do you go to buy medicine?",
          answers: ["A) Library", "B) Pharmacy", "C) Bakery", "D) Bank"],
          correct: 1,
          hint: "This place is also called a 'drug store'",
          difficulty: "beginner",
        },

        // Intermediate Level Questions
        {
          type: "Idioms",
          question: "What does 'break a leg' mean?",
          answers: [
            "A) To hurt yourself",
            "B) Good luck",
            "C) To run fast",
            "D) To dance badly",
          ],
          correct: 1,
          hint: "This is said to actors before a performance",
          difficulty: "intermediate",
        },
        {
          type: "Grammar",
          question: "Which is the correct past tense of 'bring'?",
          answers: ["A) Brang", "B) Bringed", "C) Brought", "D) Brung"],
          correct: 2,
          hint: "This is an irregular verb - it doesn't follow normal rules",
          difficulty: "intermediate",
        },
        {
          type: "Vocabulary",
          question: "What is a 'sibling'?",
          answers: [
            "A) A parent",
            "B) A friend",
            "C) A brother or sister",
            "D) A cousin",
          ],
          correct: 2,
          hint: "These people share the same parents as you",
          difficulty: "intermediate",
        },
        {
          type: "Culture",
          question: "In which country would you pay with 'pounds'?",
          answers: [
            "A) Australia",
            "B) Canada",
            "C) United Kingdom",
            "D) Ireland",
          ],
          correct: 2,
          hint: "Think of Big Ben and the Queen's English",
          difficulty: "intermediate",
        },
        {
          type: "Grammar",
          question:
            "Choose the correct form: 'If I _____ rich, I would travel the world.'",
          answers: ["A) am", "B) was", "C) were", "D) be"],
          correct: 2,
          hint: "This is a hypothetical situation (unreal conditional)",
          difficulty: "intermediate",
        },
        {
          type: "Idioms",
          question: "What does 'it's raining cats and dogs' mean?",
          answers: [
            "A) Animals are falling",
            "B) It's raining very hard",
            "C) It's a light rain",
            "D) The weather is nice",
          ],
          correct: 1,
          hint: "This describes very heavy rain",
          difficulty: "intermediate",
        },
        {
          type: "Vocabulary",
          question: "What does 'procrastinate' mean?",
          answers: [
            "A) To work quickly",
            "B) To delay doing something",
            "C) To finish early",
            "D) To work together",
          ],
          correct: 1,
          hint: "Students often do this with homework",
          difficulty: "intermediate",
        },
        {
          type: "Grammar",
          question: "Which sentence uses the present perfect correctly?",
          answers: [
            "A) I have went there",
            "B) I have gone there",
            "C) I has gone there",
            "D) I gone there",
          ],
          correct: 1,
          hint: "Use 'have/has' + past participle",
          difficulty: "intermediate",
        },
        {
          type: "Culture",
          question: "What is a 'fender bender'?",
          answers: [
            "A) A guitar part",
            "B) A minor car accident",
            "C) A cooking tool",
            "D) A type of dance",
          ],
          correct: 1,
          hint: "This involves cars but isn't serious",
          difficulty: "intermediate",
        },
        {
          type: "Pronunciation",
          question: "Which word has the stress on the second syllable?",
          answers: [
            "A) PHOtograph",
            "B) phoTOgraphy",
            "C) photoGRAPHic",
            "D) PHOto",
          ],
          correct: 1,
          hint: "Listen for the emphasized part",
          difficulty: "intermediate",
        },

        // Advanced Level Questions
        {
          type: "Vocabulary",
          question: "What does 'ubiquitous' mean?",
          answers: [
            "A) Rare and special",
            "B) Present everywhere",
            "C) Very expensive",
            "D) Extremely old",
          ],
          correct: 1,
          hint: "Think about smartphones in modern life",
          difficulty: "advanced",
        },
        {
          type: "Idioms",
          question: "What does 'bite the bullet' mean?",
          answers: [
            "A) To eat quickly",
            "B) To face a difficult situation",
            "C) To make a mistake",
            "D) To speak loudly",
          ],
          correct: 1,
          hint: "Sometimes you have to do something unpleasant but necessary",
          difficulty: "advanced",
        },
        {
          type: "Grammar",
          question: "Which sentence uses the subjunctive mood correctly?",
          answers: [
            "A) I wish I was taller",
            "B) I wish I were taller",
            "C) I wish I am taller",
            "D) I wish I will be taller",
          ],
          correct: 1,
          hint: "The subjunctive uses 'were' for hypothetical wishes",
          difficulty: "advanced",
        },
        {
          type: "Pronunciation",
          question: "Which word has a silent 'b'?",
          answers: ["A) About", "B) Lamb", "C) Bobby", "D) Globe"],
          correct: 1,
          hint: "This word ends with 'mb' but you don't hear the 'b'",
          difficulty: "advanced",
        },
        {
          type: "Culture",
          question: "What does 'Thanksgiving' celebrate in American culture?",
          answers: [
            "A) Independence from Britain",
            "B) The harvest and gratitude",
            "C) The end of winter",
            "D) Religious freedom",
          ],
          correct: 1,
          hint: "Think about pilgrims, turkey, and being thankful",
          difficulty: "advanced",
        },
        {
          type: "Vocabulary",
          question: "What does 'serendipity' mean?",
          answers: [
            "A) A planned discovery",
            "B) A pleasant surprise",
            "C) A difficult situation",
            "D) A boring routine",
          ],
          correct: 1,
          hint: "When you find something wonderful by accident",
          difficulty: "advanced",
        },
        {
          type: "Grammar",
          question: "Choose the correct form: 'The data _____ inconclusive.'",
          answers: ["A) is", "B) are", "C) was", "D) were"],
          correct: 1,
          hint: "'Data' can be singular or plural, but in formal English...",
          difficulty: "advanced",
        },
        {
          type: "Idioms",
          question: "What does 'burn the midnight oil' mean?",
          answers: [
            "A) To waste energy",
            "B) To work late into the night",
            "C) To cook dinner",
            "D) To have a party",
          ],
          correct: 1,
          hint: "Students do this before exams",
          difficulty: "advanced",
        },
        {
          type: "Vocabulary",
          question: "What is an 'epiphany'?",
          answers: [
            "A) A religious holiday",
            "B) A sudden realization",
            "C) A type of flower",
            "D) A musical instrument",
          ],
          correct: 1,
          hint: "That 'aha!' moment when you understand something",
          difficulty: "advanced",
        },
        {
          type: "Culture",
          question: "What does 'mind the gap' refer to in British culture?",
          answers: [
            "A) A TV show",
            "B) A warning on the London Underground",
            "C) A type of food",
            "D) A shopping center",
          ],
          correct: 1,
          hint: "You hear this on the London subway system",
          difficulty: "advanced",
        },
      ];

      let questions = [];

      function startGame() {
        gameState = {
          currentQuestion: 0,
          score: 0,
          selectedAnswer: null,
          lifelines: { fiftyFifty: false, hint: false, skip: false },
        };

        // Select and shuffle questions for variety
        questions = selectQuestions();

        // Play game start sound
        soundFX.play("gameStart");

        document.getElementById("title-screen").style.display = "none";
        document.getElementById("results-screen").style.display = "none";
        document.getElementById("game-screen").style.display = "block";

        // Reset lifeline buttons
        document.getElementById("fifty-fifty").classList.remove("used");
        document.getElementById("hint").classList.remove("used");
        document.getElementById("skip").classList.remove("used");
        document.getElementById("hint-box").style.display = "none";

        announceToScreenReader(
          `Game started with ${gameDifficulty} difficulty. Good luck!`
        );
        displayQuestion();
      }

      function selectQuestions() {
        let selectedQuestions = [];

        if (gameDifficulty === "beginner") {
          // All beginner questions
          const beginnerQuestions = allQuestions.filter(
            (q) => q.difficulty === "beginner"
          );
          selectedQuestions = shuffleArray(beginnerQuestions).slice(0, 15);
        } else if (gameDifficulty === "advanced") {
          // All advanced questions
          const advancedQuestions = allQuestions.filter(
            (q) => q.difficulty === "advanced"
          );
          selectedQuestions = shuffleArray(advancedQuestions).slice(0, 15);
        } else {
          // Mixed difficulty (default)
          const beginnerQuestions = allQuestions.filter(
            (q) => q.difficulty === "beginner"
          );
          const intermediateQuestions = allQuestions.filter(
            (q) => q.difficulty === "intermediate"
          );
          const advancedQuestions = allQuestions.filter(
            (q) => q.difficulty === "advanced"
          );

          const shuffledBeginner = shuffleArray(beginnerQuestions);
          const shuffledIntermediate = shuffleArray(intermediateQuestions);
          const shuffledAdvanced = shuffleArray(advancedQuestions);

          selectedQuestions = [
            ...shuffledBeginner.slice(0, 5),
            ...shuffledIntermediate.slice(0, 5),
            ...shuffledAdvanced.slice(0, 5),
          ];
        }

        // Shuffle answers for each question to prevent pattern memorization
        return selectedQuestions.map((question) => {
          const correctAnswer = question.answers[question.correct];
          const shuffledAnswers = shuffleArray([...question.answers]);
          const newCorrectIndex = shuffledAnswers.indexOf(correctAnswer);

          return {
            ...question,
            answers: shuffledAnswers,
            correct: newCorrectIndex,
          };
        });
      }

      function setDifficulty(difficulty) {
        gameDifficulty = difficulty;

        // Update UI and ARIA states
        document.querySelectorAll(".difficulty-btn").forEach((btn) => {
          btn.classList.remove("selected");
          btn.setAttribute("aria-checked", "false");
        });
        const selectedBtn = document.getElementById(`diff-${difficulty}`);
        selectedBtn.classList.add("selected");
        selectedBtn.setAttribute("aria-checked", "true");

        announceToScreenReader(`Difficulty set to ${difficulty}`);
      }

      function showStats() {
        const stats = scoreManager.getStats();

        document.getElementById("title-screen").style.display = "none";
        document.getElementById("game-screen").style.display = "none";
        document.getElementById("results-screen").style.display = "none";
        document.getElementById("stats-screen").style.display = "block";

        // Populate stats
        const statsGrid = document.getElementById("stats-grid");
        statsGrid.innerHTML = `
                <div class="stats-card">
                    <h4>üèÜ High Score</h4>
                    <div class="stats-number">${stats.highScore}/15</div>
                    <p>${Math.round((stats.highScore / 15) * 100)}% Accuracy</p>
                </div>
                <div class="stats-card">
                    <h4>üéÆ Games Played</h4>
                    <div class="stats-number">${stats.totalGames}</div>
                    <p>Keep practicing!</p>
                </div>
                <div class="stats-card">
                    <h4>üìà Average Score</h4>
                    <div class="stats-number">${stats.averageScore}</div>
                    <p>Out of 15 questions</p>
                </div>
                <div class="stats-card">
                    <h4>‚úÖ Total Correct</h4>
                    <div class="stats-number">${stats.totalCorrect}</div>
                    <p>Answers across all games</p>
                </div>
            `;

        // Populate achievements
        const achievementList = document.getElementById("achievement-list");
        if (stats.achievements.length === 0) {
          achievementList.innerHTML =
            '<p style="color: #87CEEB; grid-column: 1 / -1;">No achievements yet. Play some games to unlock them!</p>';
        } else {
          const achievementData = {
            firstGame: {
              name: "First Steps",
              icon: "üéØ",
              description: "Completed your first game",
            },
            perfect: {
              name: "Perfect Score!",
              icon: "üèÜ",
              description: "Got all questions correct",
            },
            dedicated: {
              name: "Dedicated Learner",
              icon: "üìö",
              description: "Played 10 games",
            },
            highAchiever: {
              name: "High Achiever",
              icon: "‚≠ê",
              description: "Scored 80% or higher",
            },
          };

          achievementList.innerHTML = stats.achievements
            .map((achId) => {
              const ach = achievementData[achId];
              return `
                        <div class="achievement-item">
                            <div class="achievement-icon">${ach.icon}</div>
                            <strong>${ach.name}</strong>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">${ach.description}</p>
                        </div>
                    `;
            })
            .join("");
        }
      }

      function resetStats() {
        if (
          confirm(
            "Are you sure you want to reset all your statistics? This cannot be undone."
          )
        ) {
          scoreManager.resetStats();
          showStats(); // Refresh the stats display
        }
      }

      function displayQuestion() {
        const question = questions[gameState.currentQuestion];

        document.getElementById("question-counter").textContent = `Question ${
          gameState.currentQuestion + 1
        } of 15`;
        document.getElementById("question-type").textContent = question.type;
        document.getElementById("question-text").textContent =
          question.question;

        // Update level display
        let level = "Beginner Level";
        if (gameState.currentQuestion >= 10) level = "Advanced Level";
        else if (gameState.currentQuestion >= 5) level = "Intermediate Level";
        document.getElementById("current-level").textContent = level;

        // Update progress bar
        const progress = ((gameState.currentQuestion + 1) / 15) * 100;
        const progressBar = document.querySelector(".progress-bar");
        progressBar.setAttribute("aria-valuenow", progress.toFixed(2));
        document.getElementById("progress-fill").style.width = progress + "%";

        // Display answers
        const answersGrid = document.getElementById("answers-grid");
        answersGrid.innerHTML = "";

        question.answers.forEach((answer, index) => {
          const button = document.createElement("button");
          button.className = "answer-btn";
          button.textContent = answer;
          button.onclick = () => selectAnswer(index);
          button.setAttribute("aria-label", `Option ${index + 1}: ${answer}`);
          button.setAttribute("role", "button");
          answersGrid.appendChild(button);
        });

        gameState.selectedAnswer = null;
        document.getElementById("confirm-btn").style.display = "none";
        document.getElementById("hint-box").style.display = "none";

        // Announce new question
        announceToScreenReader(
          `Question ${gameState.currentQuestion + 1} of 15. ${question.type}. ${
            question.question
          }`
        );
      }

      function selectAnswer(index) {
        // Play select sound
        soundFX.play("select");

        // Remove previous selection
        document.querySelectorAll(".answer-btn").forEach((btn) => {
          btn.classList.remove("selected");
        });

        // Select new answer
        const selectedBtn = document.querySelectorAll(".answer-btn")[index];
        selectedBtn.classList.add("selected");
        gameState.selectedAnswer = index;
        document.getElementById("confirm-btn").style.display = "inline-block";

        // Announce selection
        const answerText = selectedBtn.textContent.trim();
        announceToScreenReader(`Selected answer: ${answerText}`);
      }

      function confirmAnswer() {
        if (gameState.selectedAnswer === null) return;

        const question = questions[gameState.currentQuestion];
        const buttons = document.querySelectorAll(".answer-btn");

        // Show correct answer
        buttons[question.correct].classList.add("correct");

        // Show wrong answer if incorrect and play appropriate sound
        if (gameState.selectedAnswer !== question.correct) {
          buttons[gameState.selectedAnswer].classList.add("wrong");
          soundFX.play("incorrect");
          announceToScreenReader(
            `Incorrect. The correct answer was ${buttons[
              question.correct
            ].textContent.trim()}`
          );
        } else {
          gameState.score++;
          soundFX.play("correct");
          announceToScreenReader(
            `Correct! Score: ${gameState.score} out of ${
              gameState.currentQuestion + 1
            }`
          );

          // Play level up sound at milestones
          if (
            gameState.currentQuestion === 4 ||
            gameState.currentQuestion === 9
          ) {
            setTimeout(() => soundFX.play("levelUp"), 800);
          }
        }

        // Disable all buttons
        buttons.forEach((btn) => (btn.onclick = null));
        document.getElementById("confirm-btn").style.display = "none";

        // Move to next question after delay
        setTimeout(() => {
          gameState.currentQuestion++;
          if (gameState.currentQuestion >= questions.length) {
            endGame();
          } else {
            displayQuestion();
          }
        }, 2000);
      }

      function useFiftyFifty() {
        if (gameState.lifelines.fiftyFifty) return;

        soundFX.play("lifeline");
        gameState.lifelines.fiftyFifty = true;
        document.getElementById("fifty-fifty").classList.add("used");

        const question = questions[gameState.currentQuestion];
        const buttons = document.querySelectorAll(".answer-btn");

        let removed = 0;
        for (let i = 0; i < buttons.length && removed < 2; i++) {
          if (i !== question.correct) {
            buttons[i].style.opacity = "0.3";
            buttons[i].onclick = null;
            removed++;
          }
        }
        announceToScreenReader(
          "50/50 lifeline used. Two wrong answers removed."
        );
      }

      function useHint() {
        if (gameState.lifelines.hint) return;

        soundFX.play("lifeline");
        gameState.lifelines.hint = true;
        document.getElementById("hint").classList.add("used");

        const question = questions[gameState.currentQuestion];
        const hintBox = document.getElementById("hint-box");
        hintBox.textContent = `üí° Hint: ${question.hint}`;
        hintBox.style.display = "block";
        announceToScreenReader(`Hint: ${question.hint}`);
      }

      function useSkip() {
        if (gameState.lifelines.skip) return;

        soundFX.play("lifeline");
        gameState.lifelines.skip = true;
        document.getElementById("skip").classList.add("used");

        announceToScreenReader("Question skipped. Moving to next question.");

        gameState.currentQuestion++;
        if (gameState.currentQuestion >= questions.length) {
          endGame();
        } else {
          displayQuestion();
        }
      }

      function toggleSound() {
        const isEnabled = soundFX.toggle();
        const button = document.getElementById("sound-toggle");
        button.textContent = isEnabled ? "üîä Sound: ON" : "üîá Sound: OFF";
      }

      function endGame() {
        document.getElementById("game-screen").style.display = "none";
        document.getElementById("results-screen").style.display = "block";

        const percentage = Math.round(
          (gameState.score / questions.length) * 100
        );

        // Update streak (perfect score = 15/15)
        const isPerfect = gameState.score === questions.length;
        updateStreak(isPerfect);

        // Record the game results
        const newAchievements = scoreManager.recordGame(
          gameState.score,
          questions.length
        );
        const stats = scoreManager.getStats();

        document.getElementById(
          "final-score"
        ).textContent = `${gameState.score}/${questions.length} Correct (${percentage}%)`;

        let achievement = "";
        if (percentage >= 90) {
          achievement = `<h3>üåü FLUENT SPEAKER! üåü</h3>
                              <p>Outstanding! You have excellent English skills. You're ready for advanced conversations and native-level content!</p>`;
        } else if (percentage >= 75) {
          achievement = `<h3>üéì ADVANCED LEARNER! üéì</h3>
                              <p>Great job! You have strong English skills. Keep practicing with challenging materials!</p>`;
        } else if (percentage >= 60) {
          achievement = `<h3>üìö INTERMEDIATE LEVEL! üìö</h3>
                              <p>Well done! You have good English fundamentals. Focus on expanding vocabulary and idioms!</p>`;
        } else if (percentage >= 40) {
          achievement = `<h3>üå± BEGINNER PLUS! üå±</h3>
                              <p>Good progress! Keep studying grammar basics and common vocabulary!</p>`;
        } else {
          achievement = `<h3>üìñ BEGINNER LEVEL! üìñ</h3>
                              <p>Don't worry - everyone starts somewhere! Focus on basic grammar and everyday vocabulary!</p>`;
        }

        // Add streak info
        if (isPerfect && currentStreak > 1) {
          achievement += `<div style="background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,140,0,0.1)); padding: 1rem; margin: 1rem 0; border-radius: 12px; border: 2px solid rgba(255,215,0,0.4);">
                            <h4 style="color: #FFD700; margin-bottom: 0.5rem;">üî• Perfect Game Streak! üî•</h4>
                            <p style="font-size: 1.2rem; margin: 0;"><strong>${currentStreak}</strong> perfect games in a row!</p>
                            ${
                              currentStreak === bestStreak
                                ? '<p style="color: #FFD700; margin: 0.5rem 0 0 0;">‚≠ê NEW BEST STREAK! ‚≠ê</p>'
                                : ""
                            }
                          </div>`;
        }

        // Add new achievements
        if (newAchievements.length > 0) {
          achievement +=
            '<div style="margin-top: 2rem; padding-top: 1rem; border-top: 2px solid rgba(255,215,0,0.3);">';
          achievement +=
            '<h4 style="color: #FFD700; margin-bottom: 1rem;">üéâ New Achievements Unlocked! üéâ</h4>';
          newAchievements.forEach((ach) => {
            achievement += `<div style="background: rgba(255,215,0,0.1); padding: 0.5rem; margin: 0.5rem 0; border-radius: 8px;">
                                      ${ach.icon} <strong>${ach.name}</strong><br>
                                      <small>${ach.description}</small>
                                   </div>`;
          });
          achievement += "</div>";
        }

        // Add statistics
        achievement += `<div style="margin-top: 2rem; padding-top: 1rem; border-top: 2px solid rgba(135,206,235,0.3);">
                             <h4 style="color: #87CEEB; margin-bottom: 1rem;">üìä Your Statistics</h4>
                             <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; text-align: left;">
                               <div><strong>High Score:</strong> ${stats.highScore}/${questions.length}</div>
                               <div><strong>Total Games:</strong> ${stats.totalGames}</div>
                               <div><strong>Average Score:</strong> ${stats.averageScore}</div>
                               <div><strong>Achievements:</strong> ${stats.achievements.length}</div>
                               <div><strong>Perfect Streak:</strong> ${currentStreak}</div>
                               <div><strong>Best Streak:</strong> ${bestStreak}</div>
                             </div>
                           </div>`;

        document.getElementById("achievement").innerHTML = achievement;

        // Announce results
        const streakText = isPerfect
          ? ` Perfect game streak: ${currentStreak}.`
          : "";
        announceToScreenReader(
          `Game complete! You scored ${gameState.score} out of ${questions.length}. ${percentage}% correct.${streakText}`
        );
      }

      function showTitleScreen() {
        document.getElementById("title-screen").style.display = "block";
        document.getElementById("game-screen").style.display = "none";
        document.getElementById("results-screen").style.display = "none";
        document.getElementById("stats-screen").style.display = "none";
      }

      // Shuffle array function for randomization
      function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      // Add keyboard navigation
      document.addEventListener("keydown", function (event) {
        if (document.getElementById("game-screen").style.display === "block") {
          const buttons = document.querySelectorAll(
            '.answer-btn:not([style*="opacity: 0.3"])'
          );

          if (event.key >= "1" && event.key <= "4") {
            const index = parseInt(event.key) - 1;
            if (buttons[index]) {
              selectAnswer(
                Array.from(document.querySelectorAll(".answer-btn")).indexOf(
                  buttons[index]
                )
              );
            }
          } else if (
            event.key === "Enter" &&
            gameState.selectedAnswer !== null
          ) {
            confirmAnswer();
          }
        }
      });

      // Initialize game on page load
      window.addEventListener("load", function () {
        showTitleScreen();
      });
    </script>

    <!-- Footer -->
    <footer class="game-footer">
      <div class="footer-links">
        <a href="../index.html"><i class="fas fa-home"></i> Home</a>
        <a href="games.html"><i class="fas fa-gamepad"></i> Games</a>
        <a href="../lessons.html"><i class="fas fa-book"></i> Lessons</a>
        <a href="../contact.html"><i class="fas fa-envelope"></i> Contact</a>
      </div>
      <p class="footer-copyright">
        &copy; 2024 ESL Fun Online. All rights reserved.
      </p>
    </footer>

    <!-- Bottom Ad -->
    <div class="ad-wrapper">
      <script
        async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
        crossorigin="anonymous"
      ></script>
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-format="autorelaxed"
        data-ad-client="ca-pub-2456627863532019"
        data-ad-slot="2184713192"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </body>
</html>
