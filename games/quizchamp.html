<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      ESL Countdown Championship - Choose Your Letters & Find Words | ESL Fun
      Online
    </title>
    <meta
      name="description"
      content="Play the classic Countdown letters game! Take turns choosing vowels and consonants, then race against time to find the longest words in this authentic ESL adaptation."
    />
    <meta
      name="keywords"
      content="ESL quiz game, English countdown quiz, grammar quiz, vocabulary test, timed English quiz, educational game, ESL championship"
    />
    <meta name="author" content="ESL Fun Online" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="English" />

    <!-- Open Graph Tags -->
    <meta
      property="og:title"
      content="ESL Countdown Quiz Championship - Test Your English Knowledge"
    />
    <meta
      property="og:description"
      content="Challenge yourself with timed questions in our ESL Countdown Quiz! Test grammar, vocabulary, and English knowledge."
    />
    <meta
      property="og:image"
      content="https://eslfunonline.com/images/image copy 2.png"
    />
    <meta
      property="og:url"
      content="https://eslfunonline.com/games/quizchamp.html"
    />
    <meta property="og:type" content="game" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ESL Countdown Quiz Championship" />
    <meta
      name="twitter:description"
      content="Race against time in this exciting English quiz game!"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/image copy 2.png"
    />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="https://eslfunonline.com/games/quizchamp.html"
    />

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "ESL Countdown Quiz Championship",
        "description": "Challenge yourself with timed questions in our ESL Countdown Quiz! Test grammar, vocabulary, and English knowledge through exciting gameplay.",
        "url": "https://eslfunonline.com/games/quizchamp.html",
        "image": "https://eslfunonline.com/images/image copy 2.png",
        "publisher": {
          "@type": "Organization",
          "name": "ESL Fun Online",
          "url": "https://eslfunonline.com"
        },
        "genre": ["Educational", "Quiz", "Grammar"],
        "audience": {
          "@type": "EducationalAudience",
          "educationalRole": "student",
          "audienceType": "ESL Learners"
        },
        "educationalLevel": "Beginner to Advanced",
        "educationalUse": [
          "grammar practice",
          "vocabulary testing",
          "reading comprehension"
        ],
        "interactivityType": "active",
        "learningResourceType": "game",
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "accessibilityFeature": [
          "alternativeText",
          "keyboardNavigation",
          "ariaLabels",
          "timingControl",
          "highContrast"
        ],
        "keywords": "ESL quiz, English grammar, vocabulary test, timed quiz, educational game"
      }
    </script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(
            135deg,
            rgba(30, 60, 114, 0.3) 0%,
            rgba(42, 82, 152, 0.4) 50%,
            rgba(102, 126, 234, 0.3) 100%
          ),
          url("../images/image copy.png");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        overflow-x: hidden;
      }

      .game-container {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(8px);
        border-radius: 20px;
        padding: 2rem;
        max-width: 900px;
        width: 95%;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.15);
        position: relative;
      }

      .team-setup-screen {
        display: block;
      }

      .team-vs-display {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 2rem 0;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }

      .team-box {
        flex: 1;
        padding: 1rem;
        margin: 0 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }

      .team-box.active {
        border-color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
      }

      .team-name {
        font-size: 1.5rem;
        font-weight: bold;
        color: #ffd700;
        margin-bottom: 0.5rem;
      }

      .team-score {
        font-size: 2rem;
        font-weight: bold;
        color: white;
      }

      .vs-text {
        font-size: 2rem;
        font-weight: bold;
        color: #ff6b6b;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        animation: pulse 2s infinite;
      }

      .round-info {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        padding: 1rem;
        margin: 1rem 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .setup-form {
        display: grid;
        gap: 1.5rem;
        max-width: 500px;
        margin: 0 auto;
        text-align: left;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .form-group label {
        font-weight: bold;
        color: #ffd700;
      }

      .form-input {
        padding: 12px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
      }

      .form-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .checkbox-group input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #ffd700;
      }

      .math-challenge-screen {
        display: none;
      }

      .math-problem {
        font-size: 2.5rem;
        font-weight: bold;
        color: #ffd700;
        margin: 2rem 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .number-tiles {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin: 1rem 0;
        flex-wrap: wrap;
      }

      .number-tile {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        padding: 1rem;
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
        min-width: 60px;
        text-align: center;
      }

      .celebration {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #ffd700;
        animation: confetti-fall 3s linear forwards;
      }

      @keyframes confetti-fall {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      .timer-critical {
        animation: timer-pulse 0.5s infinite;
        color: #ff4444 !important;
      }

      @keyframes timer-pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .skip-btn {
        background: linear-gradient(45deg, #ff9800, #f57c00);
        color: white;
        border: none;
        padding: 10px 25px;
        font-size: 1rem;
        border-radius: 25px;
        cursor: pointer;
        margin: 0 10px;
        transition: all 0.3s ease;
      }

      .skip-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
        animation: pulse 2s infinite;
        color: #ffffff;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes pulse-glow {
        0%,
        100% {
          box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
          transform: scale(1);
        }
        50% {
          box-shadow: 0 8px 25px rgba(255, 107, 107, 0.8);
          transform: scale(1.02);
        }
      }

      .quick-start-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        margin: 1rem 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #45a049);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .sound-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.3s ease;
      }

      .sound-toggle:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
      }

      .hint-box {
        background: rgba(255, 215, 0, 0.1);
        border: 2px solid rgba(255, 215, 0, 0.3);
        border-radius: 10px;
        padding: 1rem;
        margin: 1rem 0;
        animation: hint-pulse 3s infinite;
      }

      @keyframes hint-pulse {
        0%,
        100% {
          border-color: rgba(255, 215, 0, 0.3);
        }
        50% {
          border-color: rgba(255, 215, 0, 0.6);
        }
      }

      .word-suggestion {
        display: inline-block;
        background: rgba(135, 206, 235, 0.2);
        color: #87ceeb;
        padding: 5px 10px;
        margin: 3px;
        border-radius: 15px;
        font-size: 0.9rem;
        border: 1px solid rgba(135, 206, 235, 0.3);
      }

      kbd {
        background-color: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 4px;
        padding: 2px 6px;
        font-size: 0.8rem;
        font-family: monospace;
        color: #ffd700;
      }

      .letter-tile {
        display: inline-block;
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.2),
          rgba(255, 255, 255, 0.1)
        );
        border: 2px solid rgba(255, 215, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin: 5px;
        font-size: 2rem;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .letter-tile:hover {
        transform: scale(1.1);
        border-color: #ffd700;
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
      }

      .feedback-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px 40px;
        border-radius: 15px;
        font-size: 1.2rem;
        z-index: 1001;
        animation: fade-in-out 2s ease;
      }

      @keyframes fade-in-out {
        0%,
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        20%,
        80% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      .letter-selection-screen {
        display: none;
      }

      .choice-buttons {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin: 2rem 0;
      }

      .vowel-btn,
      .consonant-btn {
        padding: 20px 40px;
        font-size: 1.5rem;
        font-weight: bold;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
      }

      .vowel-btn {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        color: white;
      }

      .consonant-btn {
        background: linear-gradient(45deg, #3498db, #2980b9);
        color: white;
      }

      .vowel-btn:hover,
      .consonant-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .vowel-btn:disabled,
      .consonant-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .letter-selection-display {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
      }

      .selected-letters {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 1rem 0;
        flex-wrap: wrap;
      }

      .selected-letter {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.1)
        );
        border: 3px solid #ffd700;
        border-radius: 10px;
        padding: 15px;
        font-size: 2rem;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        min-width: 60px;
        text-align: center;
        animation: letter-appear 0.5s ease;
      }

      @keyframes letter-appear {
        0% {
          transform: scale(0) rotate(180deg);
          opacity: 0;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .countdown-info {
        text-align: center;
        margin: 2rem 0;
      }

      .current-player {
        font-size: 1.8rem;
        color: #ffd700;
        font-weight: bold;
        margin-bottom: 1rem;
      }

      .letters-remaining {
        font-size: 1.2rem;
        color: #87ceeb;
        margin-bottom: 1rem;
      }

      .individual-play-screen {
        display: none;
      }

      .player-turn-indicator {
        background: rgba(255, 215, 0, 0.2);
        border: 2px solid #ffd700;
        border-radius: 15px;
        padding: 1rem;
        margin: 1rem 0;
        text-align: center;
      }

      .word-input-section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
      }

      .word-submit-area {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin: 1rem 0;
      }

      .countdown-word-input {
        padding: 15px 20px;
        font-size: 1.4rem;
        border: 3px solid rgba(255, 215, 0, 0.5);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-align: center;
        min-width: 300px;
        text-transform: uppercase;
        font-weight: bold;
      }

      .countdown-word-input:focus {
        border-color: #ffd700;
        outline: none;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
      }

      .reveal-screen {
        display: none;
      }

      .word-reveal {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
      }

      .player-word {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 1.5rem;
        margin: 1rem 0;
        border-left: 5px solid #ffd700;
      }

      .word-display {
        font-size: 2rem;
        font-weight: bold;
        color: #ffd700;
        margin-bottom: 0.5rem;
      }

      .word-points {
        font-size: 1.2rem;
        color: #87ceeb;
      }

      .invalid-word {
        border-left-color: #e74c3c;
      }

      .invalid-word .word-display {
        color: #e74c3c;
      }

      .instructions {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
        text-align: left;
        line-height: 1.8;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
      }

      .instructions h2 {
        color: #ffd700;
        text-align: center;
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }

      .instructions h3 {
        color: #87ceeb;
        margin: 1.5rem 0 0.8rem 0;
        font-size: 1.3rem;
      }

      .instructions ul {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
      }

      .instructions li {
        margin-bottom: 0.5rem;
      }

      .example-box {
        background: rgba(255, 215, 0, 0.2);
        border-left: 4px solid #ffd700;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 5px;
      }

      .difficulty-levels {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        margin: 1.5rem 0;
      }

      .difficulty-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 1rem;
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }

      .difficulty-card:hover {
        border-color: #ffd700;
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .difficulty-card h4 {
        color: #ffd700;
        margin-bottom: 0.5rem;
      }

      .start-btn {
        background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 1.2rem;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 2rem;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
      }

      .start-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
      }

      .start-btn:active {
        transform: translateY(0);
      }

      .tips {
        background: rgba(135, 206, 235, 0.2);
        border-left: 4px solid #87ceeb;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 5px;
      }

      .highlight {
        color: #ffd700;
        font-weight: bold;
      }

      .game-screen {
        display: none;
      }

      .letters-display {
        font-size: 3rem;
        font-weight: bold;
        color: #ffd700;
        margin: 2rem 0;
        letter-spacing: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .timer {
        font-size: 4rem;
        color: #ff6b6b;
        margin: 1rem 0;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .word-input {
        padding: 15px;
        font-size: 1.2rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-align: center;
        width: 300px;
        margin: 1rem;
      }

      .word-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .submit-btn,
      .back-btn {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        border: none;
        padding: 10px 25px;
        font-size: 1rem;
        border-radius: 25px;
        cursor: pointer;
        margin: 0 10px;
        transition: all 0.3s ease;
      }

      .back-btn {
        background: linear-gradient(45deg, #757575, #616161);
      }

      .submit-btn:hover,
      .back-btn:hover {
        transform: translateY(-2px);
      }

      .word-list {
        max-height: 200px;
        overflow-y: auto;
        margin: 1rem 0;
        text-align: left;
      }

      .word-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 5px 10px;
        margin: 5px 0;
        border-radius: 5px;
        border-left: 3px solid #4caf50;
      }

      .score {
        font-size: 1.5rem;
        margin: 1rem 0;
        color: #ffd700;
      }

      /* Accessibility Styles */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      /* Focus visible styles for keyboard navigation */
      button:focus-visible,
      input:focus-visible,
      select:focus-visible,
      .letter-tile:focus-visible {
        outline: 3px solid #4caf50;
        outline-offset: 3px;
        box-shadow: 0 0 0 6px rgba(76, 175, 80, 0.3);
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container" role="main">
      <button
        class="sound-toggle"
        onclick="toggleSound()"
        title="Toggle Sound Effects"
        aria-label="Toggle sound effects on or off"
        aria-pressed="true"
      >
        🔊
      </button>

      <!-- Team Setup Screen -->
      <div
        id="team-setup-screen"
        class="team-setup-screen"
        role="region"
        aria-label="Team Setup"
      >
        <h1>⚔️ ESL Team Countdown Championship</h1>

        <div class="instructions">
          <h2>🏆 Countdown Championship Setup</h2>
          <p>
            Experience the authentic Countdown TV show! Players take turns
            choosing vowels and consonants to build 9 letters, then compete
            individually to find the longest words!
          </p>

          <div class="setup-form">
            <div class="form-group">
              <label for="team1-name">Team 1 Name:</label>
              <input
                type="text"
                id="team1-name"
                class="form-input"
                placeholder="Enter Team 1 name"
                maxlength="20"
                aria-required="false"
              />
            </div>

            <div class="form-group">
              <label for="team2-name">Team 2 Name:</label>
              <input
                type="text"
                id="team2-name"
                class="form-input"
                placeholder="Enter Team 2 name"
                maxlength="20"
                aria-required="false"
              />
            </div>

            <div class="form-group">
              <label for="num-rounds">Number of Rounds:</label>
              <select
                id="num-rounds"
                class="form-input"
                aria-label="Select number of rounds"
              >
                <option value="3">3 Rounds (Quick Match)</option>
                <option value="5" selected>5 Rounds (Standard)</option>
                <option value="7">7 Rounds (Championship)</option>
                <option value="10">10 Rounds (Epic Battle)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="letter-type">Letter Generation:</label>
              <select
                id="letter-type"
                class="form-input"
                aria-label="Select letter generation type"
              >
                <option value="random" selected>Random Letters</option>
                <option value="vowel-heavy">
                  More Vowels (4 vowels, 5 consonants)
                </option>
                <option value="consonant-heavy">
                  More Consonants (2 vowels, 7 consonants)
                </option>
                <option value="balanced">
                  Balanced (3 vowels, 6 consonants)
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Game Options:</label>
              <div class="checkbox-group">
                <input type="checkbox" id="include-math" checked />
                <label for="include-math">Include Math Challenges</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="extended-time" />
                <label for="extended-time"
                  >Extended Time (45 seconds instead of 30)</label
                >
              </div>
            </div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 2rem">
          <button
            class="start-btn"
            onclick="startTeamGame()"
            style="
              font-size: 1.4rem;
              padding: 20px 50px;
              margin: 10px;
              animation: pulse-glow 2s infinite;
            "
          >
            🚀 START CHAMPIONSHIP!
          </button>
          <br />
          <button
            class="quick-start-btn"
            onclick="quickStart()"
            style="
              background: linear-gradient(45deg, #4caf50, #45a049);
              color: white;
              border: none;
              padding: 12px 30px;
              font-size: 1rem;
              border-radius: 25px;
              cursor: pointer;
              margin: 10px;
              transition: all 0.3s ease;
            "
          >
            ⚡ Quick Start (Default Settings)
          </button>
          <button class="back-btn" onclick="showInstructions()">
            📖 View Rules
          </button>
        </div>
      </div>

      <!-- Instructions Screen -->
      <div id="instructions-screen" style="display: none">
        <h1>🎯 ESL Team Countdown Rules</h1>

        <div class="instructions">
          <h2>📖 How to Play</h2>

          <h3>🎲 The Countdown Challenge</h3>
          <p>
            Just like the TV show! Players take turns choosing
            <span class="highlight">vowels or consonants</span> until you have
            <span class="highlight">9 letters</span>. Then both players work
            <span class="highlight">separately</span> for 30 seconds to find the
            longest word possible!
          </p>

          <div class="example-box">
            <strong>How it works:</strong> Player 1 chooses "Vowel" → gets E.
            Player 2 chooses "Consonant" → gets R. Continue until 9 letters are
            selected. Then both players secretly find words!
          </div>

          <h3>📋 Letter Selection Rules</h3>
          <ul>
            <li>
              <strong>Take turns choosing</strong> - alternate between players
            </li>
            <li>
              <strong>Must have at least 3 vowels and 4 consonants</strong>
            </li>
            <li>
              Choose "VOWEL" or "CONSONANT" - letters are randomly selected
            </li>
            <li>Continue until all 9 letters are chosen</li>
            <li>
              <strong>No going back</strong> - once chosen, letters are final
            </li>
          </ul>

          <h3>⏱️ Word Finding Rules</h3>
          <ul>
            <li><strong>30 seconds</strong> to find your best word</li>
            <li>Players work <strong>individually and secretly</strong></li>
            <li>Use only the 9 selected letters</li>
            <li>Each letter can only be used <strong>once</strong></li>
            <li>Words must be at least <strong>3 letters long</strong></li>
            <li><strong>Longest word wins the round!</strong></li>
            <li>Same length words = points for both players</li>
          </ul>

          <h3>🔢 Math Challenge Rules</h3>
          <ul>
            <li>Use 6 numbers and basic operations (+, -, ×, ÷)</li>
            <li>Try to reach the target number</li>
            <li>You can use each number only once</li>
            <li>You don't have to use all numbers</li>
            <li>Teams can choose to skip math rounds</li>
          </ul>

          <h3>🏆 Countdown Scoring</h3>
          <div class="difficulty-levels">
            <div class="difficulty-card">
              <h4>Letters Round</h4>
              <p>
                Longest word wins!<br />3-4 letters: 1pt<br />5-6 letters:
                2pts<br />7+ letters: 3pts<br />9-letter word: 18pts!
              </p>
            </div>
            <div class="difficulty-card">
              <h4>Math Challenge</h4>
              <p>
                Exact answer: 10pts<br />Within 5: 7pts<br />Within 10: 5pts
              </p>
            </div>
            <div class="difficulty-card">
              <h4>Championship</h4>
              <p>Best of multiple rounds wins the championship!</p>
            </div>
          </div>

          <div class="tips">
            <h3>💡 Countdown Strategy Tips</h3>
            <ul>
              <li>
                <strong>Letter Selection:</strong> Choose a good mix of vowels
                and consonants
              </li>
              <li>
                <strong>Common letters:</strong> E, A, R, I, O, T, N, S are very
                useful
              </li>
              <li>
                <strong>Word Finding:</strong> Look for common endings like
                -ING, -ED, -ER
              </li>
              <li>
                <strong>Start small:</strong> Find short words first, then build
                longer ones
              </li>
              <li>
                <strong>Use all letters:</strong> A 9-letter word gives maximum
                points!
              </li>
              <li><strong>Think quickly:</strong> You only have 30 seconds!</li>
            </ul>

            <div
              style="
                margin-top: 1rem;
                padding: 1rem;
                background: rgba(135, 206, 235, 0.1);
                border-radius: 8px;
              "
            >
              <h4 style="color: #87ceeb">⌨️ Keyboard Shortcuts:</h4>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 0.5rem;
                  font-size: 0.9rem;
                "
              >
                <div>• <kbd>Enter</kbd> - Submit math answer</div>
                <div>• <kbd>H</kbd> - Show/hide hints</div>
                <div>• <kbd>Space</kbd> - Quick start</div>
                <div>• <kbd>Esc</kbd> - End game early</div>
              </div>
            </div>
          </div>
        </div>

        <button class="start-btn" onclick="showTeamSetup()">
          ⚔️ Back to Team Setup
        </button>
      </div>

      <!-- Letter Selection Screen -->
      <div id="letter-selection-screen" class="letter-selection-screen">
        <div class="team-vs-display">
          <div class="team-box" id="selection-team1-box">
            <div class="team-name" id="selection-team1-display">Player 1</div>
            <div class="team-score" id="selection-team1-score">0</div>
          </div>
          <div class="vs-text">VS</div>
          <div class="team-box" id="selection-team2-box">
            <div class="team-name" id="selection-team2-display">Player 2</div>
            <div class="team-score" id="selection-team2-score">0</div>
          </div>
        </div>

        <div class="countdown-info">
          <div class="current-player" id="current-chooser">Player 1's Turn</div>
          <div class="letters-remaining" id="letters-remaining">
            Choose letter 1 of 9
          </div>
        </div>

        <div class="choice-buttons">
          <button
            class="vowel-btn"
            id="vowel-btn"
            onclick="chooseLetter('vowel')"
          >
            📢 VOWEL
          </button>
          <button
            class="consonant-btn"
            id="consonant-btn"
            onclick="chooseLetter('consonant')"
          >
            🔤 CONSONANT
          </button>
        </div>

        <div class="letter-selection-display">
          <h3 style="color: #ffd700; margin-bottom: 1rem">Selected Letters:</h3>
          <div class="selected-letters" id="selected-letters-display">
            <!-- Letters will appear here as they're chosen -->
          </div>

          <div style="margin-top: 1rem; color: #87ceeb">
            <span id="vowel-count">Vowels: 0</span> |
            <span id="consonant-count">Consonants: 0</span>
          </div>
        </div>
      </div>

      <!-- Individual Play Screen -->
      <div id="individual-play-screen" class="individual-play-screen">
        <div class="team-vs-display">
          <div class="team-box" id="play-team1-box">
            <div class="team-name" id="play-team1-display">Player 1</div>
            <div class="team-score" id="play-team1-score">0</div>
          </div>
          <div class="vs-text">VS</div>
          <div class="team-box" id="play-team2-box">
            <div class="team-name" id="play-team2-display">Player 2</div>
            <div class="team-score" id="play-team2-score">0</div>
          </div>
        </div>

        <div class="player-turn-indicator">
          <h2 id="current-player-indicator">
            Both Players: Find Your Best Word!
          </h2>
          <div class="timer" id="countdown-timer">30</div>
        </div>

        <div class="selected-letters" id="play-letters-display">
          <!-- Selected letters will be shown here -->
        </div>

        <div class="word-input-section">
          <h3 style="color: #ffd700; margin-bottom: 1rem">Enter Your Word:</h3>
          <div class="word-submit-area">
            <input
              type="text"
              class="countdown-word-input"
              id="player-word-input"
              placeholder="TYPE YOUR WORD HERE"
              maxlength="9"
            />
            <button class="submit-btn" onclick="submitPlayerWord()">
              Submit Word
            </button>
          </div>
          <div style="color: #87ceeb; margin-top: 1rem; text-align: center">
            💡 Tip: Longer words score more points! A 9-letter word = 18 points!
          </div>
        </div>
      </div>

      <!-- Word Reveal Screen -->
      <div id="reveal-screen" class="reveal-screen">
        <h1>🎯 Word Reveal!</h1>

        <div class="selected-letters" id="reveal-letters-display">
          <!-- Letters will be shown here -->
        </div>

        <div class="word-reveal">
          <div class="player-word" id="player1-word-reveal">
            <div class="word-display" id="player1-word-display">TESTING</div>
            <div class="word-points" id="player1-word-points">
              7 letters - 3 points
            </div>
          </div>

          <div class="player-word" id="player2-word-reveal">
            <div class="word-display" id="player2-word-display">TEST</div>
            <div class="word-points" id="player2-word-points">
              4 letters - 1 point
            </div>
          </div>
        </div>

        <div id="round-winner-announcement" class="score"></div>

        <button class="start-btn" onclick="nextCountdownRound()">
          Next Round
        </button>
        <button class="back-btn" onclick="endGameEarly()">End Game</button>
      </div>

      <!-- Game Screen -->
      <div
        id="game-screen"
        class="game-screen"
        role="region"
        aria-label="Game Play Area"
      >
        <div class="team-vs-display" role="region" aria-label="Team Scoreboard">
          <div class="team-box" id="team1-box">
            <div class="team-name" id="team1-display">Team 1</div>
            <div
              class="team-score"
              id="team1-score"
              aria-live="polite"
              aria-label="Team 1 score"
            >
              0
            </div>
          </div>
          <div class="vs-text" aria-hidden="true">VS</div>
          <div class="team-box" id="team2-box">
            <div class="team-name" id="team2-display">Team 2</div>
            <div
              class="team-score"
              id="team2-score"
              aria-live="polite"
              aria-label="Team 2 score"
            >
              0
            </div>
          </div>
        </div>

        <div class="round-info" role="status" aria-live="polite">
          <div>
            <strong
              >Round <span id="current-round">1</span> of
              <span id="total-rounds">5</span></strong
            >
          </div>
          <div>
            <strong>Both Teams Playing Together</strong>
          </div>
          <div><strong>Letters Challenge</strong></div>
        </div>

        <div
          class="progress-bar"
          role="progressbar"
          aria-valuenow="20"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-label="Round progress"
        >
          <div
            class="progress-fill"
            id="round-progress"
            style="width: 20%"
          ></div>
        </div>

        <h1>🔤 Both Teams: Find Words Together!</h1>
        <div class="timer" id="timer" aria-live="assertive" aria-atomic="true">
          30
        </div>
        <div
          class="letters-display"
          id="letters-container"
          role="list"
          aria-label="Available letters"
        >
          <!-- Letters will be populated as individual tiles -->
        </div>

        <div
          style="
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
          "
        >
          <h2 style="color: #ffd700; margin-bottom: 1rem">📝 Instructions</h2>
          <p style="font-size: 1.2rem; line-height: 1.6">
            Both teams work together! Look at the letters above and find as many
            English words as possible. Remember the words you find - you'll
            enter them all when the timer ends!
          </p>
          <div
            style="
              margin-top: 1rem;
              padding: 1rem;
              background: rgba(255, 215, 0, 0.2);
              border-radius: 10px;
            "
          >
            <strong style="color: #ffd700">Rules:</strong> Use only these
            letters • Each letter used once per word • Minimum 3 letters •
            English words only
          </div>

          <div id="hint-container" class="hint-box" style="display: none">
            <h4 style="color: #ffd700; margin-bottom: 0.5rem">💡 Hints:</h4>
            <div id="word-hints"></div>
            <button
              onclick="toggleHints()"
              style="
                background: rgba(255, 255, 255, 0.2);
                border: 1px solid #ffd700;
                color: #ffd700;
                padding: 5px 15px;
                border-radius: 15px;
                cursor: pointer;
                margin-top: 10px;
              "
            >
              Hide Hints
            </button>
          </div>

          <button
            onclick="showHints()"
            id="show-hints-btn"
            style="
              background: rgba(255, 215, 0, 0.2);
              border: 1px solid #ffd700;
              color: #ffd700;
              padding: 8px 20px;
              border-radius: 20px;
              cursor: pointer;
              margin-top: 15px;
            "
          >
            💡 Show Hints
          </button>
        </div>

        <button class="back-btn" onclick="endGameEarly()">
          End Game Early
        </button>
      </div>

      <!-- Math Challenge Screen -->
      <div id="math-screen" class="math-challenge-screen">
        <div class="team-vs-display">
          <div class="team-box" id="math-team1-box">
            <div class="team-name" id="math-team1-display">Team 1</div>
            <div class="team-score" id="math-team1-score">0</div>
          </div>
          <div class="vs-text">VS</div>
          <div class="team-box" id="math-team2-box">
            <div class="team-name" id="math-team2-display">Team 2</div>
            <div class="team-score" id="math-team2-score">0</div>
          </div>
        </div>

        <div class="round-info">
          <div>
            <strong
              >Round <span id="math-current-round">1</span> of
              <span id="math-total-rounds">5</span></strong
            >
          </div>
          <div>
            <strong
              ><span id="math-current-team-turn">Team 1</span>'s Turn</strong
            >
          </div>
          <div><strong>Math Challenge</strong></div>
        </div>

        <h1>🔢 Numbers Challenge!</h1>
        <div class="timer" id="math-timer">60</div>
        <div class="math-problem">
          Target: <span id="target-number">573</span>
        </div>

        <div class="number-tiles" id="number-tiles">
          <div class="number-tile">25</div>
          <div class="number-tile">50</div>
          <div class="number-tile">75</div>
          <div class="number-tile">100</div>
          <div class="number-tile">3</div>
          <div class="number-tile">6</div>
        </div>

        <input
          type="text"
          class="word-input"
          id="math-input"
          placeholder="Enter your calculation (e.g., 25 + 50 * 3)"
          style="width: 400px"
        />
        <br />
        <button class="submit-btn" onclick="submitMathAnswer()">
          Submit Answer
        </button>
        <button class="skip-btn" onclick="skipMathChallenge()">
          Skip Math Challenge
        </button>

        <div id="math-result" class="score"></div>
      </div>

      <!-- Word Entry Screen -->
      <div id="word-entry-screen" style="display: none">
        <h1>⏰ Round Complete! Enter All Words Found</h1>

        <div class="team-vs-display">
          <div class="team-box">
            <div class="team-name" id="entry-team1-name">Team 1</div>
            <div class="team-score" id="entry-team1-score">0</div>
          </div>
          <div class="vs-text">BOTH</div>
          <div class="team-box">
            <div class="team-name" id="entry-team2-name">Team 2</div>
            <div class="team-score" id="entry-team2-score">0</div>
          </div>
        </div>

        <div class="round-info">
          <div>
            <strong
              >Round <span id="entry-current-round">1</span> of
              <span id="entry-total-rounds">5</span></strong
            >
          </div>
          <div>
            <strong>Letters were: <span id="entry-letters"></span></strong>
          </div>
        </div>

        <div
          style="
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
          "
        >
          <h3 style="color: #ffd700; margin-bottom: 1rem">
            📝 Now Enter ALL Words You Found!
          </h3>
          <p style="color: #87ceeb; font-size: 1.1rem">
            Time to reveal your vocabulary skills! Enter every word you
            discovered during the countdown. Both teams should list all words
            they found, separated by commas or new lines.
          </p>
        </div>

        <div
          style="
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
          "
        >
          <h3 style="color: #ffd700; margin-bottom: 1rem">
            📝 Now Enter ALL Words You Found!
          </h3>
          <p style="color: #87ceeb; font-size: 1.1rem">
            Time to reveal your vocabulary skills! Enter every word you
            discovered during the countdown. Both teams should list all words
            they found, separated by commas or new lines.
          </p>
        </div>

        <div
          style="
            display: flex;
            justify-content: space-between;
            gap: 2rem;
            margin: 2rem 0;
          "
        >
          <div
            style="
              flex: 1;
              background: rgba(255, 255, 255, 0.1);
              padding: 1.5rem;
              border-radius: 15px;
            "
          >
            <h3 style="color: #ffd700; margin-bottom: 1rem">
              <span id="word-entry-team1-name">Team 1</span> - Enter Your Words:
            </h3>
            <textarea
              id="team1-words"
              placeholder="Enter all words you found, separated by commas or new lines..."
              style="
                width: 100%;
                height: 150px;
                padding: 10px;
                border-radius: 8px;
                border: 2px solid rgba(255, 255, 255, 0.3);
                background: rgba(255, 255, 255, 0.1);
                color: white;
                font-size: 1rem;
                resize: vertical;
              "
            ></textarea>
            <div
              id="team1-word-count"
              style="margin-top: 0.5rem; color: #87ceeb"
            >
              Words found: 0
            </div>
          </div>

          <div
            style="
              flex: 1;
              background: rgba(255, 255, 255, 0.1);
              padding: 1.5rem;
              border-radius: 15px;
            "
          >
            <h3 style="color: #ffd700; margin-bottom: 1rem">
              <span id="word-entry-team2-name">Team 2</span> - Enter Your Words:
            </h3>
            <textarea
              id="team2-words"
              placeholder="Enter all words you found, separated by commas or new lines..."
              style="
                width: 100%;
                height: 150px;
                padding: 10px;
                border-radius: 8px;
                border: 2px solid rgba(255, 255, 255, 0.3);
                background: rgba(255, 255, 255, 0.1);
                color: white;
                font-size: 1rem;
                resize: vertical;
              "
            ></textarea>
            <div
              id="team2-word-count"
              style="margin-top: 0.5rem; color: #87ceeb"
            >
              Words found: 0
            </div>
          </div>
        </div>

        <button class="start-btn" onclick="processTeamWords()">
          ✅ Process Words & Continue
        </button>
        <button class="back-btn" onclick="skipWordEntry()">
          ⏭️ Skip Word Entry
        </button>
      </div>

      <!-- Round Results Screen -->
      <div id="round-results-screen" style="display: none">
        <h1>� Round <span id="round-result-number">1</span> Complete!</h1>
        <div class="team-vs-display">
          <div class="team-box">
            <div class="team-name" id="round-team1-name">Team 1</div>
            <div class="team-score">
              <span id="round-team1-points">5</span> points this round
            </div>
            <div style="font-size: 1rem; opacity: 0.8">
              Total: <span id="round-team1-total">15</span>
            </div>
          </div>
          <div class="vs-text">VS</div>
          <div class="team-box">
            <div class="team-name" id="round-team2-name">Team 2</div>
            <div class="team-score">
              <span id="round-team2-points">7</span> points this round
            </div>
            <div style="font-size: 1rem; opacity: 0.8">
              Total: <span id="round-team2-total">12</span>
            </div>
          </div>
        </div>
        <div id="round-winner-message" class="score"></div>
        <button class="start-btn" onclick="nextRound()">Next Round</button>
      </div>

      <!-- Final Results Screen -->
      <div id="results-screen" style="display: none">
        <h1>🏆 Championship Complete!</h1>
        <div class="team-vs-display">
          <div class="team-box" id="final-winner-box">
            <div class="team-name" id="final-team1-name">Team 1</div>
            <div class="team-score" id="final-team1-score">45</div>
            <div style="font-size: 1rem">🏆 CHAMPIONS! 🏆</div>
          </div>
          <div class="vs-text">FINAL</div>
          <div class="team-box">
            <div class="team-name" id="final-team2-name">Team 2</div>
            <div class="team-score" id="final-team2-score">38</div>
            <div style="font-size: 1rem">Great effort!</div>
          </div>
        </div>
        <div id="final-message" class="score"></div>
        <div id="round-breakdown"></div>
        <button class="start-btn" onclick="playAgain()">
          New Championship
        </button>
        <button class="back-btn" onclick="showTeamSetup()">
          Back to Setup
        </button>
      </div>

      <div class="celebration" id="celebration"></div>
    </div>

    <script>
      let gameState = {
        team1: { name: "Player 1", score: 0, roundScores: [], bestStreak: 0 },
        team2: { name: "Player 2", score: 0, roundScores: [], bestStreak: 0 },
        currentTeam: 1,
        currentRound: 1,
        totalRounds: 5,
        includeMath: true,
        extendedTime: false,
        roundType: "letters", // "letters" or "math"
        letters: [],
        selectedLetters: [],
        vowelCount: 0,
        consonantCount: 0,
        lettersToSelect: 9,
        currentSelector: 1, // who's choosing letters
        timeLeft: 30,
        roundScore: 0,
        wordsFound: [],
        timer: null,
        mathTarget: 0,
        mathNumbers: [],
        gamePhase: "setup", // "setup", "selecting", "playing", "revealing", "round-results", "final-results"
        soundEnabled: true,
        hintsShown: false,
        player1Word: "",
        player2Word: "",
        bothWordsSubmitted: false,
      };

      // Load stats from localStorage
      function loadStats() {
        try {
          const saved = localStorage.getItem("quizChampStats");
          if (saved) {
            const stats = JSON.parse(saved);
            if (stats.team1BestStreak)
              gameState.team1.bestStreak = stats.team1BestStreak;
            if (stats.team2BestStreak)
              gameState.team2.bestStreak = stats.team2BestStreak;
          }
        } catch (e) {
          console.warn("Could not load stats", e);
        }
      }

      // Save stats to localStorage
      function saveStats() {
        try {
          const stats = {
            team1BestStreak: gameState.team1.bestStreak,
            team2BestStreak: gameState.team2.bestStreak,
            lastPlayed: new Date().toISOString(),
          };
          localStorage.setItem("quizChampStats", JSON.stringify(stats));
        } catch (e) {
          console.warn("Could not save stats", e);
        }
      }

      // Enhanced sound effects
      const sounds = {
        tick: () => gameState.soundEnabled && playBeep(800, 100),
        success: () => gameState.soundEnabled && playSuccessSound(),
        error: () => gameState.soundEnabled && playErrorSound(),
        warning: () => gameState.soundEnabled && playBeep(400, 300),
        victory: () => gameState.soundEnabled && playVictorySound(),
      };

      function playSuccessSound() {
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
          oscillator.frequency.setValueAtTime(
            659.25,
            audioContext.currentTime + 0.1
          );
          oscillator.frequency.setValueAtTime(
            783.99,
            audioContext.currentTime + 0.2
          );

          oscillator.type = "sine";
          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.3
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.3);
        } catch (e) {}
      }

      function playErrorSound() {
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
          oscillator.frequency.setValueAtTime(
            196,
            audioContext.currentTime + 0.1
          );

          oscillator.type = "sine";
          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.2
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.2);
        } catch (e) {}
      }

      function playBeep(frequency, duration) {
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = "sine";

          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + duration / 1000
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration / 1000);
        } catch (e) {
          console.log("Audio not supported");
        }
      }

      function playVictorySound() {
        const notes = [523, 659, 784, 1047];
        notes.forEach((note, i) => {
          setTimeout(() => playBeep(note, 200), i * 150);
        });
      }

      function toggleSound() {
        gameState.soundEnabled = !gameState.soundEnabled;
        const btn = document.querySelector(".sound-toggle");
        btn.textContent = gameState.soundEnabled ? "🔊" : "🔇";
        btn.title = gameState.soundEnabled
          ? "Disable Sound Effects"
          : "Enable Sound Effects";
      }

      function quickStart() {
        // Set default values and start immediately
        document.getElementById("team1-name").value = "Player 1";
        document.getElementById("team2-name").value = "Player 2";
        document.getElementById("num-rounds").value = "5";
        document.getElementById("include-math").checked = true;
        document.getElementById("extended-time").checked = false;
        document.getElementById("letter-type").value = "balanced";

        sounds.success();
        setTimeout(() => startTeamGame(), 500);
      }

      const consonants = "BCDFGHJKLMNPQRSTVWXYZ";
      const vowels = "AEIOU";
      const largeNumbers = [25, 50, 75, 100];
      const smallNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

      // Word facts database
      const wordFacts = {
        HELLO:
          "The word 'hello' was first used as a greeting in 1827, popularized by telephone inventor Alexander Graham Bell.",
        WATER:
          "Water is the only substance that naturally exists in all three states of matter on Earth: solid, liquid, and gas.",
        HEART:
          "The human heart beats about 100,000 times per day, pumping about 2,000 gallons of blood.",
        COMPUTER:
          "The first computer bug was an actual bug - a moth found stuck in a relay in 1947 by Grace Hopper.",
        MUSIC:
          "Music activates more areas of the brain than any other human activity, including both hemispheres simultaneously.",
        FRIEND:
          "The word 'friend' comes from the Old English 'freond,' meaning 'to love' or 'to be fond of.'",
        LIGHT:
          "Light travels at approximately 186,282 miles per second - nothing in the universe travels faster.",
        OCEAN:
          "We have explored less than 5% of our oceans, making them more mysterious than outer space.",
        DREAM:
          "Everyone dreams, but we forget about 95% of our dreams within 5 minutes of waking up.",
        RAINBOW:
          "A rainbow is actually a complete circle, but we usually only see half due to the ground blocking our view.",
        BUTTERFLY:
          "Butterflies taste with their feet and smell with their antennae.",
        ELEPHANT:
          "Elephants are one of the few animals that can recognize themselves in a mirror.",
        CHOCOLATE:
          "Chocolate was once used as currency by the Aztecs and was more valuable than gold.",
        PIZZA:
          "Pizza was originally a flatbread topped with oil, garlic, and salt, served to poor people in Naples.",
        GUITAR:
          "The guitar has ancient origins, with early versions dating back over 4,000 years.",
        CASTLE:
          "Medieval castles were often built on hills for better defense and to show the lord's power.",
        DRAGON:
          "Dragons appear in mythologies around the world, often symbolizing power, wisdom, or chaos.",
        FOREST:
          "Forests produce about 28% of the oxygen on Earth, with ocean plants producing the rest.",
        MAGIC:
          "The word 'magic' comes from the ancient Persian word 'magus,' meaning 'wise person.'",
        PLANET:
          "The word 'planet' comes from the Greek word 'planetes,' meaning 'wanderer.'",
      };

      function generateLetters(letterType = "balanced") {
        const letters = [];
        let vowelCount = 3;
        let consonantCount = 6;

        switch (letterType) {
          case "vowel-heavy":
            vowelCount = 4;
            consonantCount = 5;
            break;
          case "consonant-heavy":
            vowelCount = 2;
            consonantCount = 7;
            break;
          case "random":
            vowelCount = Math.floor(Math.random() * 4) + 2; // 2-5 vowels
            consonantCount = 9 - vowelCount;
            break;
          case "balanced":
          default:
            vowelCount = 3;
            consonantCount = 6;
            break;
        }

        // Add vowels
        for (let i = 0; i < vowelCount; i++) {
          letters.push(vowels[Math.floor(Math.random() * vowels.length)]);
        }
        // Add consonants
        for (let i = 0; i < consonantCount; i++) {
          letters.push(
            consonants[Math.floor(Math.random() * consonants.length)]
          );
        }
        // Shuffle the array
        return letters.sort(() => Math.random() - 0.5);
      }

      function generateMathChallenge() {
        const numbers = [];
        // Add 2 large numbers
        for (let i = 0; i < 2; i++) {
          numbers.push(
            largeNumbers[Math.floor(Math.random() * largeNumbers.length)]
          );
        }
        // Add 4 small numbers
        for (let i = 0; i < 4; i++) {
          numbers.push(
            smallNumbers[Math.floor(Math.random() * smallNumbers.length)]
          );
        }

        const target = Math.floor(Math.random() * 900) + 100; // Target between 100-999

        return { numbers: numbers.sort(() => Math.random() - 0.5), target };
      }

      function showTeamSetup() {
        hideAllScreens();
        document.getElementById("team-setup-screen").style.display = "block";
        document.getElementById("team1-name").focus();
      }

      function showInstructions() {
        hideAllScreens();
        document.getElementById("instructions-screen").style.display = "block";
      }

      function hideAllScreens() {
        const screens = [
          "team-setup-screen",
          "instructions-screen",
          "letter-selection-screen",
          "individual-play-screen",
          "reveal-screen",
          "game-screen",
          "math-screen",
          "word-entry-screen",
          "round-results-screen",
          "results-screen",
        ];
        screens.forEach((screen) => {
          document.getElementById(screen).style.display = "none";
        });
      }

      function startTeamGame() {
        // Get team names
        const team1Name =
          document.getElementById("team1-name").value.trim() || "Team 1";
        const team2Name =
          document.getElementById("team2-name").value.trim() || "Team 2";
        const numRounds = parseInt(document.getElementById("num-rounds").value);
        const includeMath = document.getElementById("include-math").checked;
        const extendedTime = document.getElementById("extended-time").checked;
        const letterType = document.getElementById("letter-type").value;

        // Initialize game state
        gameState = {
          team1: { name: team1Name, score: 0, roundScores: [], roundWords: [] },
          team2: { name: team2Name, score: 0, roundScores: [], roundWords: [] },
          currentTeam: 1,
          currentRound: 1,
          totalRounds: numRounds,
          includeMath: includeMath,
          extendedTime: extendedTime,
          letterType: letterType,
          roundType: "letters",
          letters: [],
          timeLeft: extendedTime ? 45 : 30,
          roundScore: 0,
          wordsFound: [],
          timer: null,
          mathTarget: 0,
          mathNumbers: [],
          gamePhase: "playing",
        };

        startRound();
      }

      function startRound() {
        // Determine round type (alternate between letters and math if math is enabled)
        if (gameState.includeMath && gameState.currentRound % 2 === 0) {
          startMathRound();
        } else {
          startLetterSelection();
        }
      }

      function startLetterSelection() {
        gameState.roundType = "letters";
        gameState.selectedLetters = [];
        gameState.vowelCount = 0;
        gameState.consonantCount = 0;
        gameState.currentSelector = 1;
        gameState.gamePhase = "selecting";
        gameState.player1Word = "";
        gameState.player2Word = "";
        gameState.bothWordsSubmitted = false;

        hideAllScreens();
        document.getElementById("letter-selection-screen").style.display =
          "block";

        updateSelectionDisplay();
        updateLetterCounts();
        updateCurrentChooser();

        sounds.success();
      }

      function chooseLetter(type) {
        if (gameState.selectedLetters.length >= 9) return;

        // Check constraints
        if (type === "vowel" && gameState.vowelCount >= 5) {
          showFeedback("Maximum 5 vowels allowed!", "warning");
          return;
        }
        if (type === "consonant" && gameState.consonantCount >= 6) {
          showFeedback("Maximum 6 consonants allowed!", "warning");
          return;
        }

        // Must have at least 3 vowels and 3 consonants
        const remaining = 9 - gameState.selectedLetters.length;
        if (
          type === "vowel" &&
          gameState.consonantCount < 3 &&
          remaining - 1 < 3 - gameState.consonantCount
        ) {
          showFeedback("Must have at least 3 consonants!", "warning");
          return;
        }
        if (
          type === "consonant" &&
          gameState.vowelCount < 3 &&
          remaining - 1 < 3 - gameState.vowelCount
        ) {
          showFeedback("Must have at least 3 vowels!", "warning");
          return;
        }

        // Select random letter of chosen type
        let letter;
        if (type === "vowel") {
          letter = vowels[Math.floor(Math.random() * vowels.length)];
          gameState.vowelCount++;
        } else {
          letter = consonants[Math.floor(Math.random() * consonants.length)];
          gameState.consonantCount++;
        }

        gameState.selectedLetters.push(letter);
        sounds.tick();

        // Update display
        updateSelectionDisplay();
        updateLetterCounts();

        // Check if we're done selecting
        if (gameState.selectedLetters.length >= 9) {
          setTimeout(() => {
            showFeedback(
              "Letter selection complete! Get ready to find words!",
              "success"
            );
            setTimeout(startIndividualPlay, 1500);
          }, 500);
        } else {
          // Switch to next player
          gameState.currentSelector = gameState.currentSelector === 1 ? 2 : 1;
          updateCurrentChooser();
        }
      }

      function updateSelectionDisplay() {
        // Update team displays
        document.getElementById("selection-team1-display").textContent =
          gameState.team1.name;
        document.getElementById("selection-team1-score").textContent =
          gameState.team1.score;
        document.getElementById("selection-team2-display").textContent =
          gameState.team2.name;
        document.getElementById("selection-team2-score").textContent =
          gameState.team2.score;

        // Show selected letters
        const lettersDisplay = document.getElementById(
          "selected-letters-display"
        );
        lettersDisplay.innerHTML = "";

        gameState.selectedLetters.forEach((letter, index) => {
          const letterElement = document.createElement("div");
          letterElement.className = "selected-letter";
          letterElement.textContent = letter;
          letterElement.style.animationDelay = `${index * 0.1}s`;
          lettersDisplay.appendChild(letterElement);
        });

        // Add placeholders for remaining letters
        for (let i = gameState.selectedLetters.length; i < 9; i++) {
          const placeholder = document.createElement("div");
          placeholder.className = "selected-letter";
          placeholder.style.opacity = "0.3";
          placeholder.style.border = "3px dashed rgba(255, 215, 0, 0.5)";
          placeholder.textContent = "?";
          lettersDisplay.appendChild(placeholder);
        }
      }

      function updateLetterCounts() {
        document.getElementById(
          "vowel-count"
        ).textContent = `Vowels: ${gameState.vowelCount}`;
        document.getElementById(
          "consonant-count"
        ).textContent = `Consonants: ${gameState.consonantCount}`;

        // Update button states
        const vowelBtn = document.getElementById("vowel-btn");
        const consonantBtn = document.getElementById("consonant-btn");

        vowelBtn.disabled = gameState.vowelCount >= 5;
        consonantBtn.disabled = gameState.consonantCount >= 6;

        // Check constraints for minimum letters
        const remaining = 9 - gameState.selectedLetters.length;
        if (
          gameState.consonantCount < 3 &&
          remaining === 3 - gameState.consonantCount
        ) {
          vowelBtn.disabled = true;
        }
        if (
          gameState.vowelCount < 3 &&
          remaining === 3 - gameState.vowelCount
        ) {
          consonantBtn.disabled = true;
        }
      }

      function updateCurrentChooser() {
        const currentChooser = document.getElementById("current-chooser");
        const lettersRemaining = document.getElementById("letters-remaining");

        const playerName =
          gameState.currentSelector === 1
            ? gameState.team1.name
            : gameState.team2.name;
        currentChooser.textContent = `${playerName}'s Turn`;
        lettersRemaining.textContent = `Choose letter ${
          gameState.selectedLetters.length + 1
        } of 9`;

        // Highlight current player
        document
          .getElementById("selection-team1-box")
          .classList.toggle("active", gameState.currentSelector === 1);
        document
          .getElementById("selection-team2-box")
          .classList.toggle("active", gameState.currentSelector === 2);
      }

      function startIndividualPlay() {
        gameState.gamePhase = "playing";
        gameState.timeLeft = 30;

        hideAllScreens();
        document.getElementById("individual-play-screen").style.display =
          "block";

        // Update displays
        document.getElementById("play-team1-display").textContent =
          gameState.team1.name;
        document.getElementById("play-team1-score").textContent =
          gameState.team1.score;
        document.getElementById("play-team2-display").textContent =
          gameState.team2.name;
        document.getElementById("play-team2-score").textContent =
          gameState.team2.score;

        // Show letters
        const lettersDisplay = document.getElementById("play-letters-display");
        lettersDisplay.innerHTML = "";
        gameState.selectedLetters.forEach((letter) => {
          const letterElement = document.createElement("div");
          letterElement.className = "selected-letter";
          letterElement.textContent = letter;
          lettersDisplay.appendChild(letterElement);
        });

        // Clear input and focus
        document.getElementById("player-word-input").value = "";
        document.getElementById("player-word-input").focus();

        // Both players active
        document.getElementById("play-team1-box").classList.add("active");
        document.getElementById("play-team2-box").classList.add("active");

        startTimer("countdown-timer");
      }

      function submitPlayerWord() {
        const input = document.getElementById("player-word-input");
        const word = input.value.trim().toUpperCase();

        if (!word) {
          showFeedback("Please enter a word!", "warning");
          return;
        }

        if (word.length < 3) {
          showFeedback("Word must be at least 3 letters!", "warning");
          return;
        }

        if (!canMakeWord(word, gameState.selectedLetters)) {
          showFeedback(
            "Word cannot be made from the selected letters!",
            "error"
          );
          return;
        }

        // Store the word (in a real game, this would be hidden from the other player)
        if (!gameState.player1Word) {
          gameState.player1Word = word;
          showFeedback(
            `Word submitted! Continue playing until time runs out for team word entry...`,
            "success"
          );
          input.disabled = true;
        } else if (!gameState.player2Word) {
          gameState.player2Word = word;
          showFeedback(
            `Word submitted! Continue playing until time runs out for team word entry...`,
            "success"
          );
          input.disabled = true;
          gameState.bothWordsSubmitted = true;
        }
      }

      function revealWords() {
        // If only one word submitted when time runs out, use empty string for the other
        if (!gameState.player1Word) gameState.player1Word = "";
        if (!gameState.player2Word) gameState.player2Word = "";

        hideAllScreens();
        document.getElementById("reveal-screen").style.display = "block";

        // Show letters
        const lettersDisplay = document.getElementById(
          "reveal-letters-display"
        );
        lettersDisplay.innerHTML = "";
        gameState.selectedLetters.forEach((letter) => {
          const letterElement = document.createElement("div");
          letterElement.className = "selected-letter";
          letterElement.textContent = letter;
          lettersDisplay.appendChild(letterElement);
        });

        // Calculate scores and show words
        const player1Result = calculateWordScore(gameState.player1Word);
        const player2Result = calculateWordScore(gameState.player2Word);

        // Display Player 1 word
        const p1WordDisplay = document.getElementById("player1-word-display");
        const p1PointsDisplay = document.getElementById("player1-word-points");
        const p1WordElement = document.getElementById("player1-word-reveal");

        if (gameState.player1Word) {
          p1WordDisplay.textContent = gameState.player1Word;
          p1PointsDisplay.textContent = `${gameState.player1Word.length} letters - ${player1Result.points} points`;
          p1WordElement.classList.remove("invalid-word");
        } else {
          p1WordDisplay.textContent = "(No word submitted)";
          p1PointsDisplay.textContent = "0 points";
          p1WordElement.classList.add("invalid-word");
        }

        // Display Player 2 word
        const p2WordDisplay = document.getElementById("player2-word-display");
        const p2PointsDisplay = document.getElementById("player2-word-points");
        const p2WordElement = document.getElementById("player2-word-reveal");

        if (gameState.player2Word) {
          p2WordDisplay.textContent = gameState.player2Word;
          p2PointsDisplay.textContent = `${gameState.player2Word.length} letters - ${player2Result.points} points`;
          p2WordElement.classList.remove("invalid-word");
        } else {
          p2WordDisplay.textContent = "(No word submitted)";
          p2PointsDisplay.textContent = "0 points";
          p2WordElement.classList.add("invalid-word");
        }

        // Update scores
        gameState.team1.score += player1Result.points;
        gameState.team1.roundScores.push(player1Result.points);
        gameState.team2.score += player2Result.points;
        gameState.team2.roundScores.push(player2Result.points);

        // Save stats
        saveStats();

        // Announce winner
        const announcement = document.getElementById(
          "round-winner-announcement"
        );
        if (player1Result.points > player2Result.points) {
          announcement.innerHTML = `<h3>🏆 ${gameState.team1.name} wins this round!</h3>`;
          sounds.victory();
          announceToScreenReader(
            `${gameState.team1.name} wins this round with ${player1Result.points} points`
          );
        } else if (player2Result.points > player1Result.points) {
          announcement.innerHTML = `<h3>🏆 ${gameState.team2.name} wins this round!</h3>`;
          sounds.victory();
          announceToScreenReader(
            `${gameState.team2.name} wins this round with ${player2Result.points} points`
          );
        } else {
          announcement.innerHTML = `<h3>🤝 It's a tie this round!</h3>`;
          announceToScreenReader("It's a tie this round");
        }

        // Add word facts if available
        let factsHTML = "";
        if (gameState.player1Word && wordFacts[gameState.player1Word]) {
          factsHTML += `<div style="margin-top: 1rem; padding: 1rem; background: rgba(135, 206, 235, 0.2); border-radius: 10px;">`;
          factsHTML += `<strong>${gameState.player1Word}:</strong> ${
            wordFacts[gameState.player1Word]
          }</div>`;
        }
        if (gameState.player2Word && wordFacts[gameState.player2Word]) {
          factsHTML += `<div style="margin-top: 1rem; padding: 1rem; background: rgba(135, 206, 235, 0.2); border-radius: 10px;">`;
          factsHTML += `<strong>${gameState.player2Word}:</strong> ${
            wordFacts[gameState.player2Word]
          }</div>`;
        }

        if (factsHTML) {
          announcement.innerHTML += factsHTML;
        }
      }

      function calculateWordScore(word) {
        if (!word || word.length < 3) {
          return { points: 0, valid: false };
        }

        if (!canMakeWord(word, gameState.selectedLetters)) {
          return { points: 0, valid: false };
        }

        let points = 0;
        if (word.length === 9) {
          points = 18; // Bonus for using all letters
        } else if (word.length >= 7) {
          points = 3;
        } else if (word.length >= 5) {
          points = 2;
        } else {
          points = 1;
        }

        return { points, valid: true };
      }

      function nextCountdownRound() {
        gameState.currentRound++;

        if (gameState.currentRound > gameState.totalRounds) {
          showFinalResults();
        } else {
          startRound();
        }
      }

      function startLettersRound() {
        // Legacy function - redirects to new Countdown format
        startLetterSelection();
      }

      function startMathRound() {
        gameState.roundType = "math";
        const mathChallenge = generateMathChallenge();
        gameState.mathNumbers = mathChallenge.numbers;
        gameState.mathTarget = mathChallenge.target;
        gameState.timeLeft = 60; // Math rounds get more time
        gameState.roundScore = 0;

        hideAllScreens();
        document.getElementById("math-screen").style.display = "block";

        updateMathTeamDisplay();
        updateMathRoundInfo();

        document.getElementById("target-number").textContent =
          gameState.mathTarget;

        const tilesContainer = document.getElementById("number-tiles");
        tilesContainer.innerHTML = "";
        gameState.mathNumbers.forEach((num) => {
          const tile = document.createElement("div");
          tile.className = "number-tile";
          tile.textContent = num;
          tilesContainer.appendChild(tile);
        });

        document.getElementById("math-input").value = "";
        document.getElementById("math-result").textContent = "";
        document.getElementById("math-input").focus();

        startTimer("math-timer");
      }

      function updateTeamDisplay() {
        document.getElementById("team1-display").textContent =
          gameState.team1.name;
        document.getElementById("team1-score").textContent =
          gameState.team1.score;
        document.getElementById("team2-display").textContent =
          gameState.team2.name;
        document.getElementById("team2-score").textContent =
          gameState.team2.score;

        // Both teams are active for letters rounds
        if (gameState.roundType === "letters") {
          document.getElementById("team1-box").classList.add("active");
          document.getElementById("team2-box").classList.add("active");
        } else {
          // For math rounds, still highlight current team
          document
            .getElementById("team1-box")
            .classList.toggle("active", gameState.currentTeam === 1);
          document
            .getElementById("team2-box")
            .classList.toggle("active", gameState.currentTeam === 2);
        }
      }

      function updateMathTeamDisplay() {
        document.getElementById("math-team1-display").textContent =
          gameState.team1.name;
        document.getElementById("math-team1-score").textContent =
          gameState.team1.score;
        document.getElementById("math-team2-display").textContent =
          gameState.team2.name;
        document.getElementById("math-team2-score").textContent =
          gameState.team2.score;

        // Highlight current team
        document
          .getElementById("math-team1-box")
          .classList.toggle("active", gameState.currentTeam === 1);
        document
          .getElementById("math-team2-box")
          .classList.toggle("active", gameState.currentTeam === 2);
      }

      function updateRoundInfo() {
        document.getElementById("current-round").textContent =
          gameState.currentRound;
        document.getElementById("total-rounds").textContent =
          gameState.totalRounds;
        const currentTeam =
          gameState.currentTeam === 1
            ? gameState.team1.name
            : gameState.team2.name;
        document.getElementById("current-team-turn").textContent = currentTeam;
      }

      function updateMathRoundInfo() {
        document.getElementById("math-current-round").textContent =
          gameState.currentRound;
        document.getElementById("math-total-rounds").textContent =
          gameState.totalRounds;
        const currentTeam =
          gameState.currentTeam === 1
            ? gameState.team1.name
            : gameState.team2.name;
        document.getElementById("math-current-team-turn").textContent =
          currentTeam;
      }

      function startTimer(timerId) {
        const timerElement = document.getElementById(timerId);
        timerElement.textContent = gameState.timeLeft;
        timerElement.classList.remove("timer-critical");

        gameState.timer = setInterval(() => {
          gameState.timeLeft--;
          timerElement.textContent = gameState.timeLeft;

          if (gameState.timeLeft <= 10) {
            timerElement.classList.add("timer-critical");
            sounds.warning();
            if (gameState.timeLeft === 10) {
              announceToScreenReader("10 seconds remaining");
            }
          } else if (gameState.timeLeft <= 5) {
            sounds.tick();
            if (gameState.timeLeft === 5) {
              announceToScreenReader("5 seconds remaining");
            }
          }

          if (gameState.timeLeft <= 0) {
            endRound();
          }
        }, 1000);
      }

      function showHints() {
        if (!gameState.hintsShown) {
          const hints = generateHints(gameState.letters);
          const hintContainer = document.getElementById("hint-container");
          const wordHints = document.getElementById("word-hints");

          wordHints.innerHTML = hints
            .map((hint) => `<span class="word-suggestion">${hint}</span>`)
            .join("");

          hintContainer.style.display = "block";
          document.getElementById("show-hints-btn").style.display = "none";
          gameState.hintsShown = true;

          announceToScreenReader(
            `Hints shown. Suggested words: ${hints.join(", ")}`
          );
        }
      }

      function toggleHints() {
        const hintContainer = document.getElementById("hint-container");
        const showBtn = document.getElementById("show-hints-btn");

        if (hintContainer.style.display === "none") {
          hintContainer.style.display = "block";
          showBtn.style.display = "none";
        } else {
          hintContainer.style.display = "none";
          showBtn.style.display = "inline-block";
        }
      }

      function generateHints(letters) {
        const hints = [];
        const letterStr = letters.join("").toLowerCase();

        // Common 3-letter word patterns
        const patterns = [
          { pattern: /[aeiou]/, hint: "Look for words starting with vowels" },
          { pattern: /th/, hint: "Try 'TH' combinations" },
          { pattern: /er/, hint: "Look for 'ER' endings" },
          { pattern: /ing/, hint: "Check for 'ING' words" },
          { pattern: /[aeiou][nt]/, hint: "Try vowel + N or T" },
        ];

        // Check available letters for common words
        const commonWords = [
          "THE",
          "AND",
          "FOR",
          "ARE",
          "BUT",
          "NOT",
          "YOU",
          "ALL",
          "CAN",
          "HER",
          "WAS",
          "ONE",
          "OUR",
          "OUT",
          "HAD",
          "HAS",
          "HIS",
          "HOW",
          "MAN",
          "NEW",
          "NOW",
          "OLD",
          "SEE",
          "TWO",
          "WAY",
          "WHO",
          "BOY",
          "DID",
          "ITS",
          "LET",
          "PUT",
          "SAY",
          "SHE",
          "TOO",
          "USE",
        ];

        commonWords.forEach((word) => {
          if (canMakeWord(word, letters)) {
            hints.push(`Try "${word}"`);
          }
        });

        // Add pattern hints
        patterns.forEach((p) => {
          if (p.pattern.test(letterStr)) {
            hints.push(p.hint);
          }
        });

        return hints.slice(0, 5); // Limit to 5 hints
      }

      function updateProgress() {
        const progress = (gameState.currentRound / gameState.totalRounds) * 100;
        const progressBar = document.getElementById("round-progress");
        if (progressBar) {
          progressBar.style.width = progress + "%";
        }
      }

      function submitMathAnswer() {
        const input = document.getElementById("math-input");
        const expression = input.value.trim();

        if (!expression) {
          alert("Please enter a calculation!");
          return;
        }

        try {
          // Basic validation - only allow numbers and basic operators
          if (!/^[\d+\-*/() ]+$/.test(expression)) {
            throw new Error("Only use numbers and +, -, *, /, () operators");
          }

          const result = eval(expression);
          const target = gameState.mathTarget;
          const difference = Math.abs(result - target);

          let points = 0;
          let feedback = "";

          if (difference === 0) {
            points = 10;
            feedback = `🎯 PERFECT! You got exactly ${target}!`;
          } else if (difference <= 5) {
            points = 7;
            feedback = `🎊 Excellent! ${result} is within 5 of ${target}!`;
          } else if (difference <= 10) {
            points = 5;
            feedback = `👏 Good try! ${result} is within 10 of ${target}!`;
          } else {
            points = 0;
            feedback = `❌ ${result} is too far from ${target}. Try again!`;
          }

          gameState.roundScore += points;
          document.getElementById("math-result").innerHTML = `
            <div>${feedback}</div>
            <div>Round Score: ${gameState.roundScore}</div>
          `;

          if (points > 0) {
            setTimeout(endRound, 2000);
          }
        } catch (error) {
          alert("Invalid calculation! Please check your expression.");
        }
      }

      function canMakeWord(word, availableLetters) {
        const letterCount = {};
        availableLetters.forEach((letter) => {
          letterCount[letter] = (letterCount[letter] || 0) + 1;
        });

        for (let letter of word) {
          if (!letterCount[letter] || letterCount[letter] === 0) {
            return false;
          }
          letterCount[letter]--;
        }
        return true;
      }

      function skipMathChallenge() {
        if (confirm("Are you sure you want to skip the math challenge?")) {
          endRound();
        }
      }

      function endRound() {
        clearInterval(gameState.timer);

        if (gameState.roundType === "letters") {
          if (gameState.gamePhase === "playing") {
            // Time's up in individual play - go to team word entry
            showTeamWordEntry();
          }
        } else {
          // For math rounds, proceed as before
          const currentTeam =
            gameState.currentTeam === 1 ? gameState.team1 : gameState.team2;
          currentTeam.score += gameState.roundScore;
          currentTeam.roundScores.push(gameState.roundScore);
          showRoundResults();
        }
      }

      function showTeamWordEntry() {
        hideAllScreens();
        document.getElementById("word-entry-screen").style.display = "block";

        // Update team names and scores
        document.getElementById("entry-team1-name").textContent =
          gameState.team1.name;
        document.getElementById("entry-team1-score").textContent =
          gameState.team1.score;
        document.getElementById("entry-team2-name").textContent =
          gameState.team2.name;
        document.getElementById("entry-team2-score").textContent =
          gameState.team2.score;

        document.getElementById("word-entry-team1-name").textContent =
          gameState.team1.name;
        document.getElementById("word-entry-team2-name").textContent =
          gameState.team2.name;

        document.getElementById("entry-current-round").textContent =
          gameState.currentRound;
        document.getElementById("entry-total-rounds").textContent =
          gameState.totalRounds;
        document.getElementById("entry-letters").textContent =
          gameState.selectedLetters.join(" ");

        // Clear previous entries
        document.getElementById("team1-words").value = "";
        document.getElementById("team2-words").value = "";
        document.getElementById("team1-word-count").textContent =
          "Words found: 0";
        document.getElementById("team2-word-count").textContent =
          "Words found: 0";

        // Add event listeners for word counting
        document
          .getElementById("team1-words")
          .addEventListener("input", updateWordCount);
        document
          .getElementById("team2-words")
          .addEventListener("input", updateWordCount);
      }

      function showWordEntryScreen() {
        hideAllScreens();
        document.getElementById("word-entry-screen").style.display = "block";

        // Update team names and scores
        document.getElementById("entry-team1-name").textContent =
          gameState.team1.name;
        document.getElementById("entry-team1-score").textContent =
          gameState.team1.score;
        document.getElementById("entry-team2-name").textContent =
          gameState.team2.name;
        document.getElementById("entry-team2-score").textContent =
          gameState.team2.score;

        document.getElementById("word-entry-team1-name").textContent =
          gameState.team1.name;
        document.getElementById("word-entry-team2-name").textContent =
          gameState.team2.name;

        document.getElementById("entry-current-round").textContent =
          gameState.currentRound;
        document.getElementById("entry-total-rounds").textContent =
          gameState.totalRounds;
        document.getElementById("entry-letters").textContent =
          gameState.letters.join(" ");

        // Clear previous entries
        document.getElementById("team1-words").value = "";
        document.getElementById("team2-words").value = "";
        document.getElementById("team1-word-count").textContent =
          "Words found: 0";
        document.getElementById("team2-word-count").textContent =
          "Words found: 0";

        // Add event listeners for word counting
        document
          .getElementById("team1-words")
          .addEventListener("input", updateWordCount);
        document
          .getElementById("team2-words")
          .addEventListener("input", updateWordCount);
      }

      function updateWordCount(event) {
        const textarea = event.target;
        const teamNumber = textarea.id.includes("team1") ? "1" : "2";
        const words = textarea.value
          .trim()
          .split(/[\n,]+/)
          .filter((word) => word.trim().length >= 3);
        document.getElementById(
          `team${teamNumber}-word-count`
        ).textContent = `Words found: ${words.length}`;
      }

      function processTeamWords() {
        const team1Input = document.getElementById("team1-words").value;
        const team2Input = document.getElementById("team2-words").value;

        if (!team1Input.trim() && !team2Input.trim()) {
          showFeedback("No words entered by either team!", "warning");
          return;
        }

        const team1Words = team1Input
          .trim()
          .split(/[\n,]+/)
          .map((word) => word.trim().toUpperCase())
          .filter((word) => word.length >= 3);

        const team2Words = team2Input
          .trim()
          .split(/[\n,]+/)
          .map((word) => word.trim().toUpperCase())
          .filter((word) => word.length >= 3);

        showFeedback("Processing words...", "info");

        // Validate and score words
        const team1ValidWords = validateAndScoreWords(team1Words);
        const team2ValidWords = validateAndScoreWords(team2Words);

        // Update scores
        gameState.team1.score += team1ValidWords.totalScore;
        gameState.team1.roundScores.push(team1ValidWords.totalScore);
        gameState.team1.roundWords.push(team1ValidWords.validWords);

        gameState.team2.score += team2ValidWords.totalScore;
        gameState.team2.roundScores.push(team2ValidWords.totalScore);
        gameState.team2.roundWords.push(team2ValidWords.validWords);

        // Store results for showing in round results
        gameState.lastRoundResults = {
          team1: team1ValidWords,
          team2: team2ValidWords,
        };

        setTimeout(() => {
          showFeedback(
            `Round complete! ${gameState.team1.name}: ${team1ValidWords.totalScore} pts, ${gameState.team2.name}: ${team2ValidWords.totalScore} pts`,
            "success"
          );
          setTimeout(() => showRoundResults(), 1000);
        }, 500);
      }

      function validateAndScoreWords(words) {
        const validWords = [];
        const invalidWords = [];
        let totalScore = 0;

        words.forEach((word) => {
          if (word.length < 3) {
            invalidWords.push({
              word,
              reason: "Too short (minimum 3 letters)",
            });
            return;
          }

          if (!canMakeWord(word, gameState.selectedLetters)) {
            invalidWords.push({
              word,
              reason: "Cannot be made from available letters",
            });
            return;
          }

          // Calculate points
          let points = 1;
          if (word.length >= 7) points = 3;
          else if (word.length >= 5) points = 2;

          validWords.push({ word, points, fact: wordFacts[word] || null });
          totalScore += points;
        });

        return { validWords, invalidWords, totalScore };
      }

      function skipWordEntry() {
        if (
          confirm(
            "Skip word entry? Both teams will get 0 points for this round."
          )
        ) {
          gameState.team1.roundScores.push(0);
          gameState.team2.roundScores.push(0);
          gameState.team1.roundWords.push([]);
          gameState.team2.roundWords.push([]);

          gameState.lastRoundResults = {
            team1: { validWords: [], invalidWords: [], totalScore: 0 },
            team2: { validWords: [], invalidWords: [], totalScore: 0 },
          };

          showRoundResults();
        }
      }

      function showRoundResults() {
        hideAllScreens();
        document.getElementById("round-results-screen").style.display = "block";

        document.getElementById("round-result-number").textContent =
          gameState.currentRound;

        if (gameState.lastRoundResults) {
          const team1Results = gameState.lastRoundResults.team1;
          const team2Results = gameState.lastRoundResults.team2;

          document.getElementById("round-team1-name").textContent =
            gameState.team1.name;
          document.getElementById("round-team1-points").textContent =
            team1Results.totalScore;
          document.getElementById("round-team1-total").textContent =
            gameState.team1.score;

          document.getElementById("round-team2-name").textContent =
            gameState.team2.name;
          document.getElementById("round-team2-points").textContent =
            team2Results.totalScore;
          document.getElementById("round-team2-total").textContent =
            gameState.team2.score;

          // Create detailed results display
          let resultsHTML = "";

          if (team1Results.totalScore > team2Results.totalScore) {
            resultsHTML += `<h3>🏆 ${gameState.team1.name} wins this round!</h3>`;
          } else if (team2Results.totalScore > team1Results.totalScore) {
            resultsHTML += `<h3>🏆 ${gameState.team2.name} wins this round!</h3>`;
          } else {
            resultsHTML += `<h3>🤝 It's a tie this round!</h3>`;
          }

          // Show word details with facts
          resultsHTML += `<div style="display: flex; gap: 2rem; margin-top: 2rem;">`;

          // Team 1 results
          resultsHTML += `<div style="flex: 1; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px;">`;
          resultsHTML += `<h4 style="color: #ffd700;">${gameState.team1.name} Words:</h4>`;
          if (team1Results.validWords.length > 0) {
            team1Results.validWords.forEach((wordObj) => {
              resultsHTML += `<div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(76,175,80,0.2); border-radius: 5px;">`;
              resultsHTML += `<strong>${wordObj.word}</strong> (+${wordObj.points} pts)`;
              if (wordObj.fact) {
                resultsHTML += `<div style="font-size: 0.9rem; color: #87ceeb; margin-top: 0.3rem;">💡 ${wordObj.fact}</div>`;
              }
              resultsHTML += `</div>`;
            });
          } else {
            resultsHTML += `<div style="color: #ff6b6b;">No valid words found</div>`;
          }
          resultsHTML += `</div>`;

          // Team 2 results
          resultsHTML += `<div style="flex: 1; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px;">`;
          resultsHTML += `<h4 style="color: #ffd700;">${gameState.team2.name} Words:</h4>`;
          if (team2Results.validWords.length > 0) {
            team2Results.validWords.forEach((wordObj) => {
              resultsHTML += `<div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(76,175,80,0.2); border-radius: 5px;">`;
              resultsHTML += `<strong>${wordObj.word}</strong> (+${wordObj.points} pts)`;
              if (wordObj.fact) {
                resultsHTML += `<div style="font-size: 0.9rem; color: #87ceeb; margin-top: 0.3rem;">💡 ${wordObj.fact}</div>`;
              }
              resultsHTML += `</div>`;
            });
          } else {
            resultsHTML += `<div style="color: #ff6b6b;">No valid words found</div>`;
          }
          resultsHTML += `</div>`;
          resultsHTML += `</div>`;

          document.getElementById("round-winner-message").innerHTML =
            resultsHTML;

          if (team1Results.totalScore > 10 || team2Results.totalScore > 10) {
            createCelebration();
          }
        } else {
          // Fallback for math rounds or other cases
          const team1Points =
            gameState.currentTeam === 1 ? gameState.roundScore : 0;
          const team2Points =
            gameState.currentTeam === 2 ? gameState.roundScore : 0;

          document.getElementById("round-team1-name").textContent =
            gameState.team1.name;
          document.getElementById("round-team1-points").textContent =
            team1Points;
          document.getElementById("round-team1-total").textContent =
            gameState.team1.score;

          document.getElementById("round-team2-name").textContent =
            gameState.team2.name;
          document.getElementById("round-team2-points").textContent =
            team2Points;
          document.getElementById("round-team2-total").textContent =
            gameState.team2.score;

          const currentTeamName =
            gameState.currentTeam === 1
              ? gameState.team1.name
              : gameState.team2.name;
          document.getElementById(
            "round-winner-message"
          ).innerHTML = `<h3>${currentTeamName} scored ${gameState.roundScore} points this round!</h3>`;
        }
      }

      function nextRound() {
        gameState.currentRound++;

        if (gameState.currentRound > gameState.totalRounds) {
          showFinalResults();
        } else {
          startRound();
        }
      }

      function showFinalResults() {
        hideAllScreens();
        document.getElementById("results-screen").style.display = "block";

        const winner =
          gameState.team1.score > gameState.team2.score
            ? gameState.team1
            : gameState.team2;
        const loser =
          gameState.team1.score > gameState.team2.score
            ? gameState.team2
            : gameState.team1;

        document.getElementById("final-team1-name").textContent = winner.name;
        document.getElementById("final-team1-score").textContent = winner.score;
        document.getElementById("final-team2-name").textContent = loser.name;
        document.getElementById("final-team2-score").textContent = loser.score;

        const winnerBox = document.getElementById("final-winner-box");
        winnerBox.innerHTML = `
          <div class="team-name">${winner.name}</div>
          <div class="team-score">${winner.score}</div>
          <div style="font-size: 1rem;">🏆 CHAMPIONS! 🏆</div>
        `;

        let message = "";
        const scoreDiff = Math.abs(
          gameState.team1.score - gameState.team2.score
        );
        if (scoreDiff > 20) {
          message = `🌟 Dominant victory for ${winner.name}!`;
        } else if (scoreDiff > 10) {
          message = `🎉 Great win for ${winner.name}!`;
        } else {
          message = `🔥 What an incredibly close match!`;
        }

        document.getElementById(
          "final-message"
        ).innerHTML = `<h3>${message}</h3>`;

        // Create enhanced round breakdown with statistics
        let breakdown = "<h3>Championship Statistics:</h3>";

        // Calculate additional stats
        const team1Avg = (
          gameState.team1.score / gameState.totalRounds
        ).toFixed(1);
        const team2Avg = (
          gameState.team2.score / gameState.totalRounds
        ).toFixed(1);
        const team1Wins = gameState.team1.roundScores.filter(
          (score, i) => score > (gameState.team2.roundScores[i] || 0)
        ).length;
        const team2Wins = gameState.team2.roundScores.filter(
          (score, i) => score > (gameState.team1.roundScores[i] || 0)
        ).length;

        breakdown += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">`;
        breakdown += `<div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px;">`;
        breakdown += `<h4 style="color: #ffd700;">${gameState.team1.name} Stats</h4>`;
        breakdown += `<div>Rounds Won: ${team1Wins}</div>`;
        breakdown += `<div>Average Score: ${team1Avg}</div>`;
        breakdown += `<div>Best Round: ${Math.max(
          ...gameState.team1.roundScores
        )}</div>`;
        breakdown += `</div>`;
        breakdown += `<div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px;">`;
        breakdown += `<h4 style="color: #ffd700;">${gameState.team2.name} Stats</h4>`;
        breakdown += `<div>Rounds Won: ${team2Wins}</div>`;
        breakdown += `<div>Average Score: ${team2Avg}</div>`;
        breakdown += `<div>Best Round: ${Math.max(
          ...gameState.team2.roundScores
        )}</div>`;
        breakdown += `</div>`;
        breakdown += `</div>`;

        breakdown += "<h4>Round by Round:</h4>";
        for (let i = 0; i < gameState.totalRounds; i++) {
          const team1Round = gameState.team1.roundScores[i] || 0;
          const team2Round = gameState.team2.roundScores[i] || 0;
          const roundWinner =
            team1Round > team2Round
              ? gameState.team1.name
              : team2Round > team1Round
              ? gameState.team2.name
              : "Tie";
          breakdown += `<div style="padding: 0.5rem; margin: 0.3rem 0; background: rgba(255,255,255,0.05); border-radius: 5px;">Round ${
            i + 1
          }: ${gameState.team1.name} ${team1Round} - ${team2Round} ${
            gameState.team2.name
          } <span style="color: #ffd700;">(${roundWinner})</span></div>`;
        }
        document.getElementById("round-breakdown").innerHTML = breakdown;

        sounds.victory();
        createCelebration();
      }

      function createCelebration() {
        const celebration = document.getElementById("celebration");
        celebration.innerHTML = "";

        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "%";
          confetti.style.backgroundColor = [
            "#ffd700",
            "#ff6b6b",
            "#4ecdc4",
            "#45b7d1",
            "#96ceb4",
          ][Math.floor(Math.random() * 5)];
          confetti.style.animationDelay = Math.random() * 3 + "s";
          celebration.appendChild(confetti);
        }

        setTimeout(() => {
          celebration.innerHTML = "";
        }, 4000);
      }

      function playAgain() {
        showTeamSetup();
      }

      function endGameEarly() {
        if (confirm("Are you sure you want to end the game early?")) {
          clearInterval(gameState.timer);
          showFinalResults();
        }
      }

      // Event listeners
      document.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          if (
            document.getElementById("math-screen").style.display === "block"
          ) {
            submitMathAnswer();
          } else if (
            document.getElementById("individual-play-screen").style.display ===
            "block"
          ) {
            submitPlayerWord();
          }
        }
      });

      document.addEventListener("keydown", function (e) {
        switch (e.key.toLowerCase()) {
          case "v":
            if (
              document.getElementById("letter-selection-screen").style
                .display === "block"
            ) {
              e.preventDefault();
              chooseLetter("vowel");
            }
            break;
          case "c":
            if (
              document.getElementById("letter-selection-screen").style
                .display === "block"
            ) {
              e.preventDefault();
              chooseLetter("consonant");
            }
            break;
          case "h":
            if (
              document.getElementById("game-screen").style.display === "block"
            ) {
              e.preventDefault();
              if (gameState.hintsShown) {
                toggleHints();
              } else {
                showHints();
              }
            }
            break;
          case " ":
            if (
              document.getElementById("team-setup-screen").style.display ===
              "block"
            ) {
              e.preventDefault();
              quickStart();
            }
            break;
          case "escape":
            if (
              document.getElementById("game-screen").style.display ===
                "block" ||
              document.getElementById("math-screen").style.display ===
                "block" ||
              document.getElementById("letter-selection-screen").style
                .display === "block" ||
              document.getElementById("individual-play-screen").style
                .display === "block"
            ) {
              e.preventDefault();
              if (confirm("End game early?")) {
                endGameEarly();
              }
            }
            break;
        }
      });

      document.addEventListener("keydown", function (e) {
        switch (e.key.toLowerCase()) {
          case "h":
            if (
              document.getElementById("game-screen").style.display === "block"
            ) {
              e.preventDefault();
              if (gameState.hintsShown) {
                toggleHints();
              } else {
                showHints();
              }
            }
            break;
          case " ":
            if (
              document.getElementById("team-setup-screen").style.display ===
              "block"
            ) {
              e.preventDefault();
              quickStart();
            }
            break;
          case "escape":
            if (
              document.getElementById("game-screen").style.display ===
                "block" ||
              document.getElementById("math-screen").style.display === "block"
            ) {
              e.preventDefault();
              if (confirm("End game early?")) {
                endGameEarly();
              }
            }
            break;
        }
      });

      function showFeedback(message, type = "info") {
        const feedback = document.createElement("div");
        feedback.className = "feedback-message";
        feedback.innerHTML = message;

        if (type === "success") {
          feedback.style.background = "rgba(76, 175, 80, 0.9)";
          sounds.success();
        } else if (type === "warning") {
          feedback.style.background = "rgba(255, 152, 0, 0.9)";
          sounds.warning();
        } else if (type === "error") {
          feedback.style.background = "rgba(244, 67, 54, 0.9)";
          sounds.warning();
        }

        document.body.appendChild(feedback);

        setTimeout(() => {
          if (document.body.contains(feedback)) {
            document.body.removeChild(feedback);
          }
        }, 2000);
      }

      // Screen reader announcements
      function announceToScreenReader(message) {
        const announcement = document.createElement("div");
        announcement.setAttribute("role", "status");
        announcement.setAttribute("aria-live", "polite");
        announcement.className = "sr-only";
        announcement.textContent = message;
        document.body.appendChild(announcement);
        setTimeout(() => announcement.remove(), 1000);
      }

      // Keyboard navigation
      document.addEventListener("keydown", function (e) {
        if (gameState.gamePhase === "setup" && e.key === " ") {
          e.preventDefault();
          startGame();
        } else if (gameState.gamePhase === "playing") {
          if (e.key === "h" || e.key === "H") {
            e.preventDefault();
            if (!gameState.hintsShown) {
              showHints();
            }
          } else if (e.key === "Escape") {
            e.preventDefault();
            if (confirm("Are you sure you want to end the game early?")) {
              endGameEarly();
            }
          }
        } else if (e.key === "Enter") {
          // Submit forms or continue actions
          const submitBtn = document.querySelector('button[onclick*="submit"]');
          if (submitBtn && submitBtn.style.display !== "none") {
            e.preventDefault();
            submitBtn.click();
          }
        }
      });

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadStats();
        showTeamSetup();
        showFeedback(
          "🏆 Welcome to ESL Quiz Championship! Press SPACE for quick start or set up your teams below.",
          "success"
        );
        announceToScreenReader(
          "Welcome to ESL Quiz Championship. Press Space to start or customize your teams."
        );
      });
    </script>
  </body>
</html>
