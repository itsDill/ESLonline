<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Survival Word Learning Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #2d5016, #228b22, #32cd32);
        color: white;
        overflow: hidden;
      }

      #gameContainer {
        position: relative;
        width: 100vw;
        height: 100vh;
      }

      #ui {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 100;
      }

      .ui-panel {
        position: absolute;
        background: rgba(0, 0, 0, 0.85);
        border: 2px solid #32cd32;
        border-radius: 12px;
        padding: 20px;
        pointer-events: auto;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      #customizationPanel {
        top: 20px;
        right: 20px;
        width: 320px;
        max-height: 85vh;
        overflow-y: auto;
      }

      #gameUI {
        display: none;
        top: 20px;
        left: 20px;
        width: 280px;
      }

      #wordLearningPanel {
        display: none;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        background: rgba(0, 0, 0, 0.95);
        border: 3px solid #ffd700;
        text-align: center;
      }

      .category-section {
        margin-bottom: 20px;
        border-bottom: 1px solid #333;
        padding-bottom: 15px;
      }

      .category-title {
        font-weight: bold;
        margin-bottom: 12px;
        color: #32cd32;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .option-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .option-label {
        font-size: 12px;
        color: #ccc;
        min-width: 80px;
      }

      button {
        background: linear-gradient(45deg, #32cd32, #228b22);
        border: none;
        color: white;
        padding: 6px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 11px;
        font-weight: 500;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(50, 205, 50, 0.3);
        min-width: 100px;
      }

      button:hover {
        background: linear-gradient(45deg, #228b22, #2d5016);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(50, 205, 50, 0.4);
      }

      #startGame {
        width: 100%;
        padding: 14px;
        font-size: 16px;
        margin-top: 20px;
        background: linear-gradient(45deg, #ff6b35, #f7931e);
        box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
      }

      #startGame:hover {
        background: linear-gradient(45deg, #f7931e, #ffb347);
        box-shadow: 0 6px 20px rgba(255, 107, 53, 0.6);
      }

      #gameStats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .stat-label {
        display: flex;
        align-items: center;
        font-size: 12px;
        font-weight: 500;
      }

      .stat-bar {
        width: 100%;
        height: 18px;
        background: #2a2a3e;
        border-radius: 9px;
        overflow: hidden;
        border: 1px solid #444;
      }

      .stat-fill {
        height: 100%;
        transition: width 0.3s ease;
        border-radius: 8px;
      }

      #healthFill {
        background: linear-gradient(to right, #e74c3c, #f39c12, #2ecc71);
      }

      #hungerFill {
        background: linear-gradient(to right, #3498db, #9b59b6, #e67e22);
      }

      #inventory {
        background: rgba(139, 69, 19, 0.2);
        border: 1px solid #8b4513;
        border-radius: 8px;
        padding: 12px;
        margin-top: 15px;
      }

      #instructions {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        padding: 15px 25px;
        border-radius: 10px;
        text-align: center;
        pointer-events: auto;
        font-size: 14px;
        backdrop-filter: blur(10px);
        border: 1px solid #444;
      }

      .controls {
        margin-top: 10px;
        font-size: 12px;
        color: #aaa;
      }

      .word-display {
        font-size: 24px;
        color: #ffd700;
        margin: 20px 0;
        font-weight: bold;
      }

      .word-definition {
        font-size: 16px;
        color: #ccc;
        margin: 15px 0;
        line-height: 1.4;
      }

      .word-example {
        font-size: 14px;
        color: #90ee90;
        font-style: italic;
        margin: 10px 0;
      }

      #vocabularyList {
        max-height: 200px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 6px;
        padding: 10px;
        margin-top: 10px;
      }

      .vocab-item {
        padding: 5px 0;
        border-bottom: 1px solid #444;
        font-size: 12px;
      }

      .progress-ring {
        width: 60px;
        height: 60px;
        margin: 10px auto;
      }

      .progress-ring-circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }

      /* Scrollbar styling */
      #customizationPanel::-webkit-scrollbar,
      #vocabularyList::-webkit-scrollbar {
        width: 8px;
      }

      #customizationPanel::-webkit-scrollbar-track,
      #vocabularyList::-webkit-scrollbar-track {
        background: #1a1a2e;
        border-radius: 4px;
      }

      #customizationPanel::-webkit-scrollbar-thumb,
      #vocabularyList::-webkit-scrollbar-thumb {
        background: #32cd32;
        border-radius: 4px;
      }

      #customizationPanel::-webkit-scrollbar-thumb:hover,
      #vocabularyList::-webkit-scrollbar-thumb:hover {
        background: #228b22;
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <div id="ui">
        <div id="customizationPanel" class="ui-panel">
          <h3 style="margin-top: 0; text-align: center; color: #32cd32">
            üèïÔ∏è Survivor Creator
          </h3>

          <div class="category-section">
            <div class="category-title">üëî OUTFIT</div>
            <div class="option-row">
              <span class="option-label">Style:</span>
              <button onclick="cycleOption('outfit', event)">
                Survival Gear
              </button>
            </div>
            <div class="option-row">
              <span class="option-label">Color:</span>
              <button onclick="cycleOption('outfitColor', event)">
                Forest Green
              </button>
            </div>
          </div>

          <div class="category-section">
            <div class="category-title">üíá HAIR</div>
            <div class="option-row">
              <span class="option-label">Style:</span>
              <button onclick="cycleOption('hair', event)">Rugged</button>
            </div>
            <div class="option-row">
              <span class="option-label">Color:</span>
              <button onclick="cycleOption('hairColor', event)">
                Dark Brown
              </button>
            </div>
            <div class="option-row">
              <span class="option-label">Length:</span>
              <button onclick="cycleOption('hairLength', event)">Short</button>
            </div>
          </div>

          <div class="category-section">
            <div class="category-title">üíÑ APPEARANCE</div>
            <div class="option-row">
              <span class="option-label">Face:</span>
              <button onclick="cycleOption('faceType', event)">Oval</button>
            </div>
            <div class="option-row">
              <span class="option-label">Eyes:</span>
              <button onclick="cycleOption('eyeColor', event)">Brown</button>
            </div>
          </div>

          <div class="category-section">
            <div class="category-title">üèóÔ∏è BUILD</div>
            <div class="option-row">
              <span class="option-label">Body:</span>
              <button onclick="cycleOption('build', event)">Athletic</button>
            </div>
            <div class="option-row">
              <span class="option-label">Height:</span>
              <button onclick="cycleOption('height', event)">Average</button>
            </div>
            <div class="option-row">
              <span class="option-label">Gender:</span>
              <button onclick="cycleOption('gender', event)">Male</button>
            </div>
          </div>

          <div class="category-section">
            <div class="category-title">üé® SKIN</div>
            <div class="option-row">
              <span class="option-label">Tone:</span>
              <button onclick="cycleOption('skinTone', event)">Medium</button>
            </div>
          </div>

          <div class="category-section">
            <div class="category-title">üéí GEAR</div>
            <div class="option-row">
              <span class="option-label">Hat:</span>
              <button onclick="cycleOption('hat', event)">None</button>
            </div>
            <div class="option-row">
              <span class="option-label">Backpack:</span>
              <button onclick="cycleOption('backpack', event)">Standard</button>
            </div>
            <div class="option-row">
              <span class="option-label">Boots:</span>
              <button onclick="cycleOption('boots', event)">
                Hiking Boots
              </button>
            </div>
          </div>

          <button id="startGame" onclick="startGame()">
            üå≤ Start Surviving
          </button>
        </div>

        <div id="gameUI" class="ui-panel">
          <div id="gameStats">
            <div class="stat-container">
              <div class="stat-label">üíö Health</div>
              <div class="stat-bar">
                <div
                  id="healthFill"
                  class="stat-fill"
                  style="width: 100%"
                ></div>
              </div>
            </div>
            <div class="stat-container">
              <div class="stat-label">üçñ Hunger</div>
              <div class="stat-bar">
                <div
                  id="hungerFill"
                  class="stat-fill"
                  style="width: 100%"
                ></div>
              </div>
            </div>
          </div>

          <div style="font-size: 12px; color: #ccc; margin-bottom: 10px">
            Status:
            <span id="status" style="font-weight: bold">Exploring</span>
          </div>

          <div id="inventory">
            <div
              style="
                font-size: 11px;
                font-weight: bold;
                color: #8b4513;
                margin-bottom: 5px;
              "
            >
              üéí INVENTORY
            </div>
            <div style="font-size: 12px">
              Wood: <span id="woodCount">0</span><br />
              Words Learned: <span id="wordCount">0</span>/100
            </div>
          </div>

          <div id="vocabularyList">
            <div
              style="
                font-size: 11px;
                font-weight: bold;
                color: #ffd700;
                margin-bottom: 5px;
              "
            >
              üìö VOCABULARY
            </div>
            <div id="learnedWords"></div>
          </div>

          <div style="margin-top: 15px; font-size: 11px; color: #888">
            <div>Area: <span id="currentArea">Forest Clearing</span></div>
            <div>Day: <span id="gameDay">1</span></div>
          </div>
        </div>

        <div id="wordLearningPanel" class="ui-panel">
          <h3 style="color: #ffd700; margin-top: 0">üìñ New Word Discovered!</h3>
          <div class="word-display" id="newWord">RESILIENCE</div>
          <div class="word-definition" id="wordDefinition">
            The ability to recover quickly from difficulties; toughness.
          </div>
          <div class="word-example" id="wordExample">
            "The survivor showed great resilience in overcoming the harsh
            wilderness."
          </div>
          <button
            onclick="closeWordPanel()"
            style="margin-top: 20px; width: 100%"
          >
            Continue Learning üìö
          </button>
        </div>

        <div id="instructions">
          <div>
            <strong
              >üå≤ Welcome, Survivor! Customize your appearance and start your
              adventure.</strong
            >
          </div>
          <div class="controls">
            WASD to move ‚Ä¢ Mouse to look around ‚Ä¢ E to interact with trees ‚Ä¢ F
            to gather resources
          </div>
        </div>
      </div>
    </div>

    <script>
      // Game state
      let scene,
        camera,
        renderer,
        player,
        trees = [],
        interactables = [];
      let gameStarted = false;
      let health = 100;
      let hunger = 100;
      let woodCount = 0;
      let wordsLearned = 0;
      let currentArea = "Forest Clearing";
      let gameDay = 1;
      let keys = {};
      let learnedVocabulary = new Set();

      // Customization options (updated for survival theme)
      const customizationOptions = {
        outfit: [
          "Survival Gear",
          "Ranger Uniform",
          "Casual Outdoors",
          "Military Fatigues",
          "Hunter Outfit",
          "Explorer Vest",
        ],
        outfitColor: [
          "Forest Green",
          "Earth Brown",
          "Camouflage",
          "Khaki",
          "Dark Green",
          "Olive Drab",
        ],
        hair: [
          "Rugged",
          "Windswept",
          "Practical Cut",
          "Long & Wild",
          "Buzz Cut",
          "Messy",
        ],
        hairColor: [
          "Dark Brown",
          "Black",
          "Blonde",
          "Auburn",
          "Gray",
          "Light Brown",
        ],
        hairLength: ["Short", "Medium", "Long"],
        faceType: ["Oval", "Round", "Square", "Heart", "Diamond"],
        eyeColor: ["Brown", "Blue", "Green", "Hazel", "Gray"],
        build: ["Lean", "Average", "Athletic", "Stocky", "Tall & Thin"],
        height: ["Short", "Average", "Tall"],
        gender: ["Male", "Female"],
        skinTone: ["Fair", "Light", "Medium", "Olive", "Dark", "Deep"],
        hat: ["None", "Baseball Cap", "Beanie", "Wide Brim", "Bandana"],
        backpack: ["None", "Standard", "Large Pack", "Military", "Hiking Pack"],
        boots: ["Sneakers", "Hiking Boots", "Combat Boots", "Work Boots"],
      };

      let currentOptions = {
        outfit: 0,
        outfitColor: 0,
        hair: 0,
        hairColor: 0,
        hairLength: 0,
        faceType: 0,
        eyeColor: 0,
        build: 2,
        height: 1,
        gender: 0,
        skinTone: 2,
        hat: 0,
        backpack: 1,
        boots: 1,
      };

      // Vocabulary database for learning
      const vocabularyDatabase = [
        {
          word: "RESILIENCE",
          definition:
            "The ability to recover quickly from difficulties; toughness.",
          example:
            "The survivor showed great resilience in overcoming the harsh wilderness.",
        },
        {
          word: "FORAGE",
          definition: "To search for and collect food, especially in the wild.",
          example:
            "We must forage for berries and nuts to supplement our diet.",
        },
        {
          word: "SHELTER",
          definition:
            "A structure that provides protection from weather or danger.",
          example:
            "Building a proper shelter is crucial for survival in the wilderness.",
        },
        {
          word: "PERSEVERANCE",
          definition:
            "Persistence in doing something despite difficulty or delay.",
          example: "Her perseverance helped her survive the long winter.",
        },
        {
          word: "RESOURCEFUL",
          definition:
            "Having the ability to find quick and clever ways to overcome difficulties.",
          example:
            "A resourceful person can make tools from natural materials.",
        },
        {
          word: "ENDURANCE",
          definition: "The ability to withstand hardship or adversity.",
          example:
            "Long-distance hiking requires both physical and mental endurance.",
        },
        {
          word: "ADAPTATION",
          definition:
            "The process of change by which an organism becomes better suited to its environment.",
          example:
            "Successful adaptation to the wilderness requires learning new skills.",
        },
        {
          word: "SUSTENANCE",
          definition:
            "Food and drink regarded as a source of strength; nourishment.",
          example:
            "Finding adequate sustenance is a daily challenge in survival situations.",
        },
        {
          word: "TENACITY",
          definition: "The quality of being determined; persistence.",
          example: "His tenacity in finding water saved the entire group.",
        },
        {
          word: "INGENUITY",
          definition: "The quality of being clever, original, and inventive.",
          example:
            "She showed great ingenuity in creating a water filter from natural materials.",
        },
        {
          word: "FORTITUDE",
          definition: "Courage in pain or adversity.",
          example:
            "Mental fortitude is as important as physical strength in survival.",
        },
        {
          word: "PROVIDENCE",
          definition:
            "The protective care of nature or God as a spiritual power.",
          example:
            "They felt providence guided them to the fresh water spring.",
        },
        {
          word: "PRUDENT",
          definition: "Acting with or showing care and thought for the future.",
          example: "It was prudent to save extra firewood for the cold night.",
        },
        {
          word: "VIGILANT",
          definition:
            "Keeping careful watch for possible danger or difficulties.",
          example: "Staying vigilant helped them avoid the dangerous wildlife.",
        },
        {
          word: "METHODICAL",
          definition: "Done according to a systematic or established plan.",
          example:
            "A methodical approach to building shelter ensures it will last.",
        },
      ];

      function init() {
        // Create scene with natural lighting
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Sky blue
        scene.fog = new THREE.Fog(0x87ceeb, 50, 200);

        // Create camera
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 8, 15);

        // Create renderer
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document
          .getElementById("gameContainer")
          .appendChild(renderer.domElement);

        // Setup lighting
        setupNaturalLighting();

        // Create player
        createSurvivalPlayer();

        // Create forest environment
        createForestEnvironment();

        // Add event listeners
        document.addEventListener("keydown", onKeyDown);
        document.addEventListener("keyup", onKeyUp);
        document.addEventListener("click", () => {
          if (gameStarted) document.body.requestPointerLock();
        });
        window.addEventListener("resize", onWindowResize);

        // Start render loop
        animate();
      }

      function setupNaturalLighting() {
        // Ambient lighting (natural daylight)
        const ambientLight = new THREE.AmbientLight(0x404080, 0.6);
        scene.add(ambientLight);

        // Sun (directional light)
        const sunlight = new THREE.DirectionalLight(0xffffff, 1.0);
        sunlight.position.set(50, 50, 25);
        sunlight.castShadow = true;
        sunlight.shadow.camera.near = 0.1;
        sunlight.shadow.camera.far = 200;
        sunlight.shadow.camera.left = -50;
        sunlight.shadow.camera.right = 50;
        sunlight.shadow.camera.top = 50;
        sunlight.shadow.camera.bottom = -50;
        sunlight.shadow.mapSize.width = 2048;
        sunlight.shadow.mapSize.height = 2048;
        scene.add(sunlight);
      }

      function createSurvivalPlayer() {
        const playerGroup = new THREE.Group();
        const bodyScale = getBodyScale();
        const heightMultiplier = getHeightMultiplier();

        // Main body (torso)
        const torsoGeometry = new THREE.CylinderGeometry(
          0.45 * bodyScale,
          0.5 * bodyScale,
          1.2 * heightMultiplier,
          12
        );
        const torsoMaterial = new THREE.MeshLambertMaterial({
          color: getOutfitMainColor(),
        });
        const torso = new THREE.Mesh(torsoGeometry, torsoMaterial);
        torso.position.y = 1.0 * heightMultiplier;
        torso.castShadow = true;
        playerGroup.add(torso);

        // Head
        const headGeometry = new THREE.SphereGeometry(
          0.32 * heightMultiplier,
          16,
          16
        );
        const headMaterial = new THREE.MeshLambertMaterial({
          color: getSkinColor(),
        });
        const head = new THREE.Mesh(headGeometry, headMaterial);
        head.position.y = 1.85 * heightMultiplier;
        head.castShadow = true;
        playerGroup.add(head);

        // Hair
        createHairSystem(playerGroup, heightMultiplier);

        // Face features
        createFaceFeatures(playerGroup, heightMultiplier);

        // Arms
        const armGeometry = new THREE.CylinderGeometry(
          0.08,
          0.12,
          0.8 * heightMultiplier,
          8
        );
        const leftArm = new THREE.Mesh(armGeometry, torsoMaterial);
        leftArm.position.set(-0.6 * bodyScale, 1.0 * heightMultiplier, 0);
        leftArm.rotation.z = 0.2;
        leftArm.castShadow = true;
        playerGroup.add(leftArm);

        const rightArm = new THREE.Mesh(armGeometry, torsoMaterial);
        rightArm.position.set(0.6 * bodyScale, 1.0 * heightMultiplier, 0);
        rightArm.rotation.z = -0.2;
        rightArm.castShadow = true;
        playerGroup.add(rightArm);

        // Legs
        const legGeometry = new THREE.CylinderGeometry(
          0.12,
          0.15,
          1.0 * heightMultiplier,
          8
        );
        const legMaterial = new THREE.MeshLambertMaterial({
          color: getOutfitSecondaryColor(),
        });
        const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
        leftLeg.position.set(-0.2, 0.3 * heightMultiplier, 0);
        leftLeg.castShadow = true;
        playerGroup.add(leftLeg);

        const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
        rightLeg.position.set(0.2, 0.3 * heightMultiplier, 0);
        rightLeg.castShadow = true;
        playerGroup.add(rightLeg);

        // Add survival gear
        addSurvivalGear(playerGroup, heightMultiplier);

        playerGroup.position.set(0, 0, 0);
        scene.add(playerGroup);
        player = playerGroup;
      }

      function createForestEnvironment() {
        // Forest floor
        const floorGeometry = new THREE.PlaneGeometry(200, 200);
        const floorMaterial = new THREE.MeshLambertMaterial({
          color: 0x3d5a27,
        });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // Create trees for chopping
        createTrees();

        // Add rocks and other natural elements
        createNaturalElements();
      }

      function createTrees() {
        const treeCount = 50;
        for (let i = 0; i < treeCount; i++) {
          const tree = createTree();
          const angle = Math.random() * Math.PI * 2;
          const distance = 10 + Math.random() * 80;
          tree.position.x = Math.cos(angle) * distance;
          tree.position.z = Math.sin(angle) * distance;
          tree.position.y = 0;

          // Add interaction data
          tree.userData = { type: "tree", chopProgress: 0, maxChops: 5 };
          trees.push(tree);
          interactables.push(tree);
          scene.add(tree);
        }
      }

      function createTree() {
        const treeGroup = new THREE.Group();

        // Tree trunk
        const trunkGeometry = new THREE.CylinderGeometry(0.8, 1.0, 8, 8);
        const trunkMaterial = new THREE.MeshLambertMaterial({
          color: 0x8b4513,
        });
        const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
        trunk.position.y = 4;
        trunk.castShadow = true;
        treeGroup.add(trunk);

        // Tree leaves/canopy
        const leavesGeometry = new THREE.SphereGeometry(4, 8, 6);
        const leavesMaterial = new THREE.MeshLambertMaterial({
          color: 0x228b22,
        });
        const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
        leaves.position.y = 10;
        leaves.castShadow = true;
        treeGroup.add(leaves);

        return treeGroup;
      }

      function createNaturalElements() {
        // Rocks
        for (let i = 0; i < 20; i++) {
          const rockGeometry = new THREE.DodecahedronGeometry(
            Math.random() * 2 + 0.5,
            0
          );
          const rockMaterial = new THREE.MeshLambertMaterial({
            color: 0x696969,
          });
          const rock = new THREE.Mesh(rockGeometry, rockMaterial);
          rock.position.x = (Math.random() - 0.5) * 150;
          rock.position.z = (Math.random() - 0.5) * 150;
          rock.position.y = Math.random() * 1;
          rock.castShadow = true;
          rock.receiveShadow = true;
          scene.add(rock);
        }

        // Bushes
        for (let i = 0; i < 30; i++) {
          const bushGeometry = new THREE.SphereGeometry(
            Math.random() * 1.5 + 0.5,
            6,
            4
          );
          const bushMaterial = new THREE.MeshLambertMaterial({
            color: 0x006400,
          });
          const bush = new THREE.Mesh(bushGeometry, bushMaterial);
          bush.position.x = (Math.random() - 0.5) * 120;
          bush.position.z = (Math.random() - 0.5) * 120;
          bush.position.y = bush.geometry.parameters.radius / 2;
          bush.castShadow = true;
          scene.add(bush);
        }
      }

      function addSurvivalGear(parent, heightMultiplier) {
        // Hat
        if (currentOptions.hat > 0) {
          const hatGeometry = new THREE.CylinderGeometry(0.4, 0.35, 0.2, 12);
          const hatMaterial = new THREE.MeshLambertMaterial({
            color: 0x8b4513,
          });
          const hat = new THREE.Mesh(hatGeometry, hatMaterial);
          hat.position.y = 2.1 * heightMultiplier;
          parent.add(hat);
        }

        // Backpack
        if (currentOptions.backpack > 0) {
          const backpackGeometry = new THREE.BoxGeometry(0.6, 0.8, 0.3);
          const backpackMaterial = new THREE.MeshLambertMaterial({
            color: 0x2f4f2f,
          });
          const backpack = new THREE.Mesh(backpackGeometry, backpackMaterial);
          backpack.position.set(0, 1.2 * heightMultiplier, -0.4);
          parent.add(backpack);
        }
      }

      // Helper functions for customization
      function createHairSystem(parent, heightMultiplier) {
        const hairColor = getHairColor();
        const hairGeometry = new THREE.SphereGeometry(
          0.36 * heightMultiplier,
          16,
          16
        );
        const hairMaterial = new THREE.MeshLambertMaterial({
          color: hairColor,
        });
        const hair = new THREE.Mesh(hairGeometry, hairMaterial);
        hair.position.y = 1.85 * heightMultiplier;
        hair.scale.y = getHairLengthScale();
        parent.add(hair);
      }

      function createFaceFeatures(parent, heightMultiplier) {
        const eyeColor = getEyeColor();

        // Eyes
        const eyeGeometry = new THREE.SphereGeometry(0.05, 8, 8);
        const eyeMaterial = new THREE.MeshLambertMaterial({ color: eyeColor });

        const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
        leftEye.position.set(-0.1, 1.9 * heightMultiplier, 0.25);
        parent.add(leftEye);

        const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
        rightEye.position.set(0.1, 1.9 * heightMultiplier, 0.25);
        parent.add(rightEye);
      }

      // Customization helper functions
      function getBodyScale() {
        const builds = [0.8, 1.0, 1.2, 1.3, 0.9]; // Lean, Average, Athletic, Stocky, Tall & Thin
        return builds[currentOptions.build] || 1.0;
      }

      function getHeightMultiplier() {
        const heights = [0.85, 1.0, 1.15]; // Short, Average, Tall
        return heights[currentOptions.height] || 1.0;
      }

      function getOutfitMainColor() {
        const colors = [
          0x228b22, 0x8b4513, 0x556b2f, 0x6b8e23, 0x2f4f4f, 0x808000,
        ];
        return colors[currentOptions.outfitColor] || 0x228b22;
      }

      function getOutfitSecondaryColor() {
        const colors = [
          0x2f4f2f, 0x654321, 0x8fbc8f, 0x9acd32, 0x696969, 0x6b8e23,
        ];
        return colors[currentOptions.outfitColor] || 0x2f4f2f;
      }

      function getSkinColor() {
        const tones = [
          0xfdbcb4, 0xeac086, 0xd08b5b, 0xae7242, 0x896347, 0x613d24,
        ];
        return tones[currentOptions.skinTone] || 0xd08b5b;
      }

      function getHairColor() {
        const colors = [
          0x3c2414, 0x000000, 0xffd700, 0x8b4513, 0x808080, 0xd2b48c,
        ];
        return colors[currentOptions.hairColor] || 0x3c2414;
      }

      function getEyeColor() {
        const colors = [0x8b4513, 0x0000ff, 0x228b22, 0xcd853f, 0x708090];
        return colors[currentOptions.eyeColor] || 0x8b4513;
      }

      function getHairLengthScale() {
        const scales = [0.8, 1.0, 1.3]; // Short, Medium, Long
        return scales[currentOptions.hairLength] || 0.8;
      }

      // Customization cycling function
      function cycleOption(optionType, event) {
        const options = customizationOptions[optionType];
        if (options) {
          currentOptions[optionType] =
            (currentOptions[optionType] + 1) % options.length;
          updateButtonText(optionType, event);
          updatePlayerAppearance();
        }
      }

      function updateButtonText(optionType, event) {
        const button = event.target;
        const options = customizationOptions[optionType];
        const currentIndex = currentOptions[optionType];
        button.textContent = options[currentIndex];
      }

      function updatePlayerAppearance() {
        if (player) {
          scene.remove(player);
          createSurvivalPlayer();
        }
      }

      // Game functions
      function startGame() {
        gameStarted = true;
        document.getElementById("customizationPanel").style.display = "none";
        document.getElementById("gameUI").style.display = "block";
        document.getElementById("instructions").innerHTML = `
          <div><strong>üå≤ Survival Mode Active!</strong></div>
          <div class="controls">WASD to move ‚Ä¢ Mouse to look ‚Ä¢ E to chop trees ‚Ä¢ Collect resources and learn words!</div>
        `;

        // Start game loops
        startGameLoops();

        // Enable controls
        document.addEventListener("mousemove", onMouseMove);
      }

      function startGameLoops() {
        // Hunger decrease loop
        setInterval(() => {
          if (gameStarted) {
            hunger = Math.max(0, hunger - 1);
            updateUI();

            if (hunger < 20) {
              document.getElementById("status").textContent = "Starving";
            } else if (hunger < 50) {
              document.getElementById("status").textContent = "Hungry";
            } else {
              document.getElementById("status").textContent = "Exploring";
            }
          }
        }, 3000);

        // Day progression
        setInterval(() => {
          if (gameStarted) {
            gameDay++;
            updateUI();
          }
        }, 60000); // New day every minute
      }

      function onKeyDown(event) {
        keys[event.code] = true;

        if (event.code === "KeyE" && gameStarted) {
          interactWithNearestObject();
        }
      }

      function onKeyUp(event) {
        keys[event.code] = false;
      }

      let cameraPitch = 0; // Add this near your game state variables
      let cameraYaw = 0; // Track yaw for camera/player rotation

      function onMouseMove(event) {
        if (gameStarted && document.pointerLockElement) {
          const sensitivity = 0.002;

          // Update yaw (Y axis) for player and camera
          cameraYaw -= event.movementX * sensitivity;
          player.rotation.y = cameraYaw;

          // Update pitch (X axis) and clamp
          cameraPitch -= event.movementY * sensitivity;
          cameraPitch = Math.max(
            -Math.PI / 2,
            Math.min(Math.PI / 2, cameraPitch)
          );
        }
      }

      function interactWithNearestObject() {
        const playerPosition = player.position.clone();
        let nearestTree = null;
        let minDistance = 5; // Interaction range

        trees.forEach((tree) => {
          const distance = playerPosition.distanceTo(tree.position);
          if (distance < minDistance) {
            nearestTree = tree;
            minDistance = distance;
          }
        });

        if (nearestTree && nearestTree.userData) {
          chopTree(nearestTree);
        }
      }

      function chopTree(tree) {
        tree.userData.chopProgress++;

        // Visual feedback - make tree shake
        tree.rotation.x = (Math.random() - 0.5) * 0.1;
        tree.rotation.z = (Math.random() - 0.5) * 0.1;

        setTimeout(() => {
          tree.rotation.x = 0;
          tree.rotation.z = 0;
        }, 200);

        if (tree.userData.chopProgress >= tree.userData.maxChops) {
          // Tree is chopped down
          scene.remove(tree);
          trees = trees.filter((t) => t !== tree);
          interactables = interactables.filter((t) => t !== tree);

          // Reward player
          woodCount += Math.floor(Math.random() * 3) + 2;
          wordsLearned++;

          // Show new word
          showNewWord();

          updateUI();
        }
      }

      function showNewWord() {
        if (vocabularyDatabase.length > 0) {
          const availableWords = vocabularyDatabase.filter(
            (word) => !learnedVocabulary.has(word.word)
          );

          if (availableWords.length > 0) {
            const randomWord =
              availableWords[Math.floor(Math.random() * availableWords.length)];
            learnedVocabulary.add(randomWord.word);

            document.getElementById("newWord").textContent = randomWord.word;
            document.getElementById("wordDefinition").textContent =
              randomWord.definition;
            document.getElementById(
              "wordExample"
            ).textContent = `"${randomWord.example}"`;
            document.getElementById("wordLearningPanel").style.display =
              "block";

            // Add to vocabulary list
            const vocabItem = document.createElement("div");
            vocabItem.className = "vocab-item";
            vocabItem.innerHTML = `<strong>${randomWord.word}</strong>: ${randomWord.definition}`;
            document.getElementById("learnedWords").appendChild(vocabItem);
          }
        }
      }

      function closeWordPanel() {
        document.getElementById("wordLearningPanel").style.display = "none";
      }

      /*************  ‚ú® Windsurf Command ‚≠ê  *************/

      /**
       * Updates the UI with the current game state.
       * Updates the health, hunger, wood count, words learned, and game day.
       */
      /*******  b9ab2c8b-8a4d-4cdd-bc21-5fe8815faaba  *******/

      function updateUI() {
        document.getElementById("healthFill").style.width = health + "%";
        document.getElementById("hungerFill").style.width = hunger + "%";
        document.getElementById("woodCount").textContent = woodCount;
        document.getElementById("wordCount").textContent =
          learnedVocabulary.size;
        document.getElementById("gameDay").textContent = gameDay;
      }

      function movePlayer() {
        if (!gameStarted || !player) return;

        const moveSpeed = 0.2;
        const direction = new THREE.Vector3();

        if (keys["KeyW"]) direction.z -= moveSpeed;
        if (keys["KeyS"]) direction.z += moveSpeed;
        if (keys["KeyA"]) direction.x -= moveSpeed;
        if (keys["KeyD"]) direction.x += moveSpeed;

        if (direction.length() > 0) {
          direction.normalize();
          direction.multiplyScalar(moveSpeed);

          // Rotate direction based on player rotation
          direction.applyEuler(new THREE.Euler(0, player.rotation.y, 0));

          player.position.add(direction);

          // Simple walking animation
          player.position.y = Math.sin(Date.now() * 0.01) * 0.1;
        }
      }

      /*************  ‚ú® Windsurf Command ‚≠ê  *************/
      /**
       * Updates the position and rotation of the camera based on the player's
       * position and rotation. The camera's pitch is updated based on the
       * `cameraPitch` value, while the yaw is unaffected.
       */
      function updateCamera() {
        if (!gameStarted || !player || !camera) return;
        const offset = new THREE.Vector3(0, 5, 8);
        offset.applyEuler(new THREE.Euler(cameraPitch, cameraYaw, 0));
        camera.position.copy(player.position).add(offset);

        const lookAt = player.position.clone();
        lookAt.y += 2;
        camera.lookAt(lookAt);
        // Removed direct assignment to camera.rotation.x to avoid conflicts with lookAt
      }

      function animate() {
        requestAnimationFrame(animate);

        movePlayer();
        updateCamera();

        renderer.render(scene, camera);
      }

      function onWindowResize() {
        if (camera && renderer) {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        }
      }

      // Initialize the game
      init();
    </script>
  </body>
</html>
