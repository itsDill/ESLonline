<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-2456627863532019" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentence Racing - ESL Grammar Racing Game | ESL Fun Online</title>

    <!-- Favicon and Icons -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon-32x32.png"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Play Sentence Racing - Rev your engines and race to build perfect sentences! Compete against the clock in this high-speed grammar game."
    />
    <meta
      name="keywords"
      content="ESL racing game, grammar game, sentence building, speed game, competitive learning"
    />

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "Sentence Racing - ESL Grammar Racing Game",
        "description": "Rev your engines and race to build perfect sentences! Compete against the clock in this high-speed grammar game. Construct sentences faster than your opponents to cross the finish line first!",
        "url": "https://eslfunonline.com/games/sentenceracing.html",
        "author": {
          "@type": "Organization",
          "name": "ESL Fun Online"
        },
        "genre": "Educational Game",
        "educationalUse": "Grammar Practice",
        "isAccessibleForFree": true,
        "isFamilyFriendly": true
      }
    </script>

    <!-- Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>

    <!-- Fonts and Styles -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/mobile-optimized.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      :root {
        --track-bg: #4ade80;
        --road-color: #64748b;
        --finish-line: #fbbf24;
        --player-car: #3b82f6;
        --opponent-car: #ef4444;
      }

      .game-container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 2rem;
      }

      .game-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .game-header h1 {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
      }

      .game-header p {
        font-size: 1.1rem;
        color: var(--text-secondary);
      }

      /* Setup Screen */
      .setup-screen,
      .game-screen {
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        padding: 2rem;
        box-shadow: var(--shadow-md);
      }

      .instructions {
        background: var(--bg-light);
        border-left: 4px solid var(--primary-color);
        padding: 1.5rem;
        margin: 1.5rem 0;
        border-radius: var(--radius-md);
        text-align: left;
      }

      .instructions h3 {
        margin-top: 0;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .instructions ul {
        margin: 0.5rem 0;
        padding-left: 1.5rem;
      }

      .instructions li {
        margin: 0.5rem 0;
        color: var(--text-secondary);
      }

      .difficulty-selection {
        margin: 2rem 0;
      }

      .difficulty-selection h3 {
        margin-bottom: 1.5rem;
        color: var(--text-primary);
        text-align: center;
      }

      .difficulty-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .difficulty-btn {
        padding: 1.5rem 2rem;
        border: 3px solid var(--border-color);
        background: white;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.3s;
        min-width: 180px;
      }

      .difficulty-btn:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
      }

      .difficulty-btn.easy:hover,
      .difficulty-btn.easy.selected {
        border-color: #10b981;
        background: rgba(16, 185, 129, 0.1);
      }

      .difficulty-btn.medium:hover,
      .difficulty-btn.medium.selected {
        border-color: #f59e0b;
        background: rgba(245, 158, 11, 0.1);
      }

      .difficulty-btn.hard:hover,
      .difficulty-btn.hard.selected {
        border-color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
      }

      .difficulty-btn h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1.2rem;
      }

      .difficulty-btn p {
        margin: 0;
        font-size: 0.85rem;
        color: var(--text-secondary);
      }

      .btn-start {
        margin-top: 2rem;
        padding: 1.25rem 3rem;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .btn-start:hover {
        transform: translateY(-2px);
      }

      .btn-start:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Game Screen */
      .game-screen {
        display: none;
      }

      .game-screen.active {
        display: block;
      }

      .race-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .info-item {
        background: var(--bg-light);
        padding: 1rem 1.5rem;
        border-radius: var(--radius-md);
        flex: 1;
        min-width: 150px;
        text-align: center;
      }

      .info-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 0.25rem;
      }

      .info-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      /* Race Track */
      .race-track {
        background: linear-gradient(
          90deg,
          #22c55e 0%,
          #16a34a 50%,
          #22c55e 100%
        );
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin: 2rem 0;
        position: relative;
        overflow: hidden;
      }

      .track-lines {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.2;
      }

      .track-line {
        position: absolute;
        left: 0;
        right: 0;
        height: 1px;
        background: white;
      }

      .race-lanes {
        position: relative;
        background: var(--road-color);
        border-radius: var(--radius-md);
        padding: 1.5rem 1rem;
        min-height: 150px;
      }

      .lane {
        display: flex;
        align-items: center;
        margin: 1rem 0;
        position: relative;
        height: 50px;
        background: #475569;
        border-radius: var(--radius-sm);
        border: 2px dashed rgba(255, 255, 255, 0.3);
      }

      .finish-line {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 40px;
        background: repeating-linear-gradient(
          45deg,
          #000,
          #000 10px,
          #fff 10px,
          #fff 20px
        );
        border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      }

      .car {
        position: absolute;
        left: 10px;
        font-size: 2rem;
        transition: left 0.5s ease-out;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .car.player {
        color: var(--player-car);
      }

      .car.opponent {
        color: var(--opponent-car);
      }

      .car-label {
        position: absolute;
        left: 10px;
        top: -20px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }

      /* Sentence Building Area */
      .sentence-area {
        margin: 2rem 0;
      }

      .target-sentence {
        background: var(--primary-color);
        color: white;
        padding: 1.5rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        font-size: 1.2rem;
        font-weight: 600;
      }

      .word-bank {
        background: var(--bg-light);
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        min-height: 80px;
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
        justify-content: center;
      }

      .word-bank-label {
        width: 100%;
        text-align: center;
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .word-chip {
        padding: 0.75rem 1.25rem;
        background: white;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        cursor: grab;
        transition: all 0.2s;
        font-size: 1rem;
        font-weight: 500;
        user-select: none;
      }

      .word-chip:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary-color);
      }

      .word-chip:active {
        cursor: grabbing;
      }

      .word-chip.used {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .answer-zone {
        background: white;
        border: 3px solid var(--primary-color);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        min-height: 100px;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        justify-content: center;
      }

      .answer-zone-label {
        width: 100%;
        text-align: center;
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .answer-zone.correct {
        border-color: #10b981;
        background: rgba(16, 185, 129, 0.1);
      }

      .answer-zone.incorrect {
        border-color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
        animation: shake 0.5s;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .game-controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
        flex-wrap: wrap;
      }

      .btn-control {
        padding: 1rem 2rem;
        border: none;
        border-radius: var(--radius-md);
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-check {
        background: #10b981;
        color: white;
      }

      .btn-check:hover {
        background: #059669;
      }

      .btn-check:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-skip {
        background: #f59e0b;
        color: white;
      }

      .btn-skip:hover {
        background: #d97706;
      }

      .btn-reset {
        background: var(--bg-light);
        color: var(--text-primary);
        border: 2px solid var(--border-color);
      }

      .btn-reset:hover {
        border-color: var(--primary-color);
      }

      .btn-new-race {
        background: var(--primary-color);
        color: white;
      }

      .btn-new-race:hover {
        background: var(--secondary-color);
      }

      /* Results Modal */
      .results-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .results-modal.active {
        display: flex;
      }

      .results-content {
        background: white;
        border-radius: var(--radius-lg);
        padding: 3rem;
        max-width: 500px;
        text-align: center;
        box-shadow: var(--shadow-lg);
      }

      .results-content h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }

      .results-stats {
        margin: 2rem 0;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }

      .stat-box {
        background: var(--bg-light);
        padding: 1.5rem;
        border-radius: var(--radius-md);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      .stat-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 0.5rem;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .game-container {
          padding: 1rem;
        }

        .race-info {
          flex-direction: column;
        }

        .difficulty-buttons {
          flex-direction: column;
        }

        .difficulty-btn {
          width: 100%;
        }

        .word-chip {
          padding: 0.5rem 1rem;
          font-size: 0.9rem;
        }

        .car {
          font-size: 1.5rem;
        }

        .results-stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="game-container">
      <header class="game-header">
        <h1><i class="fas fa-flag-checkered"></i> Sentence Racing</h1>
        <p>Build sentences correctly to speed past your opponents!</p>
      </header>

      <!-- Setup Screen -->
      <div id="setupScreen" class="setup-screen">
        <div class="instructions">
          <h3><i class="fas fa-info-circle"></i> How to Play</h3>
          <ul>
            <li>Choose your difficulty level to start the race</li>
            <li>Read the target sentence at the top</li>
            <li>
              Drag words from the word bank to build the sentence correctly
            </li>
            <li>Click "Check Answer" to submit your sentence</li>
            <li>Correct answers make your car move forward!</li>
            <li>Race to the finish line before your opponents!</li>
          </ul>
        </div>

        <div class="difficulty-selection">
          <h3><i class="fas fa-sliders-h"></i> Select Race Difficulty</h3>
          <div class="difficulty-buttons">
            <button class="difficulty-btn easy" data-difficulty="easy">
              <h4>üü¢ Easy Track</h4>
              <p>Simple sentences | 5 laps | Perfect for beginners</p>
            </button>
            <button class="difficulty-btn medium" data-difficulty="medium">
              <h4>üü° Medium Track</h4>
              <p>Moderate complexity | 7 laps | Good challenge</p>
            </button>
            <button class="difficulty-btn hard" data-difficulty="hard">
              <h4>üî¥ Hard Track</h4>
              <p>Complex sentences | 10 laps | Expert racers</p>
            </button>
          </div>
        </div>

        <div style="text-align: center">
          <button id="startRaceBtn" class="btn-start" disabled>
            <i class="fas fa-flag-checkered"></i> Start Race
          </button>
        </div>
      </div>

      <!-- Game Screen -->
      <div id="gameScreen" class="game-screen">
        <div class="race-info">
          <div class="info-item">
            <div class="info-label">Lap</div>
            <div class="info-value" id="currentLap">1 / 5</div>
          </div>
          <div class="info-item">
            <div class="info-label">Correct</div>
            <div class="info-value" style="color: #10b981" id="correctCount">
              0
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">Mistakes</div>
            <div class="info-value" style="color: #ef4444" id="mistakeCount">
              0
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">Time</div>
            <div class="info-value" id="raceTime">0:00</div>
          </div>
        </div>

        <!-- Race Track -->
        <div class="race-track">
          <div class="race-lanes">
            <div class="lane">
              <span class="car-label">You</span>
              <div class="car player" id="playerCar">üèéÔ∏è</div>
              <div class="finish-line"></div>
            </div>
            <div class="lane">
              <span class="car-label" style="top: -20px">Opponent 1</span>
              <div class="car opponent" id="opponent1Car">üèéÔ∏è</div>
              <div class="finish-line"></div>
            </div>
            <div class="lane">
              <span class="car-label" style="top: -20px">Opponent 2</span>
              <div class="car opponent" id="opponent2Car">üèéÔ∏è</div>
              <div class="finish-line"></div>
            </div>
          </div>
        </div>

        <!-- Sentence Building Area -->
        <div class="sentence-area">
          <div class="target-sentence">
            <strong>Build this sentence:</strong>
            <span id="targetSentence"
              >The quick brown fox jumps over the lazy dog.</span
            >
          </div>

          <div class="word-bank" id="wordBank">
            <div class="word-bank-label">üì¶ Word Bank - Drag words below</div>
          </div>

          <div class="answer-zone" id="answerZone">
            <div class="answer-zone-label">‚úçÔ∏è Build your sentence here</div>
          </div>
        </div>

        <div class="game-controls">
          <button id="checkBtn" class="btn-control btn-check">
            <i class="fas fa-check-circle"></i> Check Answer
          </button>
          <button id="resetBtn" class="btn-control btn-reset">
            <i class="fas fa-undo"></i> Reset
          </button>
          <button id="skipBtn" class="btn-control btn-skip">
            <i class="fas fa-forward"></i> Skip
          </button>
          <button id="newRaceBtn" class="btn-control btn-new-race">
            <i class="fas fa-redo"></i> New Race
          </button>
        </div>
      </div>

      <!-- Results Modal -->
      <div id="resultsModal" class="results-modal">
        <div class="results-content">
          <h2 id="resultsTitle">üèÅ Race Complete!</h2>
          <p id="resultsMessage">You finished the race!</p>
          <div class="results-stats">
            <div class="stat-box">
              <div class="stat-value" id="finalPosition">1st</div>
              <div class="stat-label">Position</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="finalTime">0:00</div>
              <div class="stat-label">Time</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="finalCorrect">0</div>
              <div class="stat-label">Correct</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="finalMistakes">0</div>
              <div class="stat-label">Mistakes</div>
            </div>
          </div>
          <button id="playAgainBtn" class="btn-control btn-new-race">
            <i class="fas fa-redo"></i> Play Again
          </button>
        </div>
      </div>
    </div>

    <script>
      // Sentence database by difficulty
      const sentences = {
        easy: [
          { text: "I like pizza.", words: ["I", "like", "pizza", "."] },
          { text: "She is happy.", words: ["She", "is", "happy", "."] },
          { text: "The cat sleeps.", words: ["The", "cat", "sleeps", "."] },
          { text: "We play soccer.", words: ["We", "play", "soccer", "."] },
          { text: "He reads books.", words: ["He", "reads", "books", "."] },
          { text: "They are friends.", words: ["They", "are", "friends", "."] },
          { text: "I love music.", words: ["I", "love", "music", "."] },
          { text: "She drinks water.", words: ["She", "drinks", "water", "."] },
          { text: "The dog barks.", words: ["The", "dog", "barks", "."] },
          { text: "We eat dinner.", words: ["We", "eat", "dinner", "."] },
        ],
        medium: [
          {
            text: "I am going to the store.",
            words: ["I", "am", "going", "to", "the", "store", "."],
          },
          {
            text: "She has been studying English.",
            words: ["She", "has", "been", "studying", "English", "."],
          },
          {
            text: "They will arrive tomorrow morning.",
            words: ["They", "will", "arrive", "tomorrow", "morning", "."],
          },
          {
            text: "We have finished our homework.",
            words: ["We", "have", "finished", "our", "homework", "."],
          },
          {
            text: "He is eating a sandwich.",
            words: ["He", "is", "eating", "a", "sandwich", "."],
          },
          {
            text: "The children are playing outside.",
            words: ["The", "children", "are", "playing", "outside", "."],
          },
          {
            text: "I can speak three languages.",
            words: ["I", "can", "speak", "three", "languages", "."],
          },
          {
            text: "She wants to travel abroad.",
            words: ["She", "wants", "to", "travel", "abroad", "."],
          },
          {
            text: "They should study more often.",
            words: ["They", "should", "study", "more", "often", "."],
          },
          {
            text: "My brother lives in Tokyo.",
            words: ["My", "brother", "lives", "in", "Tokyo", "."],
          },
        ],
        hard: [
          {
            text: "If I had known earlier, I would have come.",
            words: [
              "If",
              "I",
              "had",
              "known",
              "earlier",
              ",",
              "I",
              "would",
              "have",
              "come",
              ".",
            ],
          },
          {
            text: "The book that I borrowed was fascinating.",
            words: [
              "The",
              "book",
              "that",
              "I",
              "borrowed",
              "was",
              "fascinating",
              ".",
            ],
          },
          {
            text: "Despite the rain, we continued our journey.",
            words: [
              "Despite",
              "the",
              "rain",
              ",",
              "we",
              "continued",
              "our",
              "journey",
              ".",
            ],
          },
          {
            text: "Having finished her work, she went home.",
            words: [
              "Having",
              "finished",
              "her",
              "work",
              ",",
              "she",
              "went",
              "home",
              ".",
            ],
          },
          {
            text: "The more you practice, the better you become.",
            words: [
              "The",
              "more",
              "you",
              "practice",
              ",",
              "the",
              "better",
              "you",
              "become",
              ".",
            ],
          },
          {
            text: "Neither the students nor the teacher was present.",
            words: [
              "Neither",
              "the",
              "students",
              "nor",
              "the",
              "teacher",
              "was",
              "present",
              ".",
            ],
          },
          {
            text: "She not only sings but also plays guitar.",
            words: [
              "She",
              "not",
              "only",
              "sings",
              "but",
              "also",
              "plays",
              "guitar",
              ".",
            ],
          },
          {
            text: "The building which was constructed last year collapsed.",
            words: [
              "The",
              "building",
              "which",
              "was",
              "constructed",
              "last",
              "year",
              "collapsed",
              ".",
            ],
          },
          {
            text: "Had I realized the consequences, I would not have agreed.",
            words: [
              "Had",
              "I",
              "realized",
              "the",
              "consequences",
              ",",
              "I",
              "would",
              "not",
              "have",
              "agreed",
              ".",
            ],
          },
          {
            text: "By the time you arrive, I will have finished cooking.",
            words: [
              "By",
              "the",
              "time",
              "you",
              "arrive",
              ",",
              "I",
              "will",
              "have",
              "finished",
              "cooking",
              ".",
            ],
          },
        ],
      };

      // Game state
      let selectedDifficulty = null;
      let totalLaps = 5;
      let currentLap = 1;
      let correctAnswers = 0;
      let mistakes = 0;
      let currentSentenceIndex = 0;
      let availableSentences = [];
      let currentSentence = null;
      let playerProgress = 0;
      let opponent1Progress = 0;
      let opponent2Progress = 0;
      let raceStartTime = null;
      let timerInterval = null;
      let draggedElement = null;
      let raceFinished = false;

      // DOM elements
      const setupScreen = document.getElementById("setupScreen");
      const gameScreen = document.getElementById("gameScreen");
      const resultsModal = document.getElementById("resultsModal");
      const difficultyButtons = document.querySelectorAll(".difficulty-btn");
      const startRaceBtn = document.getElementById("startRaceBtn");
      const targetSentence = document.getElementById("targetSentence");
      const wordBank = document.getElementById("wordBank");
      const answerZone = document.getElementById("answerZone");
      const currentLapDisplay = document.getElementById("currentLap");
      const correctCount = document.getElementById("correctCount");
      const mistakeCount = document.getElementById("mistakeCount");
      const raceTime = document.getElementById("raceTime");
      const playerCar = document.getElementById("playerCar");
      const opponent1Car = document.getElementById("opponent1Car");
      const opponent2Car = document.getElementById("opponent2Car");
      const checkBtn = document.getElementById("checkBtn");
      const resetBtn = document.getElementById("resetBtn");
      const skipBtn = document.getElementById("skipBtn");
      const newRaceBtn = document.getElementById("newRaceBtn");
      const playAgainBtn = document.getElementById("playAgainBtn");

      // Difficulty selection
      difficultyButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          difficultyButtons.forEach((b) => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedDifficulty = btn.dataset.difficulty;

          // Set laps based on difficulty
          if (selectedDifficulty === "easy") totalLaps = 5;
          else if (selectedDifficulty === "medium") totalLaps = 7;
          else totalLaps = 10;

          startRaceBtn.disabled = false;
        });
      });

      // Start race
      startRaceBtn.addEventListener("click", () => {
        availableSentences = [...sentences[selectedDifficulty]];
        shuffleArray(availableSentences);
        currentSentenceIndex = 0;
        currentLap = 1;
        correctAnswers = 0;
        mistakes = 0;
        playerProgress = 0;
        opponent1Progress = 0;
        opponent2Progress = 0;
        raceFinished = false;

        setupScreen.classList.add("hidden");
        gameScreen.classList.add("active");

        updateRaceInfo();
        loadNextSentence();
        startTimer();
        resetCarPositions();
      });

      // Load next sentence
      function loadNextSentence() {
        if (currentSentenceIndex >= availableSentences.length) {
          shuffleArray(availableSentences);
          currentSentenceIndex = 0;
        }

        currentSentence = availableSentences[currentSentenceIndex];
        targetSentence.textContent = currentSentence.text;

        // Shuffle and display words
        const shuffledWords = [...currentSentence.words];
        shuffleArray(shuffledWords);

        wordBank.innerHTML =
          '<div class="word-bank-label">üì¶ Word Bank - Click or drag words below</div>';
        shuffledWords.forEach((word) => {
          const chip = createWordChip(word);
          wordBank.appendChild(chip);
        });

        // Clear answer zone
        answerZone.innerHTML =
          '<div class="answer-zone-label">‚úçÔ∏è Build your sentence here</div>';
        answerZone.classList.remove("correct", "incorrect");

        currentSentenceIndex++;
      }

      // Create word chip
      function createWordChip(word) {
        const chip = document.createElement("div");
        chip.className = "word-chip";
        chip.textContent = word;
        chip.draggable = true;

        // Click to move
        chip.addEventListener("click", () => {
          if (!chip.classList.contains("used")) {
            const clone = chip.cloneNode(true);
            setupWordChip(clone);
            answerZone.appendChild(clone);
            chip.classList.add("used");
          }
        });

        // Drag events
        chip.addEventListener("dragstart", handleDragStart);
        chip.addEventListener("dragend", handleDragEnd);

        return chip;
      }

      function setupWordChip(chip) {
        chip.draggable = true;
        chip.classList.remove("used");

        chip.addEventListener("click", () => {
          chip.remove();
          // Re-enable word in bank
          const wordInBank = Array.from(wordBank.children).find(
            (c) =>
              c.textContent === chip.textContent && c.classList.contains("used")
          );
          if (wordInBank) wordInBank.classList.remove("used");
        });

        chip.addEventListener("dragstart", handleDragStart);
        chip.addEventListener("dragend", handleDragEnd);
      }

      // Drag and drop handlers
      function handleDragStart(e) {
        draggedElement = e.target;
        e.target.style.opacity = "0.5";
      }

      function handleDragEnd(e) {
        e.target.style.opacity = "1";
      }

      answerZone.addEventListener("dragover", (e) => {
        e.preventDefault();
      });

      answerZone.addEventListener("drop", (e) => {
        e.preventDefault();
        if (draggedElement && !draggedElement.classList.contains("used")) {
          const clone = draggedElement.cloneNode(true);
          setupWordChip(clone);
          answerZone.appendChild(clone);
          draggedElement.classList.add("used");
        }
      });

      // Check answer
      checkBtn.addEventListener("click", () => {
        const userAnswer = Array.from(answerZone.children)
          .filter((child) => child.classList.contains("word-chip"))
          .map((chip) => chip.textContent)
          .join(" ");

        if (userAnswer === currentSentence.text) {
          // Correct!
          correctAnswers++;
          answerZone.classList.add("correct");
          playSound("correct");

          // Move player forward
          playerProgress += 1;
          updateCarPosition(playerCar, playerProgress);

          setTimeout(() => {
            if (playerProgress >= totalLaps) {
              finishRace(true);
            } else {
              currentLap++;
              updateRaceInfo();
              loadNextSentence();
            }
          }, 1000);
        } else {
          // Incorrect
          mistakes++;
          answerZone.classList.add("incorrect");
          playSound("incorrect");

          setTimeout(() => {
            answerZone.classList.remove("incorrect");
          }, 500);
        }

        updateRaceInfo();
        moveOpponents();
      });

      // Reset answer
      resetBtn.addEventListener("click", () => {
        answerZone.innerHTML =
          '<div class="answer-zone-label">‚úçÔ∏è Build your sentence here</div>';
        answerZone.classList.remove("correct", "incorrect");

        // Re-enable all words
        Array.from(wordBank.children).forEach((chip) => {
          if (chip.classList.contains("word-chip")) {
            chip.classList.remove("used");
          }
        });
      });

      // Skip sentence
      skipBtn.addEventListener("click", () => {
        mistakes++;
        updateRaceInfo();
        moveOpponents();
        loadNextSentence();
      });

      // New race
      newRaceBtn.addEventListener("click", () => {
        gameScreen.classList.remove("active");
        setupScreen.classList.remove("hidden");
        clearInterval(timerInterval);
      });

      playAgainBtn.addEventListener("click", () => {
        resultsModal.classList.remove("active");
        setupScreen.classList.remove("hidden");
        clearInterval(timerInterval);
      });

      // Update race info
      function updateRaceInfo() {
        currentLapDisplay.textContent = `${currentLap} / ${totalLaps}`;
        correctCount.textContent = correctAnswers;
        mistakeCount.textContent = mistakes;
      }

      // Timer
      function startTimer() {
        raceStartTime = Date.now();
        timerInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - raceStartTime) / 1000);
          const minutes = Math.floor(elapsed / 60);
          const seconds = elapsed % 60;
          raceTime.textContent = `${minutes}:${seconds
            .toString()
            .padStart(2, "0")}`;
        }, 1000);
      }

      // Move opponents (simulated)
      function moveOpponents() {
        // Opponents move randomly
        if (Math.random() > 0.3) {
          opponent1Progress += Math.random() > 0.5 ? 1 : 0.5;
          updateCarPosition(opponent1Car, opponent1Progress);
        }

        if (Math.random() > 0.4) {
          opponent2Progress += Math.random() > 0.6 ? 1 : 0.5;
          updateCarPosition(opponent2Car, opponent2Progress);
        }

        // Check if opponents finished
        if (opponent1Progress >= totalLaps || opponent2Progress >= totalLaps) {
          if (!raceFinished) {
            finishRace(false);
          }
        }
      }

      // Update car position
      function updateCarPosition(car, progress) {
        const maxPosition = car.parentElement.offsetWidth - 100;
        const position = Math.min(
          (progress / totalLaps) * maxPosition,
          maxPosition
        );
        car.style.left = position + "px";
      }

      // Reset car positions
      function resetCarPositions() {
        playerCar.style.left = "10px";
        opponent1Car.style.left = "10px";
        opponent2Car.style.left = "10px";
      }

      // Finish race
      function finishRace(playerWon) {
        raceFinished = true;
        clearInterval(timerInterval);

        const elapsed = Math.floor((Date.now() - raceStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        const timeString = `${minutes}:${seconds.toString().padStart(2, "0")}`;

        // Determine position
        let position = 1;
        if (
          opponent1Progress >= totalLaps &&
          opponent1Progress > playerProgress
        )
          position++;
        if (
          opponent2Progress >= totalLaps &&
          opponent2Progress > playerProgress
        )
          position++;

        const positionText =
          position === 1 ? "1st ü•á" : position === 2 ? "2nd ü•à" : "3rd ü•â";

        document.getElementById("resultsTitle").textContent = playerWon
          ? "üèÅ Victory!"
          : "üèÅ Race Complete!";
        document.getElementById("resultsMessage").textContent = playerWon
          ? "Congratulations! You won the race!"
          : "Good effort! Keep practicing to improve!";
        document.getElementById("finalPosition").textContent = positionText;
        document.getElementById("finalTime").textContent = timeString;
        document.getElementById("finalCorrect").textContent = correctAnswers;
        document.getElementById("finalMistakes").textContent = mistakes;

        resultsModal.classList.add("active");
        playSound(playerWon ? "win" : "finish");
      }

      // Sound effects
      function playSound(type) {
        const context = new (window.AudioContext ||
          window.webkitAudioContext)();
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(context.destination);

        if (type === "correct") {
          oscillator.frequency.value = 800;
          gainNode.gain.setValueAtTime(0.3, context.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            context.currentTime + 0.3
          );
          oscillator.start(context.currentTime);
          oscillator.stop(context.currentTime + 0.3);
        } else if (type === "incorrect") {
          oscillator.frequency.value = 200;
          gainNode.gain.setValueAtTime(0.2, context.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            context.currentTime + 0.2
          );
          oscillator.start(context.currentTime);
          oscillator.stop(context.currentTime + 0.2);
        } else if (type === "win") {
          // Victory fanfare
          [523, 659, 784, 1047].forEach((freq, i) => {
            const osc = context.createOscillator();
            const gain = context.createGain();
            osc.connect(gain);
            gain.connect(context.destination);
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.3, context.currentTime + i * 0.15);
            gain.gain.exponentialRampToValueAtTime(
              0.01,
              context.currentTime + i * 0.15 + 0.2
            );
            osc.start(context.currentTime + i * 0.15);
            osc.stop(context.currentTime + i * 0.15 + 0.2);
          });
        } else if (type === "finish") {
          oscillator.frequency.value = 400;
          gainNode.gain.setValueAtTime(0.3, context.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            context.currentTime + 0.5
          );
          oscillator.start(context.currentTime);
          oscillator.stop(context.currentTime + 0.5);
        }
      }

      // Utility
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
    </script>
  </body>
</html>
