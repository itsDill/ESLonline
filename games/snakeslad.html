<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>
      English Snakes & Ladders - ESL Learning Adventure Game | ESL Fun Online
    </title>
    <meta
      name="description"
      content="Play the classic Snakes & Ladders with an ESL twist! Answer English vocabulary, grammar, and conversation questions to climb ladders and avoid snakes."
    />
    <meta
      name="keywords"
      content="snakes and ladders, ESL game, English learning game, board game, vocabulary game, grammar game, educational game"
    />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://pagead2.googlesyndication.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" />

    <!-- AdSense -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-2456627863532019" />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>
    <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="../images/favicon-48x48.png"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../images/favicon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="../images/favicon-512x512.png"
    />

    <!-- Open Graph Tags -->
    <meta
      property="og:title"
      content="English Snakes & Ladders - ESL Learning Adventure Game"
    />
    <meta
      property="og:description"
      content="Play the classic Snakes & Ladders with an ESL twist! Answer English questions to climb ladders and avoid snakes."
    />
    <meta
      property="og:image"
      content="https://eslfunonline.com/images/image.png"
    />
    <meta
      property="og:url"
      content="https://eslfunonline.com/games/snakeslad.html"
    />
    <meta property="og:type" content="game" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="ESL Fun Online" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="English Snakes & Ladders ESL Game" />
    <meta
      name="twitter:description"
      content="Classic board game with English learning questions!"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/image.png"
    />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="https://eslfunonline.com/games/snakeslad.html"
    />

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "VideoGame",
        "name": "English Snakes & Ladders ESL Game",
        "description": "Play the classic Snakes & Ladders with an ESL twist! Answer English vocabulary, grammar, and conversation questions to climb ladders and avoid snakes in this educational adventure.",
        "url": "https://eslfunonline.com/games/snakeslad.html",
        "image": "https://eslfunonline.com/images/image.png",
        "publisher": {
          "@type": "Organization",
          "name": "ESL Fun Online",
          "url": "https://eslfunonline.com"
        },
        "genre": ["Educational", "Board Game", "Grammar", "Vocabulary"],
        "audience": {
          "@type": "EducationalAudience",
          "educationalRole": "student",
          "audienceType": "ESL Learners of All Ages"
        },
        "educationalLevel": "All Levels",
        "educationalUse": [
          "grammar practice",
          "vocabulary building",
          "conversation practice",
          "family learning"
        ],
        "interactivityType": "active",
        "learningResourceType": "Interactive Game",
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "isFamilyFriendly": true,
        "numberOfPlayers": {
          "@type": "QuantitativeValue",
          "value": 1
        },
        "playMode": "SinglePlayer",
        "applicationCategory": "Game",
        "accessibilityFeature": [
          "alternativeText",
          "keyboardNavigation",
          "ariaLabels",
          "highContrast"
        ],
        "keywords": "ESL board game, snakes and ladders, English learning, family game"
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://eslfunonline.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Games",
            "item": "https://eslfunonline.com/games/games.html"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": "Snakes & Ladders",
            "item": "https://eslfunonline.com/games/snakeslad.html"
          }
        ]
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How do I play ESL Snakes & Ladders?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Roll the dice to move forward on the board. When you land on a question square, answer correctly to earn stars. Land on a ladder to climb up, but watch out for snakes that take you down! First to reach square 100 wins!"
            }
          },
          {
            "@type": "Question",
            "name": "What topics can I practice in Snakes & Ladders?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Choose from three learning modes: Fun Vocabulary (word meanings and opposites), Cool Conversations (phrases and responses), and Grammar Games (verb tenses, articles, and sentence structure)."
            }
          },
          {
            "@type": "Question",
            "name": "Can I track my progress in the game?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes! The game tracks your stars earned, correct answer streak, games played, games won, and best streak. Click 'My Stats' to see your progress and try to beat your records!"
            }
          }
        ]
      }
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&family=Comic+Neue:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    

    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/snakeslad-page.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Skip Link for Accessibility */
      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: #6366f1;
        color: white;
        padding: 8px 16px;
        z-index: 10000;
        text-decoration: none;
        border-radius: 0 0 4px 0;
        font-weight: 600;
        transition: top 0.3s;
      }
      .skip-link:focus {
        top: 0;
      }

      html,
      body {
        margin: 0 !important;
        padding: 0 !important;
        padding-top: 0 !important;
      }

      body {
        font-family: "Inter", "Poppins", sans-serif;
        background-color: #1a1a2e;
        background: url("../images/game-bg-blue.jpg") center center / cover
          no-repeat fixed;
        min-height: 100vh;
        color: #e2e8f0;
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
        padding-bottom: env(safe-area-inset-bottom);
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.35);
        pointer-events: none;
        z-index: 0;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Compact Navigation Header */
      .game-nav-header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 0.75rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav-left {
        display: flex;
        gap: 0.75rem;
      }

      .nav-btn {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      .nav-game-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .nav-game-title i {
        color: #fbbf24;
      }

      /* Ad Wrapper */
      .ad-wrapper {
        max-width: 800px;
        margin: 1rem auto;
        padding: 0 1rem;
        text-align: center;
        contain: layout style;
        isolation: isolate;
        max-height: 100px;
        overflow: hidden;
      }

      @media (max-width: 768px) {
        .ad-wrapper {
          max-height: 90px;
        }

        .nav-btn {
          min-height: 44px;
          padding: 0.5rem 0.75rem;
        }
      }

      @media (max-width: 480px) {
        .ad-wrapper {
          max-height: 70px;
        }

        .nav-btn {
          font-size: 0.85rem;
          padding: 0.4rem 0.6rem;
        }

        .nav-game-title {
          font-size: 0.95rem;
        }

        .control-btn {
          min-height: 44px;
          padding: 0.6rem 1rem;
        }
      }

      @media (max-width: 380px) {
        .nav-left {
          gap: 0.4rem;
        }

        .nav-btn span {
          display: none;
        }
      }

      /* Accessibility */
      *:focus-visible {
        outline: 2px solid #fbbf24;
        outline-offset: 2px;
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }

        body {
          animation: none !important;
        }
      }

      @media (prefers-contrast: high) {
        .nav-btn,
        .control-btn {
          border: 2px solid white !important;
        }

        .setup-screen,
        .info-panel,
        .question-panel {
          border: 2px solid white !important;
        }
      }

      /* Footer */
      .game-footer {
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        padding: 1.5rem;
        text-align: center;
        margin-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .footer-links {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }

      .footer-links a {
        color: #94a3b8;
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.3s ease;
      }

      .footer-links a:hover {
        color: white;
      }

      .footer-copyright {
        color: #64748b;
        font-size: 0.85rem;
      }

      /* Override game header for dark theme */
      .game-header {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(10px) !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
      }

      .game-title {
        color: #e2e8f0 !important;
      }

      .control-btn {
        background: rgba(255, 255, 255, 0.15) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: white !important;
      }

      .control-btn:hover {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      .control-btn.secondary {
        background: rgba(255, 255, 255, 0.1) !important;
      }

      /* Setup screen dark theme */
      .setup-screen {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
      }

      .setup-title {
        color: #e2e8f0 !important;
      }

      .player-option {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .player-option:hover,
      .player-option.selected {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      .category-option {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .category-option:hover,
      .category-option.selected {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      /* Game screen dark theme */
      .game-screen {
        background: transparent !important;
      }

      .info-panel {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        color: #e2e8f0 !important;
      }

      .question-panel {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
      }

      .question-text {
        color: #e2e8f0 !important;
      }

      .answer-option {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 2px solid rgba(255, 255, 255, 0.2) !important;
        color: #e2e8f0 !important;
      }

      .answer-option:hover {
        background: rgba(99, 102, 241, 0.3) !important;
        border-color: #6366f1 !important;
      }

      .message-modal {
        background: rgba(30, 41, 59, 0.95) !important;
        backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        color: #e2e8f0 !important;
      }

      .particles {
        opacity: 0.3;
      }
    </style>
  </head>
  <body>
    <a href="#main-game" class="skip-link">Skip to game</a>

    <!-- Compact Navigation Header -->
    <nav class="game-nav-header" aria-label="Game navigation">
      <div class="nav-left">
        <a href="../index.html" class="nav-btn" aria-label="Go to home page">
          <i class="fas fa-home" aria-hidden="true"></i> <span>Home</span>
        </a>
        <a href="games.html" class="nav-btn" aria-label="Go to games list">
          <i class="fas fa-gamepad" aria-hidden="true"></i> <span>Games</span>
        </a>
      </div>
      <div class="nav-game-title">
        <i class="fas fa-dice" aria-hidden="true"></i> Snakes & Ladders
      </div>
    </nav>

    <main id="main-game">
      <div class="particles" id="particles" aria-hidden="true"></div>

      <header class="game-header" role="banner">
        <div class="header-content">
          <h1 class="game-title">
            <span aria-hidden="true">üêçü™ú</span> Super Fun English Snakes &
            Ladders
          </h1>
          <div class="game-controls" role="group" aria-label="Game controls">
            <button
              class="control-btn"
              onclick="newGame()"
              aria-label="Start a new game adventure"
            >
              <i class="fas fa-plus" aria-hidden="true"></i>
              New Adventure
            </button>
            <button
              class="control-btn secondary"
              onclick="showRules()"
              aria-label="Show game rules and instructions"
            >
              <i class="fas fa-question-circle" aria-hidden="true"></i>
              How to Play
            </button>
            <button
              class="control-btn secondary"
              onclick="showStats()"
              aria-label="View your game statistics"
            >
              <i class="fas fa-trophy" aria-hidden="true"></i>
              My Stats
            </button>
          </div>
        </div>
      </header>

      <!-- Immediate Mobile Menu Script - Inline for guaranteed execution -->
      <script>
        (function () {
          "use strict";

          function initMobileMenu() {
            const mobileToggle = document.getElementById("mobileToggle");
            const navLinks = document.getElementById("navLinks");
            const body = document.body;

            if (!mobileToggle || !navLinks) {
              console.warn("Mobile menu elements not found");
              return;
            }

            let isMenuOpen = false;

            function toggleMenu(e) {
              if (e && e.preventDefault) e.preventDefault();
              if (e && e.stopPropagation) e.stopPropagation();

              isMenuOpen = !isMenuOpen;
              const icon = mobileToggle.querySelector("i");

              if (isMenuOpen) {
                navLinks.classList.add("active");
                body.classList.add("mobile-menu-open");
                body.style.overflow = "hidden";
                if (icon) icon.className = "fas fa-times";
              } else {
                navLinks.classList.remove("active");
                body.classList.remove("mobile-menu-open");
                body.style.overflow = "";
                if (icon) icon.className = "fas fa-bars";

                // Close all dropdowns
                document.querySelectorAll(".nav-item").forEach((item) => {
                  item.classList.remove("mobile-open", "mobile-dropdown-open");
                  const chevron = item.querySelector(".fa-chevron-down");
                  if (chevron) chevron.style.transform = "rotate(0deg)";
                });
              }
            }

            // Simple unified handler - works for both touch and click
            let lastToggleTime = 0;

            function handleToggleClick(e) {
              const now = Date.now();
              // Prevent double-firing within 300ms
              if (now - lastToggleTime < 300) {
                return;
              }
              lastToggleTime = now;

              e.preventDefault();
              e.stopPropagation();
              toggleMenu(e);
            }

            mobileToggle.addEventListener("click", handleToggleClick);
            mobileToggle.addEventListener("touchend", handleToggleClick);

            // Handle dropdown toggles on mobile
            document.querySelectorAll(".nav-item").forEach((item) => {
              const link = item.querySelector(".nav-link");
              const dropdown = item.querySelector(".dropdown");
              const chevron = link?.querySelector(".fa-chevron-down");

              // Only add special handling for links WITH dropdowns
              if (link && dropdown && chevron) {
                // Simple unified dropdown handler
                let lastDropdownToggle = 0;

                function handleDropdownClick(e) {
                  if (window.innerWidth > 768) return; // Only on mobile

                  const now = Date.now();
                  // Prevent double-firing within 300ms
                  if (now - lastDropdownToggle < 300) {
                    return;
                  }
                  lastDropdownToggle = now;

                  e.preventDefault();
                  e.stopPropagation();

                  const isOpen = item.classList.contains("mobile-open");

                  // Close other dropdowns
                  document
                    .querySelectorAll(".nav-item")
                    .forEach((otherItem) => {
                      if (otherItem !== item) {
                        otherItem.classList.remove(
                          "mobile-open",
                          "mobile-dropdown-open",
                        );
                        const otherChevron =
                          otherItem.querySelector(".fa-chevron-down");
                        if (otherChevron)
                          otherChevron.style.transform = "rotate(0deg)";
                      }
                    });

                  // Toggle current dropdown
                  if (isOpen) {
                    item.classList.remove(
                      "mobile-open",
                      "mobile-dropdown-open",
                    );
                    chevron.style.transform = "rotate(0deg)";
                    link.setAttribute("aria-expanded", "false");
                  } else {
                    item.classList.add("mobile-open", "mobile-dropdown-open");
                    chevron.style.transform = "rotate(180deg)";
                    link.setAttribute("aria-expanded", "true");
                  }
                }

                // Remove href="#" behavior on mobile
                if (link.getAttribute("href") === "#") {
                  link.style.cursor = "pointer";
                }

                // Attach handlers for both click and touch
                link.addEventListener("click", handleDropdownClick);
                link.addEventListener("touchend", handleDropdownClick);
              }
            });

            // Close menu when clicking outside
            document.addEventListener("click", function (e) {
              if (window.innerWidth <= 768 && isMenuOpen) {
                if (
                  !mobileToggle.contains(e.target) &&
                  !navLinks.contains(e.target)
                ) {
                  toggleMenu(null);
                }
              }
            });

            // Close menu on escape key
            document.addEventListener("keydown", function (e) {
              if (e.key === "Escape" && isMenuOpen) {
                toggleMenu(null);
                mobileToggle.focus();
              }
            });

            // Close menu on window resize to desktop
            window.addEventListener("resize", function () {
              if (window.innerWidth > 768 && isMenuOpen) {
                toggleMenu(null);
              }
            });

            // Close menu after dropdown link click
            document.querySelectorAll(".dropdown a").forEach((link) => {
              link.addEventListener("click", function () {
                if (window.innerWidth <= 768 && isMenuOpen) {
                  setTimeout(() => {
                    toggleMenu(null);
                  }, 100);
                }
              });
            });
          }

          // Initialize immediately if DOM is ready, otherwise wait
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initMobileMenu);
          } else {
            initMobileMenu();
          }
        })();
      </script>

      <!-- Additional Mobile Dropdown Fixes -->

      <!-- Google AdSense -->
      <!-- Setup Screen -->
      <div
        class="setup-screen"
        id="setupScreen"
        role="main"
        aria-label="Game setup"
      >
        <div class="setup-container">
          <h2 class="setup-title">
            üöÄ Start Your English Learning Adventure! üåü
          </h2>

          <!-- Board Selection -->
          <div class="setup-section">
            <h3><i class="fas fa-map"></i> Choose Your Adventure Board</h3>
            <div
              class="board-selection"
              id="boardSelection"
              role="radiogroup"
              aria-label="Board selection"
            >
              <!-- Board options will be populated here -->
            </div>
          </div>

          <!-- Player Selection -->
          <div class="setup-section">
            <h3><i class="fas fa-user-astronaut"></i> Pick Your Character</h3>
            <div
              class="player-selection"
              id="playerSelection"
              role="radiogroup"
              aria-label="Character selection"
            >
              <!-- Player options will be populated here -->
            </div>
          </div>

          <!-- Content Type Selection -->
          <div class="setup-section">
            <h3><i class="fas fa-brain"></i> What Do You Want to Learn?</h3>
            <div
              class="content-selection"
              id="contentSelection"
              role="radiogroup"
              aria-label="Learning topic selection"
            >
              <button
                class="content-option"
                data-content="vocabulary"
                role="radio"
                aria-checked="false"
              >
                <i class="fas fa-book-open"></i> Fun Vocabulary
              </button>
              <button
                class="content-option"
                data-content="conversation"
                role="radio"
                aria-checked="false"
              >
                <i class="fas fa-comments"></i> Cool Conversations
              </button>
              <button
                class="content-option"
                data-content="grammar"
                role="radio"
                aria-checked="false"
              >
                <i class="fas fa-spell-check"></i> Grammar Games
              </button>
            </div>
          </div>

          <button
            class="start-game-btn"
            id="startGameBtn"
            onclick="startGame()"
            disabled
            aria-label="Start the game with selected options"
          >
            <i class="fas fa-rocket"></i> Start My Adventure!
          </button>
        </div>
      </div>

      <!-- Game Screen -->
      <div
        class="game-screen"
        id="gameScreen"
        role="main"
        aria-label="Game board"
      >
        <!-- Game Status -->
        <div class="game-status" role="status" aria-live="polite">
          <div class="status-item">
            <div
              class="player-avatar"
              id="playerAvatar"
              aria-hidden="true"
            ></div>
            <div>
              <div style="font-size: 1.1rem; font-weight: 700">
                Your Progress
              </div>
              <div>
                Square:
                <span
                  id="playerPosition"
                  class="info-value"
                  aria-label="Current position"
                  >1</span
                >/100
              </div>
              <div
                class="progress-bar"
                role="progressbar"
                aria-valuenow="1"
                aria-valuemin="1"
                aria-valuemax="100"
              >
                <div
                  class="progress-fill"
                  id="progressFill"
                  style="width: 1%"
                ></div>
              </div>
            </div>
          </div>

          <div class="turn-indicator" id="turnIndicator" aria-live="polite">
            üé≤ Roll the Magic Dice! ‚ú®
          </div>

          <div class="status-item">
            <div>
              <div style="font-size: 1.1rem; font-weight: 700" id="contentType">
                Vocabulary Fun
              </div>
              <div>
                Stars:
                <span
                  id="playerScore"
                  class="info-value"
                  aria-label="Current score"
                  >0</span
                >
                ‚≠ê
              </div>
              <div>
                Streak:
                <span
                  id="correctStreak"
                  class="info-value"
                  aria-label="Current correct streak"
                  >0</span
                >
                üî•
              </div>
            </div>
          </div>
        </div>

        <!-- Game Board Container -->
        <div class="game-board-container">
          <!-- Game Board -->
          <div class="board-area">
            <div
              class="game-board"
              id="gameBoard"
              role="region"
              aria-label="Game board"
            >
              <div class="board-grid" id="boardGrid" role="grid">
                <!-- Board cells will be generated here -->
              </div>
              <div
                class="player-piece"
                id="playerPiece"
                aria-hidden="true"
              ></div>
            </div>
          </div>

          <!-- Game Controls -->
          <div
            class="game-controls-panel"
            role="region"
            aria-label="Game controls"
          >
            <!-- Dice Control -->
            <div class="control-panel">
              <h4>üé≤ Magic Dice</h4>
              <div class="dice-container">
                <div
                  class="dice"
                  id="dice"
                  role="img"
                  aria-label="Dice showing six"
                >
                  <i class="fas fa-dice-six"></i>
                </div>
                <button
                  class="roll-btn"
                  id="rollBtn"
                  onclick="rollDice()"
                  aria-label="Roll the dice to move forward"
                >
                  üé≤ Roll the Dice!
                </button>
              </div>
            </div>

            <!-- Question Panel -->
            <div
              class="control-panel question-panel"
              id="questionPanel"
              role="region"
              aria-label="Question panel"
            >
              <div class="question-title" id="questionTitle">
                <i class="fas fa-star"></i> Learning Challenge
                <i class="fas fa-star"></i>
              </div>
              <div
                class="question-content"
                id="questionContent"
                role="heading"
                aria-level="3"
              >
                <!-- Question will be displayed here -->
              </div>
              <div
                class="question-options"
                id="questionOptions"
                role="group"
                aria-label="Answer options"
              >
                <!-- Options will be displayed here -->
              </div>
              <button
                class="continue-btn"
                id="continueBtn"
                onclick="continueGame()"
                style="display: none"
                aria-label="Continue to next turn"
              >
                ‚ú® Continue Adventure ‚ú®
              </button>
            </div>

            <!-- Game Info -->
            <div class="control-panel">
              <h4>üéØ Your Stats</h4>
              <div class="game-info">
                <div class="info-item">
                  <span><i class="fas fa-footsteps"></i> Moves:</span>
                  <span
                    id="moveCount"
                    class="info-value"
                    aria-label="Number of moves"
                    >0</span
                  >
                </div>
                <div class="info-item">
                  <span><i class="fas fa-clock"></i> Time:</span>
                  <span id="gameTime" class="info-value" aria-label="Game time"
                    >0:00</span
                  >
                </div>
                <div class="info-item">
                  <span><i class="fas fa-check-circle"></i> Correct:</span>
                  <span id="correctAnswers" class="info-value">0</span>
                </div>
                <div class="info-item">
                  <span><i class="fas fa-percentage"></i> Score:</span>
                  <span id="accuracyRate" class="info-value">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Game Message Modal -->
      <div class="game-message" id="gameMessage">
        <div class="message-content">
          <div class="message-title" id="messageTitle">üéâ Amazing!</div>
          <div class="message-text" id="messageText">You're doing great!</div>
          <button class="message-btn" onclick="closeMessage()">
            <i class="fas fa-arrow-right"></i> Continue
          </button>
        </div>
      </div>

      <script>
        // Game State
        let gameState = {
          selectedBoard: null,
          selectedPlayer: null,
          selectedContent: null,
          playerPosition: 1,
          playerScore: 0,
          moveCount: 0,
          correctAnswers: 0,
          gameStartTime: null,
          currentQuestion: null,
          isMoving: false,
          gameOver: false,
          currentStreak: 0,
          bestStreak: parseInt(localStorage.getItem("sl_bestStreak") || "0"),
          stats: {
            gamesPlayed: parseInt(
              localStorage.getItem("sl_gamesPlayed") || "0",
            ),
            gamesWon: parseInt(localStorage.getItem("sl_gamesWon") || "0"),
            totalTime: parseInt(localStorage.getItem("sl_totalTime") || "0"),
            bestStreak: parseInt(localStorage.getItem("sl_bestStreak") || "0"),
          },
        };

        // Audio Context for sound effects
        let audioContext;
        let soundEnabled = true;

        // Initialize audio on first user interaction
        function initAudio() {
          if (!audioContext) {
            audioContext = new (
              window.AudioContext || window.webkitAudioContext
            )();
          }
        }

        // Play sound effect
        function playSound(type) {
          if (!soundEnabled || !audioContext) return;

          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          switch (type) {
            case "success":
              oscillator.frequency.setValueAtTime(
                523.25,
                audioContext.currentTime,
              ); // C5
              oscillator.frequency.setValueAtTime(
                659.25,
                audioContext.currentTime + 0.1,
              ); // E5
              oscillator.frequency.setValueAtTime(
                783.99,
                audioContext.currentTime + 0.2,
              ); // G5
              gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                audioContext.currentTime + 0.3,
              );
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.3);
              break;
            case "error":
              oscillator.frequency.setValueAtTime(
                200,
                audioContext.currentTime,
              );
              gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                audioContext.currentTime + 0.2,
              );
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.2);
              break;
            case "dice":
              oscillator.frequency.setValueAtTime(
                440,
                audioContext.currentTime,
              );
              oscillator.frequency.setValueAtTime(
                880,
                audioContext.currentTime + 0.05,
              );
              gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                audioContext.currentTime + 0.15,
              );
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.15);
              break;
            case "ladder":
              oscillator.frequency.setValueAtTime(
                400,
                audioContext.currentTime,
              );
              oscillator.frequency.setValueAtTime(
                600,
                audioContext.currentTime + 0.1,
              );
              oscillator.frequency.setValueAtTime(
                800,
                audioContext.currentTime + 0.2,
              );
              gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                audioContext.currentTime + 0.3,
              );
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.3);
              break;
            case "snake":
              oscillator.frequency.setValueAtTime(
                600,
                audioContext.currentTime,
              );
              oscillator.frequency.setValueAtTime(
                400,
                audioContext.currentTime + 0.1,
              );
              oscillator.frequency.setValueAtTime(
                200,
                audioContext.currentTime + 0.2,
              );
              gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                audioContext.currentTime + 0.3,
              );
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.3);
              break;
            case "win":
              oscillator.frequency.setValueAtTime(
                523.25,
                audioContext.currentTime,
              ); // C5
              oscillator.frequency.setValueAtTime(
                659.25,
                audioContext.currentTime + 0.15,
              ); // E5
              oscillator.frequency.setValueAtTime(
                783.99,
                audioContext.currentTime + 0.3,
              ); // G5
              oscillator.frequency.setValueAtTime(
                1046.5,
                audioContext.currentTime + 0.45,
              ); // C6
              gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                audioContext.currentTime + 0.6,
              );
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.6);
              break;
          }
        }

        // Screen reader announcements
        function announceToScreenReader(message) {
          const announcement = document.createElement("div");
          announcement.className = "sr-only";
          announcement.setAttribute("role", "status");
          announcement.setAttribute("aria-live", "polite");
          announcement.textContent = message;
          document.body.appendChild(announcement);
          setTimeout(() => announcement.remove(), 1000);
        }

        // Load stats from localStorage
        function loadStats() {
          gameState.stats.gamesPlayed = parseInt(
            localStorage.getItem("sl_gamesPlayed") || "0",
          );
          gameState.stats.gamesWon = parseInt(
            localStorage.getItem("sl_gamesWon") || "0",
          );
          gameState.stats.totalTime = parseInt(
            localStorage.getItem("sl_totalTime") || "0",
          );
          gameState.stats.bestStreak = parseInt(
            localStorage.getItem("sl_bestStreak") || "0",
          );
          gameState.bestStreak = gameState.stats.bestStreak;
        }

        // Save stats to localStorage
        function saveStats() {
          localStorage.setItem(
            "sl_gamesPlayed",
            gameState.stats.gamesPlayed.toString(),
          );
          localStorage.setItem(
            "sl_gamesWon",
            gameState.stats.gamesWon.toString(),
          );
          localStorage.setItem(
            "sl_totalTime",
            gameState.stats.totalTime.toString(),
          );
          localStorage.setItem(
            "sl_bestStreak",
            gameState.stats.bestStreak.toString(),
          );
        }

        // Update streak tracking
        function updateStreak(correct) {
          if (correct) {
            gameState.currentStreak++;
            if (gameState.currentStreak > gameState.bestStreak) {
              gameState.bestStreak = gameState.currentStreak;
              gameState.stats.bestStreak = gameState.bestStreak;
              saveStats();
            }
          } else {
            gameState.currentStreak = 0;
          }
        }

        // Board configurations
        const boards = [
          {
            id: "classic",
            name: "üé≤ Classic Board",
            theme: "classic",
            snakes: { 91: 75, 87: 24, 93: 73, 95: 56, 88: 36 },
            ladders: { 4: 56, 12: 50, 14: 55, 22: 58, 41: 79, 54: 88 },
          },
          {
            id: "jungle",
            name: "üå¥ Jungle Adventure",
            theme: "jungle",
            snakes: { 89: 53, 90: 48, 76: 63, 95: 24, 92: 51 },
            ladders: { 8: 52, 6: 42, 21: 82, 28: 77, 36: 57, 71: 92 },
          },
          {
            id: "ocean",
            name: "üåä Ocean Quest",
            theme: "ocean",
            snakes: { 83: 19, 90: 48, 76: 63, 98: 79, 85: 23 },
            ladders: { 1: 40, 9: 89, 16: 25, 51: 67, 65: 85, 68: 91 },
          },
          {
            id: "space",
            name: "üöÄ Space Explorer",
            theme: "space",
            snakes: { 97: 78, 92: 53, 83: 27, 69: 33, 64: 16 },
            ladders: { 3: 39, 10: 12, 27: 53, 40: 62, 43: 84, 74: 92 },
          },
        ];

        // Player options with emoji representations
        const players = [
          { id: "boy", name: "Boy", emoji: "üë¶", color: "#4ade80" },
          { id: "girl", name: "Girl", emoji: "üëß", color: "#f472b6" },
          { id: "cat", name: "Cat", emoji: "üê±", color: "#fbbf24" },
          { id: "dog", name: "Dog", emoji: "üê∂", color: "#fb7185" },
          { id: "robot", name: "Robot", emoji: "ü§ñ", color: "#6366f1" },
          { id: "alien", name: "Alien", emoji: "üëΩ", color: "#34d399" },
        ];

        // Question banks
        const questionBanks = {
          vocabulary: [
            {
              question: "What is the opposite of 'big'?",
              options: ["Small", "Large", "Huge", "Tiny"],
              correct: 0,
            },
            {
              question: "Which word means 'happy'?",
              options: ["Sad", "Angry", "Joyful", "Tired"],
              correct: 2,
            },
            {
              question: "What do you call a young cat?",
              options: ["Puppy", "Kitten", "Cub", "Chick"],
              correct: 1,
            },
            {
              question: "Which is a color?",
              options: ["Chair", "Blue", "Run", "Happy"],
              correct: 1,
            },
            {
              question: "What is the plural of 'child'?",
              options: ["Childs", "Children", "Childes", "Child"],
              correct: 1,
            },
          ],
          conversation: [
            {
              question: "How do you greet someone in the morning?",
              options: [
                "Good night",
                "Good morning",
                "Goodbye",
                "See you later",
              ],
              correct: 1,
            },
            {
              question: "What do you say when someone helps you?",
              options: ["Sorry", "Please", "Thank you", "Excuse me"],
              correct: 2,
            },
            {
              question: "How do you ask for someone's name?",
              options: [
                "How old are you?",
                "Where are you from?",
                "What's your name?",
                "How are you?",
              ],
              correct: 2,
            },
            {
              question: "What's a polite way to interrupt someone?",
              options: [
                "Stop talking!",
                "Excuse me",
                "Be quiet!",
                "Listen to me!",
              ],
              correct: 1,
            },
            {
              question: "How do you ask for help?",
              options: [
                "Help me now!",
                "Can you help me, please?",
                "You must help me",
                "I need help immediately",
              ],
              correct: 1,
            },
          ],
          grammar: [
            {
              question: "Choose the correct sentence:",
              options: [
                "I am going to school",
                "I are going to school",
                "I is going to school",
                "I be going to school",
              ],
              correct: 0,
            },
            {
              question: "What is the past tense of 'go'?",
              options: ["Goed", "Goes", "Went", "Going"],
              correct: 2,
            },
            {
              question: "Which is correct?",
              options: [
                "She don't like apples",
                "She doesn't like apples",
                "She not like apples",
                "She no like apples",
              ],
              correct: 1,
            },
            {
              question: "Choose the correct article:",
              options: [
                "A elephant",
                "An elephant",
                "The elephants",
                "Some elephant",
              ],
              correct: 1,
            },
            {
              question: "What's the correct question form?",
              options: [
                "You are happy?",
                "Are you happy?",
                "Happy you are?",
                "You happy are?",
              ],
              correct: 1,
            },
          ],
        };

        // Initialize game
        document.addEventListener("DOMContentLoaded", function () {
          loadStats();
          initializeSetup();
          updateStats();

          // Initialize audio on first user interaction
          document.body.addEventListener("click", initAudio, { once: true });
          document.body.addEventListener("keydown", initAudio, { once: true });

          // Reposition player piece on window resize
          let resizeTimeout;
          window.addEventListener("resize", function () {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function () {
              if (
                gameState.playerPosition > 0 &&
                document
                  .getElementById("gameScreen")
                  .classList.contains("active")
              ) {
                positionPlayerPiece(gameState.playerPosition);
                // Redraw snakes and ladders to match new board size
                drawSnakesAndLadders();
              }
            }, 100);
          });

          // Keyboard navigation
          document.addEventListener("keydown", function (e) {
            // Space for dice roll
            if (
              e.code === "Space" &&
              !gameState.isMoving &&
              !gameState.gameOver
            ) {
              const rollBtn = document.getElementById("rollBtn");
              if (
                rollBtn &&
                !rollBtn.disabled &&
                document
                  .getElementById("gameScreen")
                  .classList.contains("active")
              ) {
                e.preventDefault();
                rollDice();
              }
            }

            // Enter for continue button
            if (e.code === "Enter") {
              const continueBtn = document.getElementById("continueBtn");
              if (continueBtn && continueBtn.style.display === "block") {
                e.preventDefault();
                continueGame();
              }
            }

            // Escape to exit game
            if (
              e.code === "Escape" &&
              document.getElementById("gameScreen").classList.contains("active")
            ) {
              if (confirm("Are you sure you want to exit the game?")) {
                exitGame();
              }
            }

            // Number keys 1-4 for answer selection
            if (e.key >= "1" && e.key <= "4") {
              const questionPanel = document.getElementById("questionPanel");
              if (questionPanel && questionPanel.classList.contains("active")) {
                const optionBtns = document.querySelectorAll(".option-btn");
                const index = parseInt(e.key) - 1;
                if (optionBtns[index] && !optionBtns[index].disabled) {
                  e.preventDefault();
                  selectAnswer(index);
                }
              }
            }

            // H for help/instructions
            if (e.code === "KeyH") {
              const instructions = document.getElementById("instructions");
              if (instructions) {
                instructions.style.display =
                  instructions.style.display === "none" ? "block" : "none";
              }
            }
          });
        });

        function initializeSetup() {
          // Populate board options
          const boardSelection = document.getElementById("boardSelection");
          boards.forEach((board) => {
            const boardOption = document.createElement("div");
            boardOption.className = "board-option";
            boardOption.dataset.board = board.id;
            boardOption.setAttribute("role", "radio");
            boardOption.setAttribute("aria-checked", "false");
            boardOption.setAttribute("aria-label", board.name);
            boardOption.setAttribute("tabindex", "0");
            boardOption.onclick = () => selectBoard(board.id);
            boardOption.onkeypress = (e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                selectBoard(board.id);
              }
            };

            // Create mini board preview
            const preview = document.createElement("div");
            preview.className = "board-preview";

            // Add mini cells to preview
            for (let i = 0; i < 25; i++) {
              const miniCell = document.createElement("div");
              miniCell.className = "board-preview-cell";
              preview.appendChild(miniCell);
            }

            boardOption.appendChild(preview);

            const label = document.createElement("div");
            label.className = "board-label";
            label.textContent = board.name;
            boardOption.appendChild(label);

            boardSelection.appendChild(boardOption);
          });

          // Populate player options
          const playerSelection = document.getElementById("playerSelection");
          players.forEach((player) => {
            const playerOption = document.createElement("div");
            playerOption.className = "player-option";
            playerOption.dataset.player = player.id;
            playerOption.textContent = player.emoji;
            playerOption.setAttribute("role", "radio");
            playerOption.setAttribute("aria-checked", "false");
            playerOption.setAttribute("aria-label", player.name);
            playerOption.setAttribute("tabindex", "0");
            playerOption.onclick = () => selectPlayer(player.id);
            playerOption.onkeypress = (e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                selectPlayer(player.id);
              }
            };
            playerSelection.appendChild(playerOption);
          });

          // Content selection handlers
          document.querySelectorAll(".content-option").forEach((btn) => {
            btn.onclick = () => selectContent(btn.dataset.content);
          });
        }

        function selectBoard(boardId) {
          gameState.selectedBoard = boardId;
          document.querySelectorAll(".board-option").forEach((opt) => {
            opt.classList.remove("selected");
            opt.setAttribute("aria-checked", "false");
          });
          const selected = document.querySelector(`[data-board="${boardId}"]`);
          selected.classList.add("selected");
          selected.setAttribute("aria-checked", "true");
          checkCanStart();
          announceToScreenReader(
            `Board selected: ${boards.find((b) => b.id === boardId).name}`,
          );
        }

        function selectPlayer(playerId) {
          gameState.selectedPlayer = playerId;
          document.querySelectorAll(".player-option").forEach((opt) => {
            opt.classList.remove("selected");
            opt.setAttribute("aria-checked", "false");
          });
          const selected = document.querySelector(
            `[data-player="${playerId}"]`,
          );
          selected.classList.add("selected");
          selected.setAttribute("aria-checked", "true");
          checkCanStart();
          announceToScreenReader(
            `Character selected: ${players.find((p) => p.id === playerId).name}`,
          );
        }

        function selectContent(contentType) {
          gameState.selectedContent = contentType;
          document.querySelectorAll(".content-option").forEach((opt) => {
            opt.classList.remove("selected");
            opt.setAttribute("aria-checked", "false");
          });
          const selected = document.querySelector(
            `[data-content="${contentType}"]`,
          );
          selected.classList.add("selected");
          selected.setAttribute("aria-checked", "true");
          checkCanStart();
          announceToScreenReader(`Learning topic selected: ${contentType}`);
        }

        function checkCanStart() {
          const canStart =
            gameState.selectedBoard &&
            gameState.selectedPlayer &&
            gameState.selectedContent;
          document.getElementById("startGameBtn").disabled = !canStart;
        }

        function startGame() {
          // Hide setup screen, show game screen
          document.getElementById("setupScreen").style.display = "none";
          document.getElementById("gameScreen").classList.add("active");

          // Initialize game state
          gameState.playerPosition = 1;
          gameState.playerScore = 0;
          gameState.moveCount = 0;
          gameState.correctAnswers = 0;
          gameState.currentStreak = 0;
          gameState.gameStartTime = Date.now();
          gameState.gameOver = false;

          // Setup game board
          setupGameBoard();

          // Position player piece after a brief delay to ensure board is fully rendered
          setTimeout(() => {
            updatePlayerPosition();
            updateGameStatus();
          }, 50);

          startGameTimer();

          announceToScreenReader("Game started! Press Space to roll the dice.");
          playSound("success");
        }

        function setupGameBoard() {
          const selectedBoard = boards.find(
            (b) => b.id === gameState.selectedBoard,
          );
          const selectedPlayer = players.find(
            (p) => p.id === gameState.selectedPlayer,
          );

          // Set board theme
          const gameBoard = document.getElementById("gameBoard");
          const themes = {
            classic: "linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%)",
            jungle: "linear-gradient(135deg, #c8e6c9 0%, #81c784 100%)",
            ocean: "linear-gradient(135deg, #90caf9 0%, #42a5f5 100%)",
            space: "linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%)",
          };
          gameBoard.style.background =
            themes[selectedBoard.theme] || themes.classic;

          // Set player avatar
          const playerAvatar = document.getElementById("playerAvatar");
          playerAvatar.textContent = selectedPlayer.emoji;
          playerAvatar.style.background = selectedPlayer.color;

          const playerPiece = document.getElementById("playerPiece");
          playerPiece.textContent = selectedPlayer.emoji;
          playerPiece.style.background = selectedPlayer.color;

          // Set content type display
          document.getElementById("contentType").textContent =
            gameState.selectedContent.charAt(0).toUpperCase() +
            gameState.selectedContent.slice(1);

          // Generate board grid
          generateBoardGrid();

          // Draw snakes and ladders
          drawSnakesAndLadders();
        }

        function generateBoardGrid() {
          const boardGrid = document.getElementById("boardGrid");
          boardGrid.innerHTML = "";

          const selectedBoard = boards.find(
            (b) => b.id === gameState.selectedBoard,
          );

          for (let i = 100; i >= 1; i--) {
            const cell = document.createElement("div");
            cell.className = "board-cell";
            cell.dataset.position = i;
            cell.id = `cell-${i}`;

            // Mark special cells
            if (i === 1) {
              cell.classList.add("start");
            } else if (i === 100) {
              cell.classList.add("finish");
            } else if (selectedBoard.snakes[i]) {
              cell.classList.add("snake-head");
            } else if (Object.values(selectedBoard.snakes).includes(i)) {
              cell.classList.add("snake-tail");
            } else if (selectedBoard.ladders[i]) {
              cell.classList.add("ladder-bottom");
            } else if (Object.values(selectedBoard.ladders).includes(i)) {
              cell.classList.add("ladder-top");
            }

            // Add cell number
            const cellNumber = document.createElement("span");
            cellNumber.textContent = i;
            cellNumber.style.fontSize = "0.65rem";
            cellNumber.style.opacity = "0.5";
            cellNumber.style.fontWeight = "700";
            cellNumber.style.position = "absolute";
            cellNumber.style.top = "2px";
            cellNumber.style.left = "2px";
            cell.appendChild(cellNumber);

            boardGrid.appendChild(cell);
          }
        }

        function drawSnakesAndLadders() {
          const selectedBoard = boards.find(
            (b) => b.id === gameState.selectedBoard,
          );
          const gameBoard = document.getElementById("gameBoard");

          // Remove existing SVG if any
          const existingSvg = gameBoard.querySelector("svg.connections");
          if (existingSvg) existingSvg.remove();

          // Create SVG for drawing connections
          const svg = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "svg",
          );
          svg.classList.add("connections");
          svg.style.position = "absolute";
          svg.style.top = "0";
          svg.style.left = "0";
          svg.style.width = "100%";
          svg.style.height = "100%";
          svg.style.pointerEvents = "none";
          svg.style.zIndex = "5";

          // Draw snakes
          Object.entries(selectedBoard.snakes).forEach(([start, end]) => {
            const path = createCurvedPath(
              parseInt(start),
              parseInt(end),
              "snake",
            );
            svg.appendChild(path);
          });

          // Draw ladders
          Object.entries(selectedBoard.ladders).forEach(([start, end]) => {
            const ladder = createLadder(parseInt(start), parseInt(end));
            ladder.forEach((element) => svg.appendChild(element));
          });

          gameBoard.appendChild(svg);
        }

        function getCellCenter(position) {
          const cell = document.getElementById(`cell-${position}`);
          if (!cell) return { x: 0, y: 0 };

          const boardRect = document
            .getElementById("gameBoard")
            .getBoundingClientRect();
          const cellRect = cell.getBoundingClientRect();

          return {
            x: cellRect.left - boardRect.left + cellRect.width / 2,
            y: cellRect.top - boardRect.top + cellRect.height / 2,
          };
        }

        function createCurvedPath(start, end, type) {
          const startPos = getCellCenter(start);
          const endPos = getCellCenter(end);

          const path = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "path",
          );

          // Create a smooth curve
          const midX = (startPos.x + endPos.x) / 2;
          const midY = (startPos.y + endPos.y) / 2;
          const curve = startPos.x < endPos.x ? -30 : 30;

          const d = `M ${startPos.x} ${startPos.y} Q ${midX + curve} ${midY} ${
            endPos.x
          } ${endPos.y}`;

          path.setAttribute("d", d);
          path.classList.add(type === "snake" ? "snake-path" : "ladder-path");

          return path;
        }

        function createLadder(start, end) {
          const elements = [];
          const startPos = getCellCenter(start);
          const endPos = getCellCenter(end);

          // Left rail
          const leftRail = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "line",
          );
          leftRail.setAttribute("x1", startPos.x - 8);
          leftRail.setAttribute("y1", startPos.y);
          leftRail.setAttribute("x2", endPos.x - 8);
          leftRail.setAttribute("y2", endPos.y);
          leftRail.classList.add("ladder-path");
          elements.push(leftRail);

          // Right rail
          const rightRail = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "line",
          );
          rightRail.setAttribute("x1", startPos.x + 8);
          rightRail.setAttribute("y1", startPos.y);
          rightRail.setAttribute("x2", endPos.x + 8);
          rightRail.setAttribute("y2", endPos.y);
          rightRail.classList.add("ladder-path");
          elements.push(rightRail);

          // Rungs
          const distance = Math.sqrt(
            Math.pow(endPos.x - startPos.x, 2) +
              Math.pow(endPos.y - startPos.y, 2),
          );
          const numRungs = Math.max(3, Math.floor(distance / 30));

          for (let i = 1; i < numRungs; i++) {
            const t = i / numRungs;
            const x = startPos.x + (endPos.x - startPos.x) * t;
            const y = startPos.y + (endPos.y - startPos.y) * t;

            const rung = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "line",
            );
            rung.setAttribute("x1", x - 8);
            rung.setAttribute("y1", y);
            rung.setAttribute("x2", x + 8);
            rung.setAttribute("y2", y);
            rung.classList.add("ladder-rung");
            elements.push(rung);
          }

          return elements;
        }

        function rollDice() {
          if (gameState.isMoving || gameState.gameOver) return;

          const dice = document.getElementById("dice");
          const rollBtn = document.getElementById("rollBtn");

          dice.classList.add("rolling");
          rollBtn.disabled = true;
          playSound("dice");

          setTimeout(() => {
            const diceValue = Math.floor(Math.random() * 6) + 1;
            dice.innerHTML = getDiceIcon(diceValue);
            dice.classList.remove("rolling");
            announceToScreenReader(`You rolled a ${diceValue}`);

            movePlayer(diceValue);
          }, 1000);
        }

        function getDiceIcon(value) {
          const icons = [
            '<i class="fas fa-dice-one"></i>',
            '<i class="fas fa-dice-two"></i>',
            '<i class="fas fa-dice-three"></i>',
            '<i class="fas fa-dice-four"></i>',
            '<i class="fas fa-dice-five"></i>',
            '<i class="fas fa-dice-six"></i>',
          ];
          return icons[value - 1];
        }

        function movePlayer(steps) {
          gameState.isMoving = true;
          gameState.moveCount++;

          const newPosition = Math.min(gameState.playerPosition + steps, 100);

          animatePlayerMovement(gameState.playerPosition, newPosition, () => {
            gameState.playerPosition = newPosition;
            updatePlayerPosition();
            updateGameStatus();

            if (newPosition === 100) {
              endGame(true);
              return;
            }

            checkSpecialSquares();
          });
        }

        function animatePlayerMovement(from, to, callback) {
          const piece = document.getElementById("playerPiece");
          piece.classList.add("moving");

          let current = from;
          const stepDelay = 250; // Slightly slower for smoother movement

          const moveNext = () => {
            if (current >= to) {
              piece.classList.remove("moving");
              setTimeout(callback, 300);
              return;
            }

            current++;
            positionPlayerPiece(current);

            setTimeout(moveNext, stepDelay);
          };

          moveNext();
        }

        function positionPlayerPiece(position) {
          const cell = document.getElementById(`cell-${position}`);
          const piece = document.getElementById("playerPiece");

          if (!cell || !piece) return;

          const gameBoard = document.getElementById("gameBoard");
          if (!gameBoard) return;

          // Get positions relative to the game board (which is the parent of the piece)
          const cellRect = cell.getBoundingClientRect();
          const boardRect = gameBoard.getBoundingClientRect();

          // Calculate center position relative to game board
          // The piece has transform: translate(-50%, -50%) so we position at the center
          const centerX = cellRect.left - boardRect.left + cellRect.width / 2;
          const centerY = cellRect.top - boardRect.top + cellRect.height / 2;

          piece.style.left = `${centerX}px`;
          piece.style.top = `${centerY}px`;
        }

        function updatePlayerPosition() {
          document.getElementById("playerPosition").textContent =
            gameState.playerPosition;
          positionPlayerPiece(gameState.playerPosition);
        }

        function updateGameStatus() {
          document.getElementById("playerScore").textContent =
            gameState.playerScore;
          document.getElementById("moveCount").textContent =
            gameState.moveCount;
          document.getElementById("correctAnswers").textContent =
            gameState.correctAnswers;
          document.getElementById("correctStreak").textContent =
            gameState.currentStreak;

          // Update accuracy rate
          const accuracy =
            gameState.moveCount > 0
              ? Math.round(
                  (gameState.correctAnswers / gameState.moveCount) * 100,
                )
              : 0;
          document.getElementById("accuracyRate").textContent = `${accuracy}%`;

          // Update progress bar
          const progressBar = document.getElementById("progressFill");
          if (progressBar) {
            progressBar.style.width = `${gameState.playerPosition}%`;
            progressBar.parentElement.setAttribute(
              "aria-valuenow",
              gameState.playerPosition,
            );
          }
        }

        function checkSpecialSquares() {
          const selectedBoard = boards.find(
            (b) => b.id === gameState.selectedBoard,
          );
          const position = gameState.playerPosition;
          const piece = document.getElementById("playerPiece");

          if (selectedBoard.snakes[position]) {
            piece.classList.add("sliding");
            setTimeout(() => piece.classList.remove("sliding"), 1000);
            playSound("snake");
            announceToScreenReader(
              `Snake bite! You slid down from ${position} to ${selectedBoard.snakes[position]}`,
            );
            showMessage(
              "Snake Bite! üêç",
              `Oh no! You slid down from ${position} to ${selectedBoard.snakes[position]}!`,
              () => {
                gameState.playerPosition = selectedBoard.snakes[position];
                updatePlayerPosition();
                showQuestion();
              },
            );
          } else if (selectedBoard.ladders[position]) {
            piece.classList.add("climbing");
            setTimeout(() => piece.classList.remove("climbing"), 1000);
            playSound("ladder");
            announceToScreenReader(
              `Ladder climb! You climbed up from ${position} to ${selectedBoard.ladders[position]}`,
            );
            showMessage(
              "Ladder Climb! ü™ú",
              `Great! You climbed up from ${position} to ${selectedBoard.ladders[position]}!`,
              () => {
                gameState.playerPosition = selectedBoard.ladders[position];
                updatePlayerPosition();
                showQuestion();
              },
            );
          } else {
            showQuestion();
          }
        }

        function showQuestion() {
          const questions = questionBanks[gameState.selectedContent];
          const randomQuestion =
            questions[Math.floor(Math.random() * questions.length)];
          gameState.currentQuestion = randomQuestion;

          document.getElementById("questionTitle").textContent = `${
            gameState.selectedContent.charAt(0).toUpperCase() +
            gameState.selectedContent.slice(1)
          } Challenge`;
          document.getElementById("questionContent").textContent =
            randomQuestion.question;

          const optionsContainer = document.getElementById("questionOptions");
          optionsContainer.innerHTML = "";

          randomQuestion.options.forEach((option, index) => {
            const button = document.createElement("button");
            button.className = "option-btn";
            button.textContent = option;
            button.setAttribute("aria-label", `Option ${index + 1}: ${option}`);
            button.onclick = () => selectAnswer(index);
            optionsContainer.appendChild(button);
          });

          document.getElementById("questionPanel").classList.add("active");
          announceToScreenReader(
            `Question: ${randomQuestion.question}. Press 1 through 4 to select an answer.`,
          );
        }

        function selectAnswer(selectedIndex) {
          const buttons = document.querySelectorAll(".option-btn");
          const correct = gameState.currentQuestion.correct;

          buttons.forEach((btn, index) => {
            btn.disabled = true;
            if (index === correct) {
              btn.classList.add("correct");
            } else if (index === selectedIndex && index !== correct) {
              btn.classList.add("incorrect");
            }
          });

          const isCorrect = selectedIndex === correct;

          if (isCorrect) {
            gameState.playerScore += 10;
            gameState.correctAnswers++;
            updateStreak(true);
            playSound("success");
            announceToScreenReader(
              `Correct! Your score is now ${gameState.playerScore}. Current streak: ${gameState.currentStreak}`,
            );
            updateGameStatus();
          } else {
            updateStreak(false);
            playSound("error");
            announceToScreenReader(
              "Incorrect answer. Your streak has been reset.",
            );
          }

          document.getElementById("continueBtn").style.display = "block";
        }

        function continueGame() {
          document.getElementById("questionPanel").classList.remove("active");
          document.getElementById("continueBtn").style.display = "none";
          document.getElementById("rollBtn").disabled = false;
          gameState.isMoving = false;
        }

        function startGameTimer() {
          setInterval(() => {
            if (!gameState.gameOver && gameState.gameStartTime) {
              const elapsed = Math.floor(
                (Date.now() - gameState.gameStartTime) / 1000,
              );
              const minutes = Math.floor(elapsed / 60);
              const seconds = elapsed % 60;
              document.getElementById("gameTime").textContent =
                `${minutes}:${seconds.toString().padStart(2, "0")}`;
            }
          }, 1000);
        }

        function endGame(won) {
          gameState.gameOver = true;
          const gameTime = Math.floor(
            (Date.now() - gameState.gameStartTime) / 1000,
          );

          // Update stats
          gameState.stats.gamesPlayed++;
          gameState.stats.totalTime += gameTime;
          if (won) {
            gameState.stats.gamesWon++;
          }

          // Save stats
          saveStats();

          if (won) {
            playSound("win");
            announceToScreenReader(
              `Congratulations! You won the game! Final score: ${gameState.playerScore}. Best streak: ${gameState.bestStreak}`,
            );
            showMessage(
              "üéâ Congratulations!",
              `You won the game!\nTime: ${Math.floor(gameTime / 60)}:${(
                gameTime % 60
              )
                .toString()
                .padStart(2, "0")}\nScore: ${
                gameState.playerScore
              }\nCorrect Answers: ${gameState.correctAnswers}/${
                gameState.moveCount
              }\nBest Streak: ${gameState.bestStreak}`,
              () => {
                newGame();
              },
            );
          }

          updateStats();
        }

        function showMessage(title, text, callback) {
          document.getElementById("messageTitle").textContent = title;
          document.getElementById("messageText").textContent = text;
          document.getElementById("gameMessage").classList.add("show");

          document.querySelector(".message-btn").onclick = () => {
            closeMessage();
            if (callback) callback();
          };
        }

        function closeMessage() {
          document.getElementById("gameMessage").classList.remove("show");
        }

        function newGame() {
          // Reset game state
          gameState = {
            selectedBoard: null,
            selectedPlayer: null,
            selectedContent: null,
            playerPosition: 1,
            playerScore: 0,
            moveCount: 0,
            correctAnswers: 0,
            gameStartTime: null,
            currentQuestion: null,
            isMoving: false,
            gameOver: false,
            currentStreak: 0,
            bestStreak: gameState.bestStreak,
            stats: gameState.stats,
          };

          // Reset UI
          document.getElementById("gameScreen").classList.remove("active");
          document.getElementById("setupScreen").style.display = "flex";
          document
            .querySelectorAll(".selected")
            .forEach((el) => el.classList.remove("selected"));
          document.getElementById("startGameBtn").disabled = true;
          document.getElementById("rollBtn").disabled = false;
          document.getElementById("questionPanel").classList.remove("active");
        }

        function exitGame() {
          if (!gameState.gameOver) {
            // Save incomplete game stats
            const gameTime = Math.floor(
              (Date.now() - gameState.gameStartTime) / 1000,
            );
            gameState.stats.gamesPlayed++;
            gameState.stats.totalTime += gameTime;
            saveStats();
          }
          newGame();
        }

        function showRules() {
          showMessage(
            "üéØ Game Rules",
            "Roll the dice to move forward. Answer questions correctly to earn points. Climb ladders to go up, avoid snakes that take you down. First to reach square 100 wins!",
          );
        }

        function showStats() {
          const winRate =
            gameState.stats.gamesPlayed > 0
              ? Math.round(
                  (gameState.stats.gamesWon / gameState.stats.gamesPlayed) *
                    100,
                )
              : 0;
          const avgTime =
            gameState.stats.gamesPlayed > 0
              ? Math.round(
                  gameState.stats.totalTime / gameState.stats.gamesPlayed,
                )
              : 0;

          showMessage(
            "üìä Your Stats",
            `Games Played: ${gameState.stats.gamesPlayed}\nGames Won: ${
              gameState.stats.gamesWon
            }\nWin Rate: ${winRate}%\nAverage Time: ${Math.floor(
              avgTime / 60,
            )}:${(avgTime % 60).toString().padStart(2, "0")}\nBest Streak: ${
              gameState.stats.bestStreak
            } correct in a row`,
          );
        }

        function updateStats() {
          // This function can be called to refresh any stats displays
        }
      </script>
    </main>

    <script src="../js/game-ads.js"></script>

    <!-- Footer -->
    <!-- Footer Ad -->
    <div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-2456627863532019"
           data-ad-slot="3089435711"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    <footer class="game-footer" role="contentinfo">
      <nav class="footer-links" aria-label="Footer navigation">
        <a href="../index.html" aria-label="Go to home page"
          ><i class="fas fa-home" aria-hidden="true"></i> Home</a
        >
        <a href="games.html" aria-label="Go to games list"
          ><i class="fas fa-gamepad" aria-hidden="true"></i> Games</a
        >
        <a href="../lessons.html" aria-label="Go to lessons"
          ><i class="fas fa-book" aria-hidden="true"></i> Lessons</a
        >
        <a href="../contact.html" aria-label="Go to contact page"
          ><i class="fas fa-envelope" aria-hidden="true"></i> Contact</a
        >
      </nav>
      <p class="footer-copyright">
        &copy; 2026 ESL Fun Online. All rights reserved.
      </p>
    </footer>

    <!-- Single Bottom Ad -->
    <div
      class="ad-wrapper bottom-ad"
      style="
        margin: 2rem auto 1rem;
        max-width: 728px;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 12px;
        padding: 1rem;
      "
    >
      <div
        style="
          text-align: center;
          font-size: 0.7rem;
          color: rgba(255, 255, 255, 0.5);
          margin-bottom: 0.5rem;
        "
      >
        Advertisement
      </div>
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-format="horizontal"
        data-ad-client="ca-pub-2456627863532019"
        data-ad-slot="2184713192"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <!-- iOS double-tap zoom prevention -->
    <script>
      document.addEventListener(
        "touchend",
        function (e) {
          const now = Date.now();
          if (now - (this.lastTouch || 0) < 300) {
            e.preventDefault();
          }
          this.lastTouch = now;
        },
        { passive: false },
      );
    </script>
  </body>
</html>
