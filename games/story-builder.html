<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Story Builder - Collaborative Creative Writing Game | ESL Fun Online
    </title>
    <meta
      name="description"
      content="Create amazing stories with Story Builder! Practice creative writing, improve grammar, and develop storytelling skills through collaborative interactive gameplay."
    />
    <meta
      name="keywords"
      content="story builder game, creative writing practice, ESL writing game, collaborative storytelling, grammar practice, English writing skills"
    />
    <meta name="author" content="ESL Fun Online" />
    <meta name="robots" content="index, follow" />
    <meta
      property="og:title"
      content="Story Builder - Collaborative Creative Writing Game | ESL Fun Online"
    />
    <meta
      property="og:description"
      content="Create collaborative stories with other players! Practice creative writing, grammar, and storytelling in this multiplayer adventure."
    />
    <meta
      property="og:image"
      content="https://eslfunonline.com/images/image copy 9.png"
    />
    <meta
      property="og:url"
      content="https://eslfunonline.com/games/story-builder.html"
    />
    <meta property="og:type" content="game" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Story Builder - Collaborative Creative Writing Game"
    />
    <meta
      name="twitter:description"
      content="Create collaborative stories and practice creative writing skills!"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/image copy 9.png"
    />
    <link
      rel="canonical"
      href="https://eslfunonline.com/games/story-builder.html"
    />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-color: #46bbe5;
        --primary-hover: #05425c;
        --secondary-color: #f59e0b;
        --accent-color: #10b981;
        --danger-color: #ef4444;
        --success-color: #10b981;
        --purple-color: #8b5cf6;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --bg-primary: #ffffff;
        --bg-secondary: #f9fafb;
        --bg-tertiary: #f3f4f6;
        --border-color: #e5e7eb;
        --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: var(--text-primary);
        padding: 1rem;
      }

      .game-container {
        max-width: 1200px;
        margin: 0 auto;
        background: var(--bg-primary);
        border-radius: 20px;
        box-shadow: var(--shadow-lg);
        padding: 2rem;
      }

      .game-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .game-header h1 {
        font-family: "Poppins", sans-serif;
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .game-header p {
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin-bottom: 1rem;
      }

      .story-modes {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .mode-btn {
        padding: 0.75rem 1.5rem;
        border: 2px solid var(--border-color);
        background: var(--bg-secondary);
        color: var(--text-primary);
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
      }

      .mode-btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .mode-btn:hover {
        transform: translateY(-2px);
      }

      .story-setup {
        background: var(--bg-secondary);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        display: none;
      }

      .story-setup.active {
        display: block;
      }

      .setup-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .setup-card {
        background: var(--bg-primary);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 2px solid var(--border-color);
      }

      .setup-card:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
      }

      .setup-card.selected {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .setup-card h4 {
        margin-bottom: 0.5rem;
        font-size: 1rem;
      }

      .setup-card p {
        font-size: 0.85rem;
        opacity: 0.8;
      }

      .story-area {
        background: var(--bg-secondary);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        min-height: 400px;
      }

      .story-display {
        background: var(--bg-primary);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        min-height: 300px;
        font-size: 1.1rem;
        line-height: 1.8;
        border: 2px solid var(--border-color);
        max-height: 400px;
        overflow-y: auto;
      }

      .story-paragraph {
        margin-bottom: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
        background: var(--bg-secondary);
        position: relative;
      }

      .story-paragraph:nth-child(even) {
        background: rgba(70, 187, 229, 0.05);
      }

      .paragraph-author {
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-style: italic;
        margin-bottom: 0.5rem;
      }

      .input-section {
        background: var(--bg-tertiary);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .prompt-display {
        background: var(--primary-color);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        text-align: center;
        font-weight: 600;
      }

      .story-input {
        width: 100%;
        min-height: 120px;
        padding: 1rem;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
        line-height: 1.6;
        resize: vertical;
        font-family: "Inter", sans-serif;
        margin-bottom: 1rem;
      }

      .story-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(70, 187, 229, 0.1);
      }

      .input-help {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .word-count {
        font-weight: 600;
      }

      .word-count.good {
        color: var(--success-color);
      }

      .word-count.warning {
        color: var(--secondary-color);
      }

      .word-count.error {
        color: var(--danger-color);
      }

      .suggestion-chips {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }

      .suggestion-chip {
        background: var(--bg-primary);
        color: var(--text-primary);
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.85rem;
        border: 1px solid var(--border-color);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .suggestion-chip:hover {
        background: var(--primary-color);
        color: white;
      }

      .story-stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .stat-card {
        background: var(--bg-secondary);
        padding: 1rem 1.5rem;
        border-radius: 15px;
        text-align: center;
        min-width: 120px;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .game-controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 2px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: var(--bg-secondary);
        border-color: var(--primary-color);
      }

      .btn-success {
        background: var(--success-color);
        color: white;
      }

      .btn-hint {
        background: var(--secondary-color);
        color: white;
      }

      .btn-danger {
        background: var(--danger-color);
        color: white;
      }

      .story-sharing {
        background: var(--bg-secondary);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        display: none;
      }

      .story-sharing.show {
        display: block;
      }

      .sharing-options {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 1rem;
      }

      .genre-selector {
        display: flex;
        gap: 0.75rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
      }

      .genre-btn {
        padding: 0.5rem 1rem;
        border: 2px solid var(--border-color);
        background: var(--bg-secondary);
        color: var(--text-primary);
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.9rem;
      }

      .genre-btn.active {
        background: var(--secondary-color);
        color: white;
        border-color: var(--secondary-color);
      }

      .game-message {
        margin: 1rem 0;
        padding: 1rem;
        border-radius: 10px;
        font-weight: 600;
        text-align: center;
        font-size: 1.1rem;
      }

      .message-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
        border: 2px solid rgba(16, 185, 129, 0.3);
      }

      .message-info {
        background: rgba(70, 187, 229, 0.1);
        color: var(--primary-color);
        border: 2px solid rgba(70, 187, 229, 0.3);
      }

      .message-warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--secondary-color);
        border: 2px solid rgba(245, 158, 11, 0.3);
      }

      @media (max-width: 768px) {
        .game-container {
          padding: 1rem;
          margin: 0.5rem;
        }

        .game-header h1 {
          font-size: 2rem;
        }

        .setup-grid {
          grid-template-columns: 1fr;
        }

        .story-stats {
          gap: 1rem;
        }

        .stat-card {
          min-width: 100px;
          padding: 0.75rem 1rem;
        }

        .input-help {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="game-header">
        <h1><i class="fas fa-feather-alt"></i> Story Builder</h1>
        <p>Create collaborative stories and practice creative writing!</p>
      </div>

      <div class="story-modes">
        <button class="mode-btn active" data-mode="solo">Solo Story</button>
        <button class="mode-btn" data-mode="collaborative">
          Collaborative
        </button>
        <button class="mode-btn" data-mode="prompt">Prompt Challenge</button>
      </div>

      <div class="genre-selector">
        <button class="genre-btn active" data-genre="adventure">
          Adventure
        </button>
        <button class="genre-btn" data-genre="mystery">Mystery</button>
        <button class="genre-btn" data-genre="romance">Romance</button>
        <button class="genre-btn" data-genre="fantasy">Fantasy</button>
        <button class="genre-btn" data-genre="scifi">Sci-Fi</button>
        <button class="genre-btn" data-genre="comedy">Comedy</button>
      </div>

      <div class="story-setup" id="storySetup">
        <h3><i class="fas fa-cog"></i> Choose Your Story Elements</h3>
        <div class="setup-grid" id="setupGrid">
          <!-- Setup cards will be populated by JavaScript -->
        </div>
        <div class="game-controls">
          <button class="btn btn-primary" id="startStoryBtn">
            <i class="fas fa-play"></i> Start Story
          </button>
        </div>
      </div>

      <div class="story-stats">
        <div class="stat-card">
          <div class="stat-value" id="paragraphCount">0</div>
          <div class="stat-label">Paragraphs</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="wordCount">0</div>
          <div class="stat-label">Total Words</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="storyScore">0</div>
          <div class="stat-label">Score</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="genreDisplay">Adventure</div>
          <div class="stat-label">Genre</div>
        </div>
      </div>

      <div class="story-area">
        <div class="story-display" id="storyDisplay">
          <p
            style="
              text-align: center;
              color: var(--text-secondary);
              font-style: italic;
            "
          >
            Your story will appear here as you write...
          </p>
        </div>

        <div class="input-section">
          <div class="prompt-display" id="promptDisplay">
            Click "Start Story" to begin your creative journey!
          </div>

          <textarea
            class="story-input"
            id="storyInput"
            placeholder="Write the next part of your story here..."
            disabled
          ></textarea>

          <div class="input-help">
            <span class="word-count" id="inputWordCount">0 words</span>
            <span class="writing-tip" id="writingTip"
              >Tip: Use descriptive language!</span
            >
          </div>

          <div class="suggestion-chips" id="suggestionChips">
            <!-- Writing suggestions will appear here -->
          </div>
        </div>
      </div>

      <div class="game-controls">
        <button class="btn btn-primary" id="addParagraphBtn" disabled>
          <i class="fas fa-plus"></i> Add to Story
        </button>
        <button class="btn btn-hint" id="hintBtn">
          <i class="fas fa-lightbulb"></i> Writing Hint
        </button>
        <button class="btn btn-secondary" id="undoBtn" disabled>
          <i class="fas fa-undo"></i> Undo Last
        </button>
        <button class="btn btn-success" id="finishStoryBtn" disabled>
          <i class="fas fa-check"></i> Finish Story
        </button>
      </div>

      <div class="story-sharing" id="storySharing">
        <h3><i class="fas fa-share"></i> Share Your Story</h3>
        <p>Great job completing your story! Here are your sharing options:</p>
        <div class="sharing-options">
          <button class="btn btn-primary" id="copyStoryBtn">
            <i class="fas fa-copy"></i> Copy Text
          </button>
          <button class="btn btn-secondary" id="saveStoryBtn">
            <i class="fas fa-save"></i> Save Story
          </button>
          <button class="btn btn-hint" id="printStoryBtn">
            <i class="fas fa-print"></i> Print Story
          </button>
        </div>
      </div>

      <div class="game-message" id="gameMessage" style="display: none"></div>

      <div class="game-controls">
        <button class="btn btn-success" id="newStoryBtn">
          <i class="fas fa-file-alt"></i> New Story
        </button>
        <button
          class="btn btn-secondary"
          onclick="window.location.href='games.html'"
        >
          <i class="fas fa-arrow-left"></i> Back to Games
        </button>
      </div>
    </div>

    <script>
      class StoryBuilderGame {
        constructor() {
          this.currentMode = "solo";
          this.currentGenre = "adventure";
          this.story = [];
          this.storyElements = {};
          this.paragraphCount = 0;
          this.totalWords = 0;
          this.score = 0;
          this.currentPrompt = "";
          this.isStoryStarted = false;

          this.storySetups = {
            adventure: {
              characters: [
                "brave explorer",
                "mysterious guide",
                "young adventurer",
                "experienced captain",
              ],
              settings: [
                "ancient temple",
                "dense jungle",
                "mysterious island",
                "hidden cave",
              ],
              objects: [
                "treasure map",
                "magic compass",
                "ancient artifact",
                "glowing crystal",
              ],
              conflicts: [
                "dangerous trap",
                "rival treasure hunters",
                "wild animals",
                "natural disaster",
              ],
            },
            mystery: {
              characters: [
                "detective",
                "suspicious butler",
                "worried client",
                "mysterious stranger",
              ],
              settings: [
                "old mansion",
                "foggy street",
                "abandoned warehouse",
                "quiet library",
              ],
              objects: [
                "cryptic letter",
                "strange key",
                "old photograph",
                "bloodstained cloth",
              ],
              conflicts: [
                "missing person",
                "stolen jewels",
                "unexplained death",
                "family secret",
              ],
            },
            romance: {
              characters: [
                "shy artist",
                "confident lawyer",
                "caring teacher",
                "charming musician",
              ],
              settings: [
                "cozy cafÃ©",
                "beautiful park",
                "busy airport",
                "quiet beach",
              ],
              objects: [
                "love letter",
                "red rose",
                "favorite book",
                "old photo",
              ],
              conflicts: [
                "misunderstanding",
                "distance",
                "disapproving family",
                "career choice",
              ],
            },
            fantasy: {
              characters: [
                "young wizard",
                "brave knight",
                "wise elf",
                "powerful dragon",
              ],
              settings: [
                "magical forest",
                "ancient castle",
                "crystal cave",
                "floating city",
              ],
              objects: [
                "magic sword",
                "spell book",
                "healing potion",
                "enchanted ring",
              ],
              conflicts: [
                "evil sorcerer",
                "cursed kingdom",
                "dangerous quest",
                "magical plague",
              ],
            },
            scifi: {
              characters: [
                "space explorer",
                "robot companion",
                "alien diplomat",
                "time traveler",
              ],
              settings: [
                "space station",
                "alien planet",
                "future city",
                "laboratory",
              ],
              objects: [
                "laser weapon",
                "time device",
                "alien artifact",
                "hologram",
              ],
              conflicts: [
                "alien invasion",
                "time paradox",
                "robot rebellion",
                "space storm",
              ],
            },
            comedy: {
              characters: [
                "clumsy waiter",
                "overly serious boss",
                "chatty neighbor",
                "confused tourist",
              ],
              settings: [
                "busy restaurant",
                "office building",
                "shopping mall",
                "airport",
              ],
              objects: [
                "slippery banana",
                "broken elevator",
                "wrong suitcase",
                "talking parrot",
              ],
              conflicts: [
                "mistaken identity",
                "embarrassing situation",
                "communication error",
                "silly accident",
              ],
            },
          };

          this.writingPrompts = {
            opening: [
              "Start with a character discovering something unexpected",
              "Begin with dialogue between two characters",
              "Open with a description of an interesting place",
              "Start with a character in a difficult situation",
            ],
            middle: [
              "Introduce a new character or complication",
              "Reveal something important about a character",
              "Show how characters react to the main conflict",
              "Add tension or raise the stakes",
            ],
            ending: [
              "Show how the main conflict is resolved",
              "Reveal what the characters learned",
              "End with a satisfying conclusion",
              "Leave the reader with something to think about",
            ],
          };

          this.writingTips = [
            "Use all five senses in your descriptions",
            "Show emotions through actions, not just words",
            "Vary your sentence length for better flow",
            "Use specific, concrete details",
            "Make your dialogue sound natural",
            "Create vivid settings that enhance the mood",
            "Give your characters clear motivations",
            "Use active voice when possible",
          ];

          this.vocabularySuggestions = {
            emotions: [
              "excited",
              "nervous",
              "curious",
              "determined",
              "worried",
              "hopeful",
            ],
            actions: [
              "whispered",
              "grabbed",
              "stumbled",
              "discovered",
              "searched",
              "realized",
            ],
            descriptions: [
              "mysterious",
              "ancient",
              "glowing",
              "weathered",
              "elegant",
              "towering",
            ],
            transitions: [
              "suddenly",
              "meanwhile",
              "however",
              "therefore",
              "consequently",
              "nevertheless",
            ],
          };

          this.init();
        }

        init() {
          this.setupEventListeners();
          this.showSetup();
          this.updateStats();
        }

        setupEventListeners() {
          // Mode selection
          document.querySelectorAll(".mode-btn").forEach((btn) => {
            btn.onclick = () => {
              document
                .querySelectorAll(".mode-btn")
                .forEach((b) => b.classList.remove("active"));
              btn.classList.add("active");
              this.currentMode = btn.dataset.mode;
              this.showSetup();
            };
          });

          // Genre selection
          document.querySelectorAll(".genre-btn").forEach((btn) => {
            btn.onclick = () => {
              document
                .querySelectorAll(".genre-btn")
                .forEach((b) => b.classList.remove("active"));
              btn.classList.add("active");
              this.currentGenre = btn.dataset.genre;
              this.showSetup();
              this.updateStats();
            };
          });

          // Story controls
          document.getElementById("startStoryBtn").onclick = () =>
            this.startStory();
          document.getElementById("addParagraphBtn").onclick = () =>
            this.addParagraph();
          document.getElementById("hintBtn").onclick = () =>
            this.showWritingHint();
          document.getElementById("undoBtn").onclick = () =>
            this.undoLastParagraph();
          document.getElementById("finishStoryBtn").onclick = () =>
            this.finishStory();
          document.getElementById("newStoryBtn").onclick = () =>
            this.startNewStory();

          // Input handling
          const storyInput = document.getElementById("storyInput");
          storyInput.addEventListener("input", () =>
            this.updateInputWordCount()
          );
          storyInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && e.ctrlKey) {
              this.addParagraph();
            }
          });

          // Sharing
          document.getElementById("copyStoryBtn").onclick = () =>
            this.copyStory();
          document.getElementById("saveStoryBtn").onclick = () =>
            this.saveStory();
          document.getElementById("printStoryBtn").onclick = () =>
            this.printStory();

          // Suggestion chips
          document
            .getElementById("suggestionChips")
            .addEventListener("click", (e) => {
              if (e.target.classList.contains("suggestion-chip")) {
                this.insertSuggestion(e.target.textContent);
              }
            });
        }

        showSetup() {
          const setup = document.getElementById("storySetup");
          const grid = document.getElementById("setupGrid");

          if (this.isStoryStarted) {
            setup.classList.remove("active");
            return;
          }

          setup.classList.add("active");
          grid.innerHTML = "";

          const setupData = this.storySetups[this.currentGenre];

          Object.keys(setupData).forEach((category) => {
            const categoryDiv = document.createElement("div");
            categoryDiv.innerHTML = `
                        <h4 style="margin-bottom: 1rem; text-align: center; color: var(--primary-color);">
                            ${
                              category.charAt(0).toUpperCase() +
                              category.slice(1)
                            }
                        </h4>
                    `;

            setupData[category].forEach((item) => {
              const card = document.createElement("div");
              card.className = "setup-card";
              card.innerHTML = `
                            <h4>${item}</h4>
                            <p>Click to select</p>
                        `;
              card.onclick = () =>
                this.selectStoryElement(category, item, card);
              categoryDiv.appendChild(card);
            });

            grid.appendChild(categoryDiv);
          });
        }

        selectStoryElement(category, item, cardElement) {
          // Deselect other cards in the same category
          const categoryCards =
            cardElement.parentElement.querySelectorAll(".setup-card");
          categoryCards.forEach((card) => card.classList.remove("selected"));

          // Select this card
          cardElement.classList.add("selected");
          this.storyElements[category] = item;
        }

        startStory() {
          const requiredElements = [
            "characters",
            "settings",
            "objects",
            "conflicts",
          ];
          const missing = requiredElements.filter(
            (elem) => !this.storyElements[elem]
          );

          if (missing.length > 0) {
            this.showMessage(`Please select: ${missing.join(", ")}`, "warning");
            return;
          }

          this.isStoryStarted = true;
          document.getElementById("storySetup").classList.remove("active");
          document.getElementById("storyInput").disabled = false;
          document.getElementById("addParagraphBtn").disabled = false;
          document.getElementById("finishStoryBtn").disabled = false;

          this.generateOpeningPrompt();
          this.updateSuggestions();
          this.showMessage(
            "ðŸŽ‰ Story started! Begin writing your opening paragraph.",
            "success"
          );
        }

        generateOpeningPrompt() {
          const character = this.storyElements.characters;
          const setting = this.storyElements.settings;
          const object = this.storyElements.objects;

          const prompts = [
            `Write about a ${character} who discovers a ${object} in a ${setting}.`,
            `Describe how a ${character} arrives at a ${setting} looking for a ${object}.`,
            `Start with a ${character} examining a mysterious ${object} in a ${setting}.`,
            `Begin with a ${character} who must find a ${object} hidden in a ${setting}.`,
          ];

          this.currentPrompt =
            prompts[Math.floor(Math.random() * prompts.length)];
          this.updatePromptDisplay();
        }

        updatePromptDisplay() {
          document.getElementById("promptDisplay").textContent =
            this.currentPrompt;
        }

        addParagraph() {
          const input = document.getElementById("storyInput");
          const text = input.value.trim();

          if (text.length < 20) {
            this.showMessage(
              "Please write at least 20 characters for your paragraph.",
              "warning"
            );
            return;
          }

          const paragraph = {
            text: text,
            author: "You",
            wordCount: text.split(/\s+/).length,
            timestamp: new Date(),
          };

          this.story.push(paragraph);
          this.updateStoryDisplay();
          this.updateStats();
          this.generateNextPrompt();

          input.value = "";
          this.updateInputWordCount();
          this.updateSuggestions();

          document.getElementById("undoBtn").disabled = false;

          const points = Math.min(paragraph.wordCount * 2, 100);
          this.score += points;
          this.updateStats();

          this.showMessage(
            `Great! Added ${paragraph.wordCount} words. (+${points} points)`,
            "success"
          );
        }

        updateStoryDisplay() {
          const display = document.getElementById("storyDisplay");

          if (this.story.length === 0) {
            display.innerHTML = `
                        <p style="text-align: center; color: var(--text-secondary); font-style: italic;">
                            Your story will appear here as you write...
                        </p>
                    `;
            return;
          }

          display.innerHTML = this.story
            .map(
              (paragraph, index) => `
                    <div class="story-paragraph">
                        <div class="paragraph-author">Paragraph ${
                          index + 1
                        } - ${paragraph.author}</div>
                        <div>${paragraph.text}</div>
                    </div>
                `
            )
            .join("");

          display.scrollTop = display.scrollHeight;
        }

        generateNextPrompt() {
          const storyLength = this.story.length;
          let promptType = "middle";

          if (storyLength === 1) {
            promptType = "middle";
          } else if (storyLength >= 4) {
            promptType = Math.random() > 0.5 ? "middle" : "ending";
          }

          const prompts = this.writingPrompts[promptType];
          this.currentPrompt =
            prompts[Math.floor(Math.random() * prompts.length)];
          this.updatePromptDisplay();
        }

        updateInputWordCount() {
          const input = document.getElementById("storyInput");
          const wordCount = input.value.trim()
            ? input.value.trim().split(/\s+/).length
            : 0;
          const counter = document.getElementById("inputWordCount");

          counter.textContent = `${wordCount} words`;

          if (wordCount < 10) {
            counter.className = "word-count";
          } else if (wordCount < 30) {
            counter.className = "word-count good";
          } else if (wordCount < 50) {
            counter.className = "word-count warning";
          } else {
            counter.className = "word-count error";
          }
        }

        updateSuggestions() {
          const container = document.getElementById("suggestionChips");
          container.innerHTML = "";

          const categories = Object.keys(this.vocabularySuggestions);
          const randomCategory =
            categories[Math.floor(Math.random() * categories.length)];
          const suggestions = this.vocabularySuggestions[randomCategory];

          suggestions.slice(0, 6).forEach((word) => {
            const chip = document.createElement("span");
            chip.className = "suggestion-chip";
            chip.textContent = word;
            container.appendChild(chip);
          });
        }

        insertSuggestion(word) {
          const input = document.getElementById("storyInput");
          const cursorPosition = input.selectionStart;
          const textBefore = input.value.substring(0, cursorPosition);
          const textAfter = input.value.substring(cursorPosition);

          const wordToInsert =
            (textBefore && !textBefore.endsWith(" ") ? " " : "") +
            word +
            (textAfter && !textAfter.startsWith(" ") ? " " : "");

          input.value = textBefore + wordToInsert + textAfter;
          input.focus();
          input.selectionStart = input.selectionEnd =
            cursorPosition + wordToInsert.length;
          this.updateInputWordCount();
        }

        showWritingHint() {
          const tips = this.writingTips;
          const randomTip = tips[Math.floor(Math.random() * tips.length)];
          this.showMessage(`ðŸ’¡ Writing Tip: ${randomTip}`, "info");
        }

        undoLastParagraph() {
          if (this.story.length === 0) return;

          const removed = this.story.pop();
          this.updateStoryDisplay();
          this.updateStats();

          if (this.story.length === 0) {
            document.getElementById("undoBtn").disabled = true;
            this.generateOpeningPrompt();
          } else {
            this.generateNextPrompt();
          }

          this.showMessage(
            `Removed paragraph with ${removed.wordCount} words.`,
            "info"
          );
        }

        finishStory() {
          if (this.story.length < 2) {
            this.showMessage(
              "Write at least 2 paragraphs before finishing your story.",
              "warning"
            );
            return;
          }

          const bonusPoints = this.story.length * 50;
          this.score += bonusPoints;
          this.updateStats();

          document.getElementById("storySharing").classList.add("show");
          document.getElementById("addParagraphBtn").disabled = true;
          document.getElementById("finishStoryBtn").disabled = true;
          document.getElementById("storyInput").disabled = true;

          this.showMessage(
            `ðŸŽ‰ Story completed! Bonus: ${bonusPoints} points for finishing!`,
            "success"
          );
        }

        startNewStory() {
          this.story = [];
          this.storyElements = {};
          this.paragraphCount = 0;
          this.totalWords = 0;
          this.score = 0;
          this.isStoryStarted = false;

          this.updateStoryDisplay();
          this.updateStats();
          this.showSetup();

          document.getElementById("storySharing").classList.remove("show");
          document.getElementById("storyInput").disabled = true;
          document.getElementById("addParagraphBtn").disabled = true;
          document.getElementById("finishStoryBtn").disabled = true;
          document.getElementById("undoBtn").disabled = true;

          document.getElementById("promptDisplay").textContent =
            'Click "Start Story" to begin your creative journey!';
          document.getElementById("storyInput").value = "";
          this.updateInputWordCount();

          this.showMessage("âœ¨ Ready to create a new story!", "info");
        }

        copyStory() {
          const storyText = this.story.map((p) => p.text).join("\n\n");
          const title = `My ${
            this.currentGenre.charAt(0).toUpperCase() +
            this.currentGenre.slice(1)
          } Story`;
          const fullText = `${title}\n\n${storyText}`;

          navigator.clipboard
            .writeText(fullText)
            .then(() => {
              this.showMessage("ðŸ“‹ Story copied to clipboard!", "success");
            })
            .catch(() => {
              this.showMessage("Could not copy story to clipboard.", "warning");
            });
        }

        saveStory() {
          const storyText = this.story.map((p) => p.text).join("\n\n");
          const title = `My ${
            this.currentGenre.charAt(0).toUpperCase() +
            this.currentGenre.slice(1)
          } Story`;
          const fullText = `${title}\n\n${storyText}`;

          const blob = new Blob([fullText], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `story-${Date.now()}.txt`;
          a.click();
          URL.revokeObjectURL(url);

          this.showMessage("ðŸ’¾ Story downloaded!", "success");
        }

        printStory() {
          const storyText = this.story.map((p) => p.text).join("\n\n");
          const title = `My ${
            this.currentGenre.charAt(0).toUpperCase() +
            this.currentGenre.slice(1)
          } Story`;

          const printWindow = window.open("", "_blank");
          printWindow.document.write(`
                    <html>
                        <head>
                            <title>${title}</title>
                            <style>
                                body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; }
                                h1 { color: #333; border-bottom: 2px solid #46bbe5; padding-bottom: 1rem; }
                                p { line-height: 1.8; margin-bottom: 1rem; text-align: justify; }
                            </style>
                        </head>
                        <body>
                            <h1>${title}</h1>
                            <div>${storyText
                              .split("\n\n")
                              .map((p) => `<p>${p}</p>`)
                              .join("")}</div>
                        </body>
                    </html>
                `);
          printWindow.document.close();
          printWindow.print();
        }

        updateStats() {
          this.paragraphCount = this.story.length;
          this.totalWords = this.story.reduce((sum, p) => sum + p.wordCount, 0);

          document.getElementById("paragraphCount").textContent =
            this.paragraphCount;
          document.getElementById("wordCount").textContent = this.totalWords;
          document.getElementById("storyScore").textContent = this.score;
          document.getElementById("genreDisplay").textContent =
            this.currentGenre.charAt(0).toUpperCase() +
            this.currentGenre.slice(1);
        }

        showMessage(text, type) {
          const message = document.getElementById("gameMessage");
          message.textContent = text;
          message.className = `game-message message-${type}`;
          message.style.display = "block";

          setTimeout(() => {
            message.style.display = "none";
          }, 4000);
        }
      }

      // Initialize game when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new StoryBuilderGame();
      });
    </script>
  </body>
</html>
