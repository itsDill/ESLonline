<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-2456627863532019" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BalanceMan - ESL Hangman Word Game | ESL Fun Online</title>
    <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="../images/favicon-48x48.png"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../images/favicon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="../images/favicon-512x512.png"
    />

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "BalanceMan - ESL Hangman Word Game",
        "description": "Play BalanceMan - an exciting ESL hangman-style word guessing game! Improve vocabulary across categories like animals, food, objects with progressive difficulty levels.",
        "url": "https://eslfunonline.com/games/balanceman.html",
        "image": "https://eslfunonline.com/images/image copy 10.png",
        "author": {
          "@type": "Organization",
          "name": "ESL Fun Online"
        },
        "publisher": {
          "@type": "Organization",
          "name": "ESL Fun Online"
        },
        "genre": "Educational Game",
        "educationalUse": "Vocabulary Building",
        "learningResourceType": "Game",
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "isFamilyFriendly": true
      }
    </script>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/balanceman-page.css" />
    <link rel="stylesheet" href="../css/mobile-optimized.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>

  <body>
    <div
      class="game-container"
      role="main"
      aria-label="BalanceMan word guessing game"
    >
      <header class="game-header">
        <h1>
          <i class="fas fa-balance-scale" aria-hidden="true"></i> BalanceMan
        </h1>
        <p>Help BalanceMan stay balanced by guessing the English word!</p>
        <p
          style="
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
          "
          role="note"
          aria-label="Keyboard shortcuts"
        >
          üí° Use keyboard: A-Z to guess, H for hint, Enter for new game, Esc to
          exit
        </p>
      </header>

      <!-- Immediate Mobile Menu Script - Inline for guaranteed execution -->
      <script>
        (function () {
          "use strict";

          function initMobileMenu() {
            const mobileToggle = document.getElementById("mobileToggle");
            const navLinks = document.getElementById("navLinks");
            const body = document.body;

            if (!mobileToggle || !navLinks) {
              console.warn("Mobile menu elements not found");
              return;
            }

            console.log("Immediate mobile menu initialized");

            let isMenuOpen = false;

            function toggleMenu(e) {
              if (e && e.preventDefault) e.preventDefault();
              if (e && e.stopPropagation) e.stopPropagation();

              isMenuOpen = !isMenuOpen;
              const icon = mobileToggle.querySelector("i");

              if (isMenuOpen) {
                navLinks.classList.add("active");
                body.classList.add("mobile-menu-open");
                body.style.overflow = "hidden";
                if (icon) icon.className = "fas fa-times";
                console.log("Menu opened");
              } else {
                navLinks.classList.remove("active");
                body.classList.remove("mobile-menu-open");
                body.style.overflow = "";
                if (icon) icon.className = "fas fa-bars";
                console.log("Menu closed");

                // Close all dropdowns
                document.querySelectorAll(".nav-item").forEach((item) => {
                  item.classList.remove("mobile-open", "mobile-dropdown-open");
                  const chevron = item.querySelector(".fa-chevron-down");
                  if (chevron) chevron.style.transform = "rotate(0deg)";
                });
              }
            }

            // Simple unified handler - works for both touch and click
            let lastToggleTime = 0;

            function handleToggleClick(e) {
              const now = Date.now();
              // Prevent double-firing within 300ms
              if (now - lastToggleTime < 300) {
                console.log("Toggle ignored - too fast");
                return;
              }
              lastToggleTime = now;

              e.preventDefault();
              e.stopPropagation();
              console.log("Hamburger clicked/tapped");
              toggleMenu(e);
            }

            mobileToggle.addEventListener("click", handleToggleClick);
            mobileToggle.addEventListener("touchend", handleToggleClick);

            // Handle dropdown toggles on mobile
            document.querySelectorAll(".nav-item").forEach((item) => {
              const link = item.querySelector(".nav-link");
              const dropdown = item.querySelector(".dropdown");
              const chevron = link?.querySelector(".fa-chevron-down");

              // Only add special handling for links WITH dropdowns
              if (link && dropdown && chevron) {
                // Simple unified dropdown handler
                let lastDropdownToggle = 0;

                function handleDropdownClick(e) {
                  if (window.innerWidth > 768) return; // Only on mobile

                  const now = Date.now();
                  // Prevent double-firing within 300ms
                  if (now - lastDropdownToggle < 300) {
                    console.log("Dropdown toggle ignored - too fast");
                    return;
                  }
                  lastDropdownToggle = now;

                  e.preventDefault();
                  e.stopPropagation();

                  const isOpen = item.classList.contains("mobile-open");
                  console.log(
                    "Dropdown clicked:",
                    isOpen ? "closing" : "opening"
                  );

                  // Close other dropdowns
                  document
                    .querySelectorAll(".nav-item")
                    .forEach((otherItem) => {
                      if (otherItem !== item) {
                        otherItem.classList.remove(
                          "mobile-open",
                          "mobile-dropdown-open"
                        );
                        const otherChevron =
                          otherItem.querySelector(".fa-chevron-down");
                        if (otherChevron)
                          otherChevron.style.transform = "rotate(0deg)";
                      }
                    });

                  // Toggle current dropdown
                  if (isOpen) {
                    item.classList.remove(
                      "mobile-open",
                      "mobile-dropdown-open"
                    );
                    chevron.style.transform = "rotate(0deg)";
                    link.setAttribute("aria-expanded", "false");
                  } else {
                    item.classList.add("mobile-open", "mobile-dropdown-open");
                    chevron.style.transform = "rotate(180deg)";
                    link.setAttribute("aria-expanded", "true");
                  }
                }

                // Remove href="#" behavior on mobile
                if (link.getAttribute("href") === "#") {
                  link.style.cursor = "pointer";
                }

                // Attach handlers for both click and touch
                link.addEventListener("click", handleDropdownClick);
                link.addEventListener("touchend", handleDropdownClick);
              }
            });

            // Close menu when clicking outside
            document.addEventListener("click", function (e) {
              if (window.innerWidth <= 768 && isMenuOpen) {
                if (
                  !mobileToggle.contains(e.target) &&
                  !navLinks.contains(e.target)
                ) {
                  toggleMenu(null);
                }
              }
            });

            // Close menu on escape key
            document.addEventListener("keydown", function (e) {
              if (e.key === "Escape" && isMenuOpen) {
                toggleMenu(null);
                mobileToggle.focus();
              }
            });

            // Close menu on window resize to desktop
            window.addEventListener("resize", function () {
              if (window.innerWidth > 768 && isMenuOpen) {
                toggleMenu(null);
              }
            });

            // Close menu after dropdown link click
            document.querySelectorAll(".dropdown a").forEach((link) => {
              link.addEventListener("click", function () {
                if (window.innerWidth <= 768 && isMenuOpen) {
                  setTimeout(() => {
                    toggleMenu(null);
                  }, 100);
                }
              });
            });
          }

          // Initialize immediately if DOM is ready, otherwise wait
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initMobileMenu);
          } else {
            initMobileMenu();
          }
        })();
      </script>

      <!-- Additional Mobile Dropdown Fixes -->

      <!-- Google AdSense -->
      <div
        class="difficulty-selector"
        id="difficultySelector"
        role="radiogroup"
        aria-label="Select difficulty level"
      >
        <h3 id="difficulty-label">Choose Difficulty:</h3>
        <button
          class="difficulty-btn active"
          data-difficulty="easy"
          role="radio"
          aria-checked="true"
          aria-labelledby="difficulty-label"
        >
          Easy (4-6 letters)
        </button>
        <button
          class="difficulty-btn"
          data-difficulty="medium"
          role="radio"
          aria-checked="false"
          aria-labelledby="difficulty-label"
        >
          Medium (7-9 letters)
        </button>
        <button
          class="difficulty-btn"
          data-difficulty="hard"
          role="radio"
          aria-checked="false"
          aria-labelledby="difficulty-label"
        >
          Hard (10+ letters)
        </button>
      </div>

      <div
        class="category-selector"
        id="categorySelector"
        role="radiogroup"
        aria-label="Select word category"
      >
        <h3 id="category-label">Choose Category:</h3>
        <button
          class="category-btn active"
          data-category="general"
          role="radio"
          aria-checked="true"
          aria-labelledby="category-label"
        >
          General
        </button>
        <button
          class="category-btn"
          data-category="animals"
          role="radio"
          aria-checked="false"
          aria-labelledby="category-label"
        >
          Animals
        </button>
        <button
          class="category-btn"
          data-category="food"
          role="radio"
          aria-checked="false"
          aria-labelledby="category-label"
        >
          Food
        </button>
        <button
          class="category-btn"
          data-category="colors"
          role="radio"
          aria-checked="false"
          aria-labelledby="category-label"
        >
          Colors
        </button>
        <button
          class="category-btn"
          data-category="family"
          role="radio"
          aria-checked="false"
          aria-labelledby="category-label"
        >
          Family
        </button>
        <button
          class="category-btn"
          data-category="school"
          role="radio"
          aria-checked="false"
          aria-labelledby="category-label"
        >
          School
        </button>
        <button
          class="category-btn"
          data-category="weather"
          role="radio"
          aria-checked="false"
          aria-labelledby="category-label"
        >
          Weather
        </button>
      </div>

      <div class="balance-area" role="region" aria-label="Game status area">
        <div class="balanceman safe" id="balancemanFigure" aria-hidden="true">
          ‚öñÔ∏è
        </div>
        <div
          class="balance-status"
          id="balanceStatus"
          role="status"
          aria-live="polite"
        >
          BalanceMan is stable!
        </div>
        <div
          class="progress-bar"
          role="progressbar"
          aria-label="Wrong guesses progress"
          aria-valuemin="0"
          aria-valuemax="6"
          aria-valuenow="0"
        >
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div
          class="word-display"
          id="wordDisplay"
          role="status"
          aria-live="polite"
          aria-label="Current word progress"
        ></div>
        <div class="word-hint" id="wordHint" role="note"></div>
      </div>

      <div class="game-stats" role="region" aria-label="Game statistics">
        <div class="stat">
          <div
            class="stat-value"
            id="correctGuesses"
            aria-label="Correct guesses"
          >
            0
          </div>
          <div class="stat-label">Correct</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="wrongGuesses" aria-label="Wrong guesses">
            0
          </div>
          <div class="stat-label">Wrong</div>
        </div>
        <div class="stat">
          <div
            class="stat-value"
            id="wordsCompleted"
            aria-label="Words completed"
          >
            0
          </div>
          <div class="stat-label">Words</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="gameScore" aria-label="Current score">
            0
          </div>
          <div class="stat-label">Score</div>
        </div>
        <div class="stat">
          <div
            class="stat-value"
            id="currentStreak"
            aria-label="Current winning streak"
          >
            0
          </div>
          <div class="stat-label">Streak</div>
        </div>
        <div class="stat">
          <div
            class="stat-value"
            id="bestStreak"
            aria-label="Best winning streak"
          >
            0
          </div>
          <div class="stat-label">Best</div>
        </div>
      </div>

      <div
        class="alphabet-grid"
        id="alphabetGrid"
        role="group"
        aria-label="Letter selection buttons"
      ></div>

      <div
        class="game-message"
        id="gameMessage"
        style="display: none"
        role="alert"
        aria-live="assertive"
      ></div>

      <div class="game-controls">
        <button
          class="btn btn-primary"
          id="newGameBtn"
          aria-label="Start a new game"
        >
          <i class="fas fa-play" aria-hidden="true"></i> New Game
        </button>
        <button
          class="btn btn-hint"
          id="hintBtn"
          aria-label="Get a hint for 5 points penalty"
        >
          <i class="fas fa-lightbulb" aria-hidden="true"></i> Get Hint (-5 pts)
        </button>
        <button
          class="btn btn-secondary"
          id="skipWordBtn"
          aria-label="Skip current word"
        >
          <i class="fas fa-forward" aria-hidden="true"></i> Skip Word
        </button>
        <button
          class="btn btn-secondary"
          onclick="window.location.href='../games.html'"
          aria-label="Return to games page"
        >
          <i class="fas fa-arrow-left" aria-hidden="true"></i> Back to Games
        </button>
      </div>
    </div>

    <script>
      class BalanceManGame {
        constructor() {
          this.currentWord = "";
          this.currentHint = "";
          this.currentCategory = "general";
          this.difficulty = "easy";
          this.guessedLetters = new Set();
          this.correctGuesses = 0;
          this.wrongGuesses = 0;
          this.maxWrongGuesses = 6;
          this.wordsCompleted = 0;
          this.score = 0;
          this.hintUsed = false;
          this.currentStreak = 0;
          this.bestStreak = 0;
          this.usedWords = new Set();

          // Load stats from localStorage
          this.loadStats();

          this.wordLists = {
            general: {
              easy: [
                { word: "HAPPY", hint: "Feeling good and cheerful" },
                { word: "HOUSE", hint: "A place where people live" },
                { word: "WATER", hint: "Clear liquid we drink" },
                { word: "MUSIC", hint: "Sounds that make songs" },
                { word: "FRIEND", hint: "Someone you like and trust" },
                { word: "SMILE", hint: "Happy expression on your face" },
                { word: "DANCE", hint: "Move your body to music" },
                { word: "BOOK", hint: "You read this to learn" },
                { word: "PHONE", hint: "Device to call people" },
                { word: "TIME", hint: "Minutes and hours" },
                { word: "LIGHT", hint: "Opposite of dark" },
                { word: "HEART", hint: "Symbol of love" },
                { word: "DREAM", hint: "What you see when you sleep" },
                { word: "STAR", hint: "Shines in the night sky" },
                { word: "TREE", hint: "Tall plant with leaves" },
              ],
              medium: [
                { word: "BEAUTIFUL", hint: "Very pretty or attractive" },
                {
                  word: "COMPUTER",
                  hint: "Electronic device for work and games",
                },
                { word: "TELEPHONE", hint: "Device used to call people" },
                { word: "IMPORTANT", hint: "Something that matters a lot" },
                {
                  word: "LANGUAGE",
                  hint: "System of communication like English",
                },
                { word: "DELICIOUS", hint: "Very tasty food" },
                { word: "DIFFERENT", hint: "Not the same as something else" },
                { word: "EXERCISE", hint: "Physical activity for health" },
                { word: "BIRTHDAY", hint: "Day you were born" },
                { word: "VACATION", hint: "Time off from work or school" },
                { word: "ADVENTURE", hint: "Exciting experience" },
                { word: "MOUNTAIN", hint: "Very tall natural landform" },
              ],
              hard: [
                { word: "UNDERSTANDING", hint: "Knowing what something means" },
                {
                  word: "COMMUNICATION",
                  hint: "Sharing information with others",
                },
                {
                  word: "RESPONSIBILITY",
                  hint: "Being accountable for something",
                },
                { word: "ENCYCLOPEDIA", hint: "Book with lots of information" },
                { word: "PRONUNCIATION", hint: "How to say words correctly" },
                { word: "EXTRAORDINARY", hint: "Very unusual or remarkable" },
                { word: "UNFORGETTABLE", hint: "Impossible to forget" },
              ],
            },
            animals: {
              easy: [
                { word: "CAT", hint: "Pet that says meow" },
                { word: "DOG", hint: "Pet that barks and wags tail" },
                { word: "BIRD", hint: "Animal that flies and has wings" },
                { word: "FISH", hint: "Animal that swims in water" },
                { word: "HORSE", hint: "Large animal people can ride" },
                { word: "MOUSE", hint: "Small animal that cats chase" },
                { word: "LION", hint: "King of the jungle" },
                { word: "BEAR", hint: "Large furry animal" },
                { word: "TIGER", hint: "Orange cat with black stripes" },
                { word: "SNAKE", hint: "Long animal with no legs" },
              ],
              medium: [
                {
                  word: "ELEPHANT",
                  hint: "Very large animal with a long trunk",
                },
                { word: "BUTTERFLY", hint: "Colorful flying insect" },
                { word: "KANGAROO", hint: "Australian animal that hops" },
                {
                  word: "PENGUIN",
                  hint: "Black and white bird that cannot fly",
                },
                { word: "DOLPHIN", hint: "Smart ocean mammal" },
                { word: "GIRAFFE", hint: "Tallest animal with long neck" },
                {
                  word: "MONKEY",
                  hint: "Playful animal that swings from trees",
                },
              ],
              hard: [
                { word: "HIPPOPOTAMUS", hint: "Large African water animal" },
                {
                  word: "CHIMPANZEE",
                  hint: "Intelligent ape similar to humans",
                },
                { word: "RHINOCEROS", hint: "Large animal with horn on nose" },
              ],
            },
            food: {
              easy: [
                { word: "APPLE", hint: "Red or green round fruit" },
                { word: "BREAD", hint: "Food made from flour" },
                { word: "MILK", hint: "White drink from cows" },
                { word: "RICE", hint: "Small white grains people eat" },
                { word: "PIZZA", hint: "Round food with cheese and toppings" },
                { word: "CAKE", hint: "Sweet dessert for birthdays" },
                { word: "CHEESE", hint: "Yellow dairy product" },
                { word: "CARROT", hint: "Orange vegetable rabbits love" },
              ],
              medium: [
                { word: "SANDWICH", hint: "Food between two pieces of bread" },
                { word: "CHOCOLATE", hint: "Sweet brown candy" },
                { word: "HAMBURGER", hint: "Meat in a round bun" },
                { word: "SPAGHETTI", hint: "Long thin pasta" },
                {
                  word: "BROCCOLI",
                  hint: "Green vegetable that looks like a tree",
                },
                { word: "STRAWBERRY", hint: "Red berry with seeds outside" },
              ],
              hard: [
                {
                  word: "WATERMELON",
                  hint: "Large green fruit with red inside",
                },
                {
                  word: "CAULIFLOWER",
                  hint: "White vegetable that looks like a tree",
                },
                { word: "POMEGRANATE", hint: "Red fruit with many seeds" },
              ],
            },
            colors: {
              easy: [
                { word: "RED", hint: "Color of blood and roses" },
                { word: "BLUE", hint: "Color of the sky and ocean" },
                { word: "GREEN", hint: "Color of grass and leaves" },
                { word: "YELLOW", hint: "Color of the sun and bananas" },
                { word: "BLACK", hint: "Darkest color" },
                { word: "WHITE", hint: "Lightest color" },
                { word: "PINK", hint: "Light red color" },
                { word: "BROWN", hint: "Color of wood and chocolate" },
              ],
              medium: [
                { word: "PURPLE", hint: "Mix of red and blue" },
                { word: "ORANGE", hint: "Mix of red and yellow" },
                { word: "SILVER", hint: "Shiny gray color" },
                { word: "GOLDEN", hint: "Color of gold and treasure" },
              ],
              hard: [
                {
                  word: "TURQUOISE",
                  hint: "Blue-green color like tropical water",
                },
                { word: "LAVENDER", hint: "Light purple color" },
              ],
            },
            family: {
              easy: [
                { word: "MOTHER", hint: "Female parent" },
                { word: "FATHER", hint: "Male parent" },
                { word: "SISTER", hint: "Female sibling" },
                { word: "BROTHER", hint: "Male sibling" },
                { word: "BABY", hint: "Very young child" },
                { word: "UNCLE", hint: "Brother of your parent" },
                { word: "AUNT", hint: "Sister of your parent" },
              ],
              medium: [
                { word: "DAUGHTER", hint: "Female child" },
                { word: "GRANDSON", hint: "Son of your child" },
                { word: "COUSIN", hint: "Child of your aunt or uncle" },
                { word: "NEPHEW", hint: "Son of your sibling" },
                { word: "PARENTS", hint: "Mother and father together" },
              ],
              hard: [
                { word: "GRANDMOTHER", hint: "Mother of your parent" },
                { word: "GRANDFATHER", hint: "Father of your parent" },
              ],
            },
            school: {
              easy: [
                { word: "BOOK", hint: "You read this to learn" },
                { word: "PEN", hint: "Tool for writing" },
                { word: "DESK", hint: "Table where students sit" },
                { word: "CHAIR", hint: "Furniture you sit on" },
                { word: "PAPER", hint: "White sheets for writing" },
                { word: "RULER", hint: "Tool to measure and draw lines" },
                { word: "ERASER", hint: "Removes pencil marks" },
              ],
              medium: [
                { word: "TEACHER", hint: "Person who helps you learn" },
                { word: "STUDENT", hint: "Person who goes to school" },
                { word: "HOMEWORK", hint: "Work you do at home" },
                { word: "CLASSROOM", hint: "Room where lessons happen" },
                { word: "BACKPACK", hint: "Bag to carry school supplies" },
                { word: "LIBRARY", hint: "Place with many books" },
              ],
              hard: [
                { word: "CALCULATOR", hint: "Machine that helps with math" },
                {
                  word: "DICTIONARY",
                  hint: "Book that explains word meanings",
                },
                { word: "GRADUATION", hint: "Ceremony when you finish school" },
              ],
            },
            weather: {
              easy: [
                { word: "SUN", hint: "Bright light in the sky" },
                { word: "RAIN", hint: "Water drops from clouds" },
                { word: "SNOW", hint: "White flakes in winter" },
                { word: "WIND", hint: "Moving air" },
                { word: "CLOUD", hint: "White or gray in the sky" },
                { word: "STORM", hint: "Very bad weather" },
                { word: "COLD", hint: "Low temperature" },
              ],
              medium: [
                { word: "RAINBOW", hint: "Colorful arc in the sky after rain" },
                { word: "THUNDER", hint: "Loud sound during storms" },
                { word: "LIGHTNING", hint: "Bright flash in the sky" },
                { word: "HURRICANE", hint: "Very strong circular storm" },
                { word: "TORNADO", hint: "Spinning funnel of wind" },
              ],
              hard: [
                { word: "TEMPERATURE", hint: "How hot or cold it is" },
                { word: "METEOROLOGY", hint: "Science of studying weather" },
              ],
            },
          };

          this.init();
        }

        init() {
          this.createAlphabetGrid();
          this.setupEventListeners();
          this.updateStats();
          this.startNewGame();
        }

        loadStats() {
          try {
            const savedStats = localStorage.getItem("balancemanStats");
            if (savedStats) {
              const stats = JSON.parse(savedStats);
              this.score = stats.score || 0;
              this.wordsCompleted = stats.wordsCompleted || 0;
              this.bestStreak = stats.bestStreak || 0;
            }
          } catch (e) {
            console.warn("Could not load stats from localStorage", e);
          }
        }

        saveStats() {
          try {
            const stats = {
              score: this.score,
              wordsCompleted: this.wordsCompleted,
              bestStreak: this.bestStreak,
              lastPlayed: new Date().toISOString(),
            };
            localStorage.setItem("balancemanStats", JSON.stringify(stats));
          } catch (e) {
            console.warn("Could not save stats to localStorage", e);
          }
        }

        updateStats() {
          this.updateStatWithAnimation("correctGuesses", this.correctGuesses);
          this.updateStatWithAnimation("wrongGuesses", this.wrongGuesses);
          this.updateStatWithAnimation("wordsCompleted", this.wordsCompleted);
          this.updateStatWithAnimation("gameScore", this.score);
          this.updateStatWithAnimation("currentStreak", this.currentStreak);
          this.updateStatWithAnimation("bestStreak", this.bestStreak);
        }

        createAlphabetGrid() {
          const grid = document.getElementById("alphabetGrid");
          const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

          grid.innerHTML = "";
          for (let letter of letters) {
            const button = document.createElement("button");
            button.className = "letter-btn";
            button.textContent = letter;
            button.setAttribute("aria-label", `Letter ${letter}`);
            button.onclick = () => this.guessLetter(letter);
            grid.appendChild(button);
          }
        }

        setupEventListeners() {
          document.getElementById("newGameBtn").onclick = () =>
            this.startNewGame();
          document.getElementById("hintBtn").onclick = () => this.showHint();

          const skipBtn = document.getElementById("skipWordBtn");
          if (skipBtn) {
            skipBtn.onclick = () => this.skipWord();
          }

          // Difficulty selector
          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.onclick = () => {
              document.querySelectorAll(".difficulty-btn").forEach((b) => {
                b.classList.remove("active");
                b.setAttribute("aria-checked", "false");
              });
              btn.classList.add("active");
              btn.setAttribute("aria-checked", "true");
              this.difficulty = btn.dataset.difficulty;
              this.usedWords.clear(); // Reset used words when changing difficulty
              this.startNewGame();
            };
          });

          // Category selector
          document.querySelectorAll(".category-btn").forEach((btn) => {
            btn.onclick = () => {
              document.querySelectorAll(".category-btn").forEach((b) => {
                b.classList.remove("active");
                b.setAttribute("aria-checked", "false");
              });
              btn.classList.add("active");
              btn.setAttribute("aria-checked", "true");
              this.currentCategory = btn.dataset.category;
              this.usedWords.clear(); // Reset used words when changing category
              this.startNewGame();
            };
          });

          // Keyboard support
          document.addEventListener("keydown", (e) => {
            const letter = e.key.toUpperCase();
            if (
              letter >= "A" &&
              letter <= "Z" &&
              !this.guessedLetters.has(letter)
            ) {
              e.preventDefault();
              const letterBtn = Array.from(
                document.querySelectorAll(".letter-btn")
              ).find((btn) => btn.textContent === letter && !btn.disabled);
              if (letterBtn) {
                this.guessLetter(letter);
              }
            } else if (e.key === "Enter") {
              e.preventDefault();
              if (document.getElementById("newGameBtn").offsetParent !== null) {
                this.startNewGame();
              }
            } else if (e.key === "h" || e.key === "H") {
              e.preventDefault();
              if (!document.getElementById("hintBtn").disabled) {
                this.showHint();
              }
            } else if (e.key === "s" || e.key === "S") {
              e.preventDefault();
              const skipBtn = document.getElementById("skipWordBtn");
              if (skipBtn && !skipBtn.disabled) {
                this.skipWord();
              }
            } else if (e.key === "Escape") {
              e.preventDefault();
              if (confirm("Are you sure you want to exit the game?")) {
                window.location.href = "../games.html";
              }
            }
          });
        }

        startNewGame() {
          this.guessedLetters.clear();
          this.wrongGuesses = 0;
          this.correctGuesses = 0;
          this.hintUsed = false;

          // Get random word from selected category and difficulty
          const wordList =
            this.wordLists[this.currentCategory][this.difficulty];

          // Filter out already used words
          const availableWords = wordList.filter(
            (item) => !this.usedWords.has(item.word)
          );

          // If all words have been used, reset the used words
          if (availableWords.length === 0) {
            this.usedWords.clear();
            this.showMessage(
              "üéâ You completed all words in this category! Starting over...",
              "success"
            );
            setTimeout(() => this.hideMessage(), 2000);
          }

          const wordsToUse =
            availableWords.length > 0 ? availableWords : wordList;
          const randomIndex = Math.floor(Math.random() * wordsToUse.length);
          const selectedWord = wordsToUse[randomIndex];

          this.currentWord = selectedWord.word;
          this.currentHint = selectedWord.hint;
          this.usedWords.add(this.currentWord);

          this.updateDisplay();
          this.resetAlphabetGrid();
          this.updateBalanceMan();
          this.hideMessage();

          // Reset hint button
          const hintBtn = document.getElementById("hintBtn");
          hintBtn.disabled = false;
          hintBtn.innerHTML =
            '<i class="fas fa-lightbulb" aria-hidden="true"></i> Get Hint (-5 pts)';

          // Update progress bar
          const progressBar = document.querySelector(".progress-bar");
          if (progressBar) {
            progressBar.setAttribute("aria-valuenow", "0");
          }
        }

        skipWord() {
          this.currentStreak = 0;
          this.showMessage("‚è≠Ô∏è Word skipped. Streak reset!", "danger");
          this.updateStats();
          setTimeout(() => {
            this.startNewGame();
          }, 1500);
        }

        guessLetter(letter) {
          if (this.guessedLetters.has(letter)) return;

          this.guessedLetters.add(letter);

          const letterBtn = Array.from(
            document.querySelectorAll(".letter-btn")
          ).find((btn) => btn.textContent === letter);

          if (!letterBtn) return;

          letterBtn.disabled = true;
          letterBtn.setAttribute("aria-pressed", "true");

          // Add loading state
          letterBtn.classList.add("loading");

          setTimeout(() => {
            letterBtn.classList.remove("loading");

            if (this.currentWord.includes(letter)) {
              letterBtn.classList.add("correct");
              this.correctGuesses++;
              this.score += 10;
              this.animateScoreIncrease();

              // Play success sound effect (if available)
              this.playSound("correct");

              // Announce to screen readers
              this.announceToScreenReader(
                `Correct! Letter ${letter} is in the word.`
              );

              if (this.isWordComplete()) {
                this.handleWordComplete();
              }
            } else {
              letterBtn.classList.add("incorrect");
              this.wrongGuesses++;

              // Play error sound effect (if available)
              this.playSound("incorrect");

              // Announce to screen readers
              this.announceToScreenReader(
                `Incorrect. Letter ${letter} is not in the word. ${
                  this.maxWrongGuesses - this.wrongGuesses
                } guesses remaining.`
              );

              if (this.wrongGuesses >= this.maxWrongGuesses) {
                this.handleGameOver();
              }
            }

            this.updateDisplay();
            this.updateBalanceMan();
          }, 200);
        }

        announceToScreenReader(message) {
          const announcement = document.createElement("div");
          announcement.setAttribute("role", "status");
          announcement.setAttribute("aria-live", "polite");
          announcement.className = "sr-only";
          announcement.textContent = message;
          document.body.appendChild(announcement);
          setTimeout(() => announcement.remove(), 1000);
        }

        animateScoreIncrease() {
          const scoreElement = document.getElementById("gameScore");
          scoreElement.classList.add("score-animation");
          setTimeout(() => {
            scoreElement.classList.remove("score-animation");
          }, 600);
        }

        playSound(type) {
          // Simple audio feedback using Web Audio API
          try {
            const audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === "correct") {
              oscillator.frequency.setValueAtTime(
                523.25,
                audioContext.currentTime
              ); // C5
              oscillator.frequency.setValueAtTime(
                659.25,
                audioContext.currentTime + 0.1
              ); // E5
            } else {
              oscillator.frequency.setValueAtTime(
                220,
                audioContext.currentTime
              ); // A3
              oscillator.frequency.setValueAtTime(
                196,
                audioContext.currentTime + 0.1
              ); // G3
            }

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.3
            );

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
          } catch (e) {
            // Audio not supported or blocked
          }
        }

        isWordComplete() {
          return this.currentWord
            .split("")
            .every(
              (letter) => this.guessedLetters.has(letter) || letter === " "
            );
        }

        handleWordComplete() {
          this.wordsCompleted++;
          this.currentStreak++;

          // Update best streak
          if (this.currentStreak > this.bestStreak) {
            this.bestStreak = this.currentStreak;
          }

          const bonusScore = this.hintUsed ? 25 : 50;
          const streakBonus =
            this.currentStreak > 1 ? this.currentStreak * 5 : 0;
          const totalBonus = bonusScore + streakBonus;
          this.score += totalBonus;

          // Save stats
          this.saveStats();

          // Create celebration effect
          this.createCelebrationEffect();

          let message = this.hintUsed
            ? `üéâ Great job! BalanceMan is safe! (+${totalBonus} points)`
            : `üåü Perfect! No hints needed! (+${totalBonus} points)`;

          if (streakBonus > 0) {
            message += ` | üî• ${this.currentStreak} win streak! (+${streakBonus} bonus)`;
          }

          this.showMessage(message, "success");

          // Add confetti animation
          this.showConfetti();

          // Announce to screen readers
          this.announceToScreenReader(
            `Congratulations! You completed the word ${this.currentWord}. ${message}`
          );

          setTimeout(() => {
            this.startNewGame();
          }, 2500);
        }

        createCelebrationEffect() {
          const balanceArea = document.querySelector(".balance-area");
          balanceArea.style.background = "var(--gradient-success)";
          balanceArea.style.transform = "scale(1.02)";

          setTimeout(() => {
            balanceArea.style.transform = "scale(1)";
          }, 300);
        }

        showConfetti() {
          // Simple confetti effect
          const colors = [
            "#ff6b6b",
            "#4ecdc4",
            "#45b7d1",
            "#96ceb4",
            "#ffeaa7",
            "#dda0dd",
          ];

          for (let i = 0; i < 20; i++) {
            setTimeout(() => {
              const confetti = document.createElement("div");
              confetti.style.cssText = `
                position: fixed;
                top: -10px;
                left: ${Math.random() * 100}vw;
                width: 10px;
                height: 10px;
                background: ${
                  colors[Math.floor(Math.random() * colors.length)]
                };
                z-index: 1000;
                border-radius: 50%;
                animation: confetti-fall 3s linear forwards;
                pointer-events: none;
              `;

              document.body.appendChild(confetti);

              setTimeout(() => {
                confetti.remove();
              }, 3000);
            }, i * 100);
          }
        }

        handleGameOver() {
          this.currentStreak = 0;
          this.showMessage(
            `üíî BalanceMan fell! The word was "${this.currentWord}". Streak reset!`,
            "danger"
          );

          // Save stats
          this.saveStats();

          // Announce to screen readers
          this.announceToScreenReader(
            `Game over. The word was ${this.currentWord}. Your streak has been reset.`
          );

          // Disable all letter buttons with animation
          document.querySelectorAll(".letter-btn").forEach((btn, index) => {
            setTimeout(() => {
              btn.disabled = true;
              btn.style.opacity = "0.5";
            }, index * 50);
          });

          // Auto-restart after delay
          setTimeout(() => {
            const shouldRestart = confirm(
              "Would you like to try again with a new word?"
            );
            if (shouldRestart) {
              this.startNewGame();
            } else {
              window.location.href = "../games.html";
            }
          }, 3000);
        }

        updateDisplay() {
          // Update word display with animation
          const display = this.currentWord
            .split("")
            .map((letter, index) => {
              if (this.guessedLetters.has(letter) || letter === " ") {
                return `<span class="letter-reveal" style="animation-delay: ${
                  index * 0.1
                }s">${letter}</span>`;
              }
              return "_";
            })
            .join(" ");

          document.getElementById("wordDisplay").innerHTML = display;

          // Update stats with smooth transitions
          this.updateStats();
        }

        updateStatWithAnimation(elementId, newValue) {
          const element = document.getElementById(elementId);
          const currentValue = parseInt(element.textContent) || 0;

          if (newValue !== currentValue) {
            // Animate number change
            const increment = newValue > currentValue ? 1 : -1;
            const step = () => {
              const current = parseInt(element.textContent) || 0;
              if (
                (increment > 0 && current < newValue) ||
                (increment < 0 && current > newValue)
              ) {
                element.textContent = current + increment;
                setTimeout(step, 50);
              } else {
                element.textContent = newValue;
              }
            };
            step();
          }
        }

        updateBalanceMan() {
          const figure = document.getElementById("balancemanFigure");
          const status = document.getElementById("balanceStatus");
          const balanceArea = document.querySelector(".balance-area");

          const dangerLevel = this.wrongGuesses / this.maxWrongGuesses;
          const progressPercent = dangerLevel * 100;

          // Update progress bar
          const progressFill = document.getElementById("progressFill");
          if (progressFill) {
            progressFill.style.width = `${progressPercent}%`;
          }

          // Remove existing classes
          figure.className = "balanceman";
          balanceArea.classList.remove("danger-bg");

          if (dangerLevel === 0) {
            figure.textContent = "‚öñÔ∏è";
            figure.classList.add("safe");
            status.textContent = "BalanceMan is perfectly balanced! üéØ";
            status.style.color = "var(--success-color)";
          } else if (dangerLevel < 0.33) {
            figure.textContent = "‚öñÔ∏è";
            figure.classList.add("safe");
            status.textContent = "BalanceMan is slightly wobbly... üòÖ";
            status.style.color = "var(--secondary-color)";
          } else if (dangerLevel < 0.67) {
            figure.textContent = "ü§π";
            figure.classList.add("danger");
            status.textContent = "BalanceMan is struggling to balance! üò∞";
            status.style.color = "var(--orange-color)";
            balanceArea.classList.add("danger-bg");
          } else if (dangerLevel < 1) {
            figure.textContent = "ü§∏";
            figure.classList.add("danger");
            status.textContent = "BalanceMan is about to fall! üö®";
            status.style.color = "var(--danger-color)";
            balanceArea.classList.add("danger-bg");
          } else {
            figure.textContent = "ÔøΩ";
            figure.classList.add("danger");
            status.textContent = "BalanceMan has fallen! üíî";
            status.style.color = "var(--danger-color)";
            balanceArea.classList.add("danger-bg");
          }

          // Add shake animation for danger states
          if (dangerLevel >= 0.5) {
            figure.style.animation = "shake 0.5s ease-in-out infinite";
          } else {
            figure.style.animation = "";
          }
        }

        resetAlphabetGrid() {
          document.querySelectorAll(".letter-btn").forEach((btn) => {
            btn.disabled = false;
            btn.classList.remove("correct", "incorrect");
          });
        }

        showHint() {
          if (!this.hintUsed) {
            document.getElementById(
              "wordHint"
            ).textContent = `üí° Hint: ${this.currentHint}`;
            this.hintUsed = true;

            const hintBtn = document.getElementById("hintBtn");
            hintBtn.disabled = true;
            hintBtn.textContent = "Hint Used";
            hintBtn.innerHTML =
              '<i class="fas fa-check" aria-hidden="true"></i> Hint Used';
            hintBtn.setAttribute("aria-label", "Hint has been used");

            this.score = Math.max(0, this.score - 5); // Small penalty for using hint
            this.updateDisplay();
            this.animateScoreDecrease();

            // Announce to screen readers
            this.announceToScreenReader(
              `Hint revealed: ${this.currentHint}. 5 points deducted.`
            );
          }
        }

        animateScoreDecrease() {
          const scoreElement = document.getElementById("gameScore");
          scoreElement.style.color = "var(--danger-color)";
          scoreElement.classList.add("score-animation");
          setTimeout(() => {
            scoreElement.classList.remove("score-animation");
            scoreElement.style.color = "";
          }, 600);
        }

        showMessage(text, type) {
          const message = document.getElementById("gameMessage");
          message.textContent = text;
          message.className = `game-message message-${type}`;
          message.style.display = "block";
        }

        hideMessage() {
          document.getElementById("gameMessage").style.display = "none";
          document.getElementById("wordHint").textContent =
            "Category: " +
            this.currentCategory.charAt(0).toUpperCase() +
            this.currentCategory.slice(1);
        }
      }

      // Initialize game when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new BalanceManGame();
      });
    </script>
    <script src="../js/game-ads.js"></script>

    <!-- Google AdSense -->
  </body>
</html>
