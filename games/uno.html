<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://pagead2.googlesyndication.com" />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />

    <title>
      English UNO Card Game - Learn Vocabulary While Playing | Free ESL Game
    </title>

    <!-- Enhanced SEO Meta Tags -->
    <meta
      name="description"
      content="Play UNO online and learn English vocabulary! Free educational card game with word challenges, difficulty levels, and progress tracking. Perfect for ESL students of all ages."
    />
    <meta
      name="keywords"
      content="UNO game online, ESL vocabulary game, learn English card game, educational UNO, free English games, vocabulary builder, ESL learning games, card game for students"
    />
    <meta name="author" content="ESL Fun Online" />
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="theme-color" content="#1a1a2e" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="English UNO" />

    <!-- Google AdSense -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2456627863532019"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-2456627863532019" />

    <!-- Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9G9RD6BHLN"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9G9RD6BHLN");
    </script>
    <!-- Favicon and Icons - Optimized for Google Search -->
    <link rel="icon" href="../favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="../images/favicon-48x48.png"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="../images/1.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="../images/favicon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="../images/favicon-512x512.png"
    />

    <!-- Open Graph Tags -->
    <meta
      property="og:title"
      content="Play English UNO - Free Vocabulary Card Game for ESL Learners"
    />
    <meta
      property="og:description"
      content="Learn English vocabulary while playing UNO! Free online card game with word challenges, multiple difficulty levels, achievements, and progress tracking. Fun for all ages!"
    />
    <meta
      property="og:image"
      content="https://eslfunonline.com/images/uno-game-preview.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="English UNO Card Game - Learn vocabulary while playing"
    />
    <meta property="og:url" content="https://eslfunonline.com/games/uno.html" />
    <meta property="og:type" content="game" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="ESL Fun Online" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@ESLFunOnline" />
    <meta name="twitter:creator" content="@ESLFunOnline" />
    <meta
      name="twitter:title"
      content="Play English UNO - Free Educational Card Game"
    />
    <meta
      name="twitter:description"
      content="Master English vocabulary through strategic UNO gameplay! ðŸŽ® Multiple difficulty levels, achievements & progress tracking. Perfect for ESL learners!"
    />
    <meta
      name="twitter:image"
      content="https://eslfunonline.com/images/uno-game-preview.png"
    />
    <meta
      name="twitter:image:alt"
      content="English UNO - Educational Card Game"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://eslfunonline.com/games/uno.html" />

    <!-- Structured Data - Game -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "VideoGame",
        "name": "English UNO - Vocabulary Card Game",
        "alternateName": ["ESL UNO", "Vocabulary UNO", "English Learning UNO"],
        "description": "Free online UNO card game that teaches English vocabulary! Features multiple difficulty levels, vocabulary quizzes, achievement system, daily challenges, and progress tracking. Perfect for ESL students, English learners, and anyone looking to expand their vocabulary through fun gameplay.",
        "url": "https://eslfunonline.com/games/uno.html",
        "image": {
          "@type": "ImageObject",
          "url": "https://eslfunonline.com/images/uno-game-preview.png",
          "width": 1200,
          "height": 630
        },
        "publisher": {
          "@type": "Organization",
          "name": "ESL Fun Online",
          "url": "https://eslfunonline.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://eslfunonline.com/images/logo.png"
          }
        },
        "author": {
          "@type": "Organization",
          "name": "ESL Fun Online"
        },
        "genre": [
          "Educational",
          "Card Game",
          "Vocabulary",
          "Strategy",
          "Language Learning"
        ],
        "gamePlatform": ["Web Browser", "Mobile Web", "Desktop"],
        "applicationCategory": "Game",
        "operatingSystem": "Any",
        "audience": {
          "@type": "EducationalAudience",
          "educationalRole": "student",
          "audienceType": "ESL Learners, English Students, Language Enthusiasts"
        },
        "typicalAgeRange": "6-99",
        "educationalLevel": ["Beginner", "Intermediate", "Advanced"],
        "educationalUse": [
          "vocabulary building",
          "strategic thinking",
          "word recognition",
          "spelling practice"
        ],
        "learningResourceType": ["game", "interactive resource"],
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "isFamilyFriendly": true,
        "numberOfPlayers": {
          "@type": "QuantitativeValue",
          "value": 1
        },
        "playMode": "SinglePlayer",
        "accessibilityFeature": [
          "alternativeText",
          "fullKeyboardControl",
          "screenReaderSupport",
          "highContrastDisplay"
        ],
        "accessibilityControl": [
          "fullKeyboardControl",
          "fullMouseControl",
          "fullTouchControl"
        ],
        "accessibilityHazard": [
          "noFlashingHazard",
          "noMotionSimulationHazard",
          "noSoundHazard"
        ],
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD",
          "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "1250",
          "bestRating": "5",
          "worstRating": "1"
        }
      }
    </script>

    <!-- Structured Data - Breadcrumb -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://eslfunonline.com"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Games",
            "item": "https://eslfunonline.com/games/games.html"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": "English UNO",
            "item": "https://eslfunonline.com/games/uno.html"
          }
        ]
      }
    </script>

    <!-- Structured Data - FAQ -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How do I play English UNO?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Match cards by color or number, use action cards strategically, and call UNO when you have one card left. Learn new vocabulary words as you play!"
            }
          },
          {
            "@type": "Question",
            "name": "Is this game free to play?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes! English UNO is completely free to play online. No download or registration required."
            }
          },
          {
            "@type": "Question",
            "name": "Can I play on mobile?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Absolutely! The game is fully optimized for mobile phones and tablets with touch-friendly controls."
            }
          }
        ]
      }
    </script>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/uno-page.css" />
    <link rel="stylesheet" href="../css/mobile-optimized.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Enhanced Game Styles -->
    <style>
      /* Reset body margin/padding - override all external CSS */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html {
        margin: 0 !important;
        padding: 0 !important;
      }

      body {
        margin: 0 !important;
        padding: 0 !important;
        padding-top: 0 !important;
        margin-top: 0 !important;
      }

      /* Skip Link - Visible on Focus */
      .skip-link {
        position: absolute;
        left: -9999px;
        top: 0;
        z-index: 9999;
        background: #46bbe5;
        color: white;
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        font-weight: 600;
        border-radius: 0 0 8px 0;
      }

      .skip-link:focus {
        left: 0;
      }

      /* Screen reader only class */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }

      /* Reduced motion preference */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }

        body {
          animation: none !important;
        }

        body::before,
        body::after {
          animation: none !important;
        }

        .card.playable {
          animation: none !important;
        }

        .card.playable::before {
          animation: none !important;
        }
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        .card {
          border: 2px solid white !important;
        }

        .card.playable {
          border: 3px solid gold !important;
        }

        .game-status,
        .game-message {
          border: 2px solid white !important;
        }
      }

      /* Ad Container - Fully Isolated from Game */
      .ad-wrapper {
        width: 100%;
        max-width: 728px;
        margin: 0.5rem auto;
        text-align: center;
        padding: 0.25rem;
        position: relative;
        z-index: 1;
        min-height: 50px;
        max-height: 120px;
        overflow: hidden;
        contain: layout style;
        isolation: isolate;
        flex-shrink: 0;
        pointer-events: auto;
        /* Ensure ads never overlap game content */
        transform: translateZ(0);
      }

      .ad-wrapper ins {
        display: block !important;
        max-height: 100px !important;
        overflow: hidden !important;
      }

      /* Prevent ads from breaking layout */
      .ad-wrapper * {
        max-width: 100% !important;
        box-sizing: border-box !important;
      }

      @media (max-width: 768px) {
        .ad-wrapper {
          max-width: 100%;
          padding: 0.25rem 0.5rem;
          max-height: 100px;
          min-height: 40px;
          margin: 0.25rem auto;
        }

        .ad-wrapper ins {
          max-height: 90px !important;
        }
      }

      @media (max-width: 480px) {
        .ad-wrapper {
          max-height: 80px;
          min-height: 30px;
          padding: 0.15rem 0.25rem;
        }

        .ad-wrapper ins {
          max-height: 70px !important;
        }
      }

      /* Hide ads when window is very small to prioritize game */
      @media (max-height: 500px) {
        .ad-wrapper {
          display: none !important;
        }
      }

      /* Bottom ad specific styles - ensure no overlap */
      .ad-wrapper.bottom-ad {
        position: relative;
        z-index: 1;
        margin-top: 180px;
        background: rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        pointer-events: auto;
      }

      /* Hide bottom ad on short screens to give more space to game */
      @media (max-height: 700px) {
        .ad-wrapper.bottom-ad {
          display: none !important;
        }
        .player-hand {
          margin-bottom: 20px !important;
        }
      }

      /* Fun Game Background */
      body {
        background-color: #1a1a2e; /* Fallback color */
        background: url("../images/game-bg.jpg") center center / cover no-repeat
          fixed;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      /* Subtle overlay to ensure readability */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.35);
        pointer-events: none;
        z-index: 0;
      }

      /* In-game ad - non-intrusive styling */
      .in-game-ad {
        pointer-events: auto;
        z-index: 1;
      }

      /* Hide in-game ad in fullscreen */
      :fullscreen .in-game-ad,
      :-webkit-full-screen .in-game-ad {
        display: none !important;
      }

      /* Hide in-game ad on small screens */
      @media (max-height: 600px) {
        .in-game-ad {
          display: none !important;
        }
      }

      /* Floating UNO cards in background */
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='90' viewBox='0 0 60 90' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='60' height='90' rx='8' fill='rgba(255,255,255,0.03)'/%3E%3C/svg%3E");
        background-size: 80px 120px;
        opacity: 0.5;
        pointer-events: none;
        z-index: 0;
        animation: floatCards 60s linear infinite;
      }

      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes floatCards {
        0% {
          transform: translateY(0) rotate(0deg);
        }
        100% {
          transform: translateY(-100px) rotate(5deg);
        }
      }

      /* Ensure content is above background */
      header,
      .game-container,
      .game-header,
      main {
        position: relative;
        z-index: 1;
      }

      /* Enhanced Card Flip Animation */
      .card {
        transform-style: preserve-3d;
        perspective: 1000px;
      }

      .card.dealing {
        animation: dealCard 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      @keyframes dealCard {
        0% {
          transform: translateX(-200px) translateY(-100px) rotateY(180deg)
            scale(0.5);
          opacity: 0;
        }
        50% {
          transform: translateX(0) translateY(-20px) rotateY(90deg) scale(1.1);
          opacity: 0.8;
        }
        100% {
          transform: translateX(0) translateY(0) rotateY(0) scale(1);
          opacity: 1;
        }
      }

      /* Card Play Animation */
      .card.playing {
        animation: playCard 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      @keyframes playCard {
        0% {
          transform: scale(1) translateY(0);
        }
        30% {
          transform: scale(1.2) translateY(-30px) rotate(5deg);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        100% {
          transform: scale(1) translateY(0) rotate(0);
        }
      }

      /* Card Draw Animation */
      .card.drawing {
        animation: drawCard 0.4s ease-out;
      }

      @keyframes drawCard {
        0% {
          transform: translateX(-100px) scale(0.8);
          opacity: 0;
        }
        100% {
          transform: translateX(0) scale(1);
          opacity: 1;
        }
      }

      /* Enhanced Playable Card Glow */
      .card.playable {
        animation: playableGlow 2s infinite alternate;
        cursor: pointer;
        position: relative;
      }

      .card.playable::before {
        content: "â–¶";
        position: absolute;
        top: -8px;
        right: -8px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1a202c;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        z-index: 10;
        animation: playIndicator 1s infinite;
      }

      @keyframes playIndicator {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
      }

      @keyframes playableGlow {
        0% {
          box-shadow:
            0 0 10px rgba(255, 215, 0, 0.5),
            0 8px 25px rgba(0, 0, 0, 0.3);
          transform: translateY(0);
        }
        100% {
          box-shadow:
            0 0 25px rgba(255, 215, 0, 0.9),
            0 0 40px rgba(255, 215, 0, 0.4),
            0 12px 30px rgba(0, 0, 0, 0.4);
          transform: translateY(-5px);
        }
      }

      .card.playable:hover {
        transform: translateY(-15px) scale(1.08) rotateX(-5deg);
        box-shadow:
          0 25px 50px rgba(0, 0, 0, 0.4),
          0 0 30px rgba(255, 215, 0, 0.8);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .card.playable:hover::before {
        background: linear-gradient(135deg, #10b981, #059669);
        content: "âœ“";
      }

      /* Card Hover 3D Effect */
      .card:not(.card-back):hover {
        transform: translateY(-12px) scale(1.05) rotateX(-5deg) rotateY(5deg);
      }

      /* Enhanced Score Display */
      .game-stats {
        font-size: 0.85rem;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
      }

      /* Smooth Turn Transitions */
      .turn-indicator {
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #46bbe5, #10b981);
        box-shadow: 0 4px 15px rgba(70, 187, 229, 0.3);
      }

      .turn-indicator.thinking-indicator {
        background: linear-gradient(135deg, #f59e0b, #ef4444);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      /* Combo Indicator */
      .combo-indicator {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2rem;
        font-weight: bold;
        color: #fbbf24;
        text-shadow: 0 0 20px rgba(251, 191, 36, 0.8);
        z-index: 9999;
        animation:
          comboAppear 0.5s ease-out forwards,
          comboFade 1.5s ease-in 0.5s forwards;
        pointer-events: none;
      }

      @keyframes comboAppear {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      @keyframes comboFade {
        to {
          transform: translate(-50%, -100%) scale(1.5);
          opacity: 0;
        }
      }

      /* Achievement Notification */
      .achievement-notification {
        position: fixed;
        top: 100px;
        right: 20px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1a202c;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(251, 191, 36, 0.4);
        z-index: 10000;
        animation:
          slideInRight 0.5s ease-out,
          fadeOut 0.5s ease-in 3.5s forwards;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(120%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        to {
          transform: translateX(120%);
          opacity: 0;
        }
      }

      /* Hint Overlay */
      .hint-overlay {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.75rem;
        white-space: nowrap;
        z-index: 100;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }

      /* Modal Show Animation */
      .game-message.show {
        display: block !important;
        animation: modalAppear 0.3s ease-out;
      }

      #colorPicker.show {
        display: flex !important;
        animation: modalAppear 0.3s ease-out;
      }

      @keyframes modalAppear {
        from {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      /* Enhanced Button Styles */
      .action-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .draw-btn {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
      }

      .draw-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
      }

      .draw-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Wild Card Enhanced Animation */
      .card.wild .wild-bg {
        animation:
          wildRotate 3s linear infinite,
          wildPulse 2s ease-in-out infinite;
      }

      @keyframes wildPulse {
        0%,
        100% {
          opacity: 0.8;
        }
        50% {
          opacity: 1;
        }
      }

      /* Current Card Entrance */
      .current-card {
        animation: currentCardPlace 0.5s ease-out;
      }

      @keyframes currentCardPlace {
        0% {
          transform: scale(1.3) rotate(10deg);
          opacity: 0.5;
        }
        50% {
          transform: scale(1.1) rotate(-5deg);
        }
        100% {
          transform: scale(1) rotate(0);
          opacity: 1;
        }
      }

      /* Deck Hover Effect */
      .draw-deck:hover .card {
        transform: translateY(-5px);
        transition: transform 0.3s ease;
      }

      .draw-deck:hover .card:nth-child(1) {
        transform: rotate(-5deg) translate(5px, -8px);
      }

      .draw-deck:hover .card:nth-child(2) {
        transform: rotate(3deg) translate(-2px, -5px);
      }

      /* Game Status Glass Effect */
      .game-status {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
      }

      @media (max-width: 768px) {
        .game-status {
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.5rem;
          border-radius: 10px;
        }
        .game-status .status-item {
          font-size: 0.75rem;
        }
        .status-icon {
          width: 32px !important;
          height: 32px !important;
          font-size: 0.9rem !important;
        }
        .turn-indicator {
          padding: 0.4rem 0.8rem !important;
          font-size: 0.75rem !important;
        }
      }

      .game-status .status-item,
      .game-status .turn-indicator {
        color: white;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .status-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      .player-icon {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
      }

      .computer-icon {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
      }

      /* Enhanced Game Stats */
      .game-stats {
        background: rgba(255, 255, 255, 0.15) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
      }

      /* Enhanced Game Container */
      .game-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0.75rem;
        padding-bottom: 2rem;
        min-height: calc(100vh - 200px);
        min-height: calc(100dvh - 200px);
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 10;
      }

      @media (max-width: 768px) {
        .game-container {
          padding: 0.35rem;
          padding-bottom: 1rem;
          min-height: calc(100vh - 150px);
          min-height: calc(100dvh - 150px);
        }
      }

      @media (max-width: 480px) {
        .game-container {
          padding: 0.25rem;
          padding-bottom: 0.75rem;
        }
      }

      /* Game Board - Flex layout for better mobile */
      .game-board {
        display: flex;
        flex-direction: column;
        flex: 1;
        gap: 0.5rem;
        justify-content: space-between;
      }

      @media (max-width: 768px) {
        .game-board {
          gap: 0.3rem;
        }
      }

      /* Center area mobile optimization */
      .center-area,
      .deck-area,
      .action-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
      }

      @media (max-width: 768px) {
        .center-area,
        .deck-area,
        .action-area {
          gap: 0.25rem;
        }
        .game-stats {
          font-size: 0.7rem !important;
          padding: 0.3rem 0.6rem !important;
        }
      }

      /* Better Card Fanning */
      .player-hand {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.4rem;
        padding: 0.75rem;
        padding-bottom: 1.5rem;
        margin-bottom: 150px; /* Space for bottom ad */
        min-height: 140px;
        overflow: visible !important;
        max-height: none !important;
      }

      /* Draw deck z-index fix */
      .deck-area {
        z-index: 10 !important;
        position: relative;
        margin-left: 2rem;
      }

      .draw-deck {
        z-index: 10;
        position: relative;
      }

      .center-area {
        z-index: 5;
        position: relative;
      }

      /* Ensure player-hand is above ads */
      .player-hand {
        position: relative;
        z-index: 20;
      }

      @media (max-width: 768px) {
        .player-hand {
          gap: 0.2rem;
          padding: 0.5rem 0.25rem;
          padding-bottom: 1rem;
          margin-bottom: 130px; /* Space for bottom ad on mobile */
          overflow: visible !important;
          max-height: none !important;
          min-height: 90px;
          flex-wrap: wrap;
          justify-content: center;
        }
        .player-hand .card {
          width: 48px !important;
          height: 72px !important;
          font-size: 0.65rem;
          touch-action: manipulation;
        }
        .player-hand .card .card-number {
          font-size: 1.5rem !important;
        }
        .player-hand .card .card-icon {
          font-size: 1.2rem !important;
        }
        .computer-hand {
          min-height: 50px;
          max-height: 70px;
        }
        .computer-hand .card {
          width: 35px !important;
          height: 52px !important;
        }
        .current-card {
          width: 65px !important;
          height: 97px !important;
        }
        .current-card .card-number {
          font-size: 1.7rem !important;
        }
        .current-card .card-icon {
          font-size: 1.4rem !important;
        }
        .draw-deck .card {
          width: 50px !important;
          height: 75px !important;
        }
        /* Touch-friendly tap targets */
        .player-hand .card.playable {
          min-width: 44px;
          min-height: 44px;
        }
      }

      @media (max-width: 480px) {
        .player-hand {
          gap: 0.15rem;
          padding: 0.4rem 0.2rem;
          min-height: 75px;
        }
        .player-hand .card {
          width: 40px !important;
          height: 60px !important;
        }
        .player-hand .card .card-number {
          font-size: 1.25rem !important;
        }
        .player-hand .card .card-icon {
          font-size: 1rem !important;
        }
        .computer-hand {
          min-height: 40px;
          max-height: 55px;
        }
        .computer-hand .card {
          width: 28px !important;
          height: 42px !important;
        }
        .current-card {
          width: 55px !important;
          height: 82px !important;
        }
        .current-card .card-number {
          font-size: 1.4rem !important;
        }
        .current-card .card-icon {
          font-size: 1.2rem !important;
        }
        .draw-deck .card {
          width: 42px !important;
          height: 63px !important;
        }
      }

      @media (max-width: 380px) {
        .player-hand .card {
          width: 36px !important;
          height: 54px !important;
        }
        .player-hand .card .card-number {
          font-size: 1.1rem !important;
        }
        .computer-hand .card {
          width: 24px !important;
          height: 36px !important;
        }
        .current-card {
          width: 48px !important;
          height: 72px !important;
        }
      }

      /* Landscape mobile optimization */
      @media (max-height: 500px) and (orientation: landscape) {
        .player-hand {
          min-height: 65px;
        }
        .player-hand .card {
          width: 35px !important;
          height: 52px !important;
        }
        .computer-hand {
          min-height: 35px;
          max-height: 45px;
        }
        .computer-hand .card {
          width: 22px !important;
          height: 33px !important;
        }
        .current-card {
          width: 45px !important;
          height: 67px !important;
        }
        .game-status {
          padding: 0.3rem 0.5rem !important;
        }
        .game-container {
          padding: 0.25rem !important;
        }
      }

      .player-hand .card {
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .player-hand .card:hover {
        z-index: 100;
      }

      /* Enhanced Deck Styling */
      .draw-deck {
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .draw-deck:hover {
        transform: scale(1.05);
      }

      .draw-deck:active {
        transform: scale(0.95);
      }

      /* UNO Button Enhanced - Better Mobile */
      .uno-btn {
        animation:
          unoPulse 1s infinite,
          shake 0.5s;
        background: linear-gradient(135deg, #ef4444, #dc2626) !important;
        font-size: 1rem !important;
        padding: 0.9rem 1.75rem !important;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-radius: 50px !important;
        position: relative;
        overflow: hidden;
        min-height: 50px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      @media (max-width: 768px) {
        .uno-btn {
          font-size: 0.9rem !important;
          padding: 0.75rem 1.5rem !important;
          letter-spacing: 1.5px;
          min-height: 46px;
        }
      }

      .uno-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        100% {
          left: 100%;
        }
      }

      @keyframes unoPulse {
        0%,
        100% {
          box-shadow:
            0 0 10px rgba(239, 68, 68, 0.5),
            0 0 30px rgba(239, 68, 68, 0.3);
          transform: scale(1);
        }
        50% {
          box-shadow:
            0 0 30px rgba(239, 68, 68, 0.8),
            0 0 50px rgba(239, 68, 68, 0.5);
          transform: scale(1.05);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px) rotate(-2deg);
        }
        75% {
          transform: translateX(5px) rotate(2deg);
        }
      }

      /* Victory Celebration */
      .celebration {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 9999;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        animation: confettiFall 3s ease-out forwards;
      }

      @keyframes confettiFall {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* Game Header Enhanced */
      .game-header {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .game-header .game-title {
        color: white;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .game-header .control-btn {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
      }

      .game-header .control-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      /* Color Picker Enhanced - Touch Friendly */
      .color-picker {
        background: rgba(0, 0, 0, 0.92) !important;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
        touch-action: none;
      }

      .color-options {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1.5rem;
        border-radius: 20px;
        display: flex;
        gap: 1rem;
        flex-direction: column;
        align-items: center;
        max-width: 90vw;
      }

      .color-options::before {
        content: "Choose a Color";
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .color-options-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }

      .color-option {
        width: 65px;
        height: 65px;
        border-radius: 16px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        font-size: 1.4rem;
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      @media (max-width: 480px) {
        .color-options {
          padding: 1.25rem;
        }
        .color-options-grid {
          gap: 0.6rem;
        }
        .color-option {
          width: 60px;
          height: 60px;
          font-size: 1.2rem;
        }
      }

      .color-option.red {
        background: linear-gradient(135deg, #ef4444, #dc2626);
      }
      .color-option.blue {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
      }
      .color-option.green {
        background: linear-gradient(135deg, #10b981, #059669);
      }
      .color-option.yellow {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1a202c;
        text-shadow: none;
      }

      .color-option:hover {
        transform: scale(1.15) rotate(5deg);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        border-color: white;
      }

      .color-option:active {
        transform: scale(0.95);
      }

      /* Modal Enhanced - Mobile Optimized */
      .game-message {
        background: linear-gradient(
          135deg,
          rgba(30, 41, 59, 0.98),
          rgba(15, 23, 42, 0.98)
        ) !important;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: white;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 1.25rem;
        border-radius: 20px;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        max-width: 92vw;
        max-height: 80vh;
        max-height: 80dvh;
        width: 420px;
        overflow-y: auto;
        overflow-x: hidden;
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
      }

      .game-message::-webkit-scrollbar {
        width: 6px;
      }

      .game-message::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
      }

      .game-message::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 3px;
      }

      .game-message::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      @media (max-width: 480px) {
        .game-message {
          width: 94vw;
          max-height: 75vh;
          max-height: 75dvh;
          padding: 1rem;
          border-radius: 16px;
        }

        .game-message .message-title {
          font-size: 1.2rem !important;
        }

        .game-message .message-text {
          font-size: 0.85rem !important;
        }

        .message-btn {
          padding: 0.7rem 1.25rem !important;
          font-size: 0.9rem !important;
          min-height: 44px;
        }
      }

      @media (max-height: 600px) {
        .game-message {
          max-height: 85vh;
          max-height: 85dvh;
          padding: 0.9rem;
        }
      }

      .game-message .message-title {
        background: linear-gradient(135deg, #46bbe5, #10b981);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 1rem;
        text-align: center;
        line-height: 1.3;
      }

      .game-message .message-text {
        color: rgba(255, 255, 255, 0.85);
        text-align: left;
        line-height: 1.5;
        margin-bottom: 1.5rem;
        white-space: pre-line;
        font-size: 0.9rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .message-btn {
        background: linear-gradient(135deg, #46bbe5, #10b981);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        font-size: 0.95rem;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        min-height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .message-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(70, 187, 229, 0.4);
      }

      .message-btn:active {
        transform: scale(0.98);
      }

      /* Ensure all interactive elements are touch-friendly */
      button,
      .control-btn,
      .action-btn,
      .color-option {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      /* Improve focus visibility for accessibility */
      button:focus-visible,
      .card:focus-visible,
      a:focus-visible {
        outline: 3px solid #46bbe5;
        outline-offset: 2px;
      }

      /* Stats Modal Specific Styling */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin: 1rem 0;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.75rem;
        border-radius: 12px;
        text-align: center;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #46bbe5;
        display: block;
      }

      .stat-label {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Settings Modal Styling */
      .settings-modal {
        width: 400px;
      }

      .settings-content {
        margin: 1rem 0;
      }

      .setting-group {
        margin-bottom: 1rem;
      }

      .setting-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.9rem;
      }

      .setting-select {
        width: 100%;
        padding: 0.75rem;
        border-radius: 10px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .setting-select:focus {
        outline: none;
        border-color: #46bbe5;
        background: rgba(255, 255, 255, 0.15);
      }

      .setting-select option {
        background: #1e293b;
        color: white;
      }

      .setting-checkbox {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 8px;
        transition: background 0.2s ease;
      }

      .setting-checkbox:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .setting-checkbox input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #46bbe5;
        cursor: pointer;
      }

      .setting-checkbox span:last-child {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.9);
      }

      /* Modal Button Styles */
      .modal-buttons {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #64748b, #475569) !important;
      }

      .btn-secondary:hover {
        box-shadow: 0 8px 25px rgba(100, 116, 139, 0.4) !important;
      }

      /* Achievements Modal */
      .achievements-modal {
        width: 500px;
      }

      .achievements-list {
        max-height: 350px;
        overflow-y: auto;
        margin: 1rem 0;
        padding-right: 0.5rem;
      }

      .achievement-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-bottom: 0.5rem;
        transition: background 0.2s ease;
      }

      .achievement-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .achievement-item.unlocked {
        background: rgba(70, 187, 229, 0.15);
        border: 1px solid rgba(70, 187, 229, 0.3);
      }

      .achievement-icon {
        font-size: 1.5rem;
        width: 40px;
        text-align: center;
      }

      .achievement-info {
        flex: 1;
      }

      .achievement-name {
        font-weight: 600;
        font-size: 0.95rem;
        color: white;
      }

      .achievement-desc {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
        margin-top: 0.25rem;
      }

      /* Word Modal */
      .word-modal {
        width: 380px;
      }

      .word-content {
        text-align: center;
        margin: 1rem 0;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
      }

      .word-display {
        font-size: 1.8rem;
        font-weight: 700;
        color: #46bbe5;
        margin-bottom: 0.5rem;
      }

      .word-definition {
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.5;
      }

      /* Quiz Modal */
      .quiz-modal {
        width: 450px;
      }

      .quiz-content {
        text-align: center;
        margin: 1rem 0;
        min-height: 100px;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
      }

      .quiz-question {
        font-size: 1.2rem;
        font-weight: 600;
        color: white;
        margin-bottom: 1rem;
      }

      .quiz-options {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin: 1rem 0;
      }

      .quiz-option {
        text-align: left;
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }

      .quiz-option:hover {
        transform: translateX(5px);
      }

      .quiz-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .quiz-score {
        font-weight: 600;
        color: #46bbe5;
        font-size: 1rem;
      }

      .quiz-footer .btn-secondary {
        width: auto;
        padding: 0.5rem 1rem;
      }

      /* Word Learning Modal Enhanced */
      #wordModal .message-title {
        font-size: 1.6rem;
      }

      #wordContent {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        padding: 1.5rem;
        margin: 1rem 0;
      }

      /* Sound Toggle Enhanced - Mobile Safe Zone */
      .sound-toggle,
      .fullscreen-toggle {
        position: fixed;
        bottom: 20px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.15),
          rgba(255, 255, 255, 0.05)
        ) !important;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: white !important;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .sound-toggle {
        right: 20px;
      }

      .fullscreen-toggle {
        right: 78px;
      }

      @media (max-width: 768px) {
        .sound-toggle,
        .fullscreen-toggle {
          bottom: 15px;
          width: 44px;
          height: 44px;
          font-size: 1rem;
        }
        .sound-toggle {
          right: 15px;
        }
        .fullscreen-toggle {
          right: 68px;
        }
      }

      /* Account for iOS safe areas */
      @supports (padding-bottom: env(safe-area-inset-bottom)) {
        .sound-toggle {
          bottom: calc(15px + env(safe-area-inset-bottom));
          right: calc(15px + env(safe-area-inset-right));
        }
        .fullscreen-toggle {
          bottom: calc(15px + env(safe-area-inset-bottom));
          right: calc(68px + env(safe-area-inset-right));
        }
      }

      .sound-toggle:hover,
      .fullscreen-toggle:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.25),
          rgba(255, 255, 255, 0.1)
        ) !important;
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .sound-toggle:active,
      .fullscreen-toggle:active {
        transform: scale(0.95);
      }

      /* Fullscreen mode styles */
      :fullscreen .ad-wrapper,
      :-webkit-full-screen .ad-wrapper,
      :fullscreen .game-footer,
      :-webkit-full-screen .game-footer,
      :fullscreen .game-header,
      :-webkit-full-screen .game-header {
        display: none !important;
      }

      :fullscreen .game-container,
      :-webkit-full-screen .game-container {
        min-height: 100vh !important;
        padding-bottom: 80px !important;
      }

      :fullscreen .player-hand,
      :-webkit-full-screen .player-hand {
        padding-bottom: 80px !important;
        margin-bottom: 0 !important;
      }

      /* Particle Effects Enhanced */
      .particle {
        border-radius: 50%;
        animation: particleExplode 1s ease-out forwards;
      }

      @keyframes particleExplode {
        0% {
          opacity: 1;
          transform: scale(1) translate(0, 0);
        }
        100% {
          opacity: 0;
          transform: scale(0) translate(var(--tx, 50px), var(--ty, -50px));
        }
      }

      /* Loading Overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #1a1a2e);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        gap: 1rem;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.2);
        border-top-color: #46bbe5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
      }

      /* Touch ripple effect */
      .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: scale(0);
        animation: ripple 0.6s linear;
        pointer-events: none;
      }

      @keyframes ripple {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }

      /* Card indicator for number of playable cards - HIDDEN */
      .playable-count {
        display: none !important;
      }
    </style>
  </head>

  <body>
    <!-- Screen reader announcements -->
    <div
      id="announcements"
      class="sr-only"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Game Header with Controls -->
    <div
      class="game-header"
      role="banner"
      style="position: relative; top: 0; margin-top: 0"
    >
      <style>
        .game-header .header-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem 1rem;
        }
        .game-header .title-row {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 1rem;
          width: 100%;
        }
        .game-header .home-btn {
          display: flex;
          align-items: center;
          gap: 0.4rem;
          padding: 0.5rem 1rem;
          border-radius: 10px;
          font-size: 0.85rem;
          font-weight: 500;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.2);
          color: white;
          text-decoration: none;
          transition: all 0.3s ease;
        }
        .game-header .home-btn:hover {
          background: rgba(255, 255, 255, 0.2);
          transform: translateY(-2px);
        }
        .game-header .game-title {
          font-size: 1.6rem;
          font-weight: 700;
          margin: 0;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
        .game-header .game-controls {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 0.4rem;
        }
        .game-header .control-btn {
          display: flex;
          align-items: center;
          gap: 0.4rem;
          padding: 0.4rem 0.8rem;
          border-radius: 8px;
          font-size: 0.8rem;
          font-weight: 500;
          transition: all 0.3s ease;
        }
        .game-header .control-btn.secondary {
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .game-header .control-btn:not(.secondary) {
          background: linear-gradient(135deg, #10b981, #059669);
          border: none;
        }
        .game-header .control-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .keyboard-hint {
          font-size: 0.6rem;
          background: rgba(0, 0, 0, 0.3);
          padding: 0.1rem 0.3rem;
          border-radius: 4px;
          margin-left: 0.2rem;
        }
        @media (max-width: 768px) {
          .game-header .header-content {
            padding: 0.4rem 0.5rem;
            gap: 0.5rem;
          }
          .game-header .title-row {
            gap: 0.5rem;
          }
          .game-header .game-title {
            font-size: 1.15rem;
          }
          .game-header .home-btn span {
            display: none;
          }
          .game-header .home-btn {
            padding: 0.4rem;
            min-width: 40px;
            min-height: 40px;
            justify-content: center;
          }
          .game-header .game-controls {
            gap: 0.25rem;
          }
          .game-header .control-btn span {
            display: none;
          }
          .game-header .control-btn {
            padding: 0.4rem;
            min-width: 40px;
            min-height: 40px;
            justify-content: center;
          }
          .keyboard-hint {
            display: none;
          }
        }
        @media (max-width: 380px) {
          .game-header .game-title {
            font-size: 1rem;
          }
          .game-header .home-btn,
          .game-header .control-btn {
            min-width: 36px;
            min-height: 36px;
            font-size: 0.8rem;
          }
        }
      </style>
      <div class="header-content">
        <div class="title-row">
          <a href="../index.html" class="home-btn" aria-label="Go to home page">
            <i class="fas fa-home" aria-hidden="true"></i>
            <span>Home</span>
          </a>
          <h1 class="game-title">ðŸŽ® English UNO</h1>
          <a href="games.html" class="home-btn" aria-label="Go to games page">
            <i class="fas fa-gamepad" aria-hidden="true"></i>
            <span>Games</span>
          </a>
        </div>
        <div class="game-controls">
          <button
            class="control-btn"
            onclick="newGame()"
            aria-label="Start a new game"
          >
            <i class="fas fa-plus" aria-hidden="true"></i>
            <span>New Game</span>
          </button>
          <button
            class="control-btn secondary"
            onclick="showSettings()"
            aria-label="Open settings"
          >
            <i class="fas fa-cog" aria-hidden="true"></i>
            <span>Settings</span>
          </button>
          <button
            class="control-btn secondary"
            onclick="showRules()"
            aria-label="View game rules"
          >
            <i class="fas fa-question-circle" aria-hidden="true"></i>
            <span>Rules</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Fullscreen Toggle Button -->
    <button
      class="fullscreen-toggle"
      id="fullscreenToggle"
      onclick="toggleFullscreen()"
      aria-label="Toggle fullscreen mode"
    >
      <i
        class="fas fa-expand"
        id="floatingFullscreenIcon"
        aria-hidden="true"
      ></i>
    </button>

    <!-- Sound Toggle Button -->
    <button
      class="sound-toggle"
      id="soundToggle"
      onclick="toggleSound()"
      aria-label="Toggle sound effects"
    >
      <i class="fas fa-volume-up" aria-hidden="true"></i>
    </button>

    <!-- Playable Cards Indicator -->
    <div class="playable-count" id="playableCount" aria-live="polite"></div>

    <div class="game-container" role="main" id="main-content">
      <!-- Game Status -->
      <div class="game-status" role="status" aria-live="polite">
        <div class="status-item">
          <div class="status-icon player-icon" aria-hidden="true">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <div>You</div>
            <div id="playerCardCount" aria-label="Your card count">7 cards</div>
            <div
              id="playerCombo"
              style="font-size: 0.7rem; color: var(--success-color)"
              aria-label="Your combo count"
            >
              Combo: 0
            </div>
          </div>
        </div>

        <div
          class="turn-indicator"
          id="turnIndicator"
          role="status"
          aria-live="assertive"
        >
          Your Turn
        </div>

        <div class="status-item">
          <div class="status-icon computer-icon" aria-hidden="true">
            <i class="fas fa-robot"></i>
          </div>
          <div>
            <div>Computer</div>
            <div id="computerCardCount" aria-label="Computer card count">
              7 cards
            </div>
            <div
              id="difficultyDisplay"
              style="font-size: 0.7rem; color: var(--warning-color)"
              aria-label="Computer difficulty level"
            >
              Beginner
            </div>
          </div>
        </div>
      </div>

      <!-- Game Board -->
      <div class="game-board" role="region" aria-label="UNO game board">
        <!-- Computer Hand -->
        <div
          class="computer-hand"
          id="computerHand"
          role="region"
          aria-label="Computer's hand"
        >
          <!-- Computer cards will be generated here -->
        </div>

        <!-- Draw Deck -->
        <div class="deck-area">
          <div
            class="draw-deck"
            onclick="drawCard()"
            role="button"
            tabindex="0"
            aria-label="Draw a card from deck"
            onkeypress="
              if (event.key === 'Enter' || event.key === ' ') drawCard();
            "
          >
            <div class="card card-back">
              <div class="card-number">UNO</div>
              <div class="card-icon">
                <i class="fas fa-layer-group" aria-hidden="true"></i>
              </div>
            </div>
            <div class="card card-back"></div>
            <div class="card card-back"></div>
          </div>
          <div class="game-stats" aria-live="polite">
            <div>Draw Pile</div>
            <div id="deckCount">Cards: 94</div>
          </div>
        </div>

        <!-- Center Area -->
        <div class="center-area">
          <div
            class="card current-card"
            id="currentCard"
            role="img"
            aria-label="Current card in play"
          >
            <!-- Current card will be displayed here -->
          </div>
          <div class="game-stats" aria-live="polite">
            <div>Current Card</div>
            <div id="currentColor">Color: Red</div>
          </div>
        </div>

        <!-- Action Area -->
        <div class="action-area">
          <style>
            .action-area {
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 0.75rem;
            }
            .action-buttons {
              display: flex;
              gap: 0.75rem;
              flex-wrap: wrap;
              justify-content: center;
            }
            .action-btn {
              display: flex;
              align-items: center;
              gap: 0.5rem;
              padding: 0.75rem 1.25rem;
              border: none;
              border-radius: 12px;
              font-weight: 600;
              font-size: 0.9rem;
              cursor: pointer;
              transition: all 0.3s ease;
              min-height: 48px;
              touch-action: manipulation;
              -webkit-tap-highlight-color: transparent;
            }
            .draw-btn {
              background: linear-gradient(135deg, #3b82f6, #2563eb);
              color: white;
              box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            }
            .draw-btn:hover:not(:disabled) {
              transform: translateY(-3px);
              box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
            }
            .draw-btn:active:not(:disabled) {
              transform: scale(0.98);
            }
            .draw-btn:disabled {
              opacity: 0.5;
              cursor: not-allowed;
              transform: none;
            }
            .draw-btn .keyboard-hint {
              font-size: 0.6rem;
              background: rgba(255, 255, 255, 0.2);
              padding: 0.15rem 0.4rem;
              border-radius: 4px;
              margin-left: 0.3rem;
            }
            @media (max-width: 768px) {
              .action-area {
                gap: 0.5rem;
              }
              .action-buttons {
                gap: 0.5rem;
              }
              .action-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                min-height: 44px;
              }
              .draw-btn .keyboard-hint {
                display: none;
              }
            }
            @media (max-width: 380px) {
              .action-btn {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
              }
            }
          </style>
          <div class="action-buttons">
            <button
              class="action-btn draw-btn"
              id="drawBtn"
              onclick="drawCard()"
              aria-label="Draw a card"
            >
              <i class="fas fa-plus" aria-hidden="true"></i>
              Draw Card
              <span class="keyboard-hint">D</span>
            </button>
            <button
              class="action-btn uno-btn"
              id="unoBtn"
              onclick="callUno()"
              style="display: none"
              aria-label="Call UNO when you have one card left"
            >
              <i class="fas fa-exclamation" aria-hidden="true"></i>
              UNO!
              <span class="keyboard-hint" style="background: rgba(0, 0, 0, 0.2)"
                >U</span
              >
            </button>
          </div>
          <div class="game-stats" aria-live="polite">
            <div id="gameTimer">Time: 0:00</div>
            <div id="moveCount">Moves: 0</div>
          </div>
        </div>

        <!-- Player Hand -->
        <div
          class="player-hand"
          id="playerHand"
          role="region"
          aria-label="Your hand"
        >
          <!-- Player cards will be generated here -->
        </div>
      </div>

      <!-- In-Game Ad - Compact sidebar style -->
      <div class="in-game-ad" style="margin-top: 1rem; text-align: center">
        <div
          style="
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
            max-width: 320px;
            margin: 0 auto;
          "
        >
          <div
            style="
              font-size: 0.65rem;
              color: rgba(255, 255, 255, 0.4);
              margin-bottom: 0.25rem;
            "
          >
            Sponsored
          </div>
          <ins
            class="adsbygoogle"
            style="display: block; max-height: 100px"
            data-ad-format="fluid"
            data-ad-layout-key="-fb+5w+4e-db+86"
            data-ad-client="ca-pub-2456627863532019"
            data-ad-slot="2184713192"
          ></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
      </div>
    </div>

    <!-- Color Picker Modal -->
    <div
      class="color-picker"
      id="colorPicker"
      role="dialog"
      aria-labelledby="colorPickerTitle"
      aria-modal="true"
    >
      <div id="colorPickerTitle" class="sr-only">
        Choose a color for wild card
      </div>
      <div class="color-options">
        <div
          class="color-options-grid"
          role="radiogroup"
          aria-label="Select card color"
        >
          <button
            class="color-option red"
            onclick="selectColor('red')"
            role="radio"
            aria-label="Red"
          >
            R
          </button>
          <button
            class="color-option blue"
            onclick="selectColor('blue')"
            role="radio"
            aria-label="Blue"
          >
            B
          </button>
          <button
            class="color-option green"
            onclick="selectColor('green')"
            role="radio"
            aria-label="Green"
          >
            G
          </button>
          <button
            class="color-option yellow"
            onclick="selectColor('yellow')"
            role="radio"
            aria-label="Yellow"
          >
            Y
          </button>
        </div>
      </div>
    </div>

    <!-- Game Message Modal -->
    <div
      class="game-message"
      id="gameMessage"
      role="dialog"
      aria-labelledby="messageTitle"
      aria-modal="true"
    >
      <div class="message-title" id="messageTitle">Game Over!</div>
      <div class="message-text" id="messageText">Congratulations! You won!</div>
      <button
        class="message-btn"
        onclick="closeMessage()"
        aria-label="Close message and continue"
      >
        Continue
      </button>
    </div>

    <!-- Settings Modal -->
    <div
      class="game-message settings-modal"
      id="settingsModal"
      role="dialog"
      aria-labelledby="settingsTitle"
      aria-modal="true"
    >
      <div class="message-title" id="settingsTitle">âš™ï¸ Game Settings</div>
      <div class="settings-content">
        <div class="setting-group">
          <label class="setting-label">Difficulty Level</label>
          <select id="difficultySelect" class="setting-select">
            <option value="beginner">Beginner - Easy AI</option>
            <option value="intermediate">Intermediate - Smarter AI</option>
            <option value="advanced">Advanced - Expert AI</option>
          </select>
        </div>
        <div class="setting-group">
          <label class="setting-checkbox">
            <input type="checkbox" id="soundToggleCheck" checked />
            <span class="checkbox-custom"></span>
            <span>Sound Effects</span>
          </label>
        </div>
        <div class="setting-group">
          <label class="setting-checkbox">
            <input type="checkbox" id="animationsToggleCheck" checked />
            <span class="checkbox-custom"></span>
            <span>Animations</span>
          </label>
        </div>
        <div class="setting-group">
          <label class="setting-checkbox">
            <input type="checkbox" id="hintsToggleCheck" checked />
            <span class="checkbox-custom"></span>
            <span>Show Hints</span>
          </label>
        </div>
      </div>
      <div class="modal-buttons">
        <button class="message-btn" onclick="saveSettings()">Save</button>
        <button class="message-btn btn-secondary" onclick="closeSettings()">
          Cancel
        </button>
      </div>
    </div>

    <!-- Achievements Modal -->
    <div class="game-message achievements-modal" id="achievementsModal">
      <div class="message-title">ðŸ† Achievements</div>
      <div id="achievementsList" class="achievements-list">
        <!-- Achievements will be populated here -->
      </div>
      <button class="message-btn" onclick="closeAchievements()">Close</button>
    </div>

    <!-- Word Learning Modal -->
    <div class="game-message word-modal" id="wordModal">
      <div class="message-title">ðŸ“š Learn This Word!</div>
      <div id="wordContent" class="word-content">
        <!-- Word content will be populated here -->
      </div>
      <div class="modal-buttons">
        <button class="message-btn" onclick="markWordLearned()">
          I Know This!
        </button>
        <button class="message-btn btn-secondary" onclick="closeWordModal()">
          Skip
        </button>
      </div>
    </div>

    <!-- Vocabulary Quiz Modal -->
    <div class="game-message quiz-modal" id="vocabularyQuizModal">
      <div class="message-title">ðŸ“ Vocabulary Quiz</div>
      <div id="quizContent" class="quiz-content">
        <!-- Quiz content will be populated here -->
      </div>
      <div class="quiz-options">
        <button
          class="message-btn quiz-option"
          id="quizOption1"
          onclick="selectQuizAnswer(0)"
        ></button>
        <button
          class="message-btn quiz-option"
          id="quizOption2"
          onclick="selectQuizAnswer(1)"
        ></button>
        <button
          class="message-btn quiz-option"
          id="quizOption3"
          onclick="selectQuizAnswer(2)"
        ></button>
      </div>
      <div class="quiz-footer">
        <span id="quizScore" class="quiz-score">Score: 0/0</span>
        <button
          class="message-btn btn-secondary"
          onclick="closeVocabularyQuiz()"
        >
          Close Quiz
        </button>
      </div>
    </div>

    <!-- Word Progress Modal -->
    <div class="game-message" id="wordProgressModal" style="max-width: 600px">
      <div class="message-title">ðŸ“ˆ Your Learning Progress</div>
      <div
        id="progressContent"
        style="
          text-align: left;
          margin: 1rem 0;
          max-height: 400px;
          overflow-y: auto;
        "
      >
        <!-- Progress content will be populated here -->
      </div>
      <button class="message-btn" onclick="closeWordProgress()">Close</button>
    </div>

    <!-- Daily Challenges Modal -->
    <div
      class="game-message"
      id="dailyChallengesModal"
      style="max-width: 600px"
    >
      <div class="message-title">ðŸŽ¯ Daily Challenges</div>
      <div
        id="challengesContent"
        style="
          text-align: left;
          margin: 1rem 0;
          max-height: 400px;
          overflow-y: auto;
        "
      >
        <!-- Challenges content will be populated here -->
      </div>
      <button class="message-btn" onclick="closeDailyChallenges()">
        Close
      </button>
    </div>

    <!-- Power-Ups Modal -->
    <div class="game-message" id="powerUpsModal" style="max-width: 600px">
      <div class="message-title">âš¡ Power-Ups</div>
      <div
        id="powerUpsContent"
        style="
          text-align: left;
          margin: 1rem 0;
          max-height: 400px;
          overflow-y: auto;
        "
      >
        <!-- Power-ups content will be populated here -->
      </div>
      <div style="display: flex; gap: 0.5rem; justify-content: center">
        <button class="message-btn" onclick="closePowerUps()">Close</button>
      </div>
    </div>

    <script>
      // Game State
      let gameState = {
        playerHand: [],
        computerHand: [],
        deck: [],
        discardPile: [],
        currentCard: null,
        currentColor: null,
        playerTurn: true,
        gameOver: false,
        playerCalledUno: false,
        computerCalledUno: false,
        computerThinking: false,
        gameStartTime: null,
        moveCount: 0,
        soundEnabled: true,
        animationsEnabled: true,
        showHints: true,
        learnedWords: new Set(
          JSON.parse(localStorage.getItem("learnedWords") || "[]"),
        ),
        cardsPlayed: parseInt(localStorage.getItem("cardsPlayed")) || 0,
        combo: 0,
        maxCombo: parseInt(localStorage.getItem("maxCombo")) || 0,
        quiz: {
          score: 0,
          totalQuestions: 0,
          currentQuestion: null,
          options: [],
          correctAnswer: 0,
        },
        wordProgress: JSON.parse(localStorage.getItem("wordProgress") || "{}"),
        streak: parseInt(localStorage.getItem("learningStreak")) || 0,
        dailyGoal: parseInt(localStorage.getItem("dailyGoal")) || 5,
        wordsLearnedToday: 0,
        powerUps: {
          hints: parseInt(localStorage.getItem("powerUpHints")) || 3,
          skipTurn: parseInt(localStorage.getItem("powerUpSkipTurn")) || 1,
          peekCards: parseInt(localStorage.getItem("powerUpPeekCards")) || 2,
          extraTime: parseInt(localStorage.getItem("powerUpExtraTime")) || 1,
        },
        dailyChallenges: {
          current: JSON.parse(localStorage.getItem("dailyChallenges") || "[]"),
          completed: JSON.parse(
            localStorage.getItem("completedChallenges") || "[]",
          ),
          lastReset:
            localStorage.getItem("challengesLastReset") ||
            new Date().toDateString(),
        },
        stats: {
          gamesPlayed: parseInt(localStorage.getItem("gamesPlayed")) || 0,
          gamesWon: parseInt(localStorage.getItem("gamesWon")) || 0,
          totalTime: parseInt(localStorage.getItem("totalTime")) || 0,
          fastestWin: parseInt(localStorage.getItem("fastestWin")) || Infinity,
        },
      };

      // Enhanced Card definitions - Clean color-based design
      const colors = ["red", "blue", "green", "yellow"];
      const numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
      const actions = ["skip", "reverse", "draw2"];

      // Enhanced vocabulary words with difficulty levels and categories
      const vocabularyWords = {
        red: [
          {
            word: "apple",
            pronunciation: "/ËˆÃ¦pÉ™l/",
            level: "beginner",
            definition: "a round fruit",
            category: "food",
          },
          {
            word: "fire",
            pronunciation: "/faÉªÉ™r/",
            level: "beginner",
            definition: "hot flames",
            category: "nature",
          },
          {
            word: "rose",
            pronunciation: "/roÊŠz/",
            level: "beginner",
            definition: "a beautiful flower",
            category: "nature",
          },
          {
            word: "heart",
            pronunciation: "/hÉ‘Ërt/",
            level: "beginner",
            definition: "organ that pumps blood",
            category: "body",
          },
          {
            word: "cherry",
            pronunciation: "/ËˆtÊƒeri/",
            level: "intermediate",
            definition: "small red fruit",
            category: "food",
          },
          {
            word: "tomato",
            pronunciation: "/tÉ™ËˆmeÉªtoÊŠ/",
            level: "intermediate",
            definition: "red vegetable for salads",
            category: "food",
          },
          {
            word: "passion",
            pronunciation: "/ËˆpÃ¦ÊƒÉ™n/",
            level: "intermediate",
            definition: "strong emotion or enthusiasm",
            category: "emotion",
          },
          {
            word: "crimson",
            pronunciation: "/ËˆkrÉªmzÉ™n/",
            level: "advanced",
            definition: "deep red color",
            category: "color",
          },
          {
            word: "scarlet",
            pronunciation: "/ËˆskÉ‘rlÉ™t/",
            level: "advanced",
            definition: "bright red color",
            category: "color",
          },
          {
            word: "cardinal",
            pronunciation: "/ËˆkÉ‘ËrdÉªnÉ™l/",
            level: "advanced",
            definition: "red bird or important official",
            category: "animal",
          },
        ],
        blue: [
          {
            word: "sky",
            pronunciation: "/skaÉª/",
            level: "beginner",
            definition: "what we see above us",
            category: "nature",
          },
          {
            word: "ocean",
            pronunciation: "/ËˆoÊŠÊƒÉ™n/",
            level: "beginner",
            definition: "large body of water",
            category: "nature",
          },
          {
            word: "ice",
            pronunciation: "/aÉªs/",
            level: "beginner",
            definition: "frozen water",
            category: "nature",
          },
          {
            word: "water",
            pronunciation: "/ËˆwÉ”ËtÉ™r/",
            level: "beginner",
            definition: "clear liquid we drink",
            category: "nature",
          },
          {
            word: "whale",
            pronunciation: "/weÉªl/",
            level: "intermediate",
            definition: "large sea mammal",
            category: "animal",
          },
          {
            word: "blueberry",
            pronunciation: "/ËˆbluËŒberi/",
            level: "intermediate",
            definition: "small blue fruit",
            category: "food",
          },
          {
            word: "peaceful",
            pronunciation: "/ËˆpiËsfÉ™l/",
            level: "intermediate",
            definition: "calm and quiet",
            category: "emotion",
          },
          {
            word: "sapphire",
            pronunciation: "/ËˆsÃ¦faÉªÉ™r/",
            level: "advanced",
            definition: "blue precious stone",
            category: "object",
          },
          {
            word: "azure",
            pronunciation: "/ËˆÃ¦Ê’É™r/",
            level: "advanced",
            definition: "bright blue color",
            category: "color",
          },
          {
            word: "melancholy",
            pronunciation: "/ËˆmelÉ™nkÉ’li/",
            level: "advanced",
            definition: "deep sadness",
            category: "emotion",
          },
        ],
        green: [
          {
            word: "grass",
            pronunciation: "/É¡rÃ¦s/",
            level: "beginner",
            definition: "plants in the yard",
            category: "nature",
          },
          {
            word: "tree",
            pronunciation: "/tri/",
            level: "beginner",
            definition: "tall plant with leaves",
            category: "nature",
          },
          {
            word: "leaf",
            pronunciation: "/lif/",
            level: "beginner",
            definition: "part of a plant",
            category: "nature",
          },
          {
            word: "frog",
            pronunciation: "/frÉ”É¡/",
            level: "beginner",
            definition: "jumping amphibian",
            category: "animal",
          },
          {
            word: "forest",
            pronunciation: "/ËˆfÉ”ËrÉªst/",
            level: "intermediate",
            definition: "area with many trees",
            category: "nature",
          },
          {
            word: "broccoli",
            pronunciation: "/ËˆbrÉ‘kÉ™li/",
            level: "intermediate",
            definition: "green vegetable",
            category: "food",
          },
          {
            word: "jealousy",
            pronunciation: "/ËˆdÊ’elÉ™si/",
            level: "intermediate",
            definition: "feeling of envy",
            category: "emotion",
          },
          {
            word: "emerald",
            pronunciation: "/ËˆemÉ™rÉ™ld/",
            level: "advanced",
            definition: "green precious stone",
            category: "object",
          },
          {
            word: "verdant",
            pronunciation: "/ËˆvÉœrdÉ™nt/",
            level: "advanced",
            definition: "green and lush",
            category: "color",
          },
          {
            word: "chlorophyll",
            pronunciation: "/ËˆklÉ”ËrÉ™fÉªl/",
            level: "advanced",
            definition: "green pigment in plants",
            category: "science",
          },
        ],
        yellow: [
          {
            word: "sun",
            pronunciation: "/sÊŒn/",
            level: "beginner",
            definition: "star that gives us light",
            category: "nature",
          },
          {
            word: "banana",
            pronunciation: "/bÉ™ËˆnÃ¦nÉ™/",
            level: "beginner",
            definition: "yellow curved fruit",
            category: "food",
          },
          {
            word: "gold",
            pronunciation: "/É¡oÊŠld/",
            level: "beginner",
            definition: "valuable metal",
            category: "object",
          },
          {
            word: "bee",
            pronunciation: "/biË/",
            level: "beginner",
            definition: "insect that makes honey",
            category: "animal",
          },
          {
            word: "star",
            pronunciation: "/stÉ‘r/",
            level: "intermediate",
            definition: "bright light in the sky",
            category: "nature",
          },
          {
            word: "lemon",
            pronunciation: "/ËˆlemÉ™n/",
            level: "intermediate",
            definition: "sour yellow fruit",
            category: "food",
          },
          {
            word: "sunshine",
            pronunciation: "/ËˆsÊŒnÊƒaÉªn/",
            level: "intermediate",
            definition: "light from the sun",
            category: "nature",
          },
          {
            word: "amber",
            pronunciation: "/ËˆÃ¦mbÉ™r/",
            level: "advanced",
            definition: "yellowish fossil resin",
            category: "object",
          },
          {
            word: "canary",
            pronunciation: "/kÉ™Ëˆneri/",
            level: "advanced",
            definition: "small yellow bird",
            category: "animal",
          },
          {
            word: "optimism",
            pronunciation: "/ËˆÉ’ptÉªmÉªzÉ™m/",
            level: "advanced",
            definition: "hopeful attitude",
            category: "emotion",
          },
        ],
      };

      // Difficulty levels
      let difficultyLevel = localStorage.getItem("unodifficulty") || "beginner";

      // Web Audio API Sound Effects - Lazy Initialize
      let audioContext = null;

      function getAudioContext() {
        if (!audioContext) {
          audioContext = new (
            window.AudioContext || window.webkitAudioContext
          )();
        }
        // Resume if suspended (required for mobile)
        if (audioContext.state === "suspended") {
          audioContext.resume();
        }
        return audioContext;
      }

      function playSound(frequency, duration, type = "sine") {
        if (!gameState.soundEnabled) return;

        try {
          const ctx = getAudioContext();
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = type;

          gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            ctx.currentTime + duration,
          );

          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + duration);
        } catch (e) {
          // Silently fail if audio context is not available
        }
      }

      function playCardSound() {
        playSound(400, 0.1);
      }

      function playDrawSound() {
        playSound(300, 0.15);
      }

      function playUnoSound() {
        playSound(600, 0.2);
        setTimeout(() => playSound(800, 0.2), 100);
      }

      function playWinSound() {
        playSound(523, 0.15);
        setTimeout(() => playSound(659, 0.15), 100);
        setTimeout(() => playSound(784, 0.3), 200);
      }

      function playLoseSound() {
        playSound(400, 0.15);
        setTimeout(() => playSound(300, 0.3), 100);
      }

      function playSkipSound() {
        playSound(350, 0.1);
        setTimeout(() => playSound(250, 0.1), 80);
      }

      function playReverseSound() {
        playSound(500, 0.1);
        setTimeout(() => playSound(400, 0.1), 80);
        setTimeout(() => playSound(300, 0.1), 160);
      }

      // Screen Reader Announcements
      function announceToScreenReader(message) {
        const announcements = document.getElementById("announcements");
        if (announcements) {
          announcements.textContent = message;
          setTimeout(() => {
            announcements.textContent = "";
          }, 1000);
        }
      }

      // Keyboard Navigation
      document.addEventListener("keydown", (e) => {
        // Escape key - close modals
        if (e.key === "Escape") {
          const colorPicker = document.getElementById("colorPicker");
          const gameMessage = document.getElementById("gameMessage");
          const settingsModal = document.getElementById("settingsModal");

          if (colorPicker?.style.display === "flex") {
            colorPicker.style.display = "none";
          }
          if (gameMessage?.style.display === "flex") {
            closeMessage();
          }
          if (settingsModal?.style.display === "flex") {
            closeSettings();
          }
          return;
        }

        // Number keys 1-4 for color selection when picker is open
        if (["1", "2", "3", "4"].includes(e.key)) {
          const colorPicker = document.getElementById("colorPicker");
          if (colorPicker?.style.display === "flex") {
            const colors = ["red", "blue", "green", "yellow"];
            selectColor(colors[parseInt(e.key) - 1]);
            e.preventDefault();
            return;
          }
        }

        // D key - draw card
        if (e.key === "d" || e.key === "D") {
          const drawBtn = document.getElementById("drawBtn");
          if (
            drawBtn &&
            !drawBtn.disabled &&
            gameState.playerTurn &&
            !gameState.gameOver
          ) {
            drawCard();
            e.preventDefault();
          }
          return;
        }

        // U key - call UNO
        if (e.key === "u" || e.key === "U") {
          const unoBtn = document.getElementById("unoBtn");
          if (unoBtn && unoBtn.style.display !== "none") {
            callUno();
            e.preventDefault();
          }
          return;
        }

        // N key - new game
        if (e.key === "n" || e.key === "N") {
          if (
            !gameState.gameOver &&
            !document.querySelector('[style*="display: flex"]')
          ) {
            if (confirm("Start a new game? Current progress will be lost.")) {
              newGame();
            }
            e.preventDefault();
          }
          return;
        }

        // S key - toggle sound
        if (e.key === "s" || e.key === "S") {
          if (!e.ctrlKey && !e.metaKey) {
            toggleSound();
            e.preventDefault();
          }
          return;
        }

        // F key - toggle fullscreen
        if (e.key === "f" || e.key === "F") {
          if (!e.ctrlKey && !e.metaKey) {
            toggleFullscreen();
            e.preventDefault();
          }
          return;
        }

        // Arrow keys - navigate player's cards
        if (gameState.playerTurn && !gameState.gameOver) {
          const playerCards = document.querySelectorAll(
            ".player-hand .card.playable",
          );
          const focused = document.activeElement;

          if (e.key === "ArrowRight" && playerCards.length > 0) {
            const index = Array.from(playerCards).indexOf(focused);
            const nextIndex = (index + 1) % playerCards.length;
            playerCards[nextIndex]?.focus();
            e.preventDefault();
          }

          if (e.key === "ArrowLeft" && playerCards.length > 0) {
            const index = Array.from(playerCards).indexOf(focused);
            const nextIndex = index <= 0 ? playerCards.length - 1 : index - 1;
            playerCards[nextIndex]?.focus();
            e.preventDefault();
          }
        }
      });

      // Streak tracking
      let currentStreak =
        parseInt(localStorage.getItem("uno_currentStreak")) || 0;
      let bestStreak = parseInt(localStorage.getItem("uno_bestStreak")) || 0;

      function updateStreak(won) {
        if (won) {
          currentStreak++;
          if (currentStreak > bestStreak) {
            bestStreak = currentStreak;
            localStorage.setItem("uno_bestStreak", bestStreak.toString());
            announceToScreenReader(`New best streak: ${bestStreak} wins!`);
          }
          localStorage.setItem("uno_currentStreak", currentStreak.toString());
        } else {
          currentStreak = 0;
          localStorage.setItem("uno_currentStreak", "0");
        }
      }

      // Achievement system
      const achievements = {
        firstWin: {
          name: "First Victory",
          description: "Win your first game",
          unlocked: false,
        },
        fastWin: {
          name: "Speed Demon",
          description: "Win in under 2 minutes",
          unlocked: false,
        },
        unoMaster: {
          name: "UNO Master",
          description: "Win 10 games",
          unlocked: false,
        },
        vocabularyExpert: {
          name: "Word Wizard",
          description: "Learn 50 new words",
          unlocked: false,
        },
        cardShark: {
          name: "Card Shark",
          description: "Play 100 cards",
          unlocked: false,
        },
      };

      // Load achievements
      Object.keys(achievements).forEach((key) => {
        achievements[key].unlocked =
          localStorage.getItem(`achievement_${key}`) === "true";
      });

      // Initialize game
      function initGame() {
        gameState.gameStartTime = Date.now();
        gameState.moveCount = 0;
        createDeck();
        shuffleDeck();
        dealCards();
        setStartingCard();
        updateDisplay();
        checkForPlayableCards();
        startGameTimer();
      }

      // Create a standard UNO deck
      function createDeck() {
        gameState.deck = [];

        // Number cards (0-9) for each color
        colors.forEach((color) => {
          numbers.forEach((number) => {
            gameState.deck.push({ color, value: number, type: "number" });
            if (number !== 0) {
              gameState.deck.push({ color, value: number, type: "number" });
            }
          });

          // Action cards (2 of each per color)
          actions.forEach((action) => {
            gameState.deck.push({ color, value: action, type: "action" });
            gameState.deck.push({ color, value: action, type: "action" });
          });
        });

        // Wild cards (4 of each)
        for (let i = 0; i < 4; i++) {
          gameState.deck.push({ color: "wild", value: "wild", type: "wild" });
          gameState.deck.push({ color: "wild", value: "draw4", type: "wild" });
        }
      }

      // Shuffle deck using Fisher-Yates algorithm
      function shuffleDeck() {
        for (let i = gameState.deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [gameState.deck[i], gameState.deck[j]] = [
            gameState.deck[j],
            gameState.deck[i],
          ];
        }
      }

      // Deal initial cards
      function dealCards() {
        gameState.playerHand = [];
        gameState.computerHand = [];

        // Deal 7 cards to each player
        for (let i = 0; i < 7; i++) {
          gameState.playerHand.push(gameState.deck.pop());
          gameState.computerHand.push(gameState.deck.pop());
        }
      }

      // Set the starting card
      function setStartingCard() {
        let startCard;
        do {
          startCard = gameState.deck.pop();
        } while (startCard.type === "wild");

        gameState.currentCard = startCard;
        gameState.currentColor = startCard.color;
        gameState.discardPile = [startCard];
      }

      // Update the display
      function updateDisplay() {
        updatePlayerHand();
        updateComputerHand();
        updateCurrentCard();
        updateGameStatus();
        updateUnoButton();
      }

      // Update player hand display
      function updatePlayerHand() {
        const playerHand = document.getElementById("playerHand");
        playerHand.innerHTML = "";

        gameState.playerHand.forEach((card, index) => {
          const cardElement = createCardElement(card, index, true);
          playerHand.appendChild(cardElement);
        });
      }

      // Update computer hand display
      function updateComputerHand() {
        const computerHand = document.getElementById("computerHand");
        computerHand.innerHTML = "";

        // Add thinking class if computer is thinking
        if (gameState.computerThinking) {
          computerHand.classList.add("computer-thinking");
        } else {
          computerHand.classList.remove("computer-thinking");
        }

        gameState.computerHand.forEach((card, index) => {
          const cardElement = createCardElement(null, index, false);
          computerHand.appendChild(cardElement);
        });
      }

      // Create card element
      function createCardElement(card, index, isPlayer) {
        const cardDiv = document.createElement("div");
        cardDiv.className = "card";

        // Add enhanced hover effects if animations are enabled
        if (gameState.animationsEnabled) {
          cardDiv.classList.add("enhanced-hover");
        }

        if (!isPlayer) {
          // Computer card (face down)
          cardDiv.classList.add("card-back");
          // Card back design handled by CSS
        } else {
          // Player card (face up)
          cardDiv.classList.add(card.color);

          // Add data attribute for corner display
          if (card.type === "number") {
            cardDiv.setAttribute("data-value", card.value);
          } else if (card.type === "action") {
            const actionSymbols = { skip: "âŠ˜", reverse: "â†»", draw2: "+2" };
            cardDiv.setAttribute(
              "data-value",
              actionSymbols[card.value] || card.value,
            );
          } else if (card.type === "wild") {
            cardDiv.setAttribute(
              "data-value",
              card.value === "wild" ? "W" : "+4",
            );
          }

          // Add card content
          const content = document.createElement("div");
          content.className = "card-content";
          content.style.cssText =
            "display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; z-index: 2; position: relative;";

          if (card.type === "number") {
            content.innerHTML = `
                        <div class="card-number">${card.value}</div>
                    `;
          } else if (card.type === "action") {
            const actionIcons = {
              skip: "fa-ban",
              reverse: "fa-sync-alt",
              draw2: "fa-plus-square",
            };
            content.innerHTML = `
                        <div class="card-icon"><i class="fas ${
                          actionIcons[card.value]
                        }"></i></div>
                    `;
          } else if (card.type === "wild") {
            const wildIcons = {
              wild: "fa-palette",
              draw4: "fa-plus-circle",
            };

            // Add animated background for wild cards
            const wildBg = document.createElement("div");
            wildBg.className = "wild-bg";
            cardDiv.appendChild(wildBg);

            content.innerHTML = `
                        <div class="card-icon"><i class="fas ${
                          wildIcons[card.value]
                        }"></i></div>
                    `;
          }

          cardDiv.appendChild(content);

          // Check if card is playable
          if (isCardPlayable(card)) {
            cardDiv.classList.add("playable");
            cardDiv.onclick = () => playCard(index);
            cardDiv.tabIndex = 0;
            cardDiv.setAttribute("role", "button");
            cardDiv.setAttribute(
              "aria-label",
              `Play ${card.value} ${card.color} card`,
            );
            cardDiv.onkeypress = (e) => {
              if (e.key === "Enter" || e.key === " ") {
                playCard(index);
                e.preventDefault();
              }
            };

            // Add tooltip for card hints
            if (gameState.showHints) {
              cardDiv.title = `Click to play this ${card.color} ${card.value}`;
            }
          } else {
            cardDiv.setAttribute(
              "aria-label",
              `${card.value} ${card.color} card - not playable`,
            );
          }
        }

        return cardDiv;
      }

      // Get random vocabulary word for color based on difficulty
      function getVocabularyWord(color) {
        if (vocabularyWords[color]) {
          const words = vocabularyWords[color].filter(
            (word) =>
              word.level === difficultyLevel || difficultyLevel === "beginner",
          );
          if (words.length === 0) return "";
          const randomWord = words[Math.floor(Math.random() * words.length)];
          return randomWord.word;
        }
        return "";
      }

      // Get word details for learning
      function getWordDetails(word) {
        for (const color in vocabularyWords) {
          const found = vocabularyWords[color].find((w) => w.word === word);
          if (found) return found;
        }
        return null;
      }

      // Show word learning modal with enhanced display
      function showWordLearning(word) {
        if (!gameState.showHints || gameState.learnedWords.has(word)) return;

        const wordDetails = getWordDetails(word);
        if (!wordDetails) return;

        const wordContent = document.getElementById("wordContent");
        const categoryEmojis = {
          food: "ðŸŽ",
          nature: "ðŸŒ¿",
          animal: "ðŸ¾",
          body: "ðŸ’ª",
          emotion: "ðŸ’­",
          color: "ðŸŽ¨",
          object: "ðŸ’Ž",
          science: "ðŸ”¬",
        };
        const categoryEmoji = categoryEmojis[wordDetails.category] || "ðŸ“š";

        wordContent.innerHTML = `
          <div style="font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 0 20px rgba(70, 187, 229, 0.5);">${
            wordDetails.word
          }</div>
          <div style="color: #46bbe5; margin-bottom: 0.75rem; font-size: 1.1rem;">${
            wordDetails.pronunciation
          }</div>
          <div style="color: rgba(255, 255, 255, 0.9); margin-bottom: 1rem; font-size: 1rem; line-height: 1.5;">${
            wordDetails.definition
          }</div>
          <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
            <span style="background: rgba(251, 191, 36, 0.2); color: #fbbf24; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">
              ${wordDetails.level.toUpperCase()}
            </span>
            <span style="background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">
              ${categoryEmoji} ${wordDetails.category}
            </span>
          </div>
        `;

        gameState.currentLearningWord = word;
        document.getElementById("wordModal").classList.add("show");
      }

      // Mark word as learned
      function markWordLearned() {
        if (gameState.currentLearningWord) {
          gameState.learnedWords.add(gameState.currentLearningWord);
          gameState.wordsLearnedToday++;
          localStorage.setItem(
            "learnedWords",
            JSON.stringify([...gameState.learnedWords]),
          );

          // Update challenges
          updateChallengeProgress("learn_words");

          // Check vocabulary expert achievement
          if (gameState.learnedWords.size >= 50) {
            unlockAchievement("vocabularyExpert");
          }
        }
        closeWordModal();
      }

      // Close word modal
      function closeWordModal() {
        document.getElementById("wordModal").classList.remove("show");
        gameState.currentLearningWord = null;
      }

      // Check if card is playable
      function isCardPlayable(card) {
        if (!gameState.playerTurn || gameState.gameOver) return false;

        if (card.type === "wild") return true;

        return (
          card.color === gameState.currentColor ||
          card.value === gameState.currentCard.value
        );
      }

      // Play a card
      function playCard(cardIndex) {
        if (!gameState.playerTurn || gameState.gameOver) return;

        const card = gameState.playerHand[cardIndex];
        if (!isCardPlayable(card)) return;

        // Remove card from player hand
        gameState.playerHand.splice(cardIndex, 1);
        gameState.moveCount++;
        gameState.cardsPlayed++;

        // Update combo
        gameState.combo++;
        if (gameState.combo > gameState.maxCombo) {
          gameState.maxCombo = gameState.combo;
          localStorage.setItem("maxCombo", gameState.maxCombo.toString());
        }

        // Show combo effect
        if (gameState.combo > 1) {
          showComboEffect(gameState.combo);
        }

        // Create card play particles
        if (gameState.animationsEnabled) {
          createParticles(
            document.querySelector(
              `#playerHand .card:nth-child(${cardIndex + 1})`,
            ),
          );
        }

        // Check for vocabulary learning
        if (card.type === "number") {
          const word = getVocabularyWord(card.color);
          if (word && Math.random() < 0.3) {
            // 30% chance to show word learning
            setTimeout(() => showWordLearning(word), 500);
          }
        }

        // Handle wild cards
        if (card.type === "wild") {
          showColorPicker(card);
          return;
        }

        // Play the card
        executeCardPlay(card);
        playCardSound();
        announceToScreenReader(
          `Played ${card.value} ${card.color} card. ${gameState.playerHand.length} cards remaining.`,
        );

        // Check card shark achievement
        if (gameState.cardsPlayed >= 100) {
          unlockAchievement("cardShark");
        }
      }

      // Execute card play
      function executeCardPlay(card) {
        gameState.currentCard = card;
        gameState.currentColor = card.color;
        gameState.discardPile.push(card);

        let skipOpponentTurn = false;

        // Handle action cards
        if (card.type === "action") {
          skipOpponentTurn = handleActionCard(card);
        } else if (card.type === "wild" && card.value === "draw4") {
          // Computer draws 4 cards AND loses their turn
          for (let i = 0; i < 4; i++) {
            if (gameState.deck.length === 0) reshuffleDeck();
            gameState.computerHand.push(gameState.deck.pop());
          }
          playSound("draw");
          skipOpponentTurn = true; // Draw 4 also skips opponent's turn
        }

        // Check for UNO
        if (gameState.playerHand.length === 1) {
          showUnoButton();
        }

        // Check for win
        if (gameState.playerHand.length === 0) {
          endGame(true);
          return;
        }

        updateDisplay();

        // If skip/reverse/draw2/draw4 was played, player gets another turn
        if (skipOpponentTurn) {
          gameState.playerTurn = true;
          showMessage(
            "Your Turn Again!",
            "The computer's turn was skipped. Play another card!",
          );
          checkForPlayableCards();
        } else {
          // Switch turns - Computer's turn
          gameState.playerTurn = false;
          setTimeout(computerTurn, 1000);
        }
      }

      // Handle action cards - returns true if opponent's turn should be skipped
      function handleActionCard(card) {
        switch (card.value) {
          case "skip":
            playSkipSound();
            announceToScreenReader(
              "Skip card played. Computer's turn skipped.",
            );
            return true; // Skip opponent's turn
          case "reverse":
            // In 2-player game, reverse acts like skip
            playReverseSound();
            announceToScreenReader(
              "Reverse card played. In 2-player mode, computer's turn is skipped.",
            );
            return true; // Skip opponent's turn
          case "draw2":
            // Computer draws 2 cards AND loses their turn
            for (let i = 0; i < 2; i++) {
              if (gameState.deck.length === 0) reshuffleDeck();
              gameState.computerHand.push(gameState.deck.pop());
            }
            playDrawSound();
            announceToScreenReader(
              "Draw 2 card played. Computer draws 2 cards and loses their turn.",
            );
            return true; // Skip opponent's turn
        }
        return false;
      }

      // Show color picker
      function showColorPicker(card) {
        gameState.pendingWildCard = card;
        document.getElementById("colorPicker").classList.add("show");
      }

      // Select color for wild card
      function selectColor(color) {
        const card = gameState.pendingWildCard;
        card.color = color;
        gameState.currentColor = color;

        document.getElementById("colorPicker").classList.remove("show");
        executeCardPlay(card);
      }

      // Computer turn with improved AI
      function computerTurn() {
        if (gameState.gameOver) return;

        gameState.computerThinking = true;
        updateDisplay();
        updateTurnIndicator();

        // Smart AI delay based on difficulty
        const thinkingTime =
          difficultyLevel === "beginner"
            ? 800
            : difficultyLevel === "intermediate"
              ? 1200
              : 1800;

        setTimeout(() => {
          const playableCards = gameState.computerHand.filter(
            (card) =>
              card.type === "wild" ||
              card.color === gameState.currentColor ||
              card.value === gameState.currentCard.value,
          );

          if (playableCards.length > 0) {
            // Improved AI strategy based on difficulty
            let cardToPlay;

            if (difficultyLevel === "advanced") {
              // Advanced: Strategic play
              cardToPlay =
                getBestComputerCard(playableCards) || playableCards[0];
            } else if (difficultyLevel === "intermediate") {
              // Intermediate: Somewhat strategic
              cardToPlay =
                playableCards.find((card) => card.type === "action") ||
                playableCards[0];
            } else {
              // Beginner: Random play
              cardToPlay =
                playableCards[Math.floor(Math.random() * playableCards.length)];
            }

            const cardIndex = gameState.computerHand.indexOf(cardToPlay);
            gameState.computerHand.splice(cardIndex, 1);

            // Handle wild cards
            if (cardToPlay.type === "wild") {
              const randomColor =
                colors[Math.floor(Math.random() * colors.length)];
              cardToPlay.color = randomColor;
              gameState.currentColor = randomColor;
            }

            gameState.currentCard = cardToPlay;
            if (cardToPlay.type !== "wild") {
              gameState.currentColor = cardToPlay.color;
            }
            gameState.discardPile.push(cardToPlay);

            let skipPlayerTurn = false;

            // Handle action cards against player
            if (cardToPlay.type === "action") {
              skipPlayerTurn = handleComputerActionCard(cardToPlay);
            } else if (
              cardToPlay.type === "wild" &&
              cardToPlay.value === "draw4"
            ) {
              // Player draws 4 cards AND loses their turn
              for (let i = 0; i < 4; i++) {
                if (gameState.deck.length === 0) reshuffleDeck();
                gameState.playerHand.push(gameState.deck.pop());
              }
              playSound("draw");
              showMessage(
                "Wild Draw 4!",
                "You drew 4 cards and lost your turn!",
              );
              skipPlayerTurn = true;
            }

            // Check for computer UNO
            if (gameState.computerHand.length === 1) {
              gameState.computerCalledUno = true;
              showMessage(
                "Computer called UNO!",
                "The computer has one card left!",
              );
              playSound("uno");
            }

            // Check for computer win
            if (gameState.computerHand.length === 0) {
              endGame(false);
              return;
            }

            playSound("cardPlay");

            // If action card was played, computer gets another turn
            if (skipPlayerTurn) {
              gameState.computerThinking = false;
              updateDisplay();
              // Computer takes another turn after a delay
              setTimeout(computerTurn, 1500);
              return;
            }
          } else {
            // Draw a card
            if (gameState.deck.length === 0) reshuffleDeck();
            gameState.computerHand.push(gameState.deck.pop());
            playSound("draw");
          }

          gameState.computerThinking = false;
          gameState.playerTurn = true;
          gameState.combo = 0; // Reset combo when turn switches
          updateDisplay();
          checkForPlayableCards();

          // Show hints if enabled
          if (gameState.showHints) {
            showPlayHints();
          }
        }, thinkingTime);
      }

      // Get best computer card (advanced AI with card counting)
      function getBestComputerCard(playableCards) {
        if (difficultyLevel === "advanced") {
          // Advanced AI: Card counting and strategic play

          // 1. Prioritize getting rid of high-value cards
          const actionCards = playableCards.filter(
            (card) => card.type === "action",
          );
          const wildCards = playableCards.filter(
            (card) => card.type === "wild",
          );
          const numberCards = playableCards.filter(
            (card) => card.type === "number",
          );

          // 2. If close to winning, use wild cards strategically
          if (gameState.computerHand.length <= 2 && wildCards.length > 0) {
            return wildCards[0];
          }

          // 3. Use action cards to disrupt player
          if (gameState.playerHand.length <= 3 && actionCards.length > 0) {
            // Prioritize draw cards when player is close to winning
            const drawCards = actionCards.filter(
              (card) => card.value === "draw2",
            );
            if (drawCards.length > 0) return drawCards[0];
            return actionCards[0];
          }

          // 4. Count colors in hand to make strategic choices
          const colorCounts = {};
          gameState.computerHand.forEach((card) => {
            if (card.color !== "wild") {
              colorCounts[card.color] = (colorCounts[card.color] || 0) + 1;
            }
          });

          // 5. Prefer cards of colors we have more of
          if (numberCards.length > 0) {
            const sortedByColorCount = numberCards.sort(
              (a, b) =>
                (colorCounts[b.color] || 0) - (colorCounts[a.color] || 0),
            );
            return sortedByColorCount[0];
          }

          return playableCards[0];
        }

        // Original logic for other difficulties
        const actionCards = playableCards.filter(
          (card) => card.type === "action",
        );
        if (actionCards.length > 0) return actionCards[0];

        const wildCards = playableCards.filter((card) => card.type === "wild");
        if (wildCards.length > 0 && gameState.computerHand.length > 3)
          return wildCards[0];

        const numberCards = playableCards.filter(
          (card) => card.type === "number",
        );
        if (numberCards.length > 0) {
          return numberCards.reduce((max, card) =>
            card.value > max.value ? card : max,
          );
        }

        return playableCards[0];
      }

      // Handle computer action cards - returns true if player's turn should be skipped
      function handleComputerActionCard(card) {
        switch (card.value) {
          case "skip":
            playSound("skip");
            showMessage("Skip!", "Your turn was skipped!");
            return true;
          case "reverse":
            // In 2-player game, reverse acts like skip
            playSound("reverse");
            showMessage("Reverse!", "In 2-player mode, your turn is skipped!");
            return true;
          case "draw2":
            // Player draws 2 cards AND loses their turn
            for (let i = 0; i < 2; i++) {
              if (gameState.deck.length === 0) reshuffleDeck();
              gameState.playerHand.push(gameState.deck.pop());
            }
            playSound("draw");
            showMessage("Draw 2!", "You drew 2 cards and lost your turn!");
            return true;
        }
        return false;
      }

      // Draw card
      function drawCard() {
        if (!gameState.playerTurn || gameState.gameOver) return;

        if (gameState.deck.length === 0) reshuffleDeck();

        const drawnCard = gameState.deck.pop();
        gameState.playerHand.push(drawnCard);
        gameState.moveCount++;

        playDrawSound();
        announceToScreenReader(
          `Drew ${drawnCard.value} ${drawnCard.color} card. ${gameState.playerHand.length} cards in hand.`,
        );
        updateDisplay();

        // Check if drawn card is playable
        if (isCardPlayable(drawnCard)) {
          // Player can choose to play it immediately
          const cardIndex = gameState.playerHand.length - 1;
          setTimeout(() => {
            const cardElement = document.querySelector(
              `#playerHand .card:nth-child(${cardIndex + 1})`,
            );
            if (cardElement) {
              cardElement.style.animation = "glow 1s infinite alternate";
            }
          }, 500);
        } else {
          // End turn
          gameState.playerTurn = false;
          announceToScreenReader("No playable card. Computer's turn.");
          setTimeout(computerTurn, 1000);
        }
      }

      // Reshuffle deck
      function reshuffleDeck() {
        if (gameState.discardPile.length <= 1) return;

        const currentCard = gameState.discardPile.pop();
        gameState.deck = [...gameState.discardPile];
        gameState.discardPile = [currentCard];
        shuffleDeck();
      }

      // Check for playable cards
      function checkForPlayableCards() {
        const playableCards = gameState.playerHand.filter((card) =>
          isCardPlayable(card),
        );
        const hasPlayableCard = playableCards.length > 0;
        document.getElementById("drawBtn").disabled =
          !gameState.playerTurn || gameState.gameOver;

        // Update playable count indicator
        updatePlayableCount(playableCards.length);
      }

      // Show playable card count on mobile
      function updatePlayableCount(count) {
        const indicator = document.getElementById("playableCount");
        if (!indicator) return;

        if (count > 0 && gameState.playerTurn && !gameState.gameOver) {
          indicator.textContent = `${count} card${count !== 1 ? "s" : ""} playable`;
          indicator.classList.add("visible");
        } else if (!gameState.playerTurn && !gameState.gameOver) {
          indicator.textContent = "Computer's turn...";
          indicator.classList.add("visible");
        } else {
          indicator.classList.remove("visible");
        }
      }

      // Update current card display
      function updateCurrentCard() {
        const currentCardElement = document.getElementById("currentCard");
        const card = gameState.currentCard;

        if (card) {
          currentCardElement.className = `card current-card ${card.color}`;

          // Add data attribute for corner display
          if (card.type === "number") {
            currentCardElement.setAttribute("data-value", card.value);
          } else if (card.type === "action") {
            const actionSymbols = { skip: "âŠ˜", reverse: "â†»", draw2: "+2" };
            currentCardElement.setAttribute(
              "data-value",
              actionSymbols[card.value] || card.value,
            );
          } else if (card.type === "wild") {
            currentCardElement.setAttribute(
              "data-value",
              card.value === "wild" ? "W" : "+4",
            );
          }

          let content = "";
          const textColor = card.color === "yellow" ? "#1a202c" : "white";

          if (card.type === "number") {
            content = `
                        <div class="card-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; z-index: 2; position: relative;">
                            <div class="card-number">${card.value}</div>
                        </div>
                    `;
          } else if (card.type === "action") {
            const actionIcons = {
              skip: "fa-ban",
              reverse: "fa-sync-alt",
              draw2: "fa-plus-square",
            };
            content = `
                        <div class="card-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; z-index: 2; position: relative;">
                            <div class="card-icon"><i class="fas ${
                              actionIcons[card.value]
                            }"></i></div>
                        </div>
                    `;
          } else if (card.type === "wild") {
            const wildIcons = {
              wild: "fa-palette",
              draw4: "fa-plus-circle",
            };
            content = `
                        <div class="wild-bg"></div>
                        <div class="card-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; z-index: 2; position: relative;">
                            <div class="card-icon"><i class="fas ${
                              wildIcons[card.value]
                            }"></i></div>
                        </div>
                    `;
          }

          currentCardElement.innerHTML = content;

          // Update color indicator
          document.getElementById("currentColor").textContent =
            `Color: ${gameState.currentColor}`;
        }
      }

      // Update game status
      function updateGameStatus() {
        document.getElementById("playerCardCount").textContent =
          `${gameState.playerHand.length} cards`;
        document.getElementById("computerCardCount").textContent =
          `${gameState.computerHand.length} cards`;
        document.getElementById("deckCount").textContent =
          `Cards: ${gameState.deck.length}`;
        document.getElementById("playerCombo").textContent =
          `Combo: ${gameState.combo}`;
        document.getElementById("difficultyDisplay").textContent =
          difficultyLevel.charAt(0).toUpperCase() + difficultyLevel.slice(1);
        updateTurnIndicator();
      }

      // Update turn indicator
      function updateTurnIndicator() {
        const indicator = document.getElementById("turnIndicator");
        if (gameState.gameOver) {
          indicator.textContent = "Game Over";
          indicator.className = "turn-indicator";
        } else if (gameState.computerThinking) {
          indicator.textContent = "Computer Thinking...";
          indicator.className = "turn-indicator thinking-indicator";
        } else if (gameState.playerTurn) {
          indicator.textContent = "Your Turn";
          indicator.className = "turn-indicator";
        } else {
          indicator.textContent = "Computer's Turn";
          indicator.className = "turn-indicator thinking-indicator";
        }
      }

      // Show/hide UNO button
      function showUnoButton() {
        document.getElementById("unoBtn").style.display = "block";
      }

      function updateUnoButton() {
        const unoBtn = document.getElementById("unoBtn");
        if (gameState.playerHand.length === 1 && !gameState.playerCalledUno) {
          unoBtn.style.display = "block";
        } else {
          unoBtn.style.display = "none";
        }
      }

      // Call UNO
      function callUno() {
        if (gameState.playerHand.length === 1) {
          gameState.playerCalledUno = true;
          showMessage("UNO!", "You called UNO with one card left!");
          playUnoSound();
          announceToScreenReader("UNO! You have one card left!");
          updateUnoButton();
        }
      }

      // End game
      function endGame(playerWon) {
        gameState.gameOver = true;
        gameState.stats.gamesPlayed++;

        const gameTime = Date.now() - gameState.gameStartTime;

        if (playerWon) {
          gameState.stats.gamesWon++;
          updateStreak(true);

          // Create celebration effect
          createCelebration();

          // Update challenges
          updateChallengeProgress("win_games");
          if (gameTime < 90000) {
            // Under 90 seconds
            updateChallengeProgress("fast_game");
          }

          // Check for fast win achievement
          if (gameTime < 120000) {
            // 2 minutes
            unlockAchievement("fastWin");
          }

          // Update fastest win
          if (gameTime < gameState.stats.fastestWin) {
            gameState.stats.fastestWin = gameTime;
            localStorage.setItem("fastestWin", gameTime.toString());
          }

          // Check for first win achievement
          if (gameState.stats.gamesWon === 1) {
            unlockAchievement("firstWin");
          }

          // Check for UNO master achievement
          if (gameState.stats.gamesWon >= 10) {
            unlockAchievement("unoMaster");
          }

          const streakText =
            currentStreak > 1 ? ` Win streak: ${currentStreak}!` : "";
          showMessage(
            "ðŸŽ‰ Congratulations!",
            `You won in ${Math.round(gameTime / 1000)}s with ${
              gameState.moveCount
            } moves!${streakText}`,
          );
          playWinSound();
          announceToScreenReader(
            `You won! Win streak: ${currentStreak}. Best streak: ${bestStreak}.`,
          );
        } else {
          updateStreak(false);
          showMessage("ðŸ˜ž Game Over", "Computer wins this time. Try again! ðŸ¤–");
          playLoseSound();
          announceToScreenReader("Computer won. Streak reset. Try again!");
        }

        // Update statistics
        gameState.stats.totalTime += gameTime;
        localStorage.setItem("cardsPlayed", gameState.cardsPlayed.toString());
        saveStats();
        updateDisplay();
      }

      // Show message
      function showMessage(title, text) {
        const titleEl = document.getElementById("messageTitle");
        const textEl = document.getElementById("messageText");
        const modalEl = document.getElementById("gameMessage");

        titleEl.textContent = title;
        // Check if text contains HTML
        if (text.includes("<")) {
          textEl.innerHTML = text;
        } else {
          textEl.textContent = text;
        }
        modalEl.classList.add("show");
      }

      // Close message
      function closeMessage() {
        const modalEl = document.getElementById("gameMessage");
        modalEl.classList.remove("show");
        // Reset to text content
        document.getElementById("messageText").innerHTML = "";
      }

      // New game
      function newGame() {
        gameState = {
          playerHand: [],
          computerHand: [],
          deck: [],
          discardPile: [],
          currentCard: null,
          currentColor: null,
          playerTurn: true,
          gameOver: false,
          playerCalledUno: false,
          computerCalledUno: false,
          computerThinking: false,
          gameStartTime: null,
          moveCount: 0,
          soundEnabled: gameState.soundEnabled,
          animationsEnabled: gameState.animationsEnabled,
          showHints: gameState.showHints,
          learnedWords: gameState.learnedWords,
          cardsPlayed: gameState.cardsPlayed,
          combo: 0,
          maxCombo: gameState.maxCombo,
          quiz: gameState.quiz,
          wordProgress: gameState.wordProgress,
          streak: gameState.streak,
          dailyGoal: gameState.dailyGoal,
          wordsLearnedToday: gameState.wordsLearnedToday,
          powerUps: gameState.powerUps,
          dailyChallenges: gameState.dailyChallenges,
          stats: gameState.stats,
        };

        closeMessage();
        initGame();

        // Add dealing animation
        setTimeout(dealCardsWithAnimation, 100);
      }

      // Game timer
      function startGameTimer() {
        setInterval(() => {
          if (!gameState.gameOver && gameState.gameStartTime) {
            const elapsed = Date.now() - gameState.gameStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById("gameTimer").textContent =
              `Time: ${minutes}:${seconds.toString().padStart(2, "0")}`;
            document.getElementById("moveCount").textContent =
              `Moves: ${gameState.moveCount}`;
          }
        }, 1000);
      }

      // Enhanced sound effects
      function playSound(type) {
        if (!gameState.soundEnabled) return;

        // Create audio context for sound effects
        const audioContext = new (
          window.AudioContext || window.webkitAudioContext
        )();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);

        switch (type) {
          case "cardPlay":
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.2,
            );
            break;
          case "draw":
            oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.3,
            );
            break;
          case "uno":
            // Create a more exciting UNO sound
            oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
            oscillator.frequency.linearRampToValueAtTime(
              1320,
              audioContext.currentTime + 0.2,
            );
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.4,
            );
            break;
          case "win":
            // Victory fanfare
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.linearRampToValueAtTime(
              880,
              audioContext.currentTime + 0.2,
            );
            oscillator.frequency.linearRampToValueAtTime(
              660,
              audioContext.currentTime + 0.4,
            );
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.6,
            );
            break;
          case "lose":
            oscillator.frequency.setValueAtTime(165, audioContext.currentTime);
            oscillator.frequency.linearRampToValueAtTime(
              110,
              audioContext.currentTime + 0.3,
            );
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.5,
            );
            break;
          case "skip":
            oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
            oscillator.frequency.linearRampToValueAtTime(
              440,
              audioContext.currentTime + 0.1,
            );
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.2,
            );
            break;
          case "reverse":
            oscillator.frequency.setValueAtTime(550, audioContext.currentTime);
            oscillator.frequency.linearRampToValueAtTime(
              330,
              audioContext.currentTime + 0.15,
            );
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.25,
            );
            break;
          case "achievement":
            // Special achievement sound
            oscillator.frequency.setValueAtTime(523, audioContext.currentTime); // C5
            oscillator.frequency.linearRampToValueAtTime(
              659,
              audioContext.currentTime + 0.1,
            ); // E5
            oscillator.frequency.linearRampToValueAtTime(
              784,
              audioContext.currentTime + 0.2,
            ); // G5
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.5,
            );
            break;
        }

        const duration =
          type === "win"
            ? 0.6
            : type === "achievement"
              ? 0.5
              : type === "uno"
                ? 0.4
                : 0.3;
        oscillator.start();
        oscillator.stop(audioContext.currentTime + duration);
      }

      // Toggle sound
      function toggleSound() {
        gameState.soundEnabled = !gameState.soundEnabled;
        const icon = document.querySelector("#soundToggle i");
        icon.className = gameState.soundEnabled
          ? "fas fa-volume-up"
          : "fas fa-volume-mute";
      }

      // Toggle fullscreen mode
      function toggleFullscreen() {
        if (!document.fullscreenElement && !document.webkitFullscreenElement) {
          // Enter fullscreen
          const elem = document.documentElement;
          if (elem.requestFullscreen) {
            elem.requestFullscreen();
          } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
          } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
          }
        } else {
          // Exit fullscreen
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
        }
      }

      // Update fullscreen button icon when fullscreen state changes
      document.addEventListener("fullscreenchange", updateFullscreenButton);
      document.addEventListener(
        "webkitfullscreenchange",
        updateFullscreenButton,
      );

      function updateFullscreenButton() {
        const icon = document.getElementById("fullscreenIcon");
        const text = document.getElementById("fullscreenText");
        const floatingIcon = document.getElementById("floatingFullscreenIcon");

        if (document.fullscreenElement || document.webkitFullscreenElement) {
          if (icon) icon.className = "fas fa-compress";
          if (text) text.textContent = "Exit";
          if (floatingIcon) floatingIcon.className = "fas fa-compress";
        } else {
          if (icon) icon.className = "fas fa-expand";
          if (text) text.textContent = "Fullscreen";
          if (floatingIcon) floatingIcon.className = "fas fa-expand";
        }
      }

      // Show rules with better formatting
      function showRules() {
        const rulesText = `ðŸƒ HOW TO PLAY:
â€¢ Match the color OR number of the current card
â€¢ Wild cards can be played anytime
â€¢ Call UNO when you have one card left
â€¢ First to play all cards wins!

ðŸŽ´ ACTION CARDS:
â€¢ Skip âŠ˜ - Opponent loses their turn
â€¢ Reverse â†» - Acts like Skip in 2-player
â€¢ Draw 2 (+2) - Opponent draws 2 cards

ðŸŒˆ WILD CARDS:
â€¢ Wild - Play anytime, pick any color
â€¢ Wild Draw 4 - Opponent draws 4 cards

ðŸ’¡ TIPS:
â€¢ Save action cards for when opponent has few cards
â€¢ Don't forget to call UNO with one card left!`;
        showMessage("ðŸ“– Game Rules", rulesText);
      }

      // Show statistics with better formatting
      function showStats() {
        const winRate =
          gameState.stats.gamesPlayed > 0
            ? Math.round(
                (gameState.stats.gamesWon / gameState.stats.gamesPlayed) * 100,
              )
            : 0;
        const avgTime =
          gameState.stats.gamesPlayed > 0
            ? Math.round(
                gameState.stats.totalTime / gameState.stats.gamesPlayed / 1000,
              )
            : 0;
        const fastestWin =
          gameState.stats.fastestWin === Infinity
            ? "N/A"
            : Math.round(gameState.stats.fastestWin / 1000) + "s";

        // Create HTML content for stats modal
        const messageEl = document.getElementById("gameMessage");
        const titleEl = document.getElementById("messageTitle");
        const textEl = document.getElementById("messageText");

        titleEl.textContent = "ðŸ“Š Your Statistics";
        textEl.innerHTML = `
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-value">${gameState.stats.gamesPlayed}</span>
              <span class="stat-label">Games Played</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${gameState.stats.gamesWon}</span>
              <span class="stat-label">Games Won</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${winRate}%</span>
              <span class="stat-label">Win Rate</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${avgTime}s</span>
              <span class="stat-label">Avg Game Time</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${fastestWin}</span>
              <span class="stat-label">Fastest Win</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${currentStreak}</span>
              <span class="stat-label">Win Streak</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${bestStreak}</span>
              <span class="stat-label">Best Streak</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">${gameState.maxCombo}</span>
              <span class="stat-label">Max Combo</span>
            </div>
          </div>
          <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
            <div style="color: rgba(255,255,255,0.7); font-size: 0.85rem;">
              ðŸƒ Cards Played: ${gameState.cardsPlayed} â€¢ ðŸ“š Words Learned: ${gameState.learnedWords.size}
            </div>
          </div>
        `;

        messageEl.style.display = "flex";
        messageEl.style.flexDirection = "column";
        messageEl.classList.add("show");
      }

      // Save statistics
      function saveStats() {
        localStorage.setItem(
          "gamesPlayed",
          gameState.stats.gamesPlayed.toString(),
        );
        localStorage.setItem("gamesWon", gameState.stats.gamesWon.toString());
        localStorage.setItem("totalTime", gameState.stats.totalTime.toString());
      }

      // Show combo effect
      function showComboEffect(combo) {
        const comboDiv = document.createElement("div");
        comboDiv.className = "combo-indicator";
        comboDiv.innerHTML = `ðŸ”¥ ${combo}x COMBO! ðŸ”¥`;
        document.body.appendChild(comboDiv);

        setTimeout(() => {
          document.body.removeChild(comboDiv);
        }, 2000);
      }

      // Create particle effects - using enhanced version
      function createParticles(element) {
        createEnhancedParticles(element);
      }

      // Show play hints
      function showPlayHints() {
        if (!gameState.showHints || !gameState.playerTurn) return;

        const playableCards = document.querySelectorAll(".card.playable");
        if (playableCards.length === 0) {
          // Show draw hint
          const drawBtn = document.getElementById("drawBtn");
          showHint(drawBtn, "No playable cards! Draw one.");
        } else if (playableCards.length === 1) {
          showHint(playableCards[0], "Only one card to play!");
        }
      }

      // Show hint
      function showHint(element, text) {
        const hint = document.createElement("div");
        hint.className = "hint-overlay";
        hint.textContent = text;
        element.style.position = "relative";
        element.appendChild(hint);

        setTimeout(() => {
          if (hint.parentNode) {
            element.removeChild(hint);
          }
        }, 3000);
      }

      // Achievement system
      function unlockAchievement(key) {
        if (achievements[key].unlocked) return;

        achievements[key].unlocked = true;
        localStorage.setItem(`achievement_${key}`, "true");
        showAchievementNotification(achievements[key]);
      }

      // Show achievement notification
      function showAchievementNotification(achievement) {
        const notification = document.createElement("div");
        notification.className = "achievement-notification";
        notification.innerHTML = `
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-trophy" style="font-size: 1.5rem;"></i>
            <div>
              <div style="font-weight: bold;">Achievement Unlocked!</div>
              <div style="font-size: 0.9rem;">${achievement.name}</div>
              <div style="font-size: 0.8rem; opacity: 0.8;">${achievement.description}</div>
            </div>
          </div>
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 4000);

        playSound("achievement");
      }

      // Settings functions
      function showSettings() {
        document.getElementById("difficultySelect").value = difficultyLevel;
        document.getElementById("soundToggleCheck").checked =
          gameState.soundEnabled;
        document.getElementById("animationsToggleCheck").checked =
          gameState.animationsEnabled;
        document.getElementById("hintsToggleCheck").checked =
          gameState.showHints;
        document.getElementById("settingsModal").classList.add("show");
      }

      function saveSettings() {
        difficultyLevel = document.getElementById("difficultySelect").value;
        gameState.soundEnabled =
          document.getElementById("soundToggleCheck").checked;
        gameState.animationsEnabled = document.getElementById(
          "animationsToggleCheck",
        ).checked;
        gameState.showHints =
          document.getElementById("hintsToggleCheck").checked;

        localStorage.setItem("unodifficulty", difficultyLevel);
        localStorage.setItem("unosound", gameState.soundEnabled.toString());
        localStorage.setItem(
          "unoanimations",
          gameState.animationsEnabled.toString(),
        );
        localStorage.setItem("unohints", gameState.showHints.toString());

        closeSettings();
        updateDisplay();
      }

      function closeSettings() {
        document.getElementById("settingsModal").classList.remove("show");
      }

      // Achievements functions
      function showAchievements() {
        const achievementsList = document.getElementById("achievementsList");
        achievementsList.innerHTML = "";

        Object.entries(achievements).forEach(([key, achievement]) => {
          const achievementDiv = document.createElement("div");
          achievementDiv.className = `achievement-item ${
            achievement.unlocked ? "unlocked" : ""
          }`;

          const icon = achievement.unlocked ? "ðŸ†" : "ðŸ”’";

          achievementDiv.innerHTML = `
            <div class="achievement-icon">${icon}</div>
            <div class="achievement-info">
              <div class="achievement-name">${achievement.name}</div>
              <div class="achievement-desc">${achievement.description}</div>
            </div>
          `;

          achievementsList.appendChild(achievementDiv);
        });

        document.getElementById("achievementsModal").style.display = "flex";
        document.getElementById("achievementsModal").style.flexDirection =
          "column";
        document.getElementById("achievementsModal").classList.add("show");
      }

      function closeAchievements() {
        document.getElementById("achievementsModal").classList.remove("show");
      }

      // Vocabulary Quiz System
      function showVocabularyQuiz() {
        gameState.quiz.score = 0;
        gameState.quiz.totalQuestions = 0;
        generateQuizQuestion();
        document.getElementById("vocabularyQuizModal").classList.add("show");
      }

      function generateQuizQuestion() {
        // Get all words from current difficulty level
        const allWords = [];
        Object.values(vocabularyWords).forEach((colorWords) => {
          colorWords
            .filter(
              (word) =>
                word.level === difficultyLevel ||
                difficultyLevel === "beginner",
            )
            .forEach((word) => allWords.push(word));
        });

        if (allWords.length < 3) return;

        // Pick a random word
        const correctWord =
          allWords[Math.floor(Math.random() * allWords.length)];
        gameState.quiz.currentQuestion = correctWord;

        // Generate wrong options
        const wrongWords = allWords.filter((w) => w.word !== correctWord.word);
        const option1 =
          wrongWords[Math.floor(Math.random() * wrongWords.length)];
        const option2 = wrongWords.filter((w) => w.word !== option1.word)[
          Math.floor(Math.random() * (wrongWords.length - 1))
        ];

        // Randomize answer position
        gameState.quiz.correctAnswer = Math.floor(Math.random() * 3);
        gameState.quiz.options = [];

        for (let i = 0; i < 3; i++) {
          if (i === gameState.quiz.correctAnswer) {
            gameState.quiz.options[i] = correctWord;
          } else {
            gameState.quiz.options[i] =
              i === 0 || (i === 1 && gameState.quiz.correctAnswer !== 0)
                ? option1
                : option2;
          }
        }

        // Update quiz UI
        document.getElementById("quizContent").innerHTML = `
          <div style="font-size: 1.2rem; margin-bottom: 1rem;">What does this word mean?</div>
          <div style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;">${
            correctWord.word
          }</div>
          <div style="color: var(--text-secondary); margin-bottom: 1.5rem;">${
            correctWord.pronunciation
          }</div>
          <div style="margin-bottom: 1rem;">Category: ${
            correctWord.category || "General"
          }</div>
        `;

        document.getElementById("quizOption1").textContent =
          gameState.quiz.options[0].definition;
        document.getElementById("quizOption2").textContent =
          gameState.quiz.options[1].definition;
        document.getElementById("quizOption3").textContent =
          gameState.quiz.options[2].definition;

        updateQuizScore();
      }

      function selectQuizAnswer(optionIndex) {
        gameState.quiz.totalQuestions++;

        if (optionIndex === gameState.quiz.correctAnswer) {
          gameState.quiz.score++;
          showQuizFeedback(true);
          playSound("achievement");

          // Add to learned words
          const word = gameState.quiz.currentQuestion.word;
          if (!gameState.learnedWords.has(word)) {
            gameState.learnedWords.add(word);
            gameState.wordsLearnedToday++;
            updateWordProgress(word, true);
          }
        } else {
          showQuizFeedback(false);
          playSound("lose");
          updateWordProgress(gameState.quiz.currentQuestion.word, false);
        }

        updateQuizScore();

        // Generate next question after delay
        setTimeout(() => {
          if (gameState.quiz.totalQuestions < 10) {
            generateQuizQuestion();
          } else {
            showQuizResults();
          }
        }, 2000);
      }

      function showQuizFeedback(correct) {
        const buttons = document.querySelectorAll(
          "#vocabularyQuizModal button[id^='quizOption']",
        );
        buttons.forEach((btn, index) => {
          if (index === gameState.quiz.correctAnswer) {
            btn.style.background = "#10b981"; // Green for correct
          } else if (!correct && index === gameState.quiz.correctAnswer) {
            btn.style.background = "#ef4444"; // Red for wrong selection
          }
          btn.disabled = true;
        });

        // Reset button styles after delay
        setTimeout(() => {
          buttons.forEach((btn) => {
            btn.style.background = "var(--primary-color)";
            btn.disabled = false;
          });
        }, 2000);
      }

      function updateQuizScore() {
        document.getElementById("quizScore").textContent =
          `Score: ${gameState.quiz.score}/${gameState.quiz.totalQuestions}`;
      }

      function showQuizResults() {
        const percentage = Math.round(
          (gameState.quiz.score / gameState.quiz.totalQuestions) * 100,
        );
        let message = "";

        if (percentage >= 80) {
          message = "ðŸŽ‰ Excellent work! You're mastering these words!";
          updateChallengeProgress("quiz_master"); // Award challenge progress for high score
        } else if (percentage >= 60) {
          message = "ðŸ‘ Good job! Keep practicing to improve.";
        } else {
          message = "ðŸ“š Keep studying! Practice makes perfect.";
        }

        document.getElementById("quizContent").innerHTML = `
          <div style="font-size: 1.5rem; margin-bottom: 1rem;">Quiz Complete!</div>
          <div style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1rem;">${gameState.quiz.score}/${gameState.quiz.totalQuestions}</div>
          <div style="font-size: 1.2rem; margin-bottom: 1rem;">${percentage}%</div>
          <div style="color: var(--text-secondary);">${message}</div>
        `;

        // Hide option buttons
        document
          .querySelectorAll("#vocabularyQuizModal button[id^='quizOption']")
          .forEach((btn) => {
            btn.style.display = "none";
          });

        // Save progress
        localStorage.setItem(
          "learnedWords",
          JSON.stringify([...gameState.learnedWords]),
        );
        localStorage.setItem(
          "wordProgress",
          JSON.stringify(gameState.wordProgress),
        );
      }

      function closeVocabularyQuiz() {
        document.getElementById("vocabularyQuizModal").classList.remove("show");
        // Reset option buttons
        document
          .querySelectorAll("#vocabularyQuizModal button[id^='quizOption']")
          .forEach((btn) => {
            btn.style.display = "inline-block";
          });
      }

      // Word Progress Tracking
      function updateWordProgress(word, correct) {
        if (!gameState.wordProgress[word]) {
          gameState.wordProgress[word] = {
            attempts: 0,
            correct: 0,
            lastSeen: Date.now(),
            streak: 0,
          };
        }

        const progress = gameState.wordProgress[word];
        progress.attempts++;
        progress.lastSeen = Date.now();

        if (correct) {
          progress.correct++;
          progress.streak++;
        } else {
          progress.streak = 0;
        }

        localStorage.setItem(
          "wordProgress",
          JSON.stringify(gameState.wordProgress),
        );
      }

      function showWordProgress() {
        const progressContent = document.getElementById("progressContent");
        let content = `
          <div style="margin-bottom: 1rem;">
            <h3>ðŸ“Š Learning Statistics</h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
              <div style="background: rgba(79, 70, 229, 0.1); padding: 0.8rem; border-radius: 8px;">
                <div style="font-size: 1.2rem; font-weight: bold;">${
                  gameState.learnedWords.size
                }</div>
                <div style="font-size: 0.9rem; color: var(--text-secondary);">Words Learned</div>
              </div>
              <div style="background: rgba(16, 185, 129, 0.1); padding: 0.8rem; border-radius: 8px;">
                <div style="font-size: 1.2rem; font-weight: bold;">${
                  gameState.wordsLearnedToday
                }</div>
                <div style="font-size: 0.9rem; color: var(--text-secondary);">Today's Progress</div>
              </div>
            </div>
          </div>
          <div style="margin-bottom: 1rem;">
            <h3>ðŸŽ¯ Daily Goal: ${gameState.wordsLearnedToday}/${
              gameState.dailyGoal
            }</h3>
            <div style="background: #e5e7eb; border-radius: 10px; overflow: hidden; height: 8px;">
              <div style="background: var(--success-color); height: 100%; width: ${Math.min(
                (gameState.wordsLearnedToday / gameState.dailyGoal) * 100,
                100,
              )}%;"></div>
            </div>
          </div>
        `;

        // Show word mastery levels
        if (Object.keys(gameState.wordProgress).length > 0) {
          content += `<div><h3>ðŸ“š Word Mastery</h3>`;

          Object.entries(gameState.wordProgress)
            .sort(([, a], [, b]) => b.correct - a.correct)
            .slice(0, 10)
            .forEach(([word, progress]) => {
              const accuracy = Math.round(
                (progress.correct / progress.attempts) * 100,
              );
              const masteryLevel =
                progress.streak >= 3
                  ? "ðŸ† Mastered"
                  : progress.streak >= 2
                    ? "â­ Good"
                    : accuracy >= 70
                      ? "ðŸ‘ Learning"
                      : "ðŸ“š Practice";

              content += `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; margin-bottom: 0.5rem; background: rgba(0,0,0,0.05); border-radius: 8px;">
                  <div>
                    <div style="font-weight: bold;">${word}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${progress.correct}/${progress.attempts} correct (${accuracy}%)</div>
                  </div>
                  <div style="font-size: 0.8rem;">${masteryLevel}</div>
                </div>
              `;
            });

          content += `</div>`;
        }

        progressContent.innerHTML = content;
        document.getElementById("wordProgressModal").classList.add("show");
      }

      function closeWordProgress() {
        document.getElementById("wordProgressModal").classList.remove("show");
      }

      // Daily Challenges System
      function generateDailyChallenges() {
        const today = new Date().toDateString();
        if (gameState.dailyChallenges.lastReset !== today) {
          // Generate new challenges for today
          const challenges = [
            {
              id: "win_games",
              title: "Victory Challenge",
              description: "Win 2 games today",
              target: 2,
              progress: 0,
              reward: "3 Hint Power-ups",
              icon: "ðŸ†",
            },
            {
              id: "learn_words",
              title: "Word Master",
              description: "Learn 8 new words today",
              target: 8,
              progress: 0,
              reward: "2 Peek Cards Power-ups",
              icon: "ðŸ“š",
            },
            {
              id: "fast_game",
              title: "Speed Demon",
              description: "Win a game in under 90 seconds",
              target: 1,
              progress: 0,
              reward: "1 Skip Turn Power-up",
              icon: "âš¡",
            },
            {
              id: "quiz_master",
              title: "Quiz Champion",
              description: "Score 80% or higher on vocabulary quiz",
              target: 1,
              progress: 0,
              reward: "1 Extra Time Power-up",
              icon: "ðŸ§ ",
            },
          ];

          gameState.dailyChallenges.current = challenges;
          gameState.dailyChallenges.completed = [];
          gameState.dailyChallenges.lastReset = today;

          localStorage.setItem("dailyChallenges", JSON.stringify(challenges));
          localStorage.setItem("completedChallenges", JSON.stringify([]));
          localStorage.setItem("challengesLastReset", today);
        }
      }

      function updateChallengeProgress(challengeId, increment = 1) {
        const challenge = gameState.dailyChallenges.current.find(
          (c) => c.id === challengeId,
        );
        if (
          challenge &&
          !gameState.dailyChallenges.completed.includes(challengeId)
        ) {
          challenge.progress = Math.min(
            challenge.progress + increment,
            challenge.target,
          );

          if (challenge.progress >= challenge.target) {
            completeDailyChallenge(challengeId);
          }

          localStorage.setItem(
            "dailyChallenges",
            JSON.stringify(gameState.dailyChallenges.current),
          );
        }
      }

      function completeDailyChallenge(challengeId) {
        if (gameState.dailyChallenges.completed.includes(challengeId)) return;

        gameState.dailyChallenges.completed.push(challengeId);
        const challenge = gameState.dailyChallenges.current.find(
          (c) => c.id === challengeId,
        );

        if (challenge) {
          // Award power-ups based on challenge
          switch (challengeId) {
            case "win_games":
              gameState.powerUps.hints += 3;
              break;
            case "learn_words":
              gameState.powerUps.peekCards += 2;
              break;
            case "fast_game":
              gameState.powerUps.skipTurn += 1;
              break;
            case "quiz_master":
              gameState.powerUps.extraTime += 1;
              break;
          }

          savePowerUps();
          showChallengeCompleteNotification(challenge);
        }

        localStorage.setItem(
          "completedChallenges",
          JSON.stringify(gameState.dailyChallenges.completed),
        );
      }

      function showChallengeCompleteNotification(challenge) {
        const notification = document.createElement("div");
        notification.className = "achievement-notification";
        notification.style.background =
          "linear-gradient(135deg, #10b981, #34d399)";
        notification.innerHTML = `
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div style="font-size: 1.5rem;">${challenge.icon}</div>
            <div>
              <div style="font-weight: bold; color: white;">Challenge Complete!</div>
              <div style="font-size: 0.9rem; color: rgba(255,255,255,0.9);">${challenge.title}</div>
              <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Reward: ${challenge.reward}</div>
            </div>
          </div>
        `;

        document.body.appendChild(notification);
        playSound("achievement");

        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 4000);
      }

      function showDailyChallenges() {
        generateDailyChallenges();
        const challengesContent = document.getElementById("challengesContent");

        let content = `
          <div style="margin-bottom: 1rem;">
            <h3>Today's Challenges</h3>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">Complete challenges to earn power-ups!</p>
          </div>
        `;

        gameState.dailyChallenges.current.forEach((challenge) => {
          const isCompleted = gameState.dailyChallenges.completed.includes(
            challenge.id,
          );
          const progressPercent = (challenge.progress / challenge.target) * 100;

          content += `
            <div style="margin-bottom: 1rem; padding: 1rem; border-radius: 10px; background: ${
              isCompleted ? "rgba(16, 185, 129, 0.1)" : "rgba(79, 70, 229, 0.1)"
            };">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <span style="font-size: 1.2rem;">${challenge.icon}</span>
                <div style="flex: 1;">
                  <div style="font-weight: bold; ${
                    isCompleted ? "color: var(--success-color);" : ""
                  }">${challenge.title} ${isCompleted ? "âœ“" : ""}</div>
                  <div style="font-size: 0.9rem; color: var(--text-secondary);">${
                    challenge.description
                  }</div>
                </div>
              </div>
              <div style="margin-bottom: 0.5rem;">
                <div style="background: #e5e7eb; border-radius: 10px; overflow: hidden; height: 8px;">
                  <div style="background: ${
                    isCompleted
                      ? "var(--success-color)"
                      : "var(--primary-color)"
                  }; height: 100%; width: ${progressPercent}%; transition: width 0.3s ease;"></div>
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.2rem;">
                  Progress: ${challenge.progress}/${challenge.target}
                </div>
              </div>
              <div style="font-size: 0.8rem; color: var(--warning-color);">
                Reward: ${challenge.reward}
              </div>
            </div>
          `;
        });

        challengesContent.innerHTML = content;
        document.getElementById("dailyChallengesModal").classList.add("show");
      }

      function closeDailyChallenges() {
        document
          .getElementById("dailyChallengesModal")
          .classList.remove("show");
      }

      // Power-Ups System
      function showPowerUps() {
        const powerUpsContent = document.getElementById("powerUpsContent");

        const powerUpsList = [
          {
            name: "Smart Hints",
            description: "Get hints about which cards to play",
            count: gameState.powerUps.hints,
            icon: "ðŸ’¡",
            action: "useHintPowerUp",
          },
          {
            name: "Skip Turn",
            description: "Force computer to skip their turn",
            count: gameState.powerUps.skipTurn,
            icon: "â­ï¸",
            action: "useSkipTurnPowerUp",
          },
          {
            name: "Peek Cards",
            description: "See computer's cards for 5 seconds",
            count: gameState.powerUps.peekCards,
            icon: "ðŸ‘ï¸",
            action: "usePeekCardsPowerUp",
          },
          {
            name: "Extra Time",
            description: "Add 30 seconds to thinking time",
            count: gameState.powerUps.extraTime,
            icon: "â°",
            action: "useExtraTimePowerUp",
          },
        ];

        let content = `
          <div style="margin-bottom: 1rem;">
            <h3>Available Power-Ups</h3>
            <p style="color: var(--text-secondary); font-size: 0.9rem;">Use power-ups strategically to gain advantages!</p>
          </div>
        `;

        powerUpsList.forEach((powerUp) => {
          content += `
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; margin-bottom: 0.5rem; background: rgba(79, 70, 229, 0.1); border-radius: 10px;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.5rem;">${powerUp.icon}</span>
                <div>
                  <div style="font-weight: bold;">${powerUp.name}</div>
                  <div style="font-size: 0.9rem; color: var(--text-secondary);">${
                    powerUp.description
                  }</div>
                </div>
              </div>
              <div style="text-align: center;">
                <div style="background: var(--primary-color); color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem; margin-bottom: 0.3rem;">
                  ${powerUp.count}
                </div>
                <button class="message-btn" 
                        onclick="${powerUp.action}()" 
                        ${
                          powerUp.count === 0 ||
                          !gameState.playerTurn ||
                          gameState.gameOver
                            ? "disabled"
                            : ""
                        }
                        style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">
                  Use
                </button>
              </div>
            </div>
          `;
        });

        powerUpsContent.innerHTML = content;
        document.getElementById("powerUpsModal").classList.add("show");
      }

      function closePowerUps() {
        document.getElementById("powerUpsModal").classList.remove("show");
      }

      function savePowerUps() {
        localStorage.setItem(
          "powerUpHints",
          gameState.powerUps.hints.toString(),
        );
        localStorage.setItem(
          "powerUpSkipTurn",
          gameState.powerUps.skipTurn.toString(),
        );
        localStorage.setItem(
          "powerUpPeekCards",
          gameState.powerUps.peekCards.toString(),
        );
        localStorage.setItem(
          "powerUpExtraTime",
          gameState.powerUps.extraTime.toString(),
        );
      }

      // Power-up functions
      function useHintPowerUp() {
        if (
          gameState.powerUps.hints <= 0 ||
          !gameState.playerTurn ||
          gameState.gameOver
        )
          return;

        gameState.powerUps.hints--;
        savePowerUps();
        closePowerUps();

        // Highlight best playable cards
        const playableCards = gameState.playerHand.filter((card) =>
          isCardPlayable(card),
        );
        if (playableCards.length > 0) {
          // Find the best card to suggest
          const bestCard =
            playableCards.find((card) => card.type === "action") ||
            playableCards.find((card) => card.type === "wild") ||
            playableCards[0];

          const cardIndex = gameState.playerHand.indexOf(bestCard);
          const cardElement = document.querySelector(
            `#playerHand .card:nth-child(${cardIndex + 1})`,
          );

          if (cardElement) {
            cardElement.style.border = "3px solid gold";
            cardElement.style.boxShadow = "0 0 15px gold";

            setTimeout(() => {
              cardElement.style.border = "";
              cardElement.style.boxShadow = "";
            }, 5000);
          }

          showMessage(
            "ðŸ’¡ Power-Up Used!",
            `The highlighted card is your best play: ${bestCard.color} ${bestCard.value}`,
          );
        }

        playSound("achievement");
      }

      function useSkipTurnPowerUp() {
        if (
          gameState.powerUps.skipTurn <= 0 ||
          gameState.playerTurn ||
          gameState.gameOver
        )
          return;

        gameState.powerUps.skipTurn--;
        savePowerUps();
        closePowerUps();

        // Skip computer's next turn
        gameState.playerTurn = true;
        updateDisplay();
        showMessage("â­ï¸ Power-Up Used!", "Computer's turn has been skipped!");
        playSound("achievement");
      }

      function usePeekCardsPowerUp() {
        if (
          gameState.powerUps.peekCards <= 0 ||
          !gameState.playerTurn ||
          gameState.gameOver
        )
          return;

        gameState.powerUps.peekCards--;
        savePowerUps();
        closePowerUps();

        // Show computer cards temporarily
        const computerHand = document.getElementById("computerHand");
        const originalContent = computerHand.innerHTML;

        // Show actual cards
        computerHand.innerHTML = "";
        gameState.computerHand.forEach((card, index) => {
          const cardElement = createCardElement(card, index, true);
          cardElement.style.transform = "scale(0.8)";
          computerHand.appendChild(cardElement);
        });

        showMessage(
          "ðŸ‘ï¸ Power-Up Used!",
          "You can see the computer's cards for 5 seconds!",
        );
        playSound("achievement");

        // Restore after 5 seconds
        setTimeout(() => {
          computerHand.innerHTML = originalContent;
        }, 5000);
      }

      function useExtraTimePowerUp() {
        if (gameState.powerUps.extraTime <= 0) return;

        gameState.powerUps.extraTime--;
        savePowerUps();
        closePowerUps();

        // Add 30 seconds to game time (visual effect)
        showMessage(
          "â° Power-Up Used!",
          "You have extra thinking time for your moves!",
        );
        playSound("achievement");
      }

      // Enhanced confetti celebration
      function createCelebration() {
        const celebration = document.createElement("div");
        celebration.className = "celebration";
        document.body.appendChild(celebration);

        const colors = [
          "#ff6b6b",
          "#4ecdc4",
          "#45b7d1",
          "#f9ca24",
          "#6c5ce7",
          "#00b894",
          "#fd79a8",
        ];

        for (let i = 0; i < 100; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "vw";
          confetti.style.background =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 2 + "s";
          confetti.style.animationDuration = Math.random() * 2 + 2 + "s";
          confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
          confetti.style.width = Math.random() * 10 + 5 + "px";
          confetti.style.height = Math.random() * 10 + 5 + "px";
          confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "0";
          celebration.appendChild(confetti);
        }

        setTimeout(() => {
          celebration.remove();
        }, 5000);
      }

      // Enhanced particle effects for card play
      function createEnhancedParticles(element) {
        if (!element || !gameState.animationsEnabled) return;

        const rect = element.getBoundingClientRect();
        const colors = ["#ff6b6b", "#4ecdc4", "#45b7d1", "#f9ca24"];

        for (let i = 0; i < 12; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.cssText = `
            position: fixed;
            left: ${rect.left + rect.width / 2}px;
            top: ${rect.top + rect.height / 2}px;
            width: ${Math.random() * 8 + 4}px;
            height: ${Math.random() * 8 + 4}px;
            background: ${colors[Math.floor(Math.random() * colors.length)]};
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            --tx: ${(Math.random() - 0.5) * 150}px;
            --ty: ${(Math.random() - 0.5) * 150}px;
          `;
          document.body.appendChild(particle);

          setTimeout(() => particle.remove(), 1000);
        }
      }

      // Card dealing animation
      function dealCardsWithAnimation() {
        const playerCards = document.querySelectorAll("#playerHand .card");
        playerCards.forEach((card, index) => {
          card.classList.add("dealing");
          card.style.animationDelay = `${index * 0.1}s`;
        });

        setTimeout(() => {
          playerCards.forEach((card) => card.classList.remove("dealing"));
        }, 1500);
      }

      // Theme toggle functionality
      function initThemeToggle() {
        const themeToggle = document.getElementById("themeToggle");
        if (themeToggle) {
          // Check saved theme preference
          const savedTheme = localStorage.getItem("theme");
          if (savedTheme === "dark") {
            document.body.classList.add("dark-mode");
            themeToggle.querySelector("i").className = "fas fa-sun";
          }

          themeToggle.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
            const isDark = document.body.classList.contains("dark-mode");
            localStorage.setItem("theme", isDark ? "dark" : "light");
            themeToggle.querySelector("i").className = isDark
              ? "fas fa-sun"
              : "fas fa-moon";
          });
        }
      }

      // Initialize game when page loads
      window.addEventListener("load", () => {
        // Load saved settings
        gameState.soundEnabled = localStorage.getItem("unosound") !== "false";
        gameState.animationsEnabled =
          localStorage.getItem("unoanimations") !== "false";
        gameState.showHints = localStorage.getItem("unohints") !== "false";

        // Update sound toggle icon
        const icon = document.querySelector("#soundToggle i");
        icon.className = gameState.soundEnabled
          ? "fas fa-volume-up"
          : "fas fa-volume-mute";

        // Initialize theme toggle
        initThemeToggle();

        // Initialize daily challenges
        generateDailyChallenges();

        // Initialize today's word count
        const today = new Date().toDateString();
        const lastPlayDate = localStorage.getItem("lastPlayDate");
        if (lastPlayDate !== today) {
          gameState.wordsLearnedToday = 0;
          localStorage.setItem("lastPlayDate", today);
        } else {
          // Count words learned today from progress
          gameState.wordsLearnedToday = Object.values(
            gameState.wordProgress,
          ).filter((progress) => {
            const lastSeen = new Date(progress.lastSeen);
            return lastSeen.toDateString() === today && progress.correct > 0;
          }).length;
        }

        initGame();

        // Add dealing animation after init
        setTimeout(dealCardsWithAnimation, 100);

        // Initialize touch support for audio
        document.addEventListener(
          "touchstart",
          function initAudio() {
            if (audioContext && audioContext.state === "suspended") {
              audioContext.resume();
            }
            document.removeEventListener("touchstart", initAudio);
          },
          { once: true, passive: true },
        );

        // Handle visibility change to pause/resume
        document.addEventListener("visibilitychange", () => {
          if (document.hidden) {
            // Pause game timer if needed
          } else {
            // Resume audio context
            if (audioContext && audioContext.state === "suspended") {
              audioContext.resume();
            }
          }
        });

        // Prevent zoom on double-tap for iOS
        let lastTouchEnd = 0;
        document.addEventListener(
          "touchend",
          (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
              e.preventDefault();
            }
            lastTouchEnd = now;
          },
          { passive: false },
        );
      });

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          if (gameState.playerTurn && !gameState.gameOver) {
            drawCard();
          }
        } else if (e.key === "u" || e.key === "U") {
          if (gameState.playerHand.length === 1) {
            callUno();
          }
        } else if (e.key === "n" || e.key === "N") {
          newGame();
        }
      });

      // Prevent context menu on cards
      document.addEventListener("contextmenu", (e) => {
        if (e.target.classList.contains("card")) {
          e.preventDefault();
        }
      });
    </script>

    <script src="../js/game-ads.js"></script>

    <!-- Single Bottom Ad - Clean placement below game -->
    <div
      class="ad-wrapper bottom-ad"
      style="
        margin: 2rem auto 1rem;
        max-width: 728px;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 12px;
        padding: 1rem;
      "
    >
      <div
        style="
          text-align: center;
          font-size: 0.7rem;
          color: rgba(255, 255, 255, 0.5);
          margin-bottom: 0.5rem;
        "
      >
        Advertisement
      </div>
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-format="horizontal"
        data-ad-client="ca-pub-2456627863532019"
        data-ad-slot="2184713192"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <!-- Footer Section -->
    <!-- Footer Ad -->
    <div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-2456627863532019"
           data-ad-slot="3089435711"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    <footer class="game-footer">
      <style>
        .game-footer {
          background: linear-gradient(
            135deg,
            rgba(30, 41, 59, 0.95),
            rgba(15, 23, 42, 0.98)
          );
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          padding: 1.5rem 1rem;
          text-align: center;
          color: rgba(255, 255, 255, 0.8);
          margin-top: 1.5rem;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          position: relative;
          z-index: 1;
        }
        .game-footer .footer-links {
          display: flex;
          justify-content: center;
          flex-wrap: wrap;
          gap: 1rem;
          margin-bottom: 0.75rem;
        }
        .game-footer .footer-links a {
          color: #46bbe5;
          text-decoration: none;
          transition:
            color 0.3s ease,
            transform 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 0.3rem;
          font-size: 0.9rem;
          padding: 0.25rem;
          min-height: 44px;
        }
        .game-footer .footer-links a:hover {
          color: #10b981;
          transform: translateY(-2px);
        }
        .game-footer .footer-copyright {
          font-size: 0.75rem;
          color: rgba(255, 255, 255, 0.4);
          margin-top: 0.5rem;
        }
        .game-footer .footer-tagline {
          font-size: 0.85rem;
          color: rgba(255, 255, 255, 0.6);
          margin-top: 0.4rem;
        }
        @media (max-width: 768px) {
          .game-footer {
            padding: 1rem 0.75rem;
          }
          .game-footer .footer-links {
            gap: 0.5rem;
          }
          .game-footer .footer-links a {
            font-size: 0.8rem;
          }
        }
        /* Safe area padding for mobile */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
          .game-footer {
            padding-bottom: calc(1rem + env(safe-area-inset-bottom));
          }
        }
      </style>
      <div style="max-width: 1200px; margin: 0 auto">
        <div class="footer-links">
          <a href="../index.html"><i class="fas fa-home"></i> Home</a>
          <a href="games.html"><i class="fas fa-gamepad"></i> More Games</a>
          <a href="../english/grammar.html"
            ><i class="fas fa-book"></i> Learn English</a
          >
          <a href="../privacy.html"
            ><i class="fas fa-shield-alt"></i> Privacy</a
          >
          <a href="../terms.html"><i class="fas fa-file-contract"></i> Terms</a>
        </div>
        <p class="footer-tagline">ðŸŽ® Learn English while having fun! ðŸ“š</p>
        <p class="footer-copyright">
          Â© 2024-2026 ESL Fun Online. All rights reserved.
        </p>
      </div>
    </footer>

    <!-- Google AdSense -->
  </body>
</html>
